<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="技术博客、日记记录">
<meta property="og:type" content="website">
<meta property="og:title" content="Wellread">
<meta property="og:url" content="http://www.zhuohc.com/page/3/index.html">
<meta property="og:site_name" content="Wellread">
<meta property="og:description" content="技术博客、日记记录">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wellread">
<meta name="twitter:description" content="技术博客、日记记录">





  
  
  <link rel="canonical" href="http://www.zhuohc.com/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>Wellread</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wellread</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">饱读诗书</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/11/22/最新在linux-ubuntu中安装qq的办法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/22/最新在linux-ubuntu中安装qq的办法/" class="post-title-link" itemprop="url">最新在linux/ubuntu中安装qq的办法</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-22 09:49:34" itemprop="dateCreated datePublished" datetime="2017-11-22T09:49:34+08:00">2017-11-22</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/办公/" itemprop="url" rel="index"><span itemprop="name">办公</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/办公/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通过docker镜像文件的方式安装qq 1, 首先需要在主机上安装docker 2, 下载镜像文件 <a href="https://hub.docker.com/r/bestwu/qq/" target="_blank" rel="noopener">https://hub.docker.com/r/bestwu/qq/</a></p>
<pre><code>sudo docker pull bestwu/qq # 速度慢可以换镜像源</code></pre><p>3, 编辑启动脚本</p>
<pre><code>vim qq.sh
sudo docker run -d --name qq --device /dev/snd --net=host \
-v /tmp/.X11-unix:/tmp/.X11-unix \
-v /home/YOURUSERNAME/TencentFiles:/TencentFiles \ # 此处数据卷的目录填写自己的目录
-e DISPLAY=unix$DISPLAY \
-e XMODIFIERS=@im=fcitx \
-e QT_IM_MODULE=fcitx \
-e GTK_IM_MODULE=fcitx \
-e AUDIO_GID=63 \
-e GID=1000 \
-e UID=1000 \
bestwu/qq:latest # 此处版本自行选择，作者提供了im (QQ) light,latest (QQLight) office (TIM)三个版本</code></pre><p>4, 启动脚本</p>
<pre><code>./qq.sh</code></pre><p>5, 感谢作者提供的镜像，本镜像基于深度操作系统.</p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/11/20/ubuntu16.04安装及使用docker(一)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/20/ubuntu16.04安装及使用docker(一)/" class="post-title-link" itemprop="url">ubuntu16.04安装及使用docker(一)</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-20 11:45:42" itemprop="dateCreated datePublished" datetime="2017-11-20T11:45:42+08:00">2017-11-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="删除旧版本"><a href="#删除旧版本" class="headerlink" title="删除旧版本"></a>删除旧版本</h3><pre><code>sudo apt-get remove docker docker-engine docker.io</code></pre><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code>$ sudo apt-get update
# 安装依赖
$ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common
# 添加官方key
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# 查找key
$ sudo apt-key fingerprint 0EBFCD88
pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22
# 获取资源
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;
# 查找合适的版本
$ apt-cache madison docker-ce
docker-ce | 17.09.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages
# 安装
$ sudo apt-get install docker-ce=&lt;VERSION&gt;
# 打印安装结果
$ sudo docker version
Client:
 Version:      17.09.0-ce
 API version:  1.32
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:42:18 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.09.0-ce
 API version:  1.32 (minimum version 1.12)
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:40:56 2017
 OS/Arch:      linux/amd64
 Experimental: false</code></pre><h3 id="将用户加入docker用户组，这样不需要输入sudo"><a href="#将用户加入docker用户组，这样不需要输入sudo" class="headerlink" title="将用户加入docker用户组，这样不需要输入sudo"></a>将用户加入docker用户组，这样不需要输入sudo</h3><pre><code>1. sudo cat /etc/group | grep docker 
2. 如果不存在docker组，可以添加sudo groupadd docker 
3. 添加当前用户到docker组，sudo usermod -aG  docker $USER 
4. 重启docker服务,sudo systemctl restart docker 
5. 如果权限不够，sudo chmod a+rw /var/run/docker.sock　
6. sudo chown -R $USER ~/.docker</code></pre><h3 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h3><pre><code>$ sudo  docker run hello-world
Unable to find image &apos;hello-world:latest&apos; locally

latest: Pulling from library/hello-world
9a0669468bf7: Pull complete
Digest: sha256:0e06ef5e1945a718b02a8c319e15bae44f47039005530bc617a5d071190ed3fc
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://cloud.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/engine/userguide/</code></pre><h3 id="更换镜像源"><a href="#更换镜像源" class="headerlink" title="更换镜像源"></a>更换镜像源</h3><pre><code># 可以修改 /etc/docker/daemon.json 文件并添加上 registry-mirrors 键值,没有就创建一个

{
  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]
}</code></pre><h3 id="安装ctop查看容器状态"><a href="#安装ctop查看容器状态" class="headerlink" title="安装ctop查看容器状态"></a>安装ctop查看容器状态</h3><pre><code># https://github.com/bcicen/ctop
$ sudo wget https://github.com/bcicen/ctop/releases/download/v0.6.1/ctop-0.6.1-linux-amd64 -O /usr/local/bin/ctop
$ sudo chmod +x /usr/local/bin/ctop</code></pre><h3 id="第一个实例"><a href="#第一个实例" class="headerlink" title="第一个实例"></a>第一个实例</h3><pre><code># 第一次使用会下载debian的镜像文件
$ sudo docker run debian echo &apos;hello world&apos;
&gt; Unable to find image &apos;debian&apos; locally
&gt; ......


# -i -t 表示进行交互会话
$ sudo docker run -i -t debian /user/bash
root@622ac5689680:/#  echo &apos;hello world&apos;
&gt; hello world
root@622ac5689680:/# exit
&gt; exit


# 基本命令
$ sudo docker run -h container -i -t debian /bin/bash #-h表示主机名称
$ sudo docker ps  # 查看当前运行的主机
$ sudo docker ps -a # 查看全部的主机
$sudo docker events  # 查看守护进程
$ sudo docker inspect HOST_NAME 　# 查看HOST_NAME的信息
$ sudo docker port HOST_NAME # 查看端口映射信息
$ sudo docker diff HOST_NAME　# 查看更改的信息
$ sudo docker logs HOST_NAME   # 打印log信息
$ sudo docker rm HOST_NAME  # 删除
$ sudo docker pull redis  # 拉取镜像
$ sudo docker create redis # 创建容器
$ sudo docker start zen_brown # 开启容器（kitematic是绿色波浪线）
$ sudo docker stop zen_brown # 停止容器（kitematic是灰色直线）
$ sudo docker pause zen_brown  # 暂停容器kitematic是灰色波浪线）
$ sudo docker commit zen_brown # 将容器变成镜像
$ sudo docker run redis /bin/bash
$ sudo docker attach zen_brown # 查看容器内进程
$ sudo docker cp # 在容器和主机之间复制内容
$ sudo docker exec # 在容器中运行命令
$ sudo docker kill # 容器立即退出</code></pre><h3 id="创建dockerfile镜像"><a href="#创建dockerfile镜像" class="headerlink" title="创建dockerfile镜像"></a>创建dockerfile镜像</h3><pre><code># 创建项目
$ mkdir cowsay
$ cd cowsay
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ :wq
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile /usr/games/cowsay &apos;Moo&apos;


# 使用entrypoint指令
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ ENTRYPOINTER [&quot;/usr/games/cowsay&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile  &apos;Moo&apos;


# 使用脚本解决entrypoint
$ vim entrypoint.sh
~ #! /bin/bash
~ if [ $# -eq 0 ]; then
~      /usr/games/fortune | /usr/games/cowsay
~  else
~     /usr/games/cowsay &quot;$@&quot;
~   fi
~ :wq
$ chmod +x entrypoint.sh
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile &apos;Moo&apos;</code></pre><h3 id="使用在线仓库"><a href="#使用在线仓库" class="headerlink" title="使用在线仓库"></a>使用在线仓库</h3><p>在线注册地址：　<a href="https://cloud.docker.com" target="_blank" rel="noopener">https://cloud.docker.com</a></p>
<pre><code># 登陆
$ sudo docker login
$ username:
$ password:
# 填写作者信息
$ vim Dockerfile
~ FROM debian:wheezy
~ MAINTAINER username &lt;username@mail.com&gt;
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t username/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run username/cowsay-dockerfile  &apos;Moo&apos;
# 上传
$ sudo docker push </code></pre><h3 id="容器连接"><a href="#容器连接" class="headerlink" title="容器连接"></a>容器连接</h3><pre><code>$ sudo docker run --name myredis -d redis # -d表示后台运行
~ a1696406326aaaa6c28931e886b8dd664d191b083de4aed464d584b4720d57b1
$ docker run --rm -it --link myredis:redis redis /bin/bash
&gt; root@9c914447f5e1:/data# redis-cli -h redis -p 6379
&gt; redis:6379&gt; ping
&gt; PONG
&gt; redis:6379&gt; set &quot;abc&quot; 123
&gt; OK
&gt; redis:6379&gt; get &quot;abc&quot;
&gt; &quot;123&quot;
&gt; redis:6379&gt; exit
&gt; root@9c914447f5e1:/data# exit
&gt; exit</code></pre><h3 id="容器的备份"><a href="#容器的备份" class="headerlink" title="容器的备份"></a>容器的备份</h3><pre><code># 查看所有的容器
$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
a1696406326a        redis               &quot;docker-entrypoint...&quot;   13 minutes ago      Up 13 minutes       6379/tcp            myredis
# 备份指定的id
$ docker commit -p a1696406326a redis-backup
# 查看镜像
$ docker images
REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE
redis-backup                 latest              fb9d896b3a39        11 seconds ago      107MB
# 上传镜像(docker login &amp;&amp; docker push)
# 或者打包
$ docker save -o ./redis-backup.tar redis-backup
# 恢复容器
$ docker pull ****
# 或者使用包
$ docker load -i ./redis-backup.tar</code></pre><h3 id="让docker容器连接互联网"><a href="#让docker容器连接互联网" class="headerlink" title="让docker容器连接互联网"></a>让docker容器连接互联网</h3><pre><code># -p 8000:80 表示将主机的8000端口转发至容器的80端口
$ docker run -d -p 8000:80 nginx 

# 容器互联
$ docker run -d --name myredis redis
$ docker run --link myredis:redis debian env  # --link 目标容器:目标容器在主容器内的简称
~ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
~ HOSTNAME=69df45e6f92d
~ REDIS_PORT=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP_ADDR=172.17.0.2
~ REDIS_PORT_6379_TCP_PORT=6379
~ REDIS_PORT_6379_TCP_PROTO=tcp
~ REDIS_NAME=/stupefied_chandrasekhar/redis
~ REDIS_ENV_GOSU_VERSION=1.10
~ REDIS_ENV_REDIS_VERSION=4.0.2
~ REDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-4.0.2.tar.gz
~ REDIS_ENV_REDIS_DOWNLOAD_SHA=b1a0915dbc91b979d06df1977fe594c3fa9b189f1f3d38743a2948c9f7634813
~ HOME=/root</code></pre><h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><pre><code>#  -v指定数据卷
$ docker run -it --name container-test -h container -v /ddata debian /bin/bash
# 查看数据卷在本机的位置
$ docker inspect -f { {.Mounts}} container-test  
[{volume 4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9 /var/lib/docker/volumes/4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9/_data /ddata local  true }]
# 可以在本机中添加文件并在容器中查看修改结果


### 在dockerfile中设置数据卷
FROM debian:wheezy
RUN useradd foo
# VOLUME /ddata # 此处添加无效果，因为touch chown是在一个临时容器内的数据卷中执行的
RUN touch /data/x
RUN CHOWN -R foo:foo /data
# VOLUME /ddata # 此处添加可以


# docker run -v 指定到特定数据卷
$ docker run -v /home/adrian/data:./data debian ls /data


# 数据容器
$ docker run --name dbdata postgres echo &apos;data-only container for postage&apos; # 创建一个postgreSQL的容器
# 使用--volumes-from参数，使其他容器也可以使用这个数据卷
$ docker run -d --volumes-from dbdata --name db1 postgres</code></pre><h3 id="如何在开发中使用docker-以python-flask为例"><a href="#如何在开发中使用docker-以python-flask为例" class="headerlink" title="如何在开发中使用docker,以python flask为例"></a>如何在开发中使用docker,以python flask为例</h3><pre><code># 创建项目
$ tree identidock
.
├── app
│   └── identidock.py
└── Dockerfile


# 编辑flask文件
$ vim app/identidock.py
from flask import Flask
app = Flask(__name__)

@app.route(&apos;/&apos;)
def hello_world():
    return &apos;hello world&apos;

if __name__ == &apos;__main__&apos;:
    app.run(debug=True, host=&apos;0.0.0.0&apos;)


# 编辑dockerfile文件
$ vim Dockerfile
FROM python:3.4

RUN pip install Flask==0.10.1
WORKDIR /app
COPY app /app
CMD [&quot;python&quot;, &quot;identidock.py&quot;]


# 创建镜像并使用容器
$ docker build -t identidock .
...
$ docker run -d -p 5000:5000 identidock # 后台运行并将主机的5000端口转发到docker
$ curl localhost:5000
~ hello world

# 将开发的代码目录挂载到docker上，这样就不必每次更改代码都需要重新bulid一次．
$ docker run -d -p 5000:5000 -v &quot;$PWD&quot;/app:/app identidock  # -v &quot;$PWD&quot;/app:/app把位于主机的./app目录挂载到容器内，覆盖容器/app目录下的内容
# 可以修改app目录下的文件查看改动情况

# 以wsgi服务器运行flask并且修改设置用户
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi # 创建用户组和用户
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app

EXPOSE 9090 9191  # 声明主机和其他容器可以访问的端口号
USER uwsgi #使用用户运行以下代码，默认docker是以root用户运行的，不安全
CMD [&quot;uwsgi&quot;, &quot;--http&quot;, &quot;0.0.0.0:9090&quot;, &quot;--wsgi-file&quot;, &quot;/app/identidock.py&quot;, &quot;--callable&quot;, &quot;app&quot;, &quot;--stats&quot;, &quot;0.0.0.0:9191&quot;]</code></pre><h3 id="使用配置文件配置开发环境和生产环境"><a href="#使用配置文件配置开发环境和生产环境" class="headerlink" title="使用配置文件配置开发环境和生产环境"></a>使用配置文件配置开发环境和生产环境</h3><pre><code># 创建脚本文件cmd.sh
$ tree
.
├── app
│   └── identidock.py
├── cmd.sh
└── Dockerfile

$ vim cmd.sh
#! /bin/bash
set -e

if [ &quot;$ENV&quot; = &apos;DEV&apos; ]; then
  echo &quot;Running Development Server&quot;
  exec python &quot;identidock.py&quot;
else
  echo &quot;Running Production Server&quot;
  exec uwsgi --http 0.0.0.0:9090 --wsgi-file /app/identidock.py --callable app --stats 0.0.0.0:9191
fi

$ chmod +x cmd.sh
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app
COPY cmd.sh /

EXPOSE 9090 9191
USER uwsgi
CMD [&quot;/cmd.sh&quot;]

$ docker build -t identidock .
$ docker run -e &quot;ENV=DEV&quot; -p 5000:5000 identidock # 开发环境
$ docker run -d -P identidock</code></pre><h3 id="使用compose自动化安装创建运行docker环境"><a href="#使用compose自动化安装创建运行docker环境" class="headerlink" title="使用compose自动化安装创建运行docker环境"></a>使用compose自动化安装创建运行docker环境</h3><pre><code># 安装环境
# https://docs.docker.com/compose/install/
$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ docker-compose --version


# 配置文件
tree
.
├── app
│   └── identidock.py
├── cmd.sh
├── docker-compose.yml
└── Dockerfile
# 编辑docker-compose文件
$ vim docker-compose.yml
identidock:
  build: .
  ports:
    - &quot;5000:5000&quot;
  environment:
    ENV: DEV
  volumes:
    - ./app:/app
~                    


# 使用方法
$ docker-compose up # 如果有镜像则直接运行，如果没有镜像则先build
$ docker-compose build # 重新构建镜像
$ docker-compose ps 获取由compose管理的容器状态
$ docker-compose logs 输出日志
$ docker-stop 停止容器，但不会删除他们</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/11/08/linux命令记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/08/linux命令记录/" class="post-title-link" itemprop="url">linux命令记录</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-08 14:41:40" itemprop="dateCreated datePublished" datetime="2017-11-08T14:41:40+08:00">2017-11-08</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="查看文件夹大小"><a href="#查看文件夹大小" class="headerlink" title="查看文件夹大小"></a>查看文件夹大小</h3><pre><code>du -h your_path --max-depth=1</code></pre><h4 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h4><blockquote>
<p>-a或-all 为每个指定文件显示磁盘使用情况，或者为目录中每个文件显示各自磁盘使用情况。 -b或-bytes 显示目录或文件大小时，以byte为单位。 -c或–total 除了显示目录或文件的大小外，同时也显示所有目录或文件的总和。 -D或–dereference-args 显示指定符号连接的源文件大小。 -h或–human-readable 以K，M，G为单位，提高信息的可读性。 -H或–si 与-h参数相同，但是K，M，G是以1000为换算单位,而不是以1024为换算单位。 -k或–kilobytes 以1024 bytes为单位。 -l或–count-links 重复计算硬件连接的文件。 -L&lt;符号连接&gt;或–dereference&lt;符号连接&gt; 显示选项中所指定符号连接的源文件大小。 -m或–megabytes 以1MB为单位。 -s或–summarize 仅显示总计，即当前目录的大小。 -S或–separate-dirs 显示每个目录的大小时，并不含其子目录的大小。 -x或–one-file-xystem 以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。 -X&lt;文件&gt;或–exclude-from=&lt;文件&gt; 在&lt;文件&gt;指定目录或文件。 –exclude=&lt;目录或文件&gt; 略过指定的目录或文件。 –max-depth=&lt;目录层数&gt; 超过指定层数的目录后，予以忽略。 –help 显示帮助。 –version 显示版本信息</p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/11/07/ubuntu本地配置SSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/07/ubuntu本地配置SSL/" class="post-title-link" itemprop="url">ubuntu本地配置SSL</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-07 11:25:08" itemprop="dateCreated datePublished" datetime="2017-11-07T11:25:08+08:00">2017-11-07</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code># 安装相关模块
sudo a2enmod ssl   //启用ssl模块
sudo apt-get install openssl  //安装openssl


# 创建证书
openssl genrsa -des3 -out server.key 1024  //创建CA签名(不使用密码去除-des3选项)
openssl req -new -key server.key -out server.csr  //创建CSR(Certificate Signing Request)
openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt  //自己签发证书
sudo cp server.crt /etc/ssl/certs
sudo cp server.key /etc/ssl/private


# 修改虚拟主机信息
在&lt;VirtualHost *:80&gt;段中，DocumentRoot一行的下方加入内容：
SSLEngine On
SSLOptions +StrictRequire
SSLCertificateFile /etc/ssl/certs/server.crt
SSLCertificateKeyFile /etc/ssl/private/server.key
端口修改为：443，即&lt;VirtualHost *:443&gt;(ssl的端口)


# 重启apache2
sudo /etc/init.d/apache2 force-reload
sudo /etc/init.d/apache2 restart</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/06/19/ubuntu配置Gitlab服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/19/ubuntu配置Gitlab服务/" class="post-title-link" itemprop="url">ubuntu配置Gitlab服务</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-06-19 14:18:48" itemprop="dateCreated datePublished" datetime="2017-06-19T14:18:48+08:00">2017-06-19</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 18:59:09" itemprop="dateModified" datetime="2019-07-23T18:59:09+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装相关服务 postfix为邮件服务</span></span><br><span class="line">sudo apt-get install curl openssh-server ca-certificates postfix</span><br><span class="line"><span class="comment"># 安装gitlab服务包</span></span><br><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br><span class="line">sudo apt-get install gitlab-ce</span><br></pre></td></tr></table></figure>

<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置服务</span></span><br><span class="line">sudo vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line"><span class="comment">## GitLab URL</span></span><br><span class="line"><span class="comment">##! URL on which GitLab will be reachable.</span></span><br><span class="line"><span class="comment">##! For more details on configuring external_url see:</span></span><br><span class="line"><span class="comment">##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab</span></span><br><span class="line">external_url <span class="string">'http:/192.168.0.19:1500'</span>    <span class="comment"># 地址</span></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment"># 邮件基本设置</span></span><br><span class="line"><span class="comment">### Email Settings</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'Gitlab'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_reply_to'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_subject_suffix'</span>] = <span class="string">'Gitlab'</span></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment">### GitLab email server settings</span></span><br><span class="line"><span class="comment">###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html</span></span><br><span class="line"><span class="comment">###! **Use smtp instead of sendmail/postfix.**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_enable'] = true</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_address'] = "smtp.server"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_port'] = 465</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_user_name'] = "smtp user"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_password'] = "smtp password"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_domain'] = "example.com"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_authentication'] = "login"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_enable_starttls_auto'] = true</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_tls'] = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮件服务地址</span></span><br><span class="line"><span class="comment"># QQ exmail (腾讯企业邮箱)</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"admin@uscnk.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"xxxxxxxxx"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx基本设置</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">## GitLab Nginx</span></span><br><span class="line"><span class="comment">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"></span><br><span class="line">nginx[<span class="string">'listen_addresses'</span>] = [<span class="string">'192.168.0.19'</span>]</span><br><span class="line">nginx[<span class="string">'losten_port'</span>] = 1500</span><br></pre></td></tr></table></figure>

<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line"><span class="comment"># 重启邮件服务</span></span><br><span class="line">sudo /etc/init.d/postfix restart</span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">http://192.168.0.19:1500</span><br><span class="line">Username: root</span><br><span class="line">Password: 5iveL!fe</span><br></pre></td></tr></table></figure>

<h4 id="github与gitlab共存"><a href="#github与gitlab共存" class="headerlink" title="github与gitlab共存"></a>github与gitlab共存</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># github账户邮箱， 将id_rsa改名成id_rsa_github</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"xxxxx@gmail.com"</span></span><br><span class="line"><span class="comment"># gitlab公司邮箱， 将id_rsa改名成id_rsa_gitlab</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"xxxxxx@work.com"</span></span><br><span class="line"><span class="comment"># 添加私钥</span></span><br><span class="line">ssh-add ~/.ssh/id_rsa_github</span><br><span class="line">ssh-add ~/.ssh/id_rsa_gitlab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在 ~/.ssh 目录下新建一个config文件</span></span><br><span class="line">touch config</span><br><span class="line">chmod 755 conifg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并添加以下内容</span></span><br><span class="line"><span class="comment"># gitlab</span></span><br><span class="line">Host github.com</span><br><span class="line">    HostName github.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line"><span class="comment"># github</span></span><br><span class="line">Host gitlib.com</span><br><span class="line">    HostName gitlib.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_gitlab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将id_rsa_github.pab内容添加到github中</span></span><br><span class="line"><span class="comment"># 测试结果</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment"># 将id_rsa_gitlab.pab内容添加到gitlab中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/mytest</span><br><span class="line"><span class="comment"># 在github中测试</span></span><br><span class="line">git remote add github https://github.com/zhcshine/mytest.git</span><br><span class="line">git push -u github master</span><br><span class="line"><span class="comment"># 在gitlab中测试</span></span><br><span class="line">git remote add gitlab http://192.168.0.19:1500/zhcshine/mytest.git</span><br><span class="line">git push -u gitlab master</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/04/20/centos7创建nagios监控集群服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/20/centos7创建nagios监控集群服务/" class="post-title-link" itemprop="url">centos7创建nagios监控集群服务</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-20 11:17:12" itemprop="dateCreated datePublished" datetime="2017-04-20T11:17:12+08:00">2017-04-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装服务器端192-168-0-206"><a href="#安装服务器端192-168-0-206" class="headerlink" title="安装服务器端192.168.0.206"></a>安装服务器端192.168.0.206</h3><p>1,安装lamp环境 <a href="http://www.zhuohc.com/articles/centos7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">参考</a> 2, 配置nagios服务</p>
<pre><code># 创建nagiso用户
$ sudo useradd nagios
# 创建apache用户，yum安装httpd服务会自动创建
$ sudo useradd apache -M -s /sbin/nologin
useradd：用户“apache”已存在
# 创建nagcmd用户组
$ sudo groupadd nagcmd
# 将usermod加入nagcmd用户组
sudo usermod -a -G nagcmd nagios
# 将apache用户加入nagcmd用户组
$ sudo usermod -a -G nagcmd apache
# 查看nagios用户所属的组
$ id -n -G nagios
nagios nagcmd
# 查看apace用户所属的组
$ id -n -G apache
apache nagcmd
# 安装nagiso服务
$sudo yum install nagios
$sudo yum install nagios-plugins-all
# 安装nrpe（服务器端和客户端都需要安装）
$sudo yum install nrpe
# 启动和开机启动
$sudo systemctl start nagios
$sudo systemctl enable nagios
$sudo systemctl start nrpe
$sudo systemctl enable nrpe</code></pre><p>3,配置web</p>
<pre><code># 取消认证
$ sudo vim /etc/nagios/cgi.cfg
use_authentication=0 # 此处将1改为0
# 查看配置文件
$ls /etc/httpd/conf.d
autoindex.conf  nagios.conf  php.conf  README  userdir.conf  welcome.conf  xcache.conf
# 其中nagiso.conf就是nagios的web配置文件
# 访问http://192.168.0.206/nagios，其中登陆密码在/etc/nagios/passwd文件中，具体文件位置可以在/etc/httpd/conf.d/nagios.conf中查看</code></pre><h3 id="安装客户端192-168-0-208"><a href="#安装客户端192-168-0-208" class="headerlink" title="安装客户端192.168.0.208"></a>安装客户端192.168.0.208</h3><pre><code># 安装mysql，参考上方链接，配合生成check_mysql插件
# 安装nrpe（服务器端和客户端都需要安装）
$ sudo yum -y install epel-release
$ sudo yum install nrpe
$ sudo yum install nagios-plugins-all
# 配置nagios客户端
$ sudo vim /etc/nagios/nrpe.cfg
allowed_hosts=127.0.0.1,192.168.0.206 # 监控当前客户端的nagios服务器地址
# 启动服务
$ sudo systemctl restart nrpe
$ sudo systemctl enable nrpe
# 检查启动结果
$ sudo netstat -lntup | grep nrpe
tcp        0      0 0.0.0.0:5666            0.0.0.0:*               LISTEN      2540/nrpe           
tcp6       0      0 :::5666                 :::*                    LISTEN      2540/nrpe
$ sudo ps -ef | grep nrpe | grep -v grep
nrpe      2540     1  0 11:59 ?        00:00:00 /usr/sbin/nrpe -c /etc/nagios/nrpe.cfg -d</code></pre><h3 id="配置服务器端192-168-0-206"><a href="#配置服务器端192-168-0-206" class="headerlink" title="配置服务器端192.168.0.206"></a>配置服务器端192.168.0.206</h3><pre><code>$ tree /etc/nagios
.
├── cgi.cfg  
├── conf.d  # 添加新的监视客户端信息
│   └── web_one.cfg
├── nagios.cfg  # 配置服务器端nagios
├── nrpe.cfg # 配置服务器端nrpe
├── objects
│   ├── commands.cfg
│   ├── contacts.cfg
│   ├── localhost.cfg
│   ├── printer.cfg
│   ├── switch.cfg
│   ├── templates.cfg
│   ├── timeperiods.cfg
│   └── windows.cfg
├── passwd
└── private
    └── resource.cfg
$ cp /etc/nagios/objects/localhost.cfg  /etc/nagios/conf.d/web_one.cfg
$ vim /etc/nagios/conf.d/web_one.cfg # 将localhost 改成web_one
define host{
        use                     linux-server  
        host_name         web_one
        alias                   web_one
        address              192.168.0.208
}
define service{
        use                             local-service 
        host_name                 web_one
        service_description    PING
        check_command        check_ping!100.0,20%!500.0,60%
}</code></pre><h3 id="查看结果"><a href="#查看结果" class="headerlink" title="查看结果"></a>查看结果</h3><p><img src="http://www.zhuohc.com/wp-content/uploads/2017/04/nagios.png" alt="nagios"></p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/04/19/centos7配置keepalived实现高可用集群/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/19/centos7配置keepalived实现高可用集群/" class="post-title-link" itemprop="url">centos7配置keepalived实现高可用集群</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-19 14:30:29" itemprop="dateCreated datePublished" datetime="2017-04-19T14:30:29+08:00">2017-04-19</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="CENTOS6-8-192-168-0-106-MASTER"><a href="#CENTOS6-8-192-168-0-106-MASTER" class="headerlink" title="CENTOS6.8 192.168.0.106 MASTER"></a>CENTOS6.8 192.168.0.106 MASTER</h3><pre><code># 安装
sudo yum install keepalived
# 配置
sudo vim /etc/keepalived/keepalived.conf

! Configuration File for keepalived

global_defs {
    # 这些信息是配置报警发邮件信息
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
     # 路由标识，同一局域网应该唯一
   router_id lb01
}
vrrp_instance VI_1 {
    # 当前角色是master
    state MASTER
        # 对外提供网络的接口
    interface eth0
        # 虚拟路由id标识，数字，必须和backup里相同实例一致
    virtual_router_id 55
        # 优先级，数字必须比backup大
    priority 150
    advert_int 1
        # 权限认证，和backup一致
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
       192.168.0.200
    }
}

# 重启
sudo /etc/init.d/keepalived restart
# 查看结果
ip addr | grep 192.168.0.200</code></pre><h3 id="CENTOS7-2-192-168-0-209-BACKUP"><a href="#CENTOS7-2-192-168-0-209-BACKUP" class="headerlink" title="CENTOS7.2 192.168.0.209 BACKUP"></a>CENTOS7.2 192.168.0.209 BACKUP</h3><pre><code># 安装
sudo yum install keepalived
# 配置
sudo vim /etc/keepalived/keepalived.conf

! Configuration File for keepalived

global_defs {
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id lb02  # 和master不一致
}

vrrp_instance VI_1 {
    state BACKUP      # 和MASTER不一致
    interface enp0s3
    virtual_router_id 55
    priority 100      # 和master不一致
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.0.200
    }
}
# 重启
sudo systemctl restart keepalived
# 查看结果
ip addr | grep 192.168.0.200</code></pre><h3 id="CENTOS6-8-192-168-0-106-nginx配置"><a href="#CENTOS6-8-192-168-0-106-nginx配置" class="headerlink" title="CENTOS6.8 192.168.0.106 nginx配置"></a>CENTOS6.8 192.168.0.106 nginx配置</h3><pre><code># nginx配置文件
    server {
        listen       192.168.0.200:80; # 这里需要指定虚拟vip监听
        server_name  localhost;

        location / {
                  # 只访问web站点
           proxy_pass http://www_server_pools;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }</code></pre><h3 id="CENTOS7-2-192-168-0-209-配置nginx"><a href="#CENTOS7-2-192-168-0-209-配置nginx" class="headerlink" title="CENTOS7.2 192.168.0.209 配置nginx"></a>CENTOS7.2 192.168.0.209 配置nginx</h3><pre><code># nginx配置文件
   server {
        listen       192.168.0.200:80;
        server_name  localhost;

        location / {
                     # 只访问phone站点
           proxy_pass http://www_phone_pools;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }</code></pre><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><pre><code># 开启192.168.0.106，192.168.0.209的keepalive服务

# 查看192.168.0.106
$ ip addr | grep 192.168.0.200
inet 192.168.0.200/32 scope global eth0 # 应该有这行结果

# 查看192.168.0.209
$ ip addr | grep 192.168.0.200 # 结果应该为空，如果有结果，表示脑裂，检查相关配置和防火墙

# 访问http://192.168.200 
curl 192.168.0.200 # 结果应该只访问web网站


# 关停192.168.0.106的keepalive服务

# 访问http://192.168.200 
curl 192.168.0.200 # 结果应该只访问phone网站

# 查看192.168.0.106
$ ip addr | grep 192.168.0.200
inet 192.168.0.200/32 scope global eth0 # 结果应该为空

# 查看192.168.0.209
$ ip addr | grep 192.168.0.200 
inet 192.168.0.200/32 scope global enp0s3 # 此时有这行结果

# 重启192.168.0.106的keepalive服务，应该恢复之前的测试结果</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2016/11/30/unittest单元测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/11/30/unittest单元测试/" class="post-title-link" itemprop="url">unittest单元测试</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-11-30 11:13:19" itemprop="dateCreated datePublished" datetime="2016-11-30T11:13:19+08:00">2016-11-30</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-24 09:35:07" itemprop="dateModified" datetime="2019-07-24T09:35:07+08:00">2019-07-24</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="unittest基础使用方法"><a href="#unittest基础使用方法" class="headerlink" title="unittest基础使用方法"></a>unittest基础使用方法</h4><pre><code># -*- coding:utf-8 -*-
# calculator.py
# 需要测试的类
class Count:

    def __init__(self, a, b):
        self.a = int(a)
        self.b = int(b)

    def add(self):
        return self.a + self.b



# -*- coding: utf-8 -*-
# test.py 测试类
from calculator import Count
import unittest
class TestCount(unittest.TestCase):
    def setUp(self):
        print &apos;test start&apos;

    def test_add(self):
        j = Count(2,3)
        self.assertEqual(j.add(), 5)

    def test_add2(self):
        j = Count(41, 76)
        self.assertEqual(j.add(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    # unittest.main()
    # 构造测试集
    suite = unittest.TestSuite()
    # 指定测试方法
    suite.addTest(TestCount(&apos;test_add2&apos;))
    # 执行测试
    runner = unittest.TextTestRunner()
    runner.run(suite)</code></pre><h4 id="自动识别测试用例"><a href="#自动识别测试用例" class="headerlink" title="自动识别测试用例"></a>自动识别测试用例</h4><pre><code># -*- coding:utf-8 -*-
# calculator.py
# 需要测试的类
class Count:

    def __init__(self, a, b):
        self.a = int(a)
        self.b = int(b)

    def add(self):
        return self.a + self.b

    def sub(self):
        return self.a - self.b


# -*- coding: utf-8 -*-
# testadd.py 测试类
from calculator import Count
import unittest
class TestAdd(unittest.TestCase):
    def setUp(self):
        print &apos;test add start&apos;

    def test_add(self):
        j = Count(2,3)
        self.assertEqual(j.add(), 5)

    def test_add2(self):
        j = Count(41, 76)
        self.assertEqual(j.add(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test add end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    unittest.main()


# -*- coding: utf-8 -*-
# testsub.py 测试类
from calculator import Count
import unittest


class TestSub(unittest.TestCase):
    def setUp(self):
        print &apos;test sub start&apos;

    def test_sub(self):
        j = Count(2,3)
        self.assertEqual(j.sub(), 5)

    def test_sub2(self):
        j = Count(41, 76)
        self.assertEqual(j.sub(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test sub end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    unittest.main()


# -*- coding: utf-8 -*-
# runtest.py
import unittest
test_dir = &apos;./&apos;
discover = unittest.defaultTestLoader.discover(test_dir, pattern=&apos;test*.py&apos;)
if __name__ == &apos;__main__&apos;:
    runner = unittest.TextTestRunner()
    runner.run(discover)</code></pre><h4 id="断言方法啊"><a href="#断言方法啊" class="headerlink" title="断言方法啊"></a>断言方法啊</h4><pre><code># unittest.TestCase.assertEqual(a, b, msg=None)   a == b
# unittest.TestCase.assertNotEqual(a, b) a !=b  
# unittest.TestCase.assertTrue(x)   x is True
# unittest.TestCase.assertFalse(x)  x is False
# unittest.TestCase.assertIs(a, b)  x is b
# unittest.TestCase.assertIsNot(a, b)  a is not b
# unittest.TestCase.assertIsNotNone(x)  x is not None
# unittest.TestCase.assertIn(a, b)  a in b
# unittest.TestCase.assertNotIn(a, b) a not in b
# unittest.TestCase.assertNotIsInstance(a, b) isinstance(a,b)
# unittest.TestCase.assertNotIsInstance(a, b) not isinstance(a,b)</code></pre><h4 id="跳过测试与预期失败"><a href="#跳过测试与预期失败" class="headerlink" title="跳过测试与预期失败"></a>跳过测试与预期失败</h4><pre><code># -*- coding: utf-8 -*-
# test.py
import unittest

class MyTest(unittest.TestCase):

    def setUp(self):
        pass
    def tearDown(self):
        pass

    @unittest.skip(u&apos;直接跳过测试&apos;)
    def test_skip(self):
        print &apos;test aaa&apos;

    @unittest.skipIf(3 &gt; 2, u&apos;条件满足时跳过测试&apos;)
    def test_skip_if(self):
        print &apos;test bbb&apos;

    @unittest.skipUnless(3 &gt; 2, u&apos;条件满足时执行测试&apos;)
    def test_skip_unless(self):
        print &apos;test ccc&apos;

    # 不管测试成功与否，都标记为失败
    @unittest.expectedFailure
    def test_expected_failure(self):
        print &apos;test ddd&apos;
        self.assertEqual(2, 3)

if __name__ == &apos;__main__&apos;:
    unittest.main()</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2016/11/30/selenium入门基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/11/30/selenium入门基础/" class="post-title-link" itemprop="url">selenium入门基础</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-11-30 09:37:47" itemprop="dateCreated datePublished" datetime="2016-11-30T09:37:47+08:00">2016-11-30</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-24 09:33:56" itemprop="dateModified" datetime="2019-07-24T09:33:56+08:00">2019-07-24</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="安装及基本操作"><a href="#安装及基本操作" class="headerlink" title="安装及基本操作"></a>安装及基本操作</h4><pre><code># -*- coding:utf-8 -*-
# 环境: ubuntu14.04
# pip install seleninum
# firefox
# https://github.com/mozilla/geckodriver/releases 下载对应版本放在$PATH目录下
# google
# https://sites.google.com/a/chromium.org/chromedriver/downloads 下载对应版本放在$PATH目录下
# http://www.seleniumhq.org/download/    其他浏览器参考
# sudo apt-get install phantomjs  安装无界面webkit浏览器引擎
from selenium import webdriver
from selenium.webdriver.common.by import By

driver = webdriver.Firefox()
# driver = webdriver.Chrome()
# driver =  webdriver.PhantomJS(executable_path=&apos;/usr/bin/phantomjs&apos;)
driver.get(&apos;http://www.baidu.com&apos;)

# 定位元素
# 根据id定位
find_id = driver.find_element_by_id(&apos;wrapper&apos;)
find_id = driver.find_element(By.ID, &apos;wrapper&apos;)
# 根据name属性定位
find_name = driver.find_element_by_name(&apos;wd&apos;)
find_name = driver.find_element(By.NAME, &apos;wd&apos;)
# 根据class定位
find_class = driver.find_element_by_class_name(&apos;head_wrapper&apos;)
find_class = driver.find_element(By.CLASS_NAME, &apos;head_wrapper&apos;)
# 根据标签名称定位
find_tag = driver.find_element_by_tag_name(&apos;div&apos;)
find_tag = driver.find_element(By.TAG_NAME, &apos;div&apos;)
# 根据链接文本定位
find_a_text = driver.find_element_by_link_text(&apos;hao123&apos;)
find_a_text = driver.find_element(By.LINK_TEXT, &apos;hao123&apos;)
# 根据部分链接文本定位
find_a_text = driver.find_element_by_partial_link_text(&apos;hao&apos;)
find_a_text = driver.find_element(By.PARTIAL_LINK_TEXT, &apos;hao&apos;)
# 根据绝对位置定位
find_x_path = driver.find_elements_by_xpath(&apos;/html/body/div&apos;)
find_x_path = driver.find_element(By.XPATH, &apos;/html/body/div&apos;)
# 支持层级，属性，逻辑运算符结合使用
find_x_path = driver.find_element_by_xpath(&quot;//input[@id=&apos;kw&apos;]&quot;)  # // 当前目录下的某个目录下
# Css定位
find_css = driver.find_elements_by_css_selector(&apos;.s_ipt&apos;)
find_css = driver.find_element(By.CSS_SELECTOR, &apos;.s_ipt&apos;)

# 设置浏览器宽高
driver.set_window_size(480, 800)
driver.get(&apos;http://www.126.com&apos;)
# 控制浏览器前进倒退
driver.back()
driver.forward()
# 刷新浏览器(F5)
driver.refresh()
# 当前页面
print driver.current_url()
# 元素操作
# dom = driver.find_element(By.ID, &apos;kw&apos;)
# dom.clear()  # 清除文本
# dom.send_keys()  # 模拟键盘输入
# dom.click()  # 点击元素
# dom.submit()  # 模拟表单提交
# dom.size()  # 返回元素的尺寸
# dom.text()  # 返回元素的文本
# dom.get_attribute(name)  # 返回元素的属性值
# dom.is_displayed()  # 设置该元素是否可见

# 鼠标操作
from selenium.webdriver.common.action_chains import ActionChains
driver.get(&apos;http://www.baidu.com&apos;)
# context_click 鼠标右键点击
right_click = driver.find_element_by_id(&apos;xx&apos;)
# perform 执行所有ActionChains中存储的动作
ActionChains(driver).context_click(right_click).perform()
# above 鼠标悬停
above = driver.find_element_by_id(&apos;xxx&apos;)
ActionChains(driver).move_to_element(above).perform()
# double_click 鼠标双击
# drag_and_drop(source, target) 鼠标拖放


# 键盘事件
from selenium.webdriver.common.keys import Keys
find_id.send_keys(Keys.BACK_SPACE) # 删除键
find_id.send_keys(Keys.SPACE)  # 空格键
find_id.send_keys(Keys.TAB)  # tab键
find_id.send_keys(Keys.ESCAPE)  # ESC
find_id.send_keys(Keys.ENTER)  # 回车键
find_id.send_keys(Keys.CONTROL, &apos;c&apos;)  # 复制
find_id.send_keys(Keys.CONTROL, &apos;v&apos;)  # 剪贴
find_id.send_keys(Keys.F1) # F1

# driver.quit()</code></pre><h4 id="webdriver原理"><a href="#webdriver原理" class="headerlink" title="webdriver原理"></a>webdriver原理</h4><pre><code># -*- coding:utf-8 -*-
from selenium import webdriver
import logging

logging.basicConfig(level=logging.DEBUG)
driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
driver.quit()</code></pre><h4 id="显示等待"><a href="#显示等待" class="headerlink" title="显示等待"></a>显示等待</h4><pre><code># -*- coding:utf-8 -*-
# 显示等待
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
# 显示等待
# 参数driver： 浏览器驱动
# 参数timeout： 最大超时时间，单位秒
# 参数poll_frequency： 检测的间隔时间，默认为0.5秒
# 参数ignored_exceptions: 超时异常信息，默认为NoSuchElementException
# WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)
# until(method, message=&apos;&apos;) 调用该方法提供的驱动程序作为参数，直到返回True
# until_not(method, message=&apos;&apos;) 调用该方法提供的驱动程序作为参数，直到返回False
# EC.title_is 判断当前页面的标题是否是否等于预期
# EC.title_contains 判断当前页面的标题是否包含预期的字符串
# EC.presence_of_element_located 判断元素是否被加载在DOM树中，并不代表当前元素可见
# EC.visibility_of_element_located 判断元素是否可见（可见并非代表元素非隐藏，并且元素的宽和高均不等于0）
# EC.visibility_of 与visibility_of_element_located相同，该方法接受的参数为定位后的元素
# EC.presence_of_all_elements_located 判断是否至少有一个元素存在与DOM树中
# EC.text_to_be_present_in_element 判断某个元素的text是否包含预期的字符串
# EC.text_to_be_present_in_element_value 判断某个元素的vaule属性是否包含了预期的字符串
# EC.frame_to_be_available_and_switch_to_it 判断该表单是否可以切换进去，如果可以，返回True并switch进去，否则返回false
# EC.invisibility_of_element_located 判断某个元素是否不存在于DOM树中或者不可见
# EC.element_to_be_clickable 判断某个元素是否可以点击
# EC.staleness_of 等到一个元素从DOM树中移除
# EC.element_to_be_selected 判断某个元素是否被选中，一般用于下拉菜单
# EC.element_selection_state_to_be 判断某个元素的选中状态是否符合预期, 参数为定位后的元素
# EC.element_located_selection_state_to_be 判断某个元素的选中状态是否符合预期,该方法接受的参数为定位
# EC.alert_is_present 判断页面上是否有alert
# driver.find_element_by_id().is_displayed() 判断元素是否可见
element = WebDriverWait(driver, 5, 0.5).until(EC.presence_of_element_located((By.ID, &apos;kw&apos;)))
element.send_keys(&apos;selenium&apos;)
# driver.quit()</code></pre><h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><pre><code># -*- coding:utf-8 -*-
# 隐式等待
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException
from time import ctime
from time import sleep
driver = webdriver.Firefox()
# sleep(10)
driver.implicitly_wait(10)
driver.get(&apos;http://www.baidu.com&apos;)
print ctime()
try:
    driver.find_element_by_id(&apos;kw22&apos;).send_keys(&apos;selenium&apos;)
except NoSuchElementException as e:
    print e
finally:
    print ctime()</code></pre><h4 id="执行js代码"><a href="#执行js代码" class="headerlink" title="执行js代码"></a>执行js代码</h4><pre><code># -*- coding:utf-8 -*-
# 执行js代码
from selenium import webdriver
from time import sleep

# 访问百度
driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
driver.set_window_size(600, 600)
driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
sleep(2)

js = &apos;window.scrollTo(100, 450);&apos;
driver.execute_script(js)
sleep(3)

# driver.quit()</code></pre><h4 id="处理cookie"><a href="#处理cookie" class="headerlink" title="处理cookie"></a>处理cookie</h4><pre><code># -*- coding:utf-8 -*-
# cookie处理
from selenium import webdriver
driver = webdriver.Firefox()
driver.get(&apos;http://www.youdao.com&apos;)
driver.add_cookie({&apos;name&apos;: &apos;name-a&apos;, &apos;value&apos;: &apos;value-b&apos;})
# 获取cookie信息
cookies = driver.get_cookies()
print cookies
for cookie in cookies:
    print cookie
    print &apos;{} -&gt; {}&apos;.format(cookie[&apos;name&apos;], cookie[&apos;value&apos;])
driver.quit()</code></pre><h4 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h4><pre><code># -*- coding:utf-8 -*-
# 窗口截图
from selenium import webdriver
from time import sleep

# driver = webdriver.Firefox()
driver =  webdriver.PhantomJS(executable_path=&apos;/usr/bin/phantomjs&apos;)
driver.get(&apos;http://www.baidu.com&apos;)

driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
sleep(2)

driver.get_screenshot_as_file(&apos;./screen.png&apos;)
driver.quit()</code></pre><h4 id="播放视频"><a href="#播放视频" class="headerlink" title="播放视频"></a>播放视频</h4><pre><code># -*- coding:utf-8 -*-
from selenium import webdriver
from time import sleep

driver = webdriver.Firefox()
driver.get(&apos;http://videojs.com&apos;)

video = driver.find_element_by_xpath(&apos;body/Setion[1]/div/video&apos;)
# 返回播放文件地址
url = driver.execute_script(&apos;return arguments[0].currentSrc;&apos;, video)
print url

# 播放视频
print &apos;start&apos;
driver.execute_script(&apos;return arguments[0].play()&apos;, video)

# 播放15秒
sleep(15)

# 暂停播放
print &apos;stop&apos;
driver.execute_script(&apos;arguments[0].pause()&apos;, video)

# driver.quit()</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2016/11/10/wordpress插件开发基础入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="www.zhuohc.om">
      <meta itemprop="description" content="技术博客、日记记录">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wellread">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/11/10/wordpress插件开发基础入门/" class="post-title-link" itemprop="url">wordpress插件开发基础入门</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-11-10 11:40:48" itemprop="dateCreated datePublished" datetime="2016-11-10T11:40:48+08:00">2016-11-10</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-24 09:35:55" itemprop="dateModified" datetime="2019-07-24T09:35:55+08:00">2019-07-24</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="创建插件"><a href="#创建插件" class="headerlink" title="创建插件"></a>创建插件</h4><pre><code>├── hanchang-copyright
│   └── hanchang-copyright.php



# hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/</code></pre><h4 id="插件启用和停用初始化"><a href="#插件启用和停用初始化" class="headerlink" title="插件启用和停用初始化"></a>插件启用和停用初始化</h4><pre><code># hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hanchang_copyright_install&apos;);

function hanchang_copyright_install() {

    //插件启动，添加一个默认的版权信息
    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&apos;color:red&apos;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );

}

//定义插件停用时候调用的方法
register_deactivation_hook( __FILE__, &apos;hanchang_copyright_deactivation&apos;);

function hanchang_copyright_deactivation() {

    //插件停用，设置停用标识为1
    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );

}</code></pre><h4 id="删除插件"><a href="#删除插件" class="headerlink" title="删除插件"></a>删除插件</h4><pre><code>.
├── hanchang-copyright.php
└── uninstall.php # 删除插件执行的文件


# uninstall.php
&lt;?
// 如果 uninstall 不是从 WordPress 调用，则退出
if( !defined( &apos;WP_UNINSTALL_PLUGIN&apos; ) )
exit();

//删除插件创建的项目，以确保不占用数据库资源
delete_option( &apos;hanchang_copyright_deactivation&apos; );
delete_option( &apos;hanchang_copyright_text&apos; );</code></pre><h4 id="add-action"><a href="#add-action" class="headerlink" title="add_action"></a>add_action</h4><pre><code>add_action(&quot;$tag钩子名称&quot;, &quot;$function_to_do执行函数&quot;, $priorrity执行优先级, $accepted_arga带参数函数的参数个数)


# hanchang-copyright.php

//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert
add_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );

function hc_copyright_insert(){

    //输出一段字符串
    echo get_option( &quot;hc_copyright_text&quot; );

}


add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );

function hanchang_copyright_insert_new() {
    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;
}

add_action( &apos;save_post&apos;, &apos;save_post_meta&apos;, 10, 2 );

function save_post_meta( $post_id, $post ) {

    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );

}</code></pre><h4 id="常见钩子"><a href="#常见钩子" class="headerlink" title="常见钩子"></a>常见钩子</h4><pre><code>init 加载初始化
wp_head 加载添加到head标签中的内容
wp_enqueue_scripts 加载css或者js文件
wp_foot 加载添加到底部内容

save_post 添加保存文章
wp_trash_post 将文章添加到回收站
delete_post 将文章删除

wp_insert_comment 插入评论

user_register 用户注册


# hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hanchang_copyright_install&apos;);

function hanchang_copyright_install() {

    //插件启动，添加一个默认的版权信息
    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&apos;color:red&apos;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );

}

//定义插件停用时候调用的方法
register_deactivation_hook( __FILE__, &apos;hanchang_copyright_deactivation&apos;);

function hanchang_copyright_deactivation() {

    //插件停用，设置停用标识为1
    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );

}

//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert
add_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );

function hc_copyright_insert(){

    //输出一段字符串
    echo get_option( &quot;hc_copyright_text&quot; );

}


add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );

function hanchang_copyright_insert_new() {
    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;
}

add_action( &apos;save_post&apos;, &apos;save_post_meta&apos;, 10, 2 );

function save_post_meta( $post_id, $post ) {

    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );

}



//在输出内容之前，给页面管理添加摘要功能
add_action( &apos;init&apos;, &apos;hc_add_excerpts_to_pages&apos; );

function hc_add_excerpts_to_pages() {

    //给页面管理添加摘要的功能
    add_post_type_support( &apos;page&apos;, array( &apos;excerpt&apos; ) );
}

//wp_head钩子
add_action(&apos;wp_head&apos;,&apos;hc_wp_head&apos;);

function hc_wp_head() {

    //只有首页输出描述
    if( is_home() ){ ?&gt;
        &lt;meta name=&quot;description&quot; content=&quot;&lt;? bloginfo(&apos;description&apos;); ?&gt;&quot; /&gt;
    &lt;? }

}


//自定义引用样式表
function hc_enqueue_style() {
    wp_enqueue_style( &apos;core&apos;, plugins_url(&apos;css/hc_copyrighy.css&apos;, __FILE__) , false );
}

//自定义引用脚本文件
function hc_enqueue_script() {
    wp_enqueue_script( &apos;my-js&apos;, plugins_url(&apos;js/hc_copyrighy.js&apos;, __FILE__), false );
}

//引用文件的钩子
add_action( &apos;wp_enqueue_scripts&apos;, &apos;hc_enqueue_style&apos;, 5 );
add_action( &apos;wp_enqueue_scripts&apos;, &apos;hc_enqueue_script&apos;, 7 );

//删除所有挂载在 wp_enqueue_scripts 钩子上的方法
remove_all_actions( &apos;wp_enqueue_scripts&apos;, 5 );

//评论被添加的时候触发
add_action( &apos;wp_insert_comment&apos;, &apos;comment_inserted&apos;, 10, 2 );

//移除 wp_insert_comment 钩子上的 comment_inserted 方法
remove_action( &apos;wp_insert_comment&apos;, &apos;comment_inserted&apos;, 10 );

function comment_inserted($comment_id, $comment_object ) {

    //获取该评论所在文章的评论总数
    $comments_count = wp_count_comments( $comment_object-&gt;comment_post_ID );

    $commentarr = array();
    $commentarr[&apos;comment_ID&apos;] = $comment_id;

    //修改评论的内容，在评论内容前加上 “第{$comments_count-&gt;total_comments}个评论：” 这么一段字符串
    $commentarr[&apos;comment_content&apos;] = &quot;第{$comments_count-&gt;total_comments}个评论：&quot; . $comment_object-&gt;comment_content;

    wp_update_comment( $commentarr );

}


add_action( &apos;user_register&apos;, &apos;myplugin_registration_save&apos;, 10, 1 );

function myplugin_registration_save( $user_id ) {

    //将新用户的个人说明，设置为注册时间
    wp_update_user( array( &apos;ID&apos; =&gt; $user_id, &apos;description&apos; =&gt; &quot;注册时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) ) );

}
?&gt;</code></pre><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><pre><code>add_filter($tag过滤器名称, $function_to_add需要添加的函数, $priority优先级, $acceptedargs添加的参数数量)



# hanchang-copyright.php
//一开始，我们设置一个变量
$value = &quot;hello&quot;;

//给名为 hc_filter 的过滤器，挂载一个 hc_filter_fun 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun 方法进行过滤
//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun&quot; );

//给名为 hc_filter 的过滤器，再挂载一个 hc_filter_fun_add_time 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun、hc_filter_fun_add_time 两个方法进行过滤
//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun_add_time&quot; );

//对 $value 值使用名为 hc_filter 的过滤器进行过滤，这个时候，由于 hc_filter 过滤器只挂载了 hc_filter_fun 方法，因此，只使用 hc_filter_fun 方法 过滤了一次，并且返回给 $myvar 变量
//$myvar = apply_filters( &quot;hc_filter&quot;, $value );

add_filter( &quot;the_content&quot;, &quot;hc_filter_fun&quot; );
add_filter( &quot;the_content&quot;, &quot;hc_filter_fun_add_time&quot; );</code></pre><h4 id="带参数的过滤器"><a href="#带参数的过滤器" class="headerlink" title="带参数的过滤器"></a>带参数的过滤器</h4><pre><code># hanchang-copyright.php
function suppress_if_blurb( $title, $id = null ) {

    if ( in_category(&apos;wpcj&apos;, $id ) ) {
        return &apos;不显示标题&apos;;
    }

    return $title . &quot;...&quot;;
}

//对 the_title 过滤器挂载一个 suppress_if_blurb 方法，优先级为10，传递的参数有2个
add_filter( &apos;the_title&apos;, &apos;suppress_if_blurb&apos;, 10, 2 );</code></pre><h4 id="常见过滤器"><a href="#常见过滤器" class="headerlink" title="常见过滤器"></a>常见过滤器</h4><pre><code>the_content 文章内容 
content_save_pre 文章保存前
the_title 文章标题
wp_handle_upload_prefilter 上传文件之前</code></pre><h4 id="创建菜单"><a href="#创建菜单" class="headerlink" title="创建菜单"></a>创建菜单</h4><pre><code>add_menu_page  # 添加菜单
add_submenu_page  # 添加子菜单


# hanchang-copyright.php
// admin_menu钩子挂载创建菜单方法
add_action( &apos;admin_menu&apos;, &apos;hc_create_menu&apos; );
function hc_create_menu() {

    // 创建顶级菜单
    add_menu_page(
        &apos;Hanchang的插件首页&apos;, // 菜单title标题
        &apos;hanchang-copyright&apos;,  // 菜单名称，显示在后台管理页面侧边栏
        &apos;manage_options&apos;, // 浏览插件所需要的权限=管理员权限
        &apos;hanchang_copyright&apos; ,  // 菜单别名，不能与其他插件冲突
        &apos;hanchang_settings_page&apos;,  // 菜单需要显示的页面，调用的哪个方法
        plugins_url( &apos;/images/icon.png&apos;, __FILE__ )  // 调用图标
    );

    // 创建子菜单
    add_submenu_page(
        &apos;hanchang_copyright&apos;,  // 父级菜单别名
        &apos;关于HC的插件&apos;,  // 菜单title标题
        &apos;关于&apos;,  //  菜单名称，显示在后台管理页面侧边栏
        &apos;manage_options&apos;,  // 浏览插件所需要的权限=管理员权限
        &apos;hc_copyright_about&apos;,  // 菜单别名，不能与其他插件冲突
        &apos;hc_create_submenu_menu&apos;  // 调用方法
    );
}

function hanchang_settings_page() {
    ?&gt;
    &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
    &lt;?
}

function hc_create_submenu_menu() {

    ?&gt;
    &lt;h2&gt;子菜单&lt;/h2&gt;
    &lt;?
}</code></pre><p>#开发 小工具</p>
<pre><code>#hanchang-copyright.php
// 使用 widgets_init 动作钩子来执行自定义的函数
add_action( &apos;widgets_init&apos;, &apos;hc_register_widgets&apos; );

// 注册小工具
function hc_register_widgets() {
    register_widget( &apos;hc_widget_info&apos; );
}

//使用 WP_Widget 类来创建小工具
class hc_widget_info extends WP_Widget {

    //构造函数
    public function __construct() {
        $widget_ops = array(
            &apos;classname&apos; =&gt; &apos;hc_widget_info&apos;,
            &apos;description&apos; =&gt; &apos;显示作者的个人信息&apos;
        );
        $this-&gt;WP_Widget( &apos;显示作者个人信息&apos;, &apos;作者的小工具&apos;, $widget_ops );
    }

    //小工具管理界面
    public function form( $instance ) {

        $defaults = array( &apos;title&apos; =&gt; &apos;作者的个人信息&apos;, &apos;xingming&apos; =&gt; &apos;作者&apos;, &apos;book&apos; =&gt; &apos;《作者》&apos; );
        $instance = wp_parse_args( (array) $instance, $defaults );

        $title = $instance[&apos;title&apos;];
        $xingming = $instance[&apos;xingming&apos;];
        $book = $instance[&apos;book&apos;];
        ?&gt;
        &lt;p&gt;标题: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &apos;title&apos; ); ?&gt;&quot; type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $title ); ?&gt;&quot; /&gt;&lt;/p&gt;
        &lt;p&gt;姓名: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &apos;xingming&apos; ); ?&gt; &quot;type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $xingming ); ?&gt; &quot; /&gt;&lt;/p&gt;
        &lt;p&gt;著作: &lt;textarea class=&quot;widefat&quot; name=&quot; &lt;?php echo $this-&gt;get_field_name( &apos;book&apos; ); ?&gt; &quot; /&gt;&lt;?php echo esc_attr( $book ); ?&gt;&lt;/textarea&gt; &lt;/p&gt;
        &lt;?php
    }

    //保存小工具设置
    public function update( $new_instance, $old_instance ) {

        $instance = $old_instance;

        $instance[&apos;title&apos;] = strip_tags( trim( $new_instance[&apos;title&apos;] ) );
        $instance[&apos;xingming&apos;] = strip_tags( trim(  $new_instance[&apos;xingming&apos;] ) );
        $instance[&apos;book&apos;] = strip_tags( trim( $new_instance[&apos;book&apos;] ) );
        return $instance;
    }

    //显示小工具
    public function widget( $args, $instance ) {

        extract( $args );

        $title = apply_filters( &apos;widget_title&apos;, $instance[&apos;title&apos;] );
        $xingming = empty( $instance[&apos;xingming&apos;] ) ? &apos; &apos; : $instance[&apos;xingming&apos;];
        $book = empty( $instance[&apos;book&apos;] ) ? &apos; &apos; : $instance[&apos;book&apos;];

        echo &apos;&lt;p&gt; 标题: &apos; . $title . &apos;&lt;/p&gt;&apos;;
        echo &apos;&lt;p&gt; 姓名: &apos; . $xingming . &apos;&lt;/p&gt;&apos;;
        echo &apos;&lt;p&gt; 著作: &apos; . $book . &apos;&lt;/p&gt;&apos;;
    }
}</code></pre><h4 id="添加元数据框"><a href="#添加元数据框" class="headerlink" title="添加元数据框"></a>添加元数据框</h4><pre><code># hanchang-copyright.php
/**
 * 添加一个元数据框到 post 和 page 的管理界面中
 */
function myplugin_add_meta_box() {

    $screens = array( &apos;post&apos;, &apos;page&apos; );

    add_meta_box(
        &apos;myplugin_sectionid&apos;,  // 元数据框的html代码中的id值
        &apos;转载自&apos;,  // 元数据框标题
        &apos;myplugin_meta_box_callback&apos;,  // 回调函数名称，输出元数据框中的内容
        $screens  // 元数据框需要添加在哪个分类内的（文章或者页面）
    );
}

//需要给 add_meta_boxes 钩子，挂载一个自定义的方法
add_action( &apos;add_meta_boxes&apos;, &apos;myplugin_add_meta_box&apos; );

/**
 * 元数据框展示代码
 */
function myplugin_meta_box_callback( $post ) {

    // 添加一个验证信息，这个在保存元数据的时候用到
    wp_nonce_field( &apos;myplugin_save_meta_box_data&apos;, &apos;myplugin_meta_box_nonce&apos; );

    /*
     * 输出元数据信息
     */
    $value = get_post_meta( $post-&gt;ID, &apos;_zzurl&apos;, true );

    echo &apos;&lt;label for=&quot;myplugin_new_field&quot;&gt;&apos;;
    _e( &apos;本文章转载自：&apos; );
    echo &apos;&lt;/label&gt; &apos;;
    echo &apos;&lt;input type=&quot;text&quot; id=&quot;_zzurl&quot; name=&quot;_zzurl&quot; value=&quot;&apos; . esc_attr( $value ) . &apos;&quot; size=&quot;25&quot; /&gt;&apos;;
}

function myplugin_save_meta_box_data( $post_id ) {

    //验证是否为有效信息
    if ( ! isset( $_POST[&apos;myplugin_meta_box_nonce&apos;] ) ) {
        return;
    }

    if ( ! wp_verify_nonce( $_POST[&apos;myplugin_meta_box_nonce&apos;], &apos;myplugin_save_meta_box_data&apos; ) ) {
        return;
    }

    if ( defined( &apos;DOING_AUTOSAVE&apos; ) &amp;&amp; DOING_AUTOSAVE ) {
        return;
    }

    // Check the user&apos;s permissions.
    if ( isset( $_POST[&apos;post_type&apos;] ) &amp;&amp; &apos;page&apos; == $_POST[&apos;post_type&apos;] ) {

        if ( ! current_user_can( &apos;edit_page&apos;, $post_id ) ) {
            return;
        }

    } else {

        if ( ! current_user_can( &apos;edit_post&apos;, $post_id ) ) {
            return;
        }
    }

    if ( ! isset( $_POST[&apos;_zzurl&apos;] ) ) {
        return;
    }

    $my_data = sanitize_text_field( $_POST[&apos;_zzurl&apos;] );

    update_post_meta( $post_id, &apos;_zzurl&apos;, $my_data );
}

//文章保存的时候，会调用 save_post 钩子，因此我们要借助这个钩子来保存元数据框内的数据
add_action( &apos;save_post&apos;, &apos;myplugin_save_meta_box_data&apos; );</code></pre><h4 id="后台常见css样式表"><a href="#后台常见css样式表" class="headerlink" title="后台常见css样式表"></a>后台常见css样式表</h4><pre><code># copyright.php
function hanchang_settings_page() {
    ?&gt;
    &lt;div class=&quot;wrap&quot;&gt;
        &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
        &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;设置保存成功&lt;/div&gt;
        &lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;保存出现错误&lt;/div&gt;
        &lt;p&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-primary&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-secondary&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-large&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-small&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-hero&quot; /&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;a href=&quot;#&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-primary&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-secondary&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-large&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-small&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-hero&quot;&gt;搜索&lt;/a&gt;
        &lt;/p&gt;

        &lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
            &lt;table class=&quot;form-table&quot;&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;xingming&quot;&gt;姓名：&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;input id=&quot;xingming&quot; name=&quot;xingming&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;shenfen&quot;&gt;身份：&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;
                        &lt;select name=&quot;shenfen&quot;&gt;
                            &lt;option value=&quot;在校&quot;&gt;在校&lt;/option&gt;
                            &lt;option value=&quot;毕业&quot;&gt;毕业&lt;/option&gt;
                        &lt;/select&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;tongyi&quot;&gt;同意注册&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;tongyi&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;xingbie&quot;&gt;性别&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;
                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;男&quot; /&gt; 男
                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;女&quot; /&gt; 女
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;beizhu&quot;&gt;备注&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;textarea name=&quot;beizhu&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;td&gt;
                        &lt;input type=&quot;submit&quot; name=&quot;save&quot; value=&quot;保存&quot; class=&quot;button-primary&quot; /&gt;
                        &lt;input type=&quot;submit&quot; name=&quot;reset&quot; value=&quot;重置&quot; class=&quot;button-secondary&quot; /&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/form&gt;

        &lt;table class=&quot;widefat striped&quot;&gt;
            &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;序号&lt;/th&gt;
                &lt;th&gt;姓名&lt;/th&gt;
            &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td&gt;1&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;2&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;3&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;/tbody&gt;
            &lt;tfoot&gt;
            &lt;tr&gt;
                &lt;th&gt;序号&lt;/th&gt;
                &lt;th&gt;姓名&lt;/th&gt;
            &lt;/tr&gt;
            &lt;/tfoot&gt;
        &lt;/table&gt;

        &lt;div class=&quot;tablenav&quot;&gt;
            &lt;div class=&quot;tablenav-pages&quot;&gt;
                &lt;span class=&quot;displaying-num&quot;&gt;第1页，共458页&lt;/span&gt;
                &lt;span class=&quot;page-numbers current&quot;&gt;1&lt;/span&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;2&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;3&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;4&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;next page-numbers&quot;&gt;»&lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;?
}</code></pre><h4 id="保存插件设置到数据库中"><a href="#保存插件设置到数据库中" class="headerlink" title="保存插件设置到数据库中"></a>保存插件设置到数据库中</h4><pre><code>├── hc-test
│   ├── css
│   ├── hc-test.php
│   ├── images
│   └── js



hc-test.php

&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hc_test_install&apos;);

function hc_test_install() {

   global $wpdb;

   if( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE &apos;{$wpdb-&gt;prefix}test&apos;&quot; ) != &quot;{$wpdb-&gt;prefix}test&quot; ) 
   {
      $sql = &quot;CREATE TABLE IF NOT EXISTS `{$wpdb-&gt;prefix}test` (
           `id` int(11) NOT NULL auto_increment COMMENT &apos;编号&apos;,
           `color` varchar(10) DEFAULT &apos;&apos; COMMENT &apos;字体颜色&apos;,
           `size`  varchar(10) DEFAULT &apos;&apos; COMMENT &apos;字体大小&apos;,
           PRIMARY KEY  (`id`)
         ) DEFAULT CHARSET=utf8 AUTO_INCREMENT=0;&quot;;
      $wpdb-&gt;query( $sql );

      $sql = &quot;REPLACE INTO `{$wpdb-&gt;prefix}test` VALUES (1, &apos;#FF0000&apos;,&apos;20&apos;);&quot;;
      $wpdb-&gt;query( $sql );
   }
}

add_action( &apos;admin_menu&apos;, &apos;hc_test_create_menu&apos; );

function hc_test_create_menu() {

   //创建顶级菜单
   add_menu_page( 
      &apos;HC-TEST&apos;, 
      &apos;HC的插件&apos;,
      &apos;manage_options&apos;, 
      &apos;hc_test&apos; ,
      &apos;hc_settings_page&apos;,
      plugins_url( &apos;/images/icon.png&apos;, __FILE__ )
   );
}

function hc_settings_page() {

   global $wpdb;

   //当提交了，并且验证信息正确
   if( !empty( $_POST ) &amp;&amp; check_admin_referer( &apos;hc_test_nonce&apos; ) ) {

      //更新设置
      update_option( &apos;hc_test_bold&apos;, $_POST[&apos;hc_test_bold&apos;] );

      $wpdb-&gt;update( &quot;{$wpdb-&gt;prefix}test&quot;, array( &apos;color&apos; =&gt; $_POST[&apos;color&apos;], &apos;size&apos; =&gt; $_POST[&apos;size&apos;] ), array( &apos;id&apos; =&gt; 1 ) );
      ?&gt;
      &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;
         &lt;p&gt;&lt;strong&gt;保存成功！&lt;/strong&gt;&lt;/p&gt;
      &lt;/div&gt;
      &lt;?
   }

   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;
   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );

   $color = $row[&apos;color&apos;];
   $size = $row[&apos;size&apos;];
   ?&gt;
   &lt;div class=&quot;wrap&quot;&gt;
      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
      &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
         &lt;p&gt;&lt;label for=&quot;color&quot;&gt;字体颜色：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;color&quot; value=&quot;&lt;?php echo $color; ?&gt;&quot; /&gt;&lt;/p&gt;
         &lt;p&gt;&lt;label for=&quot;size&quot;&gt;字体大小：&lt;/label&gt;
         &lt;select name=&quot;size&quot;&gt;
            &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
            &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
            &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
            &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
            &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
         &lt;/select&gt;&lt;/p&gt;
         &lt;p&gt;&lt;label for=&quot;hc_test_obold&quot;&gt;字体加粗：&lt;/label&gt;&lt;input name=&quot;hc_test_bold&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, get_option( &apos;hc_test_bold&apos; ) ); ?&gt; /&gt; 加粗&lt;/p&gt;
         &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;保存设置&quot; /&gt;&lt;/p&gt;
         &lt;?
            //输出一个验证信息
            wp_nonce_field(&apos;hc_test_nonce&apos;);
         ?&gt;
      &lt;/form&gt;
   &lt;/div&gt;
   &lt;?
}

add_action( &apos;wp_head&apos;, &apos;hc_test_head_fun&apos; );

function hc_test_head_fun() {

   global $wpdb;

   //获取自定义数据库中的设置
   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;
   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );

   //获取options表中的设置选项
   $bold = get_option( &quot;hc_test_bold&quot; ) == 1 ? &quot;bold&quot; : &quot;normal&quot;;

   ?&gt;&lt;style&gt;body{color:&lt;? echo $row[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $row[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
}</code></pre><h4 id="使用wordpress内置api设置插件属性"><a href="#使用wordpress内置api设置插件属性" class="headerlink" title="使用wordpress内置api设置插件属性"></a>使用wordpress内置api设置插件属性</h4><pre><code># hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

add_action( &apos;admin_menu&apos;, &apos;test_create_menu&apos; );

function test_create_menu() {

   //创建顶级菜单
   add_menu_page(
      &apos;HC的插件首页&apos;,
      &apos;HC的插件&apos;,
      &apos;manage_options&apos;,
      &apos;hc_test&apos; ,
      &apos;hc_settings_page&apos;,
      plugins_url( &apos;/images/icon.png&apos;, __FILE__ )
   );
}

add_action( &apos;admin_init&apos;, &apos;register_hc_test_setting&apos; );

//使用register_setting()注册要存储的字段
function register_hc_test_setting() {

   //注册一个选项，用于装载所有插件设置项
   $option_group = &quot;hc_test_group&quot;;
   register_setting( $option_group, &apos;hc_test_option&apos; );

   //添加选项设置区域
   $setting_section = &quot;hc_test_setting_section&quot;;
   add_settings_section(
      $setting_section,
      &apos;设置&apos;,  // 标题
      &apos;hc_test_setting_section_function&apos;,  // 调用方法，自定义输出
      $option_group
   );

   //设置字体颜色
   add_settings_field(
      &apos;hc_test_color&apos;,  // 字段id
      &apos;字体颜色&apos;,  // 字段标题
      &apos;hc_test_color_function&apos;, // 字段对应函数方法
      $option_group,  // 字段对应分组
      $setting_section  // 字段对应设置选项
   );

   //设置字体大小
   add_settings_field(
      &apos;hc_test_size&apos;,
      &apos;字体大小&apos;,
      &apos;hc_test_size_function&apos;,
      $option_group,
      $setting_section
   );

   //设置字体加粗
   add_settings_field(
      &apos;hc_test_bold&apos;,
      &apos;字体加粗&apos;,
      &apos;hc_test_bold_function&apos;,
      $option_group,
      $setting_section
   );
}

function hc_test_bold_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   ?&gt;
   &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
   &lt;?
}

function hc_test_size_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   $size = $hc_test_option[&quot;size&quot;];
   ?&gt;
   &lt;select name=&quot;hc_test_option[size]&quot;&gt;
      &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
      &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
      &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
      &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
      &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
   &lt;/select&gt;
   &lt;?
}

function hc_test_color_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   ?&gt;
   &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
   &lt;?
}

function hc_settings_page() {
   ?&gt;
   &lt;div class=&quot;wrap&quot;&gt;
      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
      &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
         &lt;?
         $option_group = &quot;hc_test_group&quot;;

         //输出一些必要的字段，包括验证信息等
         settings_fields( $option_group );

         //输出选项设置区域
         do_settings_sections( $option_group );

         //输出按钮
         submit_button();
         ?&gt;
      &lt;/form&gt;
   &lt;/div&gt;
   &lt;?
}


add_action( &apos;wp_head&apos;, &apos;hc_test_head_fun&apos; );

function hc_test_head_fun() {

   $hc_test_option = get_option( &quot;hc_test_option&quot; );

   $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
   ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
}</code></pre><h4 id="将插件改写成类的形式"><a href="#将插件改写成类的形式" class="headerlink" title="将插件改写成类的形式"></a>将插件改写成类的形式</h4><pre><code>#hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);


class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );
   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;HC的插件首页&apos;,
         &apos;HC的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre><h4 id="将插件设置内容转移到wordpress设置里"><a href="#将插件设置内容转移到wordpress设置里" class="headerlink" title="将插件设置内容转移到wordpress设置里"></a>将插件设置内容转移到wordpress设置里</h4><pre><code># hc-test.php

class hcsem_change_font_style {

   var $option_group = &quot;general&quot;;  // general常规 writing撰写 reading阅读 discussion讨论 media多媒体 permalink固定链接

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );
   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre><h4 id="调用ajax"><a href="#调用ajax" class="headerlink" title="调用ajax"></a>调用ajax</h4><pre><code># hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );

      //使用ajax校验信息
      wp_enqueue_script( &apos;hc_test&apos;, plugins_url(&apos;js/hc_test.js&apos;, __FILE__), array(&apos;jquery&apos;) );
      wp_localize_script( &apos;hc_test&apos;, &apos;ajax_object&apos;, array( &apos;ajax_url&apos; =&gt; admin_url( &apos;admin-ajax.php&apos; ) ) );

      add_action( &apos;wp_ajax_color_check_action&apos; , array( $this, &apos;color_check_action_fun&apos;) );
      add_action( &apos;wp_ajax_nopriv_hcsem_description&apos; , array( $this, &apos;hcsem_description_fun&apos;) );
   }

   function color_check_action_fun(){

      if( trim( $_POST[&apos;color&apos;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }
      wp_die();
   }

   function hcsem_description_fun() {

      echo &quot;hc的笔记本：&quot; . $_POST[&apos;description&apos;];
      wp_die();

   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;HC的插件首页&apos;,
         &apos;HC的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();


# js/hc_test.js
jQuery(document).ready( function($) {
   $(&quot;input[name=&apos;hc_test_option[color]&apos;]&quot;).blur( function() {
      $.ajax({
         type: &quot;POST&quot;,
         data: &quot;color=&quot; + $(this).val() + &quot;&amp;action=hc_color_check&quot;,
         url: ajax_object.ajax_url,
         beforeSend: function() {
            $(&apos;#error_color&apos;).html(&apos;校验中...&apos;); 
         },
         success: function( $data ) {
            if( $data == &apos;ok&apos;){
                $(&apos;#error_color&apos;).html(&apos;输入正确&apos;);  
            } else {
                $(&apos;#error_color&apos;).html(&apos;颜色不能为空！&apos;); 
            }
         }
      });
   });
});


jQuery(document).ready( function($) {
   $(&quot;.description&quot;).click( function() {
      $.ajax({
         type: &quot;POST&quot;,
         data: &quot;description=&quot; + $(this).text() + &quot;&amp;action=hcsem_description&quot;,
         url: ajax_object.ajax_url,
         success : function( $data ) {

            if( $data != &quot;0&quot; ) {
               $(&quot;.description&quot;).text( $data );
            }
         }
      });
   });
});</code></pre><h4 id="实现插件翻译功能"><a href="#实现插件翻译功能" class="headerlink" title="实现插件翻译功能"></a>实现插件翻译功能</h4><pre><code>.
├── css
│   └── hc_copyrighy.css
├── hc-test.php
├── images
│   └── icon.png
├── js
│   └── hc_test.js
└── languages
    ├── zh_CN.mo
    └── zh_CN.po



# hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );

      //使用ajax校验信息
      wp_enqueue_script( &apos;hc_test&apos;, plugins_url(&apos;js/hc_test.js&apos;, __FILE__), array(&apos;jquery&apos;) );
      wp_localize_script( &apos;hc_test&apos;, &apos;ajax_object&apos;, array( &apos;ajax_url&apos; =&gt; admin_url( &apos;admin-ajax.php&apos; ) ) );

      add_action( &apos;wp_ajax_color_check_action&apos; , array( $this, &apos;color_check_action_fun&apos;) );
      add_action( &apos;wp_ajax_nopriv_hcsem_description&apos; , array( $this, &apos;hcsem_description_fun&apos;) );

      add_action( &apos;init&apos;, array( $this, &apos;hcsem_load_textdomain&apos; ) );
   }

   function hcsem_load_textdomain() {

      //加载 languages 目录下的翻译文件 zh_CN
      $currentLocale = get_locale();

      if( !empty( $currentLocale ) ) {

         $moFile = dirname(__FILE__) . &quot;/languages/{$currentLocale}.mo&quot;;

         if( @file_exists( $moFile ) &amp;&amp; is_readable( $moFile ) ) load_textdomain( &apos;hc-test&apos;, $moFile );
      }
   }

   function color_check_action_fun(){

      if( trim( $_POST[&apos;color&apos;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }
      wp_die();
   }

   function hcsem_description_fun() {

      echo &quot;HC的笔记本：&quot; . $_POST[&apos;description&apos;];
      wp_die();

   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         __( &apos;color&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         __( &apos;size&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         __( &apos;bold&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; &lt;? _e( &apos;set bold&apos;, &apos;hc-test&apos; ); ?&gt;
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;hc的插件首页&apos;,
         &apos;hc的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">www.zhuohc.om</p>
  <div class="site-description motion-element" itemprop="description">技术博客、日记记录</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>













          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">www.zhuohc.om</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  

















  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>














<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
