<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>zhuohc.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="技术博客、日记记录">
<meta property="og:type" content="website">
<meta property="og:title" content="zhuohc.com">
<meta property="og:url" content="http://www.zhuohc.com/page/3/index.html">
<meta property="og:site_name" content="zhuohc.com">
<meta property="og:description" content="技术博客、日记记录">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zhuohc.com">
<meta name="twitter:description" content="技术博客、日记记录">
  
    <link rel="alternate" href="/atom.xml" title="zhuohc.com" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zhuohc.com</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">我的个人网站</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.zhuohc.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-ubuntu-e9-85-8d-e7-bd-aegitlab-e6-9c-8d-e5-8a-a1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/19/ubuntu-e9-85-8d-e7-bd-aegitlab-e6-9c-8d-e5-8a-a1/" class="article-date">
  <time datetime="2017-06-19T06:18:48.000Z" itemprop="datePublished">2017-06-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/19/ubuntu-e9-85-8d-e7-bd-aegitlab-e6-9c-8d-e5-8a-a1/">ubuntu配置Gitlab服务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <pre><code># 安装相关服务 postfix为邮件服务
sudo apt-get install curl openssh-server ca-certificates postfix


# 安装gitlab服务包
curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash
sudo apt-get install gitlab-ce


# 配置服务
sudo vim /etc/gitlab/gitlab.rb

## GitLab URL
##! URL on which GitLab will be reachable.
##! For more details on configuring external_url see:
##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
external_url &apos;http:/192.168.0.19:1500&apos;    # 地址

.
.
.
# 邮件基本设置
### Email Settings
gitlab_rails[&apos;gitlab_email_enabled&apos;] = true
gitlab_rails[&apos;gitlab_email_from&apos;] = &apos;admin@uscnk.com&apos;
gitlab_rails[&apos;gitlab_email_display_name&apos;] = &apos;Gitlab&apos;
gitlab_rails[&apos;gitlab_email_reply_to&apos;] = &apos;admin@uscnk.com&apos;
gitlab_rails[&apos;gitlab_email_subject_suffix&apos;] = &apos;Gitlab&apos;

.
.
.
### GitLab email server settings
###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html
###! **Use smtp instead of sendmail/postfix.**

# gitlab_rails[&apos;smtp_enable&apos;] = true
# gitlab_rails[&apos;smtp_address&apos;] = &quot;smtp.server&quot;
# gitlab_rails[&apos;smtp_port&apos;] = 465
# gitlab_rails[&apos;smtp_user_name&apos;] = &quot;smtp user&quot;
# gitlab_rails[&apos;smtp_password&apos;] = &quot;smtp password&quot;
# gitlab_rails[&apos;smtp_domain&apos;] = &quot;example.com&quot;
# gitlab_rails[&apos;smtp_authentication&apos;] = &quot;login&quot;
# gitlab_rails[&apos;smtp_enable_starttls_auto&apos;] = true
# gitlab_rails[&apos;smtp_tls&apos;] = false

# 邮件服务地址
# QQ exmail (腾讯企业邮箱)
gitlab_rails[&apos;smtp_enable&apos;] = true
gitlab_rails[&apos;smtp_address&apos;] = &quot;smtp.exmail.qq.com&quot;
gitlab_rails[&apos;smtp_port&apos;] = 465
gitlab_rails[&apos;smtp_user_name&apos;] = &quot;admin@uscnk.com&quot;
gitlab_rails[&apos;smtp_password&apos;] = &quot;xxxxxxxxx&quot;
gitlab_rails[&apos;smtp_authentication&apos;] = &quot;login&quot;
gitlab_rails[&apos;smtp_enable_starttls_auto&apos;] = true
gitlab_rails[&apos;smtp_tls&apos;] = true
gitlab_rails[&apos;gitlab_email_from&apos;] = &apos;admin@uscnk.com&apos;


# nginx基本设置
################################################################################
## GitLab Nginx
##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html
################################################################################

nginx[&apos;listen_addresses&apos;] = [&apos;192.168.0.19&apos;]
nginx[&apos;losten_port&apos;] = 1500



# 重启服务
sudo gitlab-ctl reconfigure
# 重启邮件服务
sudo /etc/init.d/postfix restart
# 访问
http://192.168.0.19:1500
Username: root
Password: 5iveL!fe</code></pre><h3 id="github与gitlab共存"><a href="#github与gitlab共存" class="headerlink" title="github与gitlab共存"></a>github与gitlab共存</h3><pre><code># github账户邮箱， 将id_rsa改名成id_rsa_github
ssh-keygen -t rsa -C &quot;xxxxx@gmail.com&quot;
# gitlab公司邮箱， 将id_rsa改名成id_rsa_gitlab
ssh-keygen -t rsa -C &quot;xxxxxx@work.com&quot;
# 添加私钥
ssh-add ~/.ssh/id_rsa_github
ssh-add ~/.ssh/id_rsa_gitlab


#在 ~/.ssh 目录下新建一个config文件
touch config
chmod 755 conifg


# 并添加以下内容
# gitlab
Host github.com
    HostName github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_github
# github
Host gitlib.com
    HostName gitlib.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/id_rsa_gitlab


# 将id_rsa_github.pab内容添加到github中
# 测试结果
ssh -T git@github.com
# 将id_rsa_gitlab.pab内容添加到gitlab中



cd ~/mytest
# 在github中测试
git remote add github https://github.com/zhcshine/mytest.git
git push -u github master
# 在gitlab中测试
git remote add gitlab http://192.168.0.19:1500/zhcshine/mytest.git
git push -u gitlab master</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2017/06/19/ubuntu-e9-85-8d-e7-bd-aegitlab-e6-9c-8d-e5-8a-a1/" data-id="cjyfelqwh002scta4iof3qj7j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-centos7-e5-88-9b-e5-bb-banagios-e7-9b-91-e6-8e-a7-e9-9b-86-e7-be-a4-e6-9c-8d-e5-8a-a1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/20/centos7-e5-88-9b-e5-bb-banagios-e7-9b-91-e6-8e-a7-e9-9b-86-e7-be-a4-e6-9c-8d-e5-8a-a1/" class="article-date">
  <time datetime="2017-04-20T03:17:12.000Z" itemprop="datePublished">2017-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/centos7-e5-88-9b-e5-bb-banagios-e7-9b-91-e6-8e-a7-e9-9b-86-e7-be-a4-e6-9c-8d-e5-8a-a1/">centos7创建nagios监控集群服务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安装服务器端192-168-0-206"><a href="#安装服务器端192-168-0-206" class="headerlink" title="安装服务器端192.168.0.206"></a>安装服务器端192.168.0.206</h3><p>1,安装lamp环境 <a href="http://www.zhuohc.com/articles/centos7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">参考</a> 2, 配置nagios服务</p>
<pre><code># 创建nagiso用户
$ sudo useradd nagios
# 创建apache用户，yum安装httpd服务会自动创建
$ sudo useradd apache -M -s /sbin/nologin
useradd：用户“apache”已存在
# 创建nagcmd用户组
$ sudo groupadd nagcmd
# 将usermod加入nagcmd用户组
sudo usermod -a -G nagcmd nagios
# 将apache用户加入nagcmd用户组
$ sudo usermod -a -G nagcmd apache
# 查看nagios用户所属的组
$ id -n -G nagios
nagios nagcmd
# 查看apace用户所属的组
$ id -n -G apache
apache nagcmd
# 安装nagiso服务
$sudo yum install nagios
$sudo yum install nagios-plugins-all
# 安装nrpe（服务器端和客户端都需要安装）
$sudo yum install nrpe
# 启动和开机启动
$sudo systemctl start nagios
$sudo systemctl enable nagios
$sudo systemctl start nrpe
$sudo systemctl enable nrpe</code></pre><p>3,配置web</p>
<pre><code># 取消认证
$ sudo vim /etc/nagios/cgi.cfg
use_authentication=0 # 此处将1改为0
# 查看配置文件
$ls /etc/httpd/conf.d
autoindex.conf  nagios.conf  php.conf  README  userdir.conf  welcome.conf  xcache.conf
# 其中nagiso.conf就是nagios的web配置文件
# 访问http://192.168.0.206/nagios，其中登陆密码在/etc/nagios/passwd文件中，具体文件位置可以在/etc/httpd/conf.d/nagios.conf中查看</code></pre><h3 id="安装客户端192-168-0-208"><a href="#安装客户端192-168-0-208" class="headerlink" title="安装客户端192.168.0.208"></a>安装客户端192.168.0.208</h3><pre><code># 安装mysql，参考上方链接，配合生成check_mysql插件
# 安装nrpe（服务器端和客户端都需要安装）
$ sudo yum -y install epel-release
$ sudo yum install nrpe
$ sudo yum install nagios-plugins-all
# 配置nagios客户端
$ sudo vim /etc/nagios/nrpe.cfg
allowed_hosts=127.0.0.1,192.168.0.206 # 监控当前客户端的nagios服务器地址
# 启动服务
$ sudo systemctl restart nrpe
$ sudo systemctl enable nrpe
# 检查启动结果
$ sudo netstat -lntup | grep nrpe
tcp        0      0 0.0.0.0:5666            0.0.0.0:*               LISTEN      2540/nrpe           
tcp6       0      0 :::5666                 :::*                    LISTEN      2540/nrpe
$ sudo ps -ef | grep nrpe | grep -v grep
nrpe      2540     1  0 11:59 ?        00:00:00 /usr/sbin/nrpe -c /etc/nagios/nrpe.cfg -d</code></pre><h3 id="配置服务器端192-168-0-206"><a href="#配置服务器端192-168-0-206" class="headerlink" title="配置服务器端192.168.0.206"></a>配置服务器端192.168.0.206</h3><pre><code>$ tree /etc/nagios
.
├── cgi.cfg  
├── conf.d  # 添加新的监视客户端信息
│   └── web_one.cfg
├── nagios.cfg  # 配置服务器端nagios
├── nrpe.cfg # 配置服务器端nrpe
├── objects
│   ├── commands.cfg
│   ├── contacts.cfg
│   ├── localhost.cfg
│   ├── printer.cfg
│   ├── switch.cfg
│   ├── templates.cfg
│   ├── timeperiods.cfg
│   └── windows.cfg
├── passwd
└── private
    └── resource.cfg
$ cp /etc/nagios/objects/localhost.cfg  /etc/nagios/conf.d/web_one.cfg
$ vim /etc/nagios/conf.d/web_one.cfg # 将localhost 改成web_one
define host{
        use                     linux-server  
        host_name         web_one
        alias                   web_one
        address              192.168.0.208
}
define service{
        use                             local-service 
        host_name                 web_one
        service_description    PING
        check_command        check_ping!100.0,20%!500.0,60%
}</code></pre><h3 id="查看结果"><a href="#查看结果" class="headerlink" title="查看结果"></a>查看结果</h3><p><img src="http://www.zhuohc.com/wp-content/uploads/2017/04/nagios.png" alt="nagios"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2017/04/20/centos7-e5-88-9b-e5-bb-banagios-e7-9b-91-e6-8e-a7-e9-9b-86-e7-be-a4-e6-9c-8d-e5-8a-a1/" data-id="cjyfelqvm000fcta4k67dlohq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-centos7-e9-85-8d-e7-bd-aekeepalived-e5-ae-9e-e7-8e-b0-e9-ab-98-e5-8f-af-e7-94-a8-e9-9b-86-e7-be-a4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/19/centos7-e9-85-8d-e7-bd-aekeepalived-e5-ae-9e-e7-8e-b0-e9-ab-98-e5-8f-af-e7-94-a8-e9-9b-86-e7-be-a4/" class="article-date">
  <time datetime="2017-04-19T06:30:29.000Z" itemprop="datePublished">2017-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/19/centos7-e9-85-8d-e7-bd-aekeepalived-e5-ae-9e-e7-8e-b0-e9-ab-98-e5-8f-af-e7-94-a8-e9-9b-86-e7-be-a4/">centos7配置keepalived实现高可用集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="CENTOS6-8-192-168-0-106-MASTER"><a href="#CENTOS6-8-192-168-0-106-MASTER" class="headerlink" title="CENTOS6.8 192.168.0.106 MASTER"></a>CENTOS6.8 192.168.0.106 MASTER</h3><pre><code># 安装
sudo yum install keepalived
# 配置
sudo vim /etc/keepalived/keepalived.conf

! Configuration File for keepalived

global_defs {
    # 这些信息是配置报警发邮件信息
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
     # 路由标识，同一局域网应该唯一
   router_id lb01
}
vrrp_instance VI_1 {
    # 当前角色是master
    state MASTER
        # 对外提供网络的接口
    interface eth0
        # 虚拟路由id标识，数字，必须和backup里相同实例一致
    virtual_router_id 55
        # 优先级，数字必须比backup大
    priority 150
    advert_int 1
        # 权限认证，和backup一致
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
       192.168.0.200
    }
}

# 重启
sudo /etc/init.d/keepalived restart
# 查看结果
ip addr | grep 192.168.0.200</code></pre><h3 id="CENTOS7-2-192-168-0-209-BACKUP"><a href="#CENTOS7-2-192-168-0-209-BACKUP" class="headerlink" title="CENTOS7.2 192.168.0.209 BACKUP"></a>CENTOS7.2 192.168.0.209 BACKUP</h3><pre><code># 安装
sudo yum install keepalived
# 配置
sudo vim /etc/keepalived/keepalived.conf

! Configuration File for keepalived

global_defs {
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id lb02  # 和master不一致
}

vrrp_instance VI_1 {
    state BACKUP      # 和MASTER不一致
    interface enp0s3
    virtual_router_id 55
    priority 100      # 和master不一致
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.0.200
    }
}
# 重启
sudo systemctl restart keepalived
# 查看结果
ip addr | grep 192.168.0.200</code></pre><h3 id="CENTOS6-8-192-168-0-106-nginx配置"><a href="#CENTOS6-8-192-168-0-106-nginx配置" class="headerlink" title="CENTOS6.8 192.168.0.106 nginx配置"></a>CENTOS6.8 192.168.0.106 nginx配置</h3><pre><code># nginx配置文件
    server {
        listen       192.168.0.200:80; # 这里需要指定虚拟vip监听
        server_name  localhost;

        location / {
                  # 只访问web站点
           proxy_pass http://www_server_pools;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }</code></pre><h3 id="CENTOS7-2-192-168-0-209-配置nginx"><a href="#CENTOS7-2-192-168-0-209-配置nginx" class="headerlink" title="CENTOS7.2 192.168.0.209 配置nginx"></a>CENTOS7.2 192.168.0.209 配置nginx</h3><pre><code># nginx配置文件
   server {
        listen       192.168.0.200:80;
        server_name  localhost;

        location / {
                     # 只访问phone站点
           proxy_pass http://www_phone_pools;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }</code></pre><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><pre><code># 开启192.168.0.106，192.168.0.209的keepalive服务

# 查看192.168.0.106
$ ip addr | grep 192.168.0.200
inet 192.168.0.200/32 scope global eth0 # 应该有这行结果

# 查看192.168.0.209
$ ip addr | grep 192.168.0.200 # 结果应该为空，如果有结果，表示脑裂，检查相关配置和防火墙

# 访问http://192.168.200 
curl 192.168.0.200 # 结果应该只访问web网站


# 关停192.168.0.106的keepalive服务

# 访问http://192.168.200 
curl 192.168.0.200 # 结果应该只访问phone网站

# 查看192.168.0.106
$ ip addr | grep 192.168.0.200
inet 192.168.0.200/32 scope global eth0 # 结果应该为空

# 查看192.168.0.209
$ ip addr | grep 192.168.0.200 
inet 192.168.0.200/32 scope global enp0s3 # 此时有这行结果

# 重启192.168.0.106的keepalive服务，应该恢复之前的测试结果</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2017/04/19/centos7-e9-85-8d-e7-bd-aekeepalived-e5-ae-9e-e7-8e-b0-e9-ab-98-e5-8f-af-e7-94-a8-e9-9b-86-e7-be-a4/" data-id="cjyfelqvp000kcta4bsvhvsr3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-unittest-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/30/unittest-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/" class="article-date">
  <time datetime="2016-11-30T03:13:19.000Z" itemprop="datePublished">2016-11-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/30/unittest-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/">Unittest单元测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="unittest基础使用方法"><a href="#unittest基础使用方法" class="headerlink" title="unittest基础使用方法"></a>unittest基础使用方法</h4><pre><code># -*- coding:utf-8 -*-
# calculator.py
# 需要测试的类
class Count:

    def __init__(self, a, b):
        self.a = int(a)
        self.b = int(b)

    def add(self):
        return self.a + self.b



# -*- coding: utf-8 -*-
# test.py 测试类
from calculator import Count
import unittest
class TestCount(unittest.TestCase):
    def setUp(self):
        print &apos;test start&apos;

    def test_add(self):
        j = Count(2,3)
        self.assertEqual(j.add(), 5)

    def test_add2(self):
        j = Count(41, 76)
        self.assertEqual(j.add(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    # unittest.main()
    # 构造测试集
    suite = unittest.TestSuite()
    # 指定测试方法
    suite.addTest(TestCount(&apos;test_add2&apos;))
    # 执行测试
    runner = unittest.TextTestRunner()
    runner.run(suite)</code></pre><h4 id="自动识别测试用例"><a href="#自动识别测试用例" class="headerlink" title="自动识别测试用例"></a>自动识别测试用例</h4><pre><code># -*- coding:utf-8 -*-
# calculator.py
# 需要测试的类
class Count:

    def __init__(self, a, b):
        self.a = int(a)
        self.b = int(b)

    def add(self):
        return self.a + self.b

    def sub(self):
        return self.a - self.b


# -*- coding: utf-8 -*-
# testadd.py 测试类
from calculator import Count
import unittest
class TestAdd(unittest.TestCase):
    def setUp(self):
        print &apos;test add start&apos;

    def test_add(self):
        j = Count(2,3)
        self.assertEqual(j.add(), 5)

    def test_add2(self):
        j = Count(41, 76)
        self.assertEqual(j.add(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test add end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    unittest.main()


# -*- coding: utf-8 -*-
# testsub.py 测试类
from calculator import Count
import unittest


class TestSub(unittest.TestCase):
    def setUp(self):
        print &apos;test sub start&apos;

    def test_sub(self):
        j = Count(2,3)
        self.assertEqual(j.sub(), 5)

    def test_sub2(self):
        j = Count(41, 76)
        self.assertEqual(j.sub(), 115, &apos;not equal&apos;)

    def tearDown(self):
        print &apos;test sub end&apos;


if __name__ == &apos;__main__&apos;:
    # 测试全部方法
    unittest.main()


# -*- coding: utf-8 -*-
# runtest.py
import unittest
test_dir = &apos;./&apos;
discover = unittest.defaultTestLoader.discover(test_dir, pattern=&apos;test*.py&apos;)
if __name__ == &apos;__main__&apos;:
    runner = unittest.TextTestRunner()
    runner.run(discover)</code></pre><h4 id="断言方法啊"><a href="#断言方法啊" class="headerlink" title="断言方法啊"></a>断言方法啊</h4><pre><code># unittest.TestCase.assertEqual(a, b, msg=None)   a == b
# unittest.TestCase.assertNotEqual(a, b) a !=b  
# unittest.TestCase.assertTrue(x)   x is True
# unittest.TestCase.assertFalse(x)  x is False
# unittest.TestCase.assertIs(a, b)  x is b
# unittest.TestCase.assertIsNot(a, b)  a is not b
# unittest.TestCase.assertIsNotNone(x)  x is not None
# unittest.TestCase.assertIn(a, b)  a in b
# unittest.TestCase.assertNotIn(a, b) a not in b
# unittest.TestCase.assertNotIsInstance(a, b) isinstance(a,b)
# unittest.TestCase.assertNotIsInstance(a, b) not isinstance(a,b)</code></pre><h4 id="跳过测试与预期失败"><a href="#跳过测试与预期失败" class="headerlink" title="跳过测试与预期失败"></a>跳过测试与预期失败</h4><pre><code># -*- coding: utf-8 -*-
# test.py
import unittest

class MyTest(unittest.TestCase):

    def setUp(self):
        pass
    def tearDown(self):
        pass

    @unittest.skip(u&apos;直接跳过测试&apos;)
    def test_skip(self):
        print &apos;test aaa&apos;

    @unittest.skipIf(3 &gt; 2, u&apos;条件满足时跳过测试&apos;)
    def test_skip_if(self):
        print &apos;test bbb&apos;

    @unittest.skipUnless(3 &gt; 2, u&apos;条件满足时执行测试&apos;)
    def test_skip_unless(self):
        print &apos;test ccc&apos;

    # 不管测试成功与否，都标记为失败
    @unittest.expectedFailure
    def test_expected_failure(self):
        print &apos;test ddd&apos;
        self.assertEqual(2, 3)

if __name__ == &apos;__main__&apos;:
    unittest.main()</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/30/unittest-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/" data-id="cjyfelqwp0035cta4bfv7ryit" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-selenium-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/30/selenium-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" class="article-date">
  <time datetime="2016-11-30T01:37:47.000Z" itemprop="datePublished">2016-11-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/30/selenium-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/">Selenium基础入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="安装及基本操作"><a href="#安装及基本操作" class="headerlink" title="安装及基本操作"></a>安装及基本操作</h4><pre><code># -*- coding:utf-8 -*-
# 环境: ubuntu14.04
# pip install seleninum
# firefox
# https://github.com/mozilla/geckodriver/releases 下载对应版本放在$PATH目录下
# google
# https://sites.google.com/a/chromium.org/chromedriver/downloads 下载对应版本放在$PATH目录下
# http://www.seleniumhq.org/download/    其他浏览器参考
# sudo apt-get install phantomjs  安装无界面webkit浏览器引擎
from selenium import webdriver
from selenium.webdriver.common.by import By

driver = webdriver.Firefox()
# driver = webdriver.Chrome()
# driver =  webdriver.PhantomJS(executable_path=&apos;/usr/bin/phantomjs&apos;)
driver.get(&apos;http://www.baidu.com&apos;)

# 定位元素
# 根据id定位
find_id = driver.find_element_by_id(&apos;wrapper&apos;)
find_id = driver.find_element(By.ID, &apos;wrapper&apos;)
# 根据name属性定位
find_name = driver.find_element_by_name(&apos;wd&apos;)
find_name = driver.find_element(By.NAME, &apos;wd&apos;)
# 根据class定位
find_class = driver.find_element_by_class_name(&apos;head_wrapper&apos;)
find_class = driver.find_element(By.CLASS_NAME, &apos;head_wrapper&apos;)
# 根据标签名称定位
find_tag = driver.find_element_by_tag_name(&apos;div&apos;)
find_tag = driver.find_element(By.TAG_NAME, &apos;div&apos;)
# 根据链接文本定位
find_a_text = driver.find_element_by_link_text(&apos;hao123&apos;)
find_a_text = driver.find_element(By.LINK_TEXT, &apos;hao123&apos;)
# 根据部分链接文本定位
find_a_text = driver.find_element_by_partial_link_text(&apos;hao&apos;)
find_a_text = driver.find_element(By.PARTIAL_LINK_TEXT, &apos;hao&apos;)
# 根据绝对位置定位
find_x_path = driver.find_elements_by_xpath(&apos;/html/body/div&apos;)
find_x_path = driver.find_element(By.XPATH, &apos;/html/body/div&apos;)
# 支持层级，属性，逻辑运算符结合使用
find_x_path = driver.find_element_by_xpath(&quot;//input[@id=&apos;kw&apos;]&quot;)  # // 当前目录下的某个目录下
# Css定位
find_css = driver.find_elements_by_css_selector(&apos;.s_ipt&apos;)
find_css = driver.find_element(By.CSS_SELECTOR, &apos;.s_ipt&apos;)

# 设置浏览器宽高
driver.set_window_size(480, 800)
driver.get(&apos;http://www.126.com&apos;)
# 控制浏览器前进倒退
driver.back()
driver.forward()
# 刷新浏览器(F5)
driver.refresh()
# 当前页面
print driver.current_url()
# 元素操作
# dom = driver.find_element(By.ID, &apos;kw&apos;)
# dom.clear()  # 清除文本
# dom.send_keys()  # 模拟键盘输入
# dom.click()  # 点击元素
# dom.submit()  # 模拟表单提交
# dom.size()  # 返回元素的尺寸
# dom.text()  # 返回元素的文本
# dom.get_attribute(name)  # 返回元素的属性值
# dom.is_displayed()  # 设置该元素是否可见

# 鼠标操作
from selenium.webdriver.common.action_chains import ActionChains
driver.get(&apos;http://www.baidu.com&apos;)
# context_click 鼠标右键点击
right_click = driver.find_element_by_id(&apos;xx&apos;)
# perform 执行所有ActionChains中存储的动作
ActionChains(driver).context_click(right_click).perform()
# above 鼠标悬停
above = driver.find_element_by_id(&apos;xxx&apos;)
ActionChains(driver).move_to_element(above).perform()
# double_click 鼠标双击
# drag_and_drop(source, target) 鼠标拖放


# 键盘事件
from selenium.webdriver.common.keys import Keys
find_id.send_keys(Keys.BACK_SPACE) # 删除键
find_id.send_keys(Keys.SPACE)  # 空格键
find_id.send_keys(Keys.TAB)  # tab键
find_id.send_keys(Keys.ESCAPE)  # ESC
find_id.send_keys(Keys.ENTER)  # 回车键
find_id.send_keys(Keys.CONTROL, &apos;c&apos;)  # 复制
find_id.send_keys(Keys.CONTROL, &apos;v&apos;)  # 剪贴
find_id.send_keys(Keys.F1) # F1

# driver.quit()</code></pre><h4 id="webdriver原理"><a href="#webdriver原理" class="headerlink" title="webdriver原理"></a>webdriver原理</h4><pre><code># -*- coding:utf-8 -*-
from selenium import webdriver
import logging

logging.basicConfig(level=logging.DEBUG)
driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
driver.quit()</code></pre><h4 id="显示等待"><a href="#显示等待" class="headerlink" title="显示等待"></a>显示等待</h4><pre><code># -*- coding:utf-8 -*-
# 显示等待
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
# 显示等待
# 参数driver： 浏览器驱动
# 参数timeout： 最大超时时间，单位秒
# 参数poll_frequency： 检测的间隔时间，默认为0.5秒
# 参数ignored_exceptions: 超时异常信息，默认为NoSuchElementException
# WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)
# until(method, message=&apos;&apos;) 调用该方法提供的驱动程序作为参数，直到返回True
# until_not(method, message=&apos;&apos;) 调用该方法提供的驱动程序作为参数，直到返回False
# EC.title_is 判断当前页面的标题是否是否等于预期
# EC.title_contains 判断当前页面的标题是否包含预期的字符串
# EC.presence_of_element_located 判断元素是否被加载在DOM树中，并不代表当前元素可见
# EC.visibility_of_element_located 判断元素是否可见（可见并非代表元素非隐藏，并且元素的宽和高均不等于0）
# EC.visibility_of 与visibility_of_element_located相同，该方法接受的参数为定位后的元素
# EC.presence_of_all_elements_located 判断是否至少有一个元素存在与DOM树中
# EC.text_to_be_present_in_element 判断某个元素的text是否包含预期的字符串
# EC.text_to_be_present_in_element_value 判断某个元素的vaule属性是否包含了预期的字符串
# EC.frame_to_be_available_and_switch_to_it 判断该表单是否可以切换进去，如果可以，返回True并switch进去，否则返回false
# EC.invisibility_of_element_located 判断某个元素是否不存在于DOM树中或者不可见
# EC.element_to_be_clickable 判断某个元素是否可以点击
# EC.staleness_of 等到一个元素从DOM树中移除
# EC.element_to_be_selected 判断某个元素是否被选中，一般用于下拉菜单
# EC.element_selection_state_to_be 判断某个元素的选中状态是否符合预期, 参数为定位后的元素
# EC.element_located_selection_state_to_be 判断某个元素的选中状态是否符合预期,该方法接受的参数为定位
# EC.alert_is_present 判断页面上是否有alert
# driver.find_element_by_id().is_displayed() 判断元素是否可见
element = WebDriverWait(driver, 5, 0.5).until(EC.presence_of_element_located((By.ID, &apos;kw&apos;)))
element.send_keys(&apos;selenium&apos;)
# driver.quit()</code></pre><h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><pre><code># -*- coding:utf-8 -*-
# 隐式等待
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException
from time import ctime
from time import sleep
driver = webdriver.Firefox()
# sleep(10)
driver.implicitly_wait(10)
driver.get(&apos;http://www.baidu.com&apos;)
print ctime()
try:
    driver.find_element_by_id(&apos;kw22&apos;).send_keys(&apos;selenium&apos;)
except NoSuchElementException as e:
    print e
finally:
    print ctime()</code></pre><h4 id="执行js代码"><a href="#执行js代码" class="headerlink" title="执行js代码"></a>执行js代码</h4><pre><code># -*- coding:utf-8 -*-
# 执行js代码
from selenium import webdriver
from time import sleep

# 访问百度
driver = webdriver.Firefox()
driver.get(&apos;http://www.baidu.com&apos;)
driver.set_window_size(600, 600)
driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
sleep(2)

js = &apos;window.scrollTo(100, 450);&apos;
driver.execute_script(js)
sleep(3)

# driver.quit()</code></pre><h4 id="处理cookie"><a href="#处理cookie" class="headerlink" title="处理cookie"></a>处理cookie</h4><pre><code># -*- coding:utf-8 -*-
# cookie处理
from selenium import webdriver
driver = webdriver.Firefox()
driver.get(&apos;http://www.youdao.com&apos;)
driver.add_cookie({&apos;name&apos;: &apos;name-a&apos;, &apos;value&apos;: &apos;value-b&apos;})
# 获取cookie信息
cookies = driver.get_cookies()
print cookies
for cookie in cookies:
    print cookie
    print &apos;{} -&gt; {}&apos;.format(cookie[&apos;name&apos;], cookie[&apos;value&apos;])
driver.quit()</code></pre><h4 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h4><pre><code># -*- coding:utf-8 -*-
# 窗口截图
from selenium import webdriver
from time import sleep

# driver = webdriver.Firefox()
driver =  webdriver.PhantomJS(executable_path=&apos;/usr/bin/phantomjs&apos;)
driver.get(&apos;http://www.baidu.com&apos;)

driver.find_element_by_id(&apos;kw&apos;).send_keys(&apos;selenium&apos;)
driver.find_element_by_id(&apos;su&apos;).click()
sleep(2)

driver.get_screenshot_as_file(&apos;./screen.png&apos;)
driver.quit()</code></pre><h4 id="播放视频"><a href="#播放视频" class="headerlink" title="播放视频"></a>播放视频</h4><pre><code># -*- coding:utf-8 -*-
from selenium import webdriver
from time import sleep

driver = webdriver.Firefox()
driver.get(&apos;http://videojs.com&apos;)

video = driver.find_element_by_xpath(&apos;body/Setion[1]/div/video&apos;)
# 返回播放文件地址
url = driver.execute_script(&apos;return arguments[0].currentSrc;&apos;, video)
print url

# 播放视频
print &apos;start&apos;
driver.execute_script(&apos;return arguments[0].play()&apos;, video)

# 播放15秒
sleep(15)

# 暂停播放
print &apos;stop&apos;
driver.execute_script(&apos;arguments[0].pause()&apos;, video)

# driver.quit()</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/30/selenium-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" data-id="cjyfelqx10049cta4v4sceefx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-wordpress-e6-8f-92-e4-bb-b6-e5-bc-80-e5-8f-91-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/wordpress-e6-8f-92-e4-bb-b6-e5-bc-80-e5-8f-91-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" class="article-date">
  <time datetime="2016-11-10T03:40:48.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/wordpress-e6-8f-92-e4-bb-b6-e5-bc-80-e5-8f-91-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/">Wordpress插件开发基础入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="创建插件"><a href="#创建插件" class="headerlink" title="创建插件"></a>创建插件</h4><pre><code>├── hanchang-copyright
│   └── hanchang-copyright.php



# hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/</code></pre><h4 id="插件启用和停用初始化"><a href="#插件启用和停用初始化" class="headerlink" title="插件启用和停用初始化"></a>插件启用和停用初始化</h4><pre><code># hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hanchang_copyright_install&apos;);

function hanchang_copyright_install() {

    //插件启动，添加一个默认的版权信息
    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&apos;color:red&apos;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );

}

//定义插件停用时候调用的方法
register_deactivation_hook( __FILE__, &apos;hanchang_copyright_deactivation&apos;);

function hanchang_copyright_deactivation() {

    //插件停用，设置停用标识为1
    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );

}</code></pre><h4 id="删除插件"><a href="#删除插件" class="headerlink" title="删除插件"></a>删除插件</h4><pre><code>.
├── hanchang-copyright.php
└── uninstall.php # 删除插件执行的文件


# uninstall.php
&lt;?
// 如果 uninstall 不是从 WordPress 调用，则退出
if( !defined( &apos;WP_UNINSTALL_PLUGIN&apos; ) )
exit();

//删除插件创建的项目，以确保不占用数据库资源
delete_option( &apos;hanchang_copyright_deactivation&apos; );
delete_option( &apos;hanchang_copyright_text&apos; );</code></pre><h4 id="add-action"><a href="#add-action" class="headerlink" title="add_action"></a>add_action</h4><pre><code>add_action(&quot;$tag钩子名称&quot;, &quot;$function_to_do执行函数&quot;, $priorrity执行优先级, $accepted_arga带参数函数的参数个数)


# hanchang-copyright.php

//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert
add_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );

function hc_copyright_insert(){

    //输出一段字符串
    echo get_option( &quot;hc_copyright_text&quot; );

}


add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );

function hanchang_copyright_insert_new() {
    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;
}

add_action( &apos;save_post&apos;, &apos;save_post_meta&apos;, 10, 2 );

function save_post_meta( $post_id, $post ) {

    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );

}</code></pre><h4 id="常见钩子"><a href="#常见钩子" class="headerlink" title="常见钩子"></a>常见钩子</h4><pre><code>init 加载初始化
wp_head 加载添加到head标签中的内容
wp_enqueue_scripts 加载css或者js文件
wp_foot 加载添加到底部内容

save_post 添加保存文章
wp_trash_post 将文章添加到回收站
delete_post 将文章删除

wp_insert_comment 插入评论

user_register 用户注册


# hanchang-copyright.php
&lt;?php
/*
Plugin Name: hanchang-copyright
Plugin URI: http://www.zhuohc.com
Description: 在页脚显示一段版权信息
Version: 1.0
Author: hanchang
Author URI: http://www.zhuohc.com
License: GPLv2
*/

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hanchang_copyright_install&apos;);

function hanchang_copyright_install() {

    //插件启动，添加一个默认的版权信息
    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&apos;color:red&apos;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );

}

//定义插件停用时候调用的方法
register_deactivation_hook( __FILE__, &apos;hanchang_copyright_deactivation&apos;);

function hanchang_copyright_deactivation() {

    //插件停用，设置停用标识为1
    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );

}

//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert
add_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );

function hc_copyright_insert(){

    //输出一段字符串
    echo get_option( &quot;hc_copyright_text&quot; );

}


add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );

function hanchang_copyright_insert_new() {
    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;
}

add_action( &apos;save_post&apos;, &apos;save_post_meta&apos;, 10, 2 );

function save_post_meta( $post_id, $post ) {

    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );

}



//在输出内容之前，给页面管理添加摘要功能
add_action( &apos;init&apos;, &apos;hc_add_excerpts_to_pages&apos; );

function hc_add_excerpts_to_pages() {

    //给页面管理添加摘要的功能
    add_post_type_support( &apos;page&apos;, array( &apos;excerpt&apos; ) );
}

//wp_head钩子
add_action(&apos;wp_head&apos;,&apos;hc_wp_head&apos;);

function hc_wp_head() {

    //只有首页输出描述
    if( is_home() ){ ?&gt;
        &lt;meta name=&quot;description&quot; content=&quot;&lt;? bloginfo(&apos;description&apos;); ?&gt;&quot; /&gt;
    &lt;? }

}


//自定义引用样式表
function hc_enqueue_style() {
    wp_enqueue_style( &apos;core&apos;, plugins_url(&apos;css/hc_copyrighy.css&apos;, __FILE__) , false );
}

//自定义引用脚本文件
function hc_enqueue_script() {
    wp_enqueue_script( &apos;my-js&apos;, plugins_url(&apos;js/hc_copyrighy.js&apos;, __FILE__), false );
}

//引用文件的钩子
add_action( &apos;wp_enqueue_scripts&apos;, &apos;hc_enqueue_style&apos;, 5 );
add_action( &apos;wp_enqueue_scripts&apos;, &apos;hc_enqueue_script&apos;, 7 );

//删除所有挂载在 wp_enqueue_scripts 钩子上的方法
remove_all_actions( &apos;wp_enqueue_scripts&apos;, 5 );

//评论被添加的时候触发
add_action( &apos;wp_insert_comment&apos;, &apos;comment_inserted&apos;, 10, 2 );

//移除 wp_insert_comment 钩子上的 comment_inserted 方法
remove_action( &apos;wp_insert_comment&apos;, &apos;comment_inserted&apos;, 10 );

function comment_inserted($comment_id, $comment_object ) {

    //获取该评论所在文章的评论总数
    $comments_count = wp_count_comments( $comment_object-&gt;comment_post_ID );

    $commentarr = array();
    $commentarr[&apos;comment_ID&apos;] = $comment_id;

    //修改评论的内容，在评论内容前加上 “第{$comments_count-&gt;total_comments}个评论：” 这么一段字符串
    $commentarr[&apos;comment_content&apos;] = &quot;第{$comments_count-&gt;total_comments}个评论：&quot; . $comment_object-&gt;comment_content;

    wp_update_comment( $commentarr );

}


add_action( &apos;user_register&apos;, &apos;myplugin_registration_save&apos;, 10, 1 );

function myplugin_registration_save( $user_id ) {

    //将新用户的个人说明，设置为注册时间
    wp_update_user( array( &apos;ID&apos; =&gt; $user_id, &apos;description&apos; =&gt; &quot;注册时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) ) );

}
?&gt;</code></pre><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><pre><code>add_filter($tag过滤器名称, $function_to_add需要添加的函数, $priority优先级, $acceptedargs添加的参数数量)



# hanchang-copyright.php
//一开始，我们设置一个变量
$value = &quot;hello&quot;;

//给名为 hc_filter 的过滤器，挂载一个 hc_filter_fun 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun 方法进行过滤
//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun&quot; );

//给名为 hc_filter 的过滤器，再挂载一个 hc_filter_fun_add_time 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun、hc_filter_fun_add_time 两个方法进行过滤
//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun_add_time&quot; );

//对 $value 值使用名为 hc_filter 的过滤器进行过滤，这个时候，由于 hc_filter 过滤器只挂载了 hc_filter_fun 方法，因此，只使用 hc_filter_fun 方法 过滤了一次，并且返回给 $myvar 变量
//$myvar = apply_filters( &quot;hc_filter&quot;, $value );

add_filter( &quot;the_content&quot;, &quot;hc_filter_fun&quot; );
add_filter( &quot;the_content&quot;, &quot;hc_filter_fun_add_time&quot; );</code></pre><h4 id="带参数的过滤器"><a href="#带参数的过滤器" class="headerlink" title="带参数的过滤器"></a>带参数的过滤器</h4><pre><code># hanchang-copyright.php
function suppress_if_blurb( $title, $id = null ) {

    if ( in_category(&apos;wpcj&apos;, $id ) ) {
        return &apos;不显示标题&apos;;
    }

    return $title . &quot;...&quot;;
}

//对 the_title 过滤器挂载一个 suppress_if_blurb 方法，优先级为10，传递的参数有2个
add_filter( &apos;the_title&apos;, &apos;suppress_if_blurb&apos;, 10, 2 );</code></pre><h4 id="常见过滤器"><a href="#常见过滤器" class="headerlink" title="常见过滤器"></a>常见过滤器</h4><pre><code>the_content 文章内容 
content_save_pre 文章保存前
the_title 文章标题
wp_handle_upload_prefilter 上传文件之前</code></pre><h4 id="创建菜单"><a href="#创建菜单" class="headerlink" title="创建菜单"></a>创建菜单</h4><pre><code>add_menu_page  # 添加菜单
add_submenu_page  # 添加子菜单


# hanchang-copyright.php
// admin_menu钩子挂载创建菜单方法
add_action( &apos;admin_menu&apos;, &apos;hc_create_menu&apos; );
function hc_create_menu() {

    // 创建顶级菜单
    add_menu_page(
        &apos;Hanchang的插件首页&apos;, // 菜单title标题
        &apos;hanchang-copyright&apos;,  // 菜单名称，显示在后台管理页面侧边栏
        &apos;manage_options&apos;, // 浏览插件所需要的权限=管理员权限
        &apos;hanchang_copyright&apos; ,  // 菜单别名，不能与其他插件冲突
        &apos;hanchang_settings_page&apos;,  // 菜单需要显示的页面，调用的哪个方法
        plugins_url( &apos;/images/icon.png&apos;, __FILE__ )  // 调用图标
    );

    // 创建子菜单
    add_submenu_page(
        &apos;hanchang_copyright&apos;,  // 父级菜单别名
        &apos;关于HC的插件&apos;,  // 菜单title标题
        &apos;关于&apos;,  //  菜单名称，显示在后台管理页面侧边栏
        &apos;manage_options&apos;,  // 浏览插件所需要的权限=管理员权限
        &apos;hc_copyright_about&apos;,  // 菜单别名，不能与其他插件冲突
        &apos;hc_create_submenu_menu&apos;  // 调用方法
    );
}

function hanchang_settings_page() {
    ?&gt;
    &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
    &lt;?
}

function hc_create_submenu_menu() {

    ?&gt;
    &lt;h2&gt;子菜单&lt;/h2&gt;
    &lt;?
}</code></pre><p>#开发 小工具</p>
<pre><code>#hanchang-copyright.php
// 使用 widgets_init 动作钩子来执行自定义的函数
add_action( &apos;widgets_init&apos;, &apos;hc_register_widgets&apos; );

// 注册小工具
function hc_register_widgets() {
    register_widget( &apos;hc_widget_info&apos; );
}

//使用 WP_Widget 类来创建小工具
class hc_widget_info extends WP_Widget {

    //构造函数
    public function __construct() {
        $widget_ops = array(
            &apos;classname&apos; =&gt; &apos;hc_widget_info&apos;,
            &apos;description&apos; =&gt; &apos;显示作者的个人信息&apos;
        );
        $this-&gt;WP_Widget( &apos;显示作者个人信息&apos;, &apos;作者的小工具&apos;, $widget_ops );
    }

    //小工具管理界面
    public function form( $instance ) {

        $defaults = array( &apos;title&apos; =&gt; &apos;作者的个人信息&apos;, &apos;xingming&apos; =&gt; &apos;作者&apos;, &apos;book&apos; =&gt; &apos;《作者》&apos; );
        $instance = wp_parse_args( (array) $instance, $defaults );

        $title = $instance[&apos;title&apos;];
        $xingming = $instance[&apos;xingming&apos;];
        $book = $instance[&apos;book&apos;];
        ?&gt;
        &lt;p&gt;标题: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &apos;title&apos; ); ?&gt;&quot; type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $title ); ?&gt;&quot; /&gt;&lt;/p&gt;
        &lt;p&gt;姓名: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &apos;xingming&apos; ); ?&gt; &quot;type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $xingming ); ?&gt; &quot; /&gt;&lt;/p&gt;
        &lt;p&gt;著作: &lt;textarea class=&quot;widefat&quot; name=&quot; &lt;?php echo $this-&gt;get_field_name( &apos;book&apos; ); ?&gt; &quot; /&gt;&lt;?php echo esc_attr( $book ); ?&gt;&lt;/textarea&gt; &lt;/p&gt;
        &lt;?php
    }

    //保存小工具设置
    public function update( $new_instance, $old_instance ) {

        $instance = $old_instance;

        $instance[&apos;title&apos;] = strip_tags( trim( $new_instance[&apos;title&apos;] ) );
        $instance[&apos;xingming&apos;] = strip_tags( trim(  $new_instance[&apos;xingming&apos;] ) );
        $instance[&apos;book&apos;] = strip_tags( trim( $new_instance[&apos;book&apos;] ) );
        return $instance;
    }

    //显示小工具
    public function widget( $args, $instance ) {

        extract( $args );

        $title = apply_filters( &apos;widget_title&apos;, $instance[&apos;title&apos;] );
        $xingming = empty( $instance[&apos;xingming&apos;] ) ? &apos; &apos; : $instance[&apos;xingming&apos;];
        $book = empty( $instance[&apos;book&apos;] ) ? &apos; &apos; : $instance[&apos;book&apos;];

        echo &apos;&lt;p&gt; 标题: &apos; . $title . &apos;&lt;/p&gt;&apos;;
        echo &apos;&lt;p&gt; 姓名: &apos; . $xingming . &apos;&lt;/p&gt;&apos;;
        echo &apos;&lt;p&gt; 著作: &apos; . $book . &apos;&lt;/p&gt;&apos;;
    }
}</code></pre><h4 id="添加元数据框"><a href="#添加元数据框" class="headerlink" title="添加元数据框"></a>添加元数据框</h4><pre><code># hanchang-copyright.php
/**
 * 添加一个元数据框到 post 和 page 的管理界面中
 */
function myplugin_add_meta_box() {

    $screens = array( &apos;post&apos;, &apos;page&apos; );

    add_meta_box(
        &apos;myplugin_sectionid&apos;,  // 元数据框的html代码中的id值
        &apos;转载自&apos;,  // 元数据框标题
        &apos;myplugin_meta_box_callback&apos;,  // 回调函数名称，输出元数据框中的内容
        $screens  // 元数据框需要添加在哪个分类内的（文章或者页面）
    );
}

//需要给 add_meta_boxes 钩子，挂载一个自定义的方法
add_action( &apos;add_meta_boxes&apos;, &apos;myplugin_add_meta_box&apos; );

/**
 * 元数据框展示代码
 */
function myplugin_meta_box_callback( $post ) {

    // 添加一个验证信息，这个在保存元数据的时候用到
    wp_nonce_field( &apos;myplugin_save_meta_box_data&apos;, &apos;myplugin_meta_box_nonce&apos; );

    /*
     * 输出元数据信息
     */
    $value = get_post_meta( $post-&gt;ID, &apos;_zzurl&apos;, true );

    echo &apos;&lt;label for=&quot;myplugin_new_field&quot;&gt;&apos;;
    _e( &apos;本文章转载自：&apos; );
    echo &apos;&lt;/label&gt; &apos;;
    echo &apos;&lt;input type=&quot;text&quot; id=&quot;_zzurl&quot; name=&quot;_zzurl&quot; value=&quot;&apos; . esc_attr( $value ) . &apos;&quot; size=&quot;25&quot; /&gt;&apos;;
}

function myplugin_save_meta_box_data( $post_id ) {

    //验证是否为有效信息
    if ( ! isset( $_POST[&apos;myplugin_meta_box_nonce&apos;] ) ) {
        return;
    }

    if ( ! wp_verify_nonce( $_POST[&apos;myplugin_meta_box_nonce&apos;], &apos;myplugin_save_meta_box_data&apos; ) ) {
        return;
    }

    if ( defined( &apos;DOING_AUTOSAVE&apos; ) &amp;&amp; DOING_AUTOSAVE ) {
        return;
    }

    // Check the user&apos;s permissions.
    if ( isset( $_POST[&apos;post_type&apos;] ) &amp;&amp; &apos;page&apos; == $_POST[&apos;post_type&apos;] ) {

        if ( ! current_user_can( &apos;edit_page&apos;, $post_id ) ) {
            return;
        }

    } else {

        if ( ! current_user_can( &apos;edit_post&apos;, $post_id ) ) {
            return;
        }
    }

    if ( ! isset( $_POST[&apos;_zzurl&apos;] ) ) {
        return;
    }

    $my_data = sanitize_text_field( $_POST[&apos;_zzurl&apos;] );

    update_post_meta( $post_id, &apos;_zzurl&apos;, $my_data );
}

//文章保存的时候，会调用 save_post 钩子，因此我们要借助这个钩子来保存元数据框内的数据
add_action( &apos;save_post&apos;, &apos;myplugin_save_meta_box_data&apos; );</code></pre><h4 id="后台常见css样式表"><a href="#后台常见css样式表" class="headerlink" title="后台常见css样式表"></a>后台常见css样式表</h4><pre><code># copyright.php
function hanchang_settings_page() {
    ?&gt;
    &lt;div class=&quot;wrap&quot;&gt;
        &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
        &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;设置保存成功&lt;/div&gt;
        &lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;保存出现错误&lt;/div&gt;
        &lt;p&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-primary&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-secondary&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-large&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-small&quot; /&gt;
            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-hero&quot; /&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;a href=&quot;#&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-primary&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-secondary&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-large&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-small&quot;&gt;搜索&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;button button-hero&quot;&gt;搜索&lt;/a&gt;
        &lt;/p&gt;

        &lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
            &lt;table class=&quot;form-table&quot;&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;xingming&quot;&gt;姓名：&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;input id=&quot;xingming&quot; name=&quot;xingming&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;shenfen&quot;&gt;身份：&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;
                        &lt;select name=&quot;shenfen&quot;&gt;
                            &lt;option value=&quot;在校&quot;&gt;在校&lt;/option&gt;
                            &lt;option value=&quot;毕业&quot;&gt;毕业&lt;/option&gt;
                        &lt;/select&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;tongyi&quot;&gt;同意注册&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;tongyi&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;xingbie&quot;&gt;性别&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;
                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;男&quot; /&gt; 男
                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;女&quot; /&gt; 女
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;th&gt;&lt;label for=&quot;beizhu&quot;&gt;备注&lt;/label&gt;&lt;/th&gt;
                    &lt;td&gt;&lt;textarea name=&quot;beizhu&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr valign=&quot;top&quot;&gt;
                    &lt;td&gt;
                        &lt;input type=&quot;submit&quot; name=&quot;save&quot; value=&quot;保存&quot; class=&quot;button-primary&quot; /&gt;
                        &lt;input type=&quot;submit&quot; name=&quot;reset&quot; value=&quot;重置&quot; class=&quot;button-secondary&quot; /&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/form&gt;

        &lt;table class=&quot;widefat striped&quot;&gt;
            &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;序号&lt;/th&gt;
                &lt;th&gt;姓名&lt;/th&gt;
            &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td&gt;1&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;2&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;3&lt;/td&gt;
                &lt;td&gt;黄聪&lt;/td&gt;
            &lt;/tr&gt;
            &lt;/tbody&gt;
            &lt;tfoot&gt;
            &lt;tr&gt;
                &lt;th&gt;序号&lt;/th&gt;
                &lt;th&gt;姓名&lt;/th&gt;
            &lt;/tr&gt;
            &lt;/tfoot&gt;
        &lt;/table&gt;

        &lt;div class=&quot;tablenav&quot;&gt;
            &lt;div class=&quot;tablenav-pages&quot;&gt;
                &lt;span class=&quot;displaying-num&quot;&gt;第1页，共458页&lt;/span&gt;
                &lt;span class=&quot;page-numbers current&quot;&gt;1&lt;/span&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;2&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;3&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;4&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;next page-numbers&quot;&gt;»&lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;?
}</code></pre><h4 id="保存插件设置到数据库中"><a href="#保存插件设置到数据库中" class="headerlink" title="保存插件设置到数据库中"></a>保存插件设置到数据库中</h4><pre><code>├── hc-test
│   ├── css
│   ├── hc-test.php
│   ├── images
│   └── js



hc-test.php

&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

//定义插件启动时候调用的方法
register_activation_hook( __FILE__, &apos;hc_test_install&apos;);

function hc_test_install() {

   global $wpdb;

   if( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE &apos;{$wpdb-&gt;prefix}test&apos;&quot; ) != &quot;{$wpdb-&gt;prefix}test&quot; ) 
   {
      $sql = &quot;CREATE TABLE IF NOT EXISTS `{$wpdb-&gt;prefix}test` (
           `id` int(11) NOT NULL auto_increment COMMENT &apos;编号&apos;,
           `color` varchar(10) DEFAULT &apos;&apos; COMMENT &apos;字体颜色&apos;,
           `size`  varchar(10) DEFAULT &apos;&apos; COMMENT &apos;字体大小&apos;,
           PRIMARY KEY  (`id`)
         ) DEFAULT CHARSET=utf8 AUTO_INCREMENT=0;&quot;;
      $wpdb-&gt;query( $sql );

      $sql = &quot;REPLACE INTO `{$wpdb-&gt;prefix}test` VALUES (1, &apos;#FF0000&apos;,&apos;20&apos;);&quot;;
      $wpdb-&gt;query( $sql );
   }
}

add_action( &apos;admin_menu&apos;, &apos;hc_test_create_menu&apos; );

function hc_test_create_menu() {

   //创建顶级菜单
   add_menu_page( 
      &apos;HC-TEST&apos;, 
      &apos;HC的插件&apos;,
      &apos;manage_options&apos;, 
      &apos;hc_test&apos; ,
      &apos;hc_settings_page&apos;,
      plugins_url( &apos;/images/icon.png&apos;, __FILE__ )
   );
}

function hc_settings_page() {

   global $wpdb;

   //当提交了，并且验证信息正确
   if( !empty( $_POST ) &amp;&amp; check_admin_referer( &apos;hc_test_nonce&apos; ) ) {

      //更新设置
      update_option( &apos;hc_test_bold&apos;, $_POST[&apos;hc_test_bold&apos;] );

      $wpdb-&gt;update( &quot;{$wpdb-&gt;prefix}test&quot;, array( &apos;color&apos; =&gt; $_POST[&apos;color&apos;], &apos;size&apos; =&gt; $_POST[&apos;size&apos;] ), array( &apos;id&apos; =&gt; 1 ) );
      ?&gt;
      &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;
         &lt;p&gt;&lt;strong&gt;保存成功！&lt;/strong&gt;&lt;/p&gt;
      &lt;/div&gt;
      &lt;?
   }

   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;
   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );

   $color = $row[&apos;color&apos;];
   $size = $row[&apos;size&apos;];
   ?&gt;
   &lt;div class=&quot;wrap&quot;&gt;
      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
      &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
         &lt;p&gt;&lt;label for=&quot;color&quot;&gt;字体颜色：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;color&quot; value=&quot;&lt;?php echo $color; ?&gt;&quot; /&gt;&lt;/p&gt;
         &lt;p&gt;&lt;label for=&quot;size&quot;&gt;字体大小：&lt;/label&gt;
         &lt;select name=&quot;size&quot;&gt;
            &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
            &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
            &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
            &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
            &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
         &lt;/select&gt;&lt;/p&gt;
         &lt;p&gt;&lt;label for=&quot;hc_test_obold&quot;&gt;字体加粗：&lt;/label&gt;&lt;input name=&quot;hc_test_bold&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, get_option( &apos;hc_test_bold&apos; ) ); ?&gt; /&gt; 加粗&lt;/p&gt;
         &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;保存设置&quot; /&gt;&lt;/p&gt;
         &lt;?
            //输出一个验证信息
            wp_nonce_field(&apos;hc_test_nonce&apos;);
         ?&gt;
      &lt;/form&gt;
   &lt;/div&gt;
   &lt;?
}

add_action( &apos;wp_head&apos;, &apos;hc_test_head_fun&apos; );

function hc_test_head_fun() {

   global $wpdb;

   //获取自定义数据库中的设置
   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;
   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );

   //获取options表中的设置选项
   $bold = get_option( &quot;hc_test_bold&quot; ) == 1 ? &quot;bold&quot; : &quot;normal&quot;;

   ?&gt;&lt;style&gt;body{color:&lt;? echo $row[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $row[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
}</code></pre><h4 id="使用wordpress内置api设置插件属性"><a href="#使用wordpress内置api设置插件属性" class="headerlink" title="使用wordpress内置api设置插件属性"></a>使用wordpress内置api设置插件属性</h4><pre><code># hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

add_action( &apos;admin_menu&apos;, &apos;test_create_menu&apos; );

function test_create_menu() {

   //创建顶级菜单
   add_menu_page(
      &apos;HC的插件首页&apos;,
      &apos;HC的插件&apos;,
      &apos;manage_options&apos;,
      &apos;hc_test&apos; ,
      &apos;hc_settings_page&apos;,
      plugins_url( &apos;/images/icon.png&apos;, __FILE__ )
   );
}

add_action( &apos;admin_init&apos;, &apos;register_hc_test_setting&apos; );

//使用register_setting()注册要存储的字段
function register_hc_test_setting() {

   //注册一个选项，用于装载所有插件设置项
   $option_group = &quot;hc_test_group&quot;;
   register_setting( $option_group, &apos;hc_test_option&apos; );

   //添加选项设置区域
   $setting_section = &quot;hc_test_setting_section&quot;;
   add_settings_section(
      $setting_section,
      &apos;设置&apos;,  // 标题
      &apos;hc_test_setting_section_function&apos;,  // 调用方法，自定义输出
      $option_group
   );

   //设置字体颜色
   add_settings_field(
      &apos;hc_test_color&apos;,  // 字段id
      &apos;字体颜色&apos;,  // 字段标题
      &apos;hc_test_color_function&apos;, // 字段对应函数方法
      $option_group,  // 字段对应分组
      $setting_section  // 字段对应设置选项
   );

   //设置字体大小
   add_settings_field(
      &apos;hc_test_size&apos;,
      &apos;字体大小&apos;,
      &apos;hc_test_size_function&apos;,
      $option_group,
      $setting_section
   );

   //设置字体加粗
   add_settings_field(
      &apos;hc_test_bold&apos;,
      &apos;字体加粗&apos;,
      &apos;hc_test_bold_function&apos;,
      $option_group,
      $setting_section
   );
}

function hc_test_bold_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   ?&gt;
   &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
   &lt;?
}

function hc_test_size_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   $size = $hc_test_option[&quot;size&quot;];
   ?&gt;
   &lt;select name=&quot;hc_test_option[size]&quot;&gt;
      &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
      &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
      &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
      &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
      &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
   &lt;/select&gt;
   &lt;?
}

function hc_test_color_function() {
   $hc_test_option = get_option( &quot;hc_test_option&quot; );
   ?&gt;
   &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
   &lt;?
}

function hc_settings_page() {
   ?&gt;
   &lt;div class=&quot;wrap&quot;&gt;
      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
      &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
         &lt;?
         $option_group = &quot;hc_test_group&quot;;

         //输出一些必要的字段，包括验证信息等
         settings_fields( $option_group );

         //输出选项设置区域
         do_settings_sections( $option_group );

         //输出按钮
         submit_button();
         ?&gt;
      &lt;/form&gt;
   &lt;/div&gt;
   &lt;?
}


add_action( &apos;wp_head&apos;, &apos;hc_test_head_fun&apos; );

function hc_test_head_fun() {

   $hc_test_option = get_option( &quot;hc_test_option&quot; );

   $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
   ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
}</code></pre><h4 id="将插件改写成类的形式"><a href="#将插件改写成类的形式" class="headerlink" title="将插件改写成类的形式"></a>将插件改写成类的形式</h4><pre><code>#hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);


class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );
   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;HC的插件首页&apos;,
         &apos;HC的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre><h4 id="将插件设置内容转移到wordpress设置里"><a href="#将插件设置内容转移到wordpress设置里" class="headerlink" title="将插件设置内容转移到wordpress设置里"></a>将插件设置内容转移到wordpress设置里</h4><pre><code># hc-test.php

class hcsem_change_font_style {

   var $option_group = &quot;general&quot;;  // general常规 writing撰写 reading阅读 discussion讨论 media多媒体 permalink固定链接

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );
   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre><h4 id="调用ajax"><a href="#调用ajax" class="headerlink" title="调用ajax"></a>调用ajax</h4><pre><code># hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );

      //使用ajax校验信息
      wp_enqueue_script( &apos;hc_test&apos;, plugins_url(&apos;js/hc_test.js&apos;, __FILE__), array(&apos;jquery&apos;) );
      wp_localize_script( &apos;hc_test&apos;, &apos;ajax_object&apos;, array( &apos;ajax_url&apos; =&gt; admin_url( &apos;admin-ajax.php&apos; ) ) );

      add_action( &apos;wp_ajax_color_check_action&apos; , array( $this, &apos;color_check_action_fun&apos;) );
      add_action( &apos;wp_ajax_nopriv_hcsem_description&apos; , array( $this, &apos;hcsem_description_fun&apos;) );
   }

   function color_check_action_fun(){

      if( trim( $_POST[&apos;color&apos;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }
      wp_die();
   }

   function hcsem_description_fun() {

      echo &quot;hc的笔记本：&quot; . $_POST[&apos;description&apos;];
      wp_die();

   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         &apos;字体颜色&apos;,
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         &apos;字体大小&apos;,
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         &apos;字体加粗&apos;,
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;HC的插件首页&apos;,
         &apos;HC的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();


# js/hc_test.js
jQuery(document).ready( function($) {
   $(&quot;input[name=&apos;hc_test_option[color]&apos;]&quot;).blur( function() {
      $.ajax({
         type: &quot;POST&quot;,
         data: &quot;color=&quot; + $(this).val() + &quot;&amp;action=hc_color_check&quot;,
         url: ajax_object.ajax_url,
         beforeSend: function() {
            $(&apos;#error_color&apos;).html(&apos;校验中...&apos;); 
         },
         success: function( $data ) {
            if( $data == &apos;ok&apos;){
                $(&apos;#error_color&apos;).html(&apos;输入正确&apos;);  
            } else {
                $(&apos;#error_color&apos;).html(&apos;颜色不能为空！&apos;); 
            }
         }
      });
   });
});


jQuery(document).ready( function($) {
   $(&quot;.description&quot;).click( function() {
      $.ajax({
         type: &quot;POST&quot;,
         data: &quot;description=&quot; + $(this).text() + &quot;&amp;action=hcsem_description&quot;,
         url: ajax_object.ajax_url,
         success : function( $data ) {

            if( $data != &quot;0&quot; ) {
               $(&quot;.description&quot;).text( $data );
            }
         }
      });
   });
});</code></pre><h4 id="实现插件翻译功能"><a href="#实现插件翻译功能" class="headerlink" title="实现插件翻译功能"></a>实现插件翻译功能</h4><pre><code>.
├── css
│   └── hc_copyrighy.css
├── hc-test.php
├── images
│   └── icon.png
├── js
│   └── hc_test.js
└── languages
    ├── zh_CN.mo
    └── zh_CN.po



# hc-test.php
&lt;?php
/*
Plugin Name: hc-test
Plugin URI: http://zhuohc.com
Description: 测试插件
Version: 1.0
Author: hc
Author URI: http://zhuohc.com
License: GPLv2
*/

//设置时区为 亚洲/上海
date_default_timezone_set(&apos;Asia/Shanghai&apos;);

class hcsem_change_font_style {

   //声明类里面的属性，用 var 开头
   var $icon_url = &quot;/images/icon.png&quot;;
   var $option_group = &quot;hc_test_group&quot;;

   //构造方法，创建类的时候调用
   function hcsem_change_font_style() {

      //创建菜单
      add_action( &apos;admin_menu&apos;, array( $this, &apos;hc_create_menu&apos; ) );
      add_action( &apos;admin_init&apos;, array( $this, &apos;register_hc_test_setting&apos; ) );
      add_action( &apos;wp_head&apos;,  array( $this,  &apos;hc_test_head_fun&apos; ) );

      //使用ajax校验信息
      wp_enqueue_script( &apos;hc_test&apos;, plugins_url(&apos;js/hc_test.js&apos;, __FILE__), array(&apos;jquery&apos;) );
      wp_localize_script( &apos;hc_test&apos;, &apos;ajax_object&apos;, array( &apos;ajax_url&apos; =&gt; admin_url( &apos;admin-ajax.php&apos; ) ) );

      add_action( &apos;wp_ajax_color_check_action&apos; , array( $this, &apos;color_check_action_fun&apos;) );
      add_action( &apos;wp_ajax_nopriv_hcsem_description&apos; , array( $this, &apos;hcsem_description_fun&apos;) );

      add_action( &apos;init&apos;, array( $this, &apos;hcsem_load_textdomain&apos; ) );
   }

   function hcsem_load_textdomain() {

      //加载 languages 目录下的翻译文件 zh_CN
      $currentLocale = get_locale();

      if( !empty( $currentLocale ) ) {

         $moFile = dirname(__FILE__) . &quot;/languages/{$currentLocale}.mo&quot;;

         if( @file_exists( $moFile ) &amp;&amp; is_readable( $moFile ) ) load_textdomain( &apos;hc-test&apos;, $moFile );
      }
   }

   function color_check_action_fun(){

      if( trim( $_POST[&apos;color&apos;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }
      wp_die();
   }

   function hcsem_description_fun() {

      echo &quot;HC的笔记本：&quot; . $_POST[&apos;description&apos;];
      wp_die();

   }

   //使用register_setting()注册要存储的字段
   function register_hc_test_setting() {

      //注册一个选项，用于装载所有插件设置项
      register_setting( $this-&gt;option_group, &apos;hc_test_option&apos; );

      //添加选项设置区域
      $setting_section = &quot;hc_test_setting_section&quot;;
      add_settings_section(
         $setting_section,
         &apos;&apos;,
         &apos;&apos;,
         $this-&gt;option_group
      );

      //设置字体颜色
      add_settings_field(
         &apos;hc_test_color&apos;,
         __( &apos;color&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_color_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体大小
      add_settings_field(
         &apos;hc_test_size&apos;,
         __( &apos;size&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_size_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );

      //设置字体加粗
      add_settings_field(
         &apos;hc_test_bold&apos;,
         __( &apos;bold&apos;, &apos;hc-test&apos; ),
         array( $this, &apos;hc_test_bold_function&apos; ),
         $this-&gt;option_group,
         $setting_section
      );
   }

   function hc_test_bold_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; &lt;? _e( &apos;set bold&apos;, &apos;hc-test&apos; ); ?&gt;
      &lt;?
   }

   function hc_test_size_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      $size = $hc_test_option[&quot;size&quot;];
      ?&gt;
      &lt;select name=&quot;hc_test_option[size]&quot;&gt;
         &lt;option value=&quot;12&quot; &lt;? selected( &apos;12&apos;, $size ); ?&gt;&gt;12&lt;/option&gt;
         &lt;option value=&quot;14&quot; &lt;? selected( &apos;14&apos;, $size ); ?&gt;&gt;14&lt;/option&gt;
         &lt;option value=&quot;16&quot; &lt;? selected( &apos;16&apos;, $size ); ?&gt;&gt;16&lt;/option&gt;
         &lt;option value=&quot;18&quot; &lt;? selected( &apos;18&apos;, $size ); ?&gt;&gt;18&lt;/option&gt;
         &lt;option value=&quot;20&quot; &lt;? selected( &apos;20&apos;, $size ); ?&gt;&gt;20&lt;/option&gt;
      &lt;/select&gt;
      &lt;?
   }

   function hc_test_color_function() {
      $hc_test_option = get_option( &quot;hc_test_option&quot; );
      ?&gt;
      &lt;input name=&apos;hc_test_option[color]&apos; type=&apos;text&apos; value=&apos;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&apos; /&gt;
      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;
      &lt;?
   }

   function hc_create_menu() {

      //创建顶级菜单
      add_menu_page(
         &apos;hc的插件首页&apos;,
         &apos;hc的插件&apos;,
         &apos;manage_options&apos;,
         &apos;hc_test&apos; ,
         array( $this, &apos;hc_settings_page&apos; ),
         plugins_url( $this-&gt;icon_url, __FILE__ )
      );
   }

   function hc_settings_page() {
      ?&gt;
      &lt;div class=&quot;wrap&quot;&gt;
         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;
         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
            &lt;?
            //输出一些必要的字段，包括验证信息等
            settings_fields( $this-&gt;option_group );

            //输出选项设置区域
            do_settings_sections( $this-&gt;option_group );

            //输出按钮
            submit_button();
            ?&gt;
         &lt;/form&gt;
      &lt;/div&gt;
      &lt;?
   }

   function hc_test_head_fun() {

      $hc_test_option = get_option( &quot;hc_test_option&quot; );

      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;
      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?
   }
}

new hcsem_change_font_style();</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/10/wordpress-e6-8f-92-e4-bb-b6-e5-bc-80-e5-8f-91-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" data-id="cjyfelqxh0052cta4xzdehy34" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pythontkinter-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/pythontkinter-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" class="article-date">
  <time datetime="2016-11-10T02:58:02.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/pythontkinter-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/">PythonTkinter基础入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>python基础环境</p>
<pre><code>sudo apt-get install python
sudo apt-get install python-pip</code></pre><p>Tkinter安装</p>
<pre><code>sudo apt-get install python-tk</code></pre><p>配置组件外观</p>
<pre><code>#!/usr/bin/python
# -*- coding: UTF-8 -*-
from Tkinter import *
root = Tk()
# 定义图标
if sys.platform == &apos;win32&apos;:
    root.iconbitmap(&apos;favicon.ico&apos;)
else:
    icon = PhotoImage(file=&apos;phone.gif&apos;)
    root.tk.call(&apos;wm&apos;, &apos;iconphoto&apos;, root._w, icon)
# 定义字体，字号，类型
label_font = (&apos;Ubuntu&apos;, 20, &apos;bold underline italic&apos;)
# 创建组件
widget = Label(root, text=&apos;Hello,云克隆&apos;, padx=100, pady=20)
# 配置组件字体
widget.config(font=label_font)
# 组件宽，高
widget.config(height=3, width=20)
# 组件背景颜色
widget.config(bg=&apos;#FF0&apos;)
# 组件字体颜色
widget.config(fg=&apos;#F0F&apos;)
# 组件边框宽度
widget.config(bd=3)
# 组件边框外形, FLAT扁平, SUNKEN凹陷, RAISED凸起, GROOVE凹槽, SOLID加粗, RIDGE脊状,
widget.config(relief=SUNKEN)
# 组件鼠标手势, &apos;gumby&apos;, &apos;watch&apos;, &apos;pencil&apos;, &apos;crdss&apos;, hand2
widget.config(cursor=&apos;gumby&apos;)
# 组件状态, DISABLE禁用, NORMAL正常, READONLY只读
widget.config(state=DISABLED)
# 布置组件
# expand设置是否可以扩展，fill表示随父组件扩展方向，可以设置BOTH, X, Y
# 设置组件padding值
# side表示按钮布置窗口的位置
widget.pack(expand=True, fill=X, padx=10, pady=50, side=LEFT)
root.mainloop()</code></pre><h4 id="标准弹出框"><a href="#标准弹出框" class="headerlink" title="标准弹出框"></a>标准弹出框</h4><pre><code># -*- coding: UTF-8 -*-
from Tkinter import *
from tkMessageBox import *
# python3
# from Tkinter.messagebox import *
def callback():
    if askyesno(&apos;Verify&apos;, &apos;Do you ready want to quit?&apos;):
        showwarning(&apos;Yes&apos;, &apos;Quit not yet&apos;)
    else:
        showinfo(&apos;No&apos;, &apos;Quit has been cancelled&apos;)

errmsg = &apos;Sorry, no spam allowed&apos;
Button(None, text=&apos;Quit&apos;, command=callback).pack(fill=X)
Button(None, text=&apos;spam&apos;, command=(lambda: showerror(&apos;spam&apos;, errmsg))).pack(fill=X)
mainloop()</code></pre><h4 id="常见弹框"><a href="#常见弹框" class="headerlink" title="常见弹框"></a>常见弹框</h4><pre><code># gui6.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from tkMessageBox import *
from tkFileDialog import *
from tkColorChooser import *
from tkSimpleDialog import *


demos = {
    &apos;Open&apos;: askopenfilename,
    &apos;Color&apos;: askcolor,
    &apos;Query&apos;: lambda: askquestion(&apos;Warning&apos;, &apos;You typed &quot;rm *&quot;\nconfirm?&apos;),
    &apos;Error&apos;: lambda: showerror(&apos;Error!&apos;, &apos;He is dead&apos;),
    &apos;Input&apos;: lambda: askfloat(&apos;Entry&apos;, &apos;Enter credit card number&apos;)
}


class Demo(Frame):
    def __init__(self, parent=None, **options):
        Frame.__init__(self, parent, **options)
        self.pack()
        Label(self, text=&apos;Basic demos&apos;).pack()
        for (key, value) in demos.items():
            Button(self, text=key, command=value).pack(side=TOP, fill=BOTH)

if __name__ == &apos;__main__&apos;:
    Demo().mainloop()
自定义弹框

# -*- coding: UTF-8 -*-
import sys
from Tkinter import *
makemodal = (len(sys.argv) &gt; 1)

def dialog():
    win = Toplevel()
    Label(win, text=&apos;Hard drive reformatted!&apos;).pack()
    Button(win, text=&apos;OK&apos;, command=win.destroy).pack()
    if makemodal:
        # 获取输入的焦点
        win.focus_set()
        # 打开的时候，禁用其他窗口
        win.grab_set()
        # 在win销毁之前，继续等待
        win.wait_window()
    print &apos;dialog exit&apos;

root = Tk()
Button(root, text=&apos;popup&apos;, command=dialog).pack()
root.mainloop()</code></pre><h4 id="绑定事件"><a href="#绑定事件" class="headerlink" title="绑定事件"></a>绑定事件</h4><pre><code># -*- coding: UTF-8 -*-
from Tkinter import *


def showPosEvent(event):
    print(&apos;Widget=%s, X=%s, Y=%s&apos; % (event.widget, event.x, event.y))


def showAllEvent(event):
    print(event)
    for attr in dir(event):
        if not attr.startswith(&apos;__&apos;):
            print(attr, &apos;=&gt;&apos;, getattr(event, attr))


def onKeyPress(event):
    print(&apos;Got key press: &apos;, event.char)


def onArrowKey(event):
    print(&apos;Got up arrow key press&apos;)


def onReturnKey(event):
    print(&apos;Got return key press&apos;)


def onLeftClick(event):
    print(&apos;Got left mouse button click: &apos;)
    showPosEvent(event)


def onRightClick(event):
    print(&apos;Got right mouse button click: &apos;)
    showPosEvent(event)


def onMiddleClick(event):
    print(&apos;Got middle mouse button click: &apos;)
    showPosEvent(event)
    showAllEvent(event)


def onLeftDrag(event):
    print(&apos;Got left mouse drag click: &apos;)
    showPosEvent(event)


def onDoubleLeftClick(event):
    print(&apos;Got double left mouse click: &apos;)
    showPosEvent(event)
    tkroot.quit()


tkroot = Tk()
labelfont = (&apos;courier&apos;, 20, &apos;bold&apos;)
widget = Label(tkroot, text=&apos;Hello bind world&apos;)
widget.config(bg=&apos;red&apos;, font=labelfont)
widget.config(height=5, width=20)
widget.pack(expand=YES, fill=BOTH)
# 绑定单击左键
widget.bind(&apos;&lt;Button-1&gt;&apos;, onLeftClick)
# 绑定单击右键
widget.bind(&apos;&lt;Button-3&gt;&apos;, onRightClick)
# 绑定单击中键
widget.bind(&apos;&lt;Button-2&gt;&apos;, onMiddleClick)
# 绑定双击左键
widget.bind(&apos;&lt;Double-1&gt;&apos;, onDoubleLeftClick)
# 绑定拖拽 B1表示点击左键，Motion表示拖拽
widget.bind(&apos;&lt;B1-Motion&gt;&apos;, onLeftDrag)
# 绑定键盘按键
widget.bind(&apos;&lt;KeyPress&gt;&apos;, onKeyPress)
# 绑定按下箭头键
widget.bind(&apos;&lt;Up&gt;&apos;, onArrowKey)
# 绑定回车，返回键
widget.bind(&apos;&lt;Return&gt;&apos;, onReturnKey)
widget.focus()
tkroot.title(&apos;CLICK ME&apos;)
tkroot.mainloop()

# &lt;ButtonPress&gt; 按下按钮
# &lt;ButtonRelease&gt; 松开按钮
# &lt;Motion&gt; 鼠标指针移动
# &lt;Configure&gt; 窗口大小，位置改变时候
# &lt;Destroy&gt; 销毁窗口
# &lt;FocusIn&gt; 获取焦点
# &lt;FocusOut&gt; 失去焦点
# &lt;Map&gt; 窗口打开
# &lt;Unmap&gt; 窗口最小化
# &lt;Escape&gt;, &lt;BackSpace&gt;, &lt;Tab&gt; 捕获特点ESC键，回车键，tab键
# &lt;Down&gt;, &lt;Up&gt;, &lt;Left&gt;, &lt;Right&gt; 捕获方向键
# &lt;B1-Motion&gt; 按下左键并拖拽
# &lt;KeyPress-a&gt; 按下按键“a”，大小写敏感</code></pre><h4 id="输入框"><a href="#输入框" class="headerlink" title="输入框"></a>输入框</h4><pre><code># -*- coding: UTF-8 -*-
from Tkinter import *
from quitGui import Quitter

fields = &apos;Name&apos;, &apos;Job&apos;, &apos;Pay&apos;


def fetch(entries):
    for entry in entries:
        print(&apos;Input =&gt; %s&apos; % entry.get())  # 获取文本信息


def makeform(root, fields):
    entries = []
    for field in fields:
        row = Frame(root)
        lab = Label(row, width=5, text=field)
        ent = Entry(row)
        row.pack(side=TOP, fill=X)
        lab.pack(side=LEFT)
        ent.pack(side=RIGHT, expand=YES, fill=X)
        entries.append(ent)
    return entries


def show(entries, popup):
    fetch(entries)  # 必须在销毁前取出
    popup.destroy()  # 如果修改了stmt， order， msgs会随之失败


def ask():
    popup = Toplevel()  # 在模拟对话框窗口中显示表单
    ents = makeform(popup, fields)
    Button(popup, text=&apos;OK&apos;, command=(lambda: show(ents, popup))).pack()
    popup.grab_set()  # 打开的时候，禁用其他窗口
    popup.focus_set()  # 获取输入的焦点
    popup.wait_window()  # 在这里等待销毁


if __name__ == &apos;__main__&apos;:
    root = Tk()
    Button(root, text=&apos;Dialog&apos;, command=ask).pack()
    root.mainloop()</code></pre><h4 id="复选框"><a href="#复选框" class="headerlink" title="复选框"></a>复选框</h4><pre><code># gui13.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from gui6 import demos
from quitGui import Quitter


class Demo(Frame):
    def __init__(self, parent=None, **options):
        Frame.__init__(self, parent, **options)
        self.pack()
        self.tools()
        Label(self, text=&apos;Ckech demos&apos;).pack()
        self.vars = []
        for key in demos:
            var = IntVar()
            Checkbutton(self, text=key, variable=var, command=demos[key]).pack(side=LEFT)
            self.vars.append(var)

    def report(self):
        for var in self.vars:
            print(var.get())  # 当前开关设置1或者0
        print()

    def tools(self):
        frm = Frame(self)
        frm.pack(side=RIGHT)
        Button(frm, text=&apos;State&apos;, command=self.report).pack(fill=X)
        Quitter(frm).pack(fill=X)


if __name__ == &apos;__main__&apos;:
    Demo().mainloop()</code></pre><h4 id="单选按钮"><a href="#单选按钮" class="headerlink" title="单选按钮"></a>单选按钮</h4><pre><code>#gui14.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from gui6 import demos
from quitGui import Quitter


class Demo(Frame):
    def __init__(self, parent=None, **options):
        Frame.__init__(self, parent, **options)
        self.pack()
        Label(self, text=&apos;Radio demos&apos;).pack(side=TOP)
        self.var = StringVar()
        # variable表示单选按钮的变量，相当与html的name标签
        # value表示单选按钮的变量值，相当与html的value标签
        for key in demos:
            Radiobutton(self, text=key, command=self.onPress, variable=self.var, value=key).pack(anchor=NW)
        self.var.set(key)  # 选中最后一个开始
        Button(self, text=&apos;State&apos;, command=self.report).pack(fill=X)
        Quitter(self).pack(fill=X)

    def onPress(self):
        pick = self.var.get()
        print(&apos;you pressed&apos;, pick)
        print(&apos;result: &apos;, demos[pick]())  # 按钮使用返回的值

    def report(self):
        print(self.var.get())

if __name__ == &apos;__main__&apos;:
    Demo().mainloop()</code></pre><h4 id="标尺滚动条"><a href="#标尺滚动条" class="headerlink" title="标尺滚动条"></a>标尺滚动条</h4><pre><code># gui16.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from gui6 import demos
from quitGui import Quitter


class Demo(Frame):
    def __init__(self, parent=None, **options):
        Frame.__init__(self, parent, **options)
        self.pack()
        Label(self, text=&apos;Scale demos&apos;).pack()
        self.var = IntVar()
        Scale(self, label=&apos;Pick demo number&apos;,
              command=self.onMove, variable=self.var,
              from_=0, to=len(demos)-1).pack()
        Scale(self, label=&apos;Pick demo number&apos;,  # 标尺的文本
              command=self.onMove,  # 绑定回调
              variable=self.var,  # 变量
              from_=0,   # 标尺最小值
              to=len(demos) - 1,   # 标尺最大值
              length = 200,  # 长度
              tickinterval = 2,   # 每隔几个单位显示标记单位
              showvalue = YES,  # 显示或隐藏标尺滑动条旁边的当前值
              orient = &apos;horizontal&apos;  # 横向展示
              ).pack()
        Quitter(self).pack(side=RIGHT)
        Button(self, text=&apos;Run demo&apos;, command=self.onRun).pack(side=LEFT)
        Button(self, text=&apos;State&apos;, command=self.report).pack(side=RIGHT)

    def onMove(self, value):
        print(&apos;in onMove&apos;, value)

    def onRun(self):
        pos = self.var.get()
        print(&apos;you picked&apos;, pos)
        demo = list(demos.values())[pos]
        print(demo())

    def report(self):
        print(self.var.get())

if __name__ == &apos;__main__&apos;:
    print(list(demos.keys()))
    Demo().mainloop()</code></pre><h4 id="创建图片"><a href="#创建图片" class="headerlink" title="创建图片"></a>创建图片</h4><pre><code># gui17.py
# -*- coding: UTF-8 -*-
from Tkinter import *

gifdir = &apos;./gif/&apos;
win = Tk()
igm = PhotoImage(file=gifdir + &apos;logo.png&apos;)

# 按钮上绑定图片
# Button(win, image=igm).pack()
# win.mainloop()

# 创建画布
can = Canvas(win)
can.pack(fill=BOTH)
can.config(width=igm.width() + 4, height=igm.height() + 4)
can.create_image(2,  # x坐标
                 2,  # y坐标
                 image=igm, anchor=NW)
win.mainloop()</code></pre><h3 id="按钮随机读取图片"><a href="#按钮随机读取图片" class="headerlink" title="按钮随机读取图片"></a>按钮随机读取图片</h3><pre><code># gui18.py
# -*- coding: UTF-8 -*-
from glob import glob
from gui13 import *
import random

gifdir = &apos;./gif/&apos;

&quot; 按钮随机读取图片 &quot;
class ButtonPicsDemo(Frame):
    def __init__(self, gifdir=gifdir, parent=None):
        Frame.__init__(self, parent)
        self.pack()
        self.lbl = Label(self, text=&apos;none&apos;, bg=&apos;blue&apos;, fg=&apos;red&apos;)
        self.pix = Button(self, text=&apos;press me&apos;, command=self.draw, bg=&apos;white&apos;)
        self.lbl.pack(fill=BOTH)
        self.pix.pack(pady=10)
        Demo(self, relief=SUNKEN, bd=2).pack(fill=BOTH)
        # glob模块， glob方法，返回所有匹配的文件列表
        files = glob(gifdir + &apos;*.png&apos;)
        self.images = [(x, PhotoImage(file=x)) for x in files]
        print(files)

    def draw(self):
        name, photo = random.choice(self.images)
        self.lbl.config(text=name)
        self.pix.config(image=photo)

if __name__ == &apos;__main__&apos;:
    if __name__ == &apos;__main__&apos;:
        ButtonPicsDemo().mainloop()</code></pre><h4 id="缩略图"><a href="#缩略图" class="headerlink" title="缩略图"></a>缩略图</h4><pre><code># gui19.py
# -*- coding: UTF-8 -*-
import os
import math
import PIL
from PIL import Image
from Tkinter import *


def make_thumbs(img_dir, size=(100, 100), subdir=&apos;thumbs&apos;):
    thumb_dir = os.path.join(img_dir, subdir)
    if not os.path.exists(thumb_dir):
        os.mkdir(thumb_dir)
    thumbs = []
    for img_file in os.listdir(img_dir):
        thumb_path = os.path.join(thumb_dir, img_file)
        if os.path.exists(thumb_path):
            thumb_obj = PIL.Image.open(thumb_path)
            thumbs.append((img_file, thumb_obj))
        else:
            print(&apos;making&apos;, thumb_path)
            img_path = os.path.join(img_dir, img_file)
            try:
                img_obj = PIL.Image.open(img_path)
                img_obj.thumbnail(size, PIL.Image.ANTIALIAS)
                img_obj.save(thumb_path)
                thumbs.append((img_file, img_obj))
            except Exception, e:
                print(&apos;skipping: &apos;, img_path)
                print e
    return thumbs


class ViewOne(Toplevel):
    def __init__(self, img_dir, img_file):
        Toplevel.__init__(self)
        self.title(img_file)
        img_path = os.path.join(img_dir, img_file)
        img_obj = PhotoImage(file=img_path)
        Label(self, image=img_obj).pack()
        print(img_path, img_obj.width(), img_obj.height())
        self.savephoto = img_obj


def viewer(img_dir, kind=Toplevel, cols=None):
    win = kind()
    win.title(&apos;VIEWER: &apos; + img_dir)
    thumbs = make_thumbs(img_dir)
    if not cols:
        # 固定大小 或者N×N
        cols = int(math.ceil(math.sqrt(len(thumbs))))
    savephotos = []
    while thumbs:
        thumbs_row, thumbs = thumbs[:cols], thumbs[cols:]
        row = Frame(win)
        row.pack(fill=BOTH)
        for(img_file, img_obj) in thumbs_row:
            size = max(img_obj.size)
            photo = PhotoImage(file=os.path.join(img_dir, &apos;thumbs&apos;, img_file))
            link = Button(row, image=photo)
        handler = lambda savefile=img_file: ViewOne(img_dir, savefile)
        link.config(command=handler, width=size, height=size)
        link.pack(side=LEFT, expand=YES)
        savephotos.append(photo)
    Button(win, text=&apos;Quit&apos;, command=win.quit, bg=&apos;beige&apos;).pack(fill=X)
    return win, savephotos

if __name__ == &apos;__main__&apos;:
    img_dir = len(sys.argv) &gt; 1 and sys.argv[1] or &apos;gif&apos;
    main, save = viewer(img_dir, kind=Tk)
    main.mainloop()</code></pre><h3 id="创建基础顶级菜单"><a href="#创建基础顶级菜单" class="headerlink" title="创建基础顶级菜单"></a>创建基础顶级菜单</h3><pre><code># gui20.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from tkMessageBox import *


def not_done():
    showerror(&apos;Not implemented&apos;, &apos;Not yet available&apos;)


def make_menu(win):
    top = Menu(win)  # 定义顶级菜单
    win.config(menu=top)
    file = Menu(top, tearoff=True)  # 一级菜单 tearoff:设置菜单下的虚线是否显示
    file.add_command(label=&apos;New...&apos;, command=not_done, underline=0)
    file.add_command(label=&apos;Open...&apos;, command=not_done, underline=0)
    file.add_command(label=&apos;Quit...&apos;, command=win.quit,  underline=0)
    top.add_cascade(label=&apos;File&apos;, menu=file, underline=0)  # 在顶级菜单中添加一级菜单

    edit = Menu(top, tearoff=False)  # 一级菜单
    edit.add_command(label=&apos;Cut&apos;, command=not_done, underline=0)
    edit.add_command(label=&apos;Paste&apos;, command=not_done, underline=0)
    edit.add_separator()  # 添加下划线
    top.add_cascade(label=&apos;Edit&apos;, menu=edit, underline=0)

    submenu = Menu(edit, tearoff=True)  # 二级菜单
    submenu.add_command(label=&apos;Spam&apos;, command=win.quit, underline=0)
    submenu.add_command(label=&apos;Eggs&apos;, command=not_done, underline=0)
    edit.add_cascade(label=&apos;Stuff&apos;, menu=submenu, underline=0)  # 在一级菜单中添加二级菜单

if __name__ == &apos;__main__&apos;:
    root = Tk()
    root.title(&apos;menu_win&apos;)
    make_menu(root)
    msg = Label(root, text=&apos;Window menu basic&apos;)
    msg.pack(expand=YES, fill=BOTH)
    msg.config(relief=SUNKEN, width=40, height=7, bg=&apos;beige&apos;)
    root.mainloop()</code></pre><h4 id="创建框架级别菜单"><a href="#创建框架级别菜单" class="headerlink" title="创建框架级别菜单"></a>创建框架级别菜单</h4><pre><code># gui21.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from tkMessageBox import *


def not_done():
    showerror(&apos;Not implemented&apos;, &apos;Not yet available&apos;)


def make_menu(parent):
    menu_bar = Frame(parent)
    menu_bar.pack(side=TOP, fill=X)

    f_button = Menubutton(menu_bar, text=&apos;File&apos;, underline=0)
    f_button.pack(side=LEFT)
    file = Menu(f_button)
    file.add_command(label=&apos;New...&apos;, command=not_done, underline=0)
    file.add_command(label=&apos;Open...&apos;, command=not_done, underline=0)
    file.add_command(label=&apos;Quit...&apos;, command=parent.quit,  underline=0)
    f_button.config(menu=file)

    e_button = Menubutton(menu_bar, text=&apos;Edit&apos;, underline=0)
    e_button.pack(side=LEFT)
    edit = Menu(e_button)
    edit.add_command(label=&apos;Cut&apos;, command=not_done, underline=0)
    edit.add_command(label=&apos;Paste&apos;, command=not_done, underline=0)
    edit.add_separator()
    e_button.config(menu=edit)

    sub_menu = Menu(edit, tearoff=True)
    sub_menu.add_command(label=&apos;Spam&apos;, command=parent.quit, underline=0)
    sub_menu.add_command(label=&apos;Eggs&apos;, command=not_done, underline=0)
    edit.add_cascade(label=&apos;Stuff&apos;, menu=sub_menu, underline=0)
    return menu_bar



if __name__ == &apos;__main__&apos;:
    root = Tk()
    root.title(&apos;menu_fra&apos;)
    for i in range(2):
        mnu = make_menu(root)
        mnu.config(bd=2, relief=RAISED)
        Label(root, bg=&apos;black&apos;, height=5, width=25).pack(expand=YES, fill=BOTH)
    Button(root, text=&apos;Bye&apos;, command=root.quit).pack()
    root.mainloop()</code></pre><h4 id="图片菜单"><a href="#图片菜单" class="headerlink" title="图片菜单"></a>图片菜单</h4><pre><code># gui22.py
# -*- coding:UTF-8 -*-
from Tkinter import *
from tkMessageBox import *


class NewMenuDemo(Frame):
    def __init__(self, parent=None):
        Frame.__init__(self, parent)
        self.pack(expand=YES, fill=BOTH)
        self.create_widgets()

    def create_widgets(self):
        self.make_menubar()
        self.make_toolbar()
        l = Label(self, text=&apos;Menu and Toolbar Demo&apos;)
        l.config(relief=SUNKEN, width=40, height=10, bg=&apos;white&apos;)
        l.pack(expand=YES, fill=BOTH)

    def make_toolbar(self, size=(30, 30)):
        toolbar = Frame(self, cursor=&apos;hand2&apos;, relief=SUNKEN, bd=2)
        toolbar.pack(side=BOTTOM, fill=X)
        Button(toolbar, text=&apos;Quit&apos;, command=self.quit).pack(side=RIGHT)
        photo_files = (&apos;at.png&apos;, &apos;bd.png&apos;, &apos;dk.png&apos;)
        self.tool_photo_objs = []
        for file in photo_files:
            img = PhotoImage(file=&apos;./gif/thumbs/&apos; + file)
            btn = Button(toolbar, image=img, command=self.greeting)
            btn.config(bd=5, relief=RIDGE)
            btn.config(width=size[0], height=size[0])
            btn.pack(side=LEFT)
            self.tool_photo_objs.append(img)
        Button(toolbar, text=&apos;Hello&apos;, command=self.greeting).pack(side=LEFT)

    def make_menubar(self):
        self.menubar = Menu(self.master)
        self.master.config(menu=self.menubar)
        self.file_menu()
        self.edit_menu()
        self.image_menu()

    def file_menu(self):
        pulldown = Menu(self.menubar)
        pulldown.add_command(label=&apos;OPEN...&apos;, command=self.notdone)
        pulldown.add_command(label=&apos;QUIT&apos;, command=self.quit)
        self.menubar.add_cascade(label=&apos;FILE&apos;, underline=0, menu=pulldown)

    def edit_menu(self):
        pulldown = Menu(self.menubar)
        pulldown.add_command(label=&apos;PASTE&apos;, command=self.notdone)
        pulldown.add_command(label=&apos;SPAM&apos;, command=self.greeting)
        pulldown.add_separator()
        pulldown.add_command(label=&apos;DELETE&apos;, command=self.greeting)
        pulldown.entryconfig(4, state=DISABLED)
        self.menubar.add_cascade(label=&apos;EDIT&apos;, underline=0, menu=pulldown)

    def image_menu(self):
        photo_files = (&apos;at.png&apos;, &apos;bd.png&apos;, &apos;dk.png&apos;)
        pulldown = Menu(self.menubar)
        self.photo_objs = []
        for file in photo_files:
            img = PhotoImage(file=&apos;./gif/&apos; + file)
            pulldown.add_command(image=img, command=self.notdone)
            self.photo_objs.append(img)
        self.menubar.add_cascade(label=&apos;IMAGE&apos;, underline=0, menu=pulldown)

    def greeting(self):
        showinfo(&apos;greeting&apos;, &apos;GREETING&apos;)

    def notdone(self):
        showerror(&apos;NOT DONE&apos;, &apos;NOT DONE&apos;)

    def quit(self):
        if askyesno(&apos;Verify quit&apos;, &apos;Sure?&apos;):
            Frame.quit(self)

if __name__ == &apos;__main__&apos;:
    NewMenuDemo().mainloop()</code></pre><h4 id="滚动条与列表"><a href="#滚动条与列表" class="headerlink" title="滚动条与列表"></a>滚动条与列表</h4><pre><code># gui23.py
# -*- coding: UTF-8 -*-
from Tkinter import *


class ScrolledList(Frame):
    def __init__(self, options, parent=None):
        Frame.__init__(self, parent)
        self.pack(expand=YES, fill=BOTH)
        self.makeWidgets(options)


    def handle_list(self, event):
        index = self.listbox.curselection()  # 鼠标选中的行
        label = self.listbox.get(index)  # 获取鼠标选中的值
        self.runCommand(label)  # 打印出值


    def makeWidgets(self, options):
        # sbar = Scrollbar(self, orient=&apos;horizontal&apos;)  # 横向滚动
        sbar = Scrollbar(self)
        list = Listbox(self, relief=SUNKEN)
        sbar.config(command=list.yview)  # 移动滚动条启用回调： 按比例调节列表框的显示，
        list.config(yscrollcommand=sbar.set)  # 移动列表框启用回调：按比例调节滚动条
        sbar.pack(side=RIGHT, fill=Y)
        list.pack(side=LEFT, expand=YES, fill=BOTH)
        pos = 0
        for label in options:
            list.insert(pos, label)
            pos += 1
        # selectmode 选择模式SINGLE(单选), BROWSE(默认单选), MULTIPLE(多选), EXTENDED(多选)
        # 启用多选时， curselection返回列表
        # 启用单选时， curselection返回字符串
        list.config(selectmode=EXTENDED, setgrid=1)
        list.bind(&apos;&lt;Double-1&gt;&apos;, self.handle_list)
        self.listbox = list

    def runCommand(self, selection):
        print(&apos;YOU SELECTED:&apos;, selection)


if __name__ == &apos;__main__&apos;:
    options = ((&apos;Lumberjack-%s&apos; % x) for x in range(20))
    ScrolledList(options).mainloop()</code></pre><h4 id="TEXT组件"><a href="#TEXT组件" class="headerlink" title="TEXT组件"></a>TEXT组件</h4><pre><code>gui24.py
# -*- coding: UTF-8 -*-
from Tkinter import *


class ScrollText(Frame):
    def __init__(self, parent=None, text=&apos;&apos;, file=None):
        Frame.__init__(self, parent)
        self.pack(expand=YES, fill=BOTH)
        self.make_widgets()
        self.set_text(text, file)

    def make_widgets(self):
        sbar = Scrollbar(self)
        text = Text(self, relief=SUNKEN)
        sbar.config(command=text.yview)
        text.config(yscrollcommand=sbar.set)
        sbar.pack(side=RIGHT, fill=Y)
        text.pack(side=LEFT, expand=YES, fill=BOTH)
        self.text = text

    def set_text(self, text=&apos;&apos;, file=None):
        if file:
            text = open(file, &apos;r&apos;).read()
        # 1.0表示第一行，第0列（行从1开始，列从0开始）
        # END表示最末一个字符后面第一个位置
        self.text.delete(&apos;1.0&apos;, END)  # 删除从第一行第0列开始到最后的字符串，即删除全部
        self.text.insert(&apos;1.0&apos;, text)  # 从第一行第0列开始填充数据
        # mark_set 设置text标志
        self.text.mark_set(INSERT, &apos;1.0&apos;)  # 设置将光标设置在文本开始位置
        # self.text.mark_set(&apos;line_two&apos;, &apos;2.2&apos;)  # 自定义标志位置 可以用mark_unset取消
        self.text.focus()
        # TEXT的tag标签
        # SEL是内置的标签，表示当前选中的文本
        # text = self.text.get(SEL_FIRST, SEL_LAST)
        # text = self.text.get(&apos;sel.first&apos;, &apos;sel.last&apos;)
        # self.text.tag_add(&apos;alltext&apos;, &apos;1.0&apos;, END)  # 选中所有文本
        # self.text.tag_add(SEL, index1, index2)  # 将一定范围内的文本添加到内建的SEL标签
        # self.text.tag_remove(SEL, &apos;1.0&apos;, END)  # 将字符串所有字符从SEL标签中删除
        # self.text.tag_delete(SEL)  # 删除SEL标签
        # self.text.tag_add(&apos;demo&apos;, &apos;1.5&apos;, &apos;1.7&apos;)
        # self.text.tag_add(&apos;demo&apos;, &apos;3.0&apos;, &apos;5.7&apos;)
        # self.text.tag_config(&apos;demo&apos;, background=&apos;purple&apos;)
        # self.text.tag_config(&apos;demo&apos;, fontground=&apos;white&apos;)
        # self.text.tag_config(&apos;demo&apos;, font=(&apos;times&apos;, 16, &apos;underline&apos;))
        # self.text.tag_bind(&apos;demo&apos;, &apos;&lt;Double-1&gt;&apos;, func)
        # see方法
        # self.text.see(&apos;1.0&apos;)  # 滚动到第一行第0列
        # self.text.see(INSERT)  # 滚动到光标插入处
        # self.text.see(SEL_FIRST)  # 滚动到选中文本第一个字符串
    def get_text(self):
        # -1c 表示往回数一个字符串
        # +1l 表示往前数一行
        return self.text.get(&apos;1.0&apos;, END + &apos;-1c&apos;)


if __name__ == &apos;__main__&apos;:
    root = Tk()
    if len(sys.argv) &gt; 1:
        st = ScrollText(file=sys.argv[1])
    else:
        st = ScrollText(text=&apos;Words\ngo here&apos;)

    def show(event):
        print(repr(st.get_text()))

    root.bind(&apos;&lt;Key-Escape&gt;&apos;, show)
    root.mainloop()</code></pre><h4 id="简单的文本编辑器"><a href="#简单的文本编辑器" class="headerlink" title="简单的文本编辑器"></a>简单的文本编辑器</h4><pre><code># gui25.py
# -*- coding: UTF-8 -*-
from Tkinter import *
from tkSimpleDialog import askstring
from tkFileDialog import asksaveasfilename
from quitGui import Quitter
from gui24 import ScrollText


class SimpleEditor(ScrollText):
    def __init__(self, parent=None, file=None):
        frm = Frame(parent)
        frm.pack(fill=X)
        Button(frm, text=&apos;Save&apos;, command=self.on_save).pack(side=LEFT)
        Button(frm, text=&apos;Cut&apos;, command=self.on_cut).pack(side=LEFT)
        Button(frm, text=&apos;Paste&apos;, command=self.on_paste).pack(side=LEFT)
        Button(frm, text=&apos;Find&apos;, command=self.on_find).pack(side=LEFT)
        Quitter(frm).pack(side=LEFT)
        ScrollText.__init__(self, parent, file=file)
        self.text.config(font=(&apos;courier&apos;, 9, &apos;normal&apos;))

    def on_save(self):
        filename = asksaveasfilename()
        if filename:
            alltext = self.get_text()
            open(filename, &apos;w&apos;).write(alltext)


    def on_cut(self):
        text = self.text.get(SEL_FIRST, SEL_LAST)
        self.text.delete(SEL_FIRST, SEL_LAST)
        self.clipboard_clear()
        self.clipboard_append(text)


    def on_paste(self):
        try:
            text = self.selection_get(selection=&apos;CLIPBOARD&apos;)
            self.text.insert(INSERT, text)
        except TclError:
            pass


    def on_find(self):
        target = askstring(&apos;SimpleEdit&apos;, &apos;Search string?&apos;)
        if target:
            where = self.text.search(target, INSERT, END)
            if where:
                print(where)
                pastit = where + (&apos;+%dc&apos; % len(target))
                self.text.tag_remove(SEL, &apos;1.0&apos;, END)
                self.text.tag_add(SEL, where, pastit)
                self.text.mark_set(INSERT, pastit)
                self.text.see(INSERT)
                self.text.focus()

if __name__ == &apos;__main__&apos;:
    if len(sys.argv) &gt; 1:
        SimpleEditor(file=sys.argv[1]).mainloop()
    else:
        SimpleEditor().mainloop()</code></pre><h4 id="创建基础画布"><a href="#创建基础画布" class="headerlink" title="创建基础画布"></a>创建基础画布</h4><pre><code># gui26.py
# -*- coding: UTF-8 -*-

from Tkinter import *
canvas = Canvas(width=525, height=300, bg=&apos;white&apos;)
canvas.pack(expand=YES, fill=BOTH)

canvas.create_line(100, 100, 200, 200)
canvas.create_line(100, 200, 200, 300)
for i in range(1, 20, 2):
    canvas.create_line(0, i, 50, i)
canvas.create_oval(20, 20, 300, 100, width=10, fill=&apos;yellow&apos;)
d = {1:PIESLICE,2:CHORD,3:ARC}
for i in d:
    canvas.create_arc(
        (10,10 + 60*i,110,110 + 60*i),
        style=d[i],   #指定样式
        start=30,     #指定起始角度
        extent=30     #指定角度偏移量
        )
canvas.create_arc(0, 0, 100, 200, fill=&apos;black&apos;)
canvas.create_rectangle(200, 200, 300, 300, width=5, fill=&apos;red&apos;)
canvas.create_line(0, 300, 150, 150, width=10, fill=&apos;green&apos;)

photo = PhotoImage(file=&apos;./gif/lightmachine.png&apos;)
canvas.create_image(325,25, image=photo, anchor=NW)

widget = Label(canvas, text=&apos;Spam&apos;, fg=&apos;white&apos;, bg=&apos;black&apos;)
widget.pack()
canvas.create_window(100, 100, window=widget)
canvas.create_text(100, 280, text=&apos;CLOUD CLONE CORP.&apos;)

# id = canvas.create_line(fromX, fromY, toX, toY)  # 创建直线
# id = canvas.create_oval(fromX, fromY, toX, toY) # 创建椭圆
# id = canvas.create_arc(fromX, fromY, toX, toY)  # 创建扇形
# id =canvas.create_rectangle(fromX, fromY, toX, toY)  # 创建矩形
# canvas.move(id, offsetX, offsetY)  # 移动对象
# canvas.delete(id)  # 删除对象
# canvas.tkraise(id)  # 将对象移动到前端
# canvas.lower(id)  # 将对象移动到底部
# canvas.itemconfig(id, fill=&apos;red&apos;)  # 修改对象属性

# 画布标签
# canvas.create_line(fromX, fromY, toX, toY, tag=&apos;bubbles&apos;) 
# canvas.create_line(fromX, fromY, toX, toY, tag=&apos;bubbles&apos;) 
# id = canvas.create_line(fromX, fromY, toX, toY)
# canvas.addtag_withtag(&apos;bubbles&apos;, id)
# canvas.move(&apos;bubbles&apos;, diffX, diffY)
mainloop()</code></pre><h4 id="canvas与滚动条"><a href="#canvas与滚动条" class="headerlink" title="canvas与滚动条"></a>canvas与滚动条</h4><pre><code># gui27.py
# -*- coding: UTF-8 -*-
from Tkinter import *

class ScrolledCanvas(Frame):
    def __init__(self, parent=None, color=&apos;brown&apos;):
        Frame.__init__(self, parent)
        self.pack(expand=YES, fill=BOTH)
        canv = Canvas(self, bg=color, relief=SUNKEN)
        canv.config(width=300, height=200)
        canv.config(scrollregion=(0, 0, 300, 1000))
        canv.config(highlightthickness=0)

        sbar = Scrollbar(self)
        sbar.config(command=canv.yview)
        canv.config(yscrollcommand=sbar.set)
        sbar.pack(side=RIGHT, fill=Y)
        canv.pack(side=LEFT, expand=YES, fill=BOTH)

        self.fillContent(canv)
        canv.bind(&apos;&lt;Double-1&gt;&apos;, self.onDoubleClick)
        self.canvas = canv

    def fillContent(self, canv):
        for i in range(10):
            canv.create_text(150, 50+(i*100), text=&apos;spam&apos;+str(i), fill=&apos;beige&apos;)

    def onDoubleClick(self, event):
        print(event.x, event.y)
        print(self.canvas.canvasx(event.x), self.canvas.canvasy(event.y))

if __name__ == &apos;__main__&apos;:
    ScrolledCanvas().mainloop()</code></pre><h4 id="canvas绑定事件"><a href="#canvas绑定事件" class="headerlink" title="canvas绑定事件"></a>canvas绑定事件</h4><pre><code># gui28.py
# -*- coding: UTF-8 -*-
from Tkinter import *
trace = False

class CanvasEventDemo:
    def __init__(self, parent=None):
        canvas = Canvas(width=300, height=300, bg=&apos;beige&apos;)
        canvas.pack()
        canvas.bind(&apos;&lt;ButtonPress-1&gt;&apos;, self.on_start)
        canvas.bind(&apos;&lt;B1-Motion&gt;&apos;, self.on_grow)
        canvas.bind(&apos;&lt;Double-1&gt;&apos;, self.on_clear)
        canvas.bind(&apos;&lt;ButtonPress-3&gt;&apos;, self.on_move)
        self.canvas = canvas
        self.drawn = None
        self.kinds = [canvas.create_oval, canvas.create_rectangle]

    def on_start(self, event):
        self.shape =self.kinds[0]
        self.kinds = self.kinds[1:] + self.kinds[:1]
        self.start = event
        self.drawn = None

    def on_grow(self, event):
        canvas = event.widget
        if self.drawn:
            canvas.delete(self.drawn)
        object_id = self.shape(self.start.x, self.start.y, event.x, event.y)
        if trace:
            print(object_id)
        self.drawn = object_id

    def on_clear(self, event):
        event.widget.delete(&apos;all&apos;)


    def on_move(self, event):
        if self.drawn:
            if trace:
                print(self.drawn)
            canvas = event.widget
            diffx, diffy = (event.x - self.start.x), (event.y - self.start.y)
            canvas.move(self.drawn, diffx, diffy)
            self.start = event

if __name__ == &apos;__main__&apos;:
    CanvasEventDemo()
    mainloop()</code></pre><h4 id="grid布局和pack布局实现自动扩展"><a href="#grid布局和pack布局实现自动扩展" class="headerlink" title="grid布局和pack布局实现自动扩展"></a>grid布局和pack布局实现自动扩展</h4><pre><code># gui29.py
# -*- coding: UTF-8 -*-

from Tkinter import *
colors = [&apos;red&apos;, &apos;green&apos;, &apos;orange&apos;, &apos;white&apos;, &apos;yellow&apos;, &apos;blue&apos;]

def gridbox(root):
    Label(root, text=&apos;GRID&apos;).grid(columnspan=2)  # 跨两列
    row = 1
    for color in colors:
        lab = Label(root, text=color, relief=RIDGE, width=25)
        ent = Entry(root, bg=color, relief=SUNKEN, width=50)
        lab.grid(row=row, column=0, sticky=NSEW)  # 向4个方向扩展
        ent.grid(row=row, column=1, sticky=NSEW)
        root.rowconfigure(row, weight=1)  # 循环行自动扩展
        row += 1
    root.columnconfigure(0, weight=1)  # 第一列自动扩展
    root.columnconfigure(1, weight=1)  # 第二列自动扩展

def packbox(root):
    Label(root, text=&apos;PACK&apos;).pack()
    for color in colors:
        row = Frame(root)
        lab = Label(row, text=color, relief=RIDGE, width=25)
        ent = Entry(row, bg=color, relief=SUNKEN, width=50)
        row.pack(side=TOP, expand=YES, fill=BOTH)
        lab.pack(side=LEFT, expand=YES, fill=BOTH)
        ent.pack(side=RIGHT, expand=YES, fill=BOTH)

if __name__ == &apos;__main__&apos;:
    root = Tk()
    gridbox(Toplevel(root))
    packbox(Toplevel(root))
    Button(root, text=&apos;Quit&apos;, command=root.quit).pack()
    mainloop()</code></pre><h3 id="PIL：Python-Imaging-Library"><a href="#PIL：Python-Imaging-Library" class="headerlink" title="PIL：Python Imaging Library"></a>PIL：Python Imaging Library</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><pre><code>sudo apt-get install python-imaging
或者
sudo easy_install PIL</code></pre><p>window系统选择</p>
<pre><code>pip install Pillow</code></pre><p>图像操作</p>
<pre><code>import Image
# 打开一个jpg图像文件，注意路径要改成你自己的:
im = Image.open(&apos;/Users/michael/test.jpg&apos;)
# 获得图像尺寸:
w, h = im.size
# 缩放到50%:
im.thumbnail((w//2, h//2))
# 把缩放后的图像用jpeg格式保存:
im.save(&apos;/Users/michael/thumbnail.jpg&apos;, &apos;jpeg&apos;)</code></pre><p>模糊效果</p>
<pre><code>import Image, ImageFilter

im = Image.open(&apos;/Users/hanchang/test.jpg&apos;)
im2 = im.filter(ImageFilter.BLUR)
im2.save(&apos;/Users/hanchang/blur.jpg&apos;, &apos;jpeg&apos;)</code></pre><p>自定义图像验证码</p>
<pre><code>import Image, ImageDraw, ImageFont, ImageFilter
import random
# 随机字母:
def rndChar():
    return chr(random.randint(65, 90))

# 随机颜色1:
def rndColor():
    return (random.randint(64, 255), random.randint(64, 255), random.randint(64, 255))

# 随机颜色2:
def rndColor2():
    return (random.randint(32, 127), random.randint(32, 127), random.randint(32, 127))

# 240 x 60:
width = 60 * 4
height = 60
image = Image.new(&apos;RGB&apos;, (width, height), (255, 255, 255))
# 创建Font对象:
font = ImageFont.truetype(&apos;Arial.ttf&apos;, 36)
# 创建Draw对象:
draw = ImageDraw.Draw(image)
# 填充每个像素:
for x in range(width):
    for y in range(height):
        draw.point((x, y), fill=rndColor())
# 输出文字:
for t in range(4):
    draw.text((60 * t + 10, 10), rndChar(), font=font, fill=rndColor2())
# 模糊:
image = image.filter(ImageFilter.BLUR)
image.save(&apos;code.jpg&apos;, &apos;jpeg&apos;);
自定义字符串生成图片</code></pre><p><code>from PIL import Image,ImageDraw,ImageFont,ImageOps &lt;h1&gt;生成图片&lt;/h1&gt; def create\_image(str, line, name, dir): img\_size = (400, (line*20) + 10) img\_mode = &#39;RGB&#39; img\_font = ImageFont.truetype(&#39;UbuntuMono-R.ttf&#39;, 14) img\_bg = &#39;#FFF&#39; img\_fg = &#39;#000&#39; img = Image.new(mode=img\_mode, size=img\_size, color=img\_bg) draw = ImageDraw.Draw(img) draw.text((10, 10), str, fill=img\_fg, font=img_font) img.save( dir + name + &#39;.png&#39;, &#39;png&#39;)</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/10/pythontkinter-e5-9f-ba-e7-a1-80-e5-85-a5-e9-97-a8/" data-id="cjyfelqxg004zcta4li6zgser" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu14-04-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/ubuntu14-04-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/" class="article-date">
  <time datetime="2016-11-10T02:49:23.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/ubuntu14-04-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/">Ubuntu14.04服务器基础配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="登陆ssh"><a href="#登陆ssh" class="headerlink" title="登陆ssh"></a>登陆ssh</h4><pre><code>ssh root@ipaddress 
password:</code></pre><h4 id="首次登陆出现的错误"><a href="#首次登陆出现的错误" class="headerlink" title="首次登陆出现的错误"></a>首次登陆出现的错误</h4><pre><code>perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:


# 安装 localepurge 管理语言文件
sudo apt-get install localepurge
# 或者之后自行配置
sudo dpkg-reconfigure localepurge
# 生成自己需要的语言
sudo locale-gen zh_CN.UTF-8 en_US.UTF-8
# 打印结果
locale
# ssh连接时候指定语言
LC_ALL=en_US.UTF-8 ssh &lt;host&gt;</code></pre><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><pre><code>adduser hanchang
password:
retry password:</code></pre><h4 id="将用户添加到sudo用户组"><a href="#将用户添加到sudo用户组" class="headerlink" title="将用户添加到sudo用户组"></a>将用户添加到sudo用户组</h4><p>错误提示</p>
<pre><code>username is not in the sudoers file.


su -
password：
chmod u+w /etc/sudoers   # 添加文件写权限
root ALL=(ALL) ALL 下面添加以下代码
hanchang ALL=(ALL) NOPASSWD: ALL
:wq 退出
chmod u-w /etc/sudoers  # 取消文件写权限</code></pre><p>修改root密码</p>
<pre><code>sudo passwd
password:
retry password:</code></pre><h4 id="禁止root用户远程登陆ssh"><a href="#禁止root用户远程登陆ssh" class="headerlink" title="禁止root用户远程登陆ssh"></a>禁止root用户远程登陆ssh</h4><pre><code>cd /e   tc/ssh/
sudo vim sshd_config
PermitRootLogin yes改成PermitRootLogin no
service sshd restart    或者 /etc/init.d/sshd restart（ssh服务器重启）</code></pre><h4 id="指定IP地址登陆"><a href="#指定IP地址登陆" class="headerlink" title="指定IP地址登陆"></a>指定IP地址登陆</h4><pre><code>vim  /etc/hosts.allow
sshd:192.168.220.164:allow  # 最后添加

vim /etc/hosts.deny
sshd:ALL #最后添加</code></pre><h4 id="避免sshd连接超时"><a href="#避免sshd连接超时" class="headerlink" title="避免sshd连接超时"></a>避免sshd连接超时</h4><p>修改客户端</p>
<pre><code>sudo vim /etc/ssh/ssh_config
# 添加
ServerAliveInterval 30   # 每30秒向服务器发起心跳
ServerAliveCountMax 6 # 允许6次无响应</code></pre><p>或者修改服务器端</p>
<pre><code># 打开
sudo vim /etc/ssh/sshd_config
# 添加
ClientAliveInterval 30
ClientAliveCountMax 6</code></pre><h4 id="流量监控"><a href="#流量监控" class="headerlink" title="流量监控"></a>流量监控</h4><pre><code># 安装监控软件
sudo apt-get install vnstat


# 安装好后运行以下命令初始化数据库
# eth0可以通过ifconfig查看
sudo vnstat -u -i eth1


# 修改配置文件
sudo vim /etc/vnstat.conf
Interface &quot;eth1&quot; #此处修改需要监控的网卡


# 启动守护进程
sudo /etc/init.d/vnstat start
# 默认开机启动
sudo update-rc.d vnstat enable</code></pre><h4 id="查看是否安装iptables"><a href="#查看是否安装iptables" class="headerlink" title="查看是否安装iptables"></a>查看是否安装iptables</h4><pre><code>iptables: /sbin/iptables /usr/share/iptables /usr/share/man/man8/iptables.8.gz #表示已经安装iptables
apt-get install iptables #如果默认没有安装，请运行此命令安装防火墙</code></pre><p>编辑iptables配置文件</p>
<pre><code>sudo vi /etc/iptables.rules
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:syn-flood - [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 20 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT
-A INPUT -p icmp -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT -p icmp -m limit --limit 1/s --limit-burst 10 -j ACCEPT
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN
-A syn-flood -j REJECT --reject-with icmp-port-unreachable
COMMIT


# sudo iptables-restore &lt; /etc/iptables.rules #使防火墙规则生效，重启主机执行此命令


# 重启主机会使以上配置失效，以下内容为如何配置开机自动启动防火墙
# vi /etc/network/if-pre-up.d/iptables #创建文件，添加以下内容，使防火墙开机启动
#!/bin/bash
iptables-restore &lt; /etc/iptables.rules


# chmod +x /etc/network/if-pre-up.d/iptables #添加执行权限
# sudo iptables -L -n查看规则是否生效.</code></pre><h4 id="挂载新的硬盘"><a href="#挂载新的硬盘" class="headerlink" title="挂载新的硬盘"></a>挂载新的硬盘</h4><pre><code>fdisk -l
如果出现
Disk /dev/sdb doesn&apos;t contain a valid partition table
说明没有分区,需要处理
fdisk /dev/sdb
Command (m for help):  m为查看选项，这里我们输入n表示创建一个新的分区
选中默认，在分区大小中填写分区大小 +500G</code></pre><p>第二步：使新创建的分区在系统中立即生效 root#partprobe 第三步：格式化新创建的分区</p>
<pre><code>mkfs.ext3 /dev/hdb1</code></pre><p>第四步：使新创建的分区挂载/mnt/ssd_one 目录下</p>
<pre><code>mount /dev/hda1 /mnt/rhce01</code></pre><p>查看已经挂载的信息</p>
<pre><code>sudo vim /etc/mtab</code></pre><p>第五步：开机自动挂载</p>
<pre><code>sudo vim /etc/fstab
# 底部添加
/dev/sdb1              /mnt/hdd_one              ext3    defaults        0 0</code></pre><p>查看现在的硬盘信息</p>
<pre><code>root@m1095:~# df -hl
Filesystem      Size  Used Avail Use% Mounted on
udev             12G  4.0K   12G   1% /dev
tmpfs           2.4G  632K  2.4G   1% /run
/dev/sda2        71G  1.2G   66G   2% /
none            4.0K     0  4.0K   0% /sys/fs/cgroup
none            5.0M     0  5.0M   0% /run/lock
none             12G     0   12G   0% /run/shm
none            100M     0  100M   0% /run/user
/dev/sda1       226M   35M  175M  17% /boot
/dev/sdb1       493G   70M  467G   1% /mnt/hdd_one</code></pre><h4 id="ftp服务器搭建"><a href="#ftp服务器搭建" class="headerlink" title="ftp服务器搭建"></a>ftp服务器搭建</h4><pre><code>sudo apt-get install vsftpd</code></pre><p>编辑配置文件</p>
<pre><code>sudo vim /etc/vsftpd.conf


anonymous_enable=NO   # 禁止匿名用户
local_enable=YES   # 允许本地用户
write_enable=YES # 允许写入
chroot_local_user=YES  # 登陆用户被限制在自己的home目录下
allow_writeable_chroot=YES # 配合chroot_local_user=YES使用
# 当chroot_local_user=YES表示chroot_list为可以访问其他目录的用户
# 当chroot_local_user=NO表示chroot_list为不可以访问其他目录的用户，
# chroot_list_enable=YES  
# chroot_list_file=/etc/vsftpd.chroot_list

# 以下内容为添加内容
# 设置为YES表示开启用户登陆过滤，设置为NO表示不开启用户过滤，所有用户都可以访问
userlist_enable=YES
# 在userlist_enable=YES的前提下，设置是否阻扯user_list文件中的用户登录FTP服务器
# YES表示user_list为黑名单，在文件中的用户不能访问，不在文件中的用户可以访问
# NO表示user_list 为白名单，在文件中的用户可以访问，不在文件中的用户不能访问
userlist_deny=YES


sudo vim /etc/vsftpd.user_list
添加root到文件中</code></pre><p>出现500 OOPS: vsftpd: refusing to run with writable root inside chroot()错误的时候 原因：chroot设置为yes的时候，需要取消ftp根目录的写权限</p>
<pre><code>#### 在配置文件中添加此设置
allow_writeable_chroot=YES </code></pre><h4 id="开启防火墙后vsftpd连接错误处理"><a href="#开启防火墙后vsftpd连接错误处理" class="headerlink" title="开启防火墙后vsftpd连接错误处理"></a>开启防火墙后vsftpd连接错误处理</h4><p>载入以下2个模块</p>
<pre><code>sudo modprobe ip_nat_ftp
sudo modprobe ip_conntrack_ftp


sudo vi /etc/modules

# Add these lines:
ip_nat_ftp
ip_conntrack_ftp</code></pre><p>重启vsftpd服务</p>
<h4 id="安装lamp服务"><a href="#安装lamp服务" class="headerlink" title="安装lamp服务"></a>安装lamp服务</h4><p>安装apache</p>
<pre><code>sudo apt-get install apache2
# 将用户添加到apache用户组中
sudo usermod -a -G www-data username # www-data 为apache用户组名，username为登陆用户名
# apache2安装rewrite
sudo a2enmod rewrite
sudo service apache2 restart
# 删除显示的版本信息
ServerTokens Prod
ServerSignature Off </code></pre><p>配置虚拟主机</p>
<pre><code>sudo vim /etc/apache.2/apache2.conf
# 添加以下内容
&lt;Directory /home/zhc/www/&gt;
        Options FollowSymLinks　#　不要加Index
        AllowOverride All
        Require all granted
&lt;/Directory&gt;</code></pre><p>安装mysql</p>
<pre><code>sudo apt-get install mysql-server php5-mysql
＃配置mysql
sudo mysql_secure_installation</code></pre><p>查看mysql是否开启慢查询日志</p>
<pre><code>mysql&gt; show variables like &apos;%slow%&apos;;
+---------------------------+---------------------------------------+
| Variable_name             | Value                                 |
+---------------------------+---------------------------------------+
| log_slow_admin_statements | OFF                                   |
| log_slow_slave_statements | OFF                                   |
| slow_launch_time          | 2                                     |
| slow_query_log            | OFF                                   |
| slow_query_log_file       | /var/lib/mysql/NC-PH-1551-49-slow.log |
+---------------------------+---------------------------------------+
5 rows in set (0.00 sec)


#开启慢查询
mysql&gt; set global log_slow_queries  = &apos;ON&apos;;
mysql&gt; show variables like &apos;%slow%&apos;;


#开启常规查询
vim /etc/myql/mysql.conf.d/mysqld.conf
general_log_file        = /var/log/mysql/mysql.log
general_log             = 1
#开启错误查询
log_error = /var/log/mysql/error.log
#　防止innodb ibdata1文件过大
innodb_file_per_table=1　</code></pre><p>安装php</p>
<pre><code>sudo apt-get install php5 libapache2-mod-php5 php5-mcrypt
#ubuntu16.04安装方法
# Add the PPA
apt-get install software-properties-common #如果提示没有 add-apt-repository，需要执行此命令安装
sudo add-apt-repository ppa:ondrej/php
# If you get add-apt-repository: command not found run the following command first :
sudo apt-get install software-properties-common
sudo apt-get update
sudo apt-get install php5.6
sudo apt-get install php5.6-*</code></pre><p>配置php</p>
<pre><code>vim /etc/php/5.6/apache/php.ini
expose_php = Off # 隐藏php版本信息</code></pre><h4 id="静态文件同步"><a href="#静态文件同步" class="headerlink" title="静态文件同步"></a>静态文件同步</h4><p>定时任务 crontab -e # 编辑当前用户的定时任务 crontab -u hanchang -e # 编辑指定用户的定时任务</p>
<pre><code># m h  dom mon dow   command
# 分钟 小时 日期 月份 星期 命令
0 0 * * * /bin/sh /home/hanchang/www/scripts/rsyncHK.sh</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/10/ubuntu14-04-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/" data-id="cjyfelqx3004bcta4ncs2ibpc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/">ubuntu</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-phpunit-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/phpunit-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/" class="article-date">
  <time datetime="2016-11-10T02:31:18.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/phpunit-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/">PHPUnit单元测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装composer</p>
<pre><code>sudo apt-get install composer</code></pre><p>安装PHPUnit</p>
<pre><code>sudo composer require --dev phpunit/phpunit</code></pre><p>安装xdebug</p>
<pre><code>sudo apt-get install php-xdebug</code></pre><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>路径/phpunit.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;phpunit bootstrap=&quot;tests/bootstrap.php&quot;&gt;
   &lt;testsuites&gt;
       &lt;testsuite name=&quot;whovian&quot;&gt;
           &lt;directory suffix=&quot;Test.php&quot;&gt;
               tests
           &lt;/directory&gt;
       &lt;/testsuite&gt;
   &lt;/testsuites&gt;
    &lt;filter&gt;
        &lt;whitelist&gt;
            &lt;directory&gt;src&lt;/directory&gt;
        &lt;/whitelist&gt;
    &lt;/filter&gt;
&lt;/phpunit&gt;</code></pre><p>tests/bootstrap..php表示phpunit文件的路径<br>filter元素列出需要分析代码覆盖度分析涵盖的目录<br>whitelist元素告诉PHPUnit只分析src/目录中的代码<br>tests/bootstrap.php</p>
<pre><code>&lt;?php
require dirname(__DIR__) . &apos;/vendor/autoload.php&apos;;</code></pre><p>src/Whovian.php</p>
<pre><code>&lt;?php

class Whovian
{
  protected $favoriteDoctor;

  // 设置实例喜欢的医生
  public function __construct($favoriteDoctor)
  {
    $this-&gt;favoriteDoctor = (string)$favoriteDoctor;
  }

  // 返回一个字符串，说出实例最喜欢的医生
  public function say()
  {
    return &apos;The best doctor is &apos; . $this-&gt;favoriteDoctor;
  }

  // 与另一个实例喜欢的医生进行比较，并做出回应
  public function respondTo($input)
  {
    $input = strtolower($input);
    $myDoctor = strtolower($this-&gt;favoriteDoctor);
    if(strpos($input, $myDoctor) === false) {
      throw new Exception(sprintf(
        &apos;No way, %s is the best doctor ever&apos;, $this-&gt;favoriteDoctor
      ));
    }
    return &apos;I agree!&apos;;
  }
}</code></pre><p>tests/WhovianTest.php</p>
<pre><code>&lt;?php

  require dirname(__DIR__) . &apos;/src/Whovian.php&apos;;
  class WhovianTest extends PHPUnit_Framework_TestCase
  {
    // 确认构造方法是否设定了Whovian实例最喜欢的医生
    public function testSetsDoctorWithConstructor()
    {
      $whovian = new Whovian(&apos;Peter Capaldi&apos;);
      $this-&gt;assertAttributeEquals(&apos;Peter Capaldi&apos;, &apos;favoriteDoctor&apos;, $whovian);
    }

    // 确认say方法是否会返回一个包含最喜欢医生名字的字符串
    public function testSaysDoctorName()
    {
      $whovian = new Whovian(&apos;David Tennant&apos;);
      $this-&gt;assertEquals(&apos;The best doctor is David Tennant&apos;, $whovian-&gt;say());
    }
    // 确认认同另一个实例最喜欢的医生
    public function testRespondToInAgreement()
    {
      $whovian = new Whovian(&apos;David Tennant&apos;);
      $opinion = &apos;David Tennant is the best doctor, period&apos;;
      $this-&gt;assertEquals(&apos;I agree!&apos;, $whovian-&gt;respondTo($opinion));
    }
    // 反对另一个实例最喜欢的医生
    public function testRespondToInDisagreement()
    {
      $whovian = new Whovian(&apos;David Tennant&apos;);
      $opinion = &apos;No way, Matt smith was awesome!&apos;;
      $whovian-&gt;respondTo($opinion);
    }
  }</code></pre><p>终端执行测试</p>
<pre><code>vendor/bin/phpunit -c phpunit.xml</code></pre><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/phpunit-run" alt> 测试的目录结构</p>
<pre><code>src/     
    /Whovian.php  
tests/    
    /bootstrap.php  
    /WhovianTest.php
vendor/
    /bin/  
    /composer/  
    /phpunit/  
    /autoload.php  
composer.json  
composer.lock  
phpunit.xml</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/10/phpunit-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95/" data-id="cjyfelqw6001xcta4jm2p6xu7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-centos7-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/centos7-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/" class="article-date">
  <time datetime="2016-11-10T02:29:42.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/centos7-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/">Centos7服务器基础配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="查看当前版本"><a href="#查看当前版本" class="headerlink" title="查看当前版本"></a>查看当前版本</h3><pre><code>cat /proc/version 
cat /etc/redhat-release
Centos Linux release 7.2.1511 (Core)</code></pre><h3 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h3><pre><code>&gt; passwd root
&gt; 输入密码</code></pre><h3 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h3><p>centos网络配置地址 /etc/sysconfig/network Centos设置主机名和网络配置<br>/etc/sysconfig/network-scripts/ifcfg-eth0针对特定的网卡进行设置<br>/etc/resolv.conf设置DNS<br>/etc/hosts设置指定的域名解析地址<br>当前使用的是虚拟机网桥模式</p>
<pre><code>cd /etc/sysconfig/network-scripts/
vi ifcfg-enp0s23
# 最后添加内容
IPADDR=192.168.0.160  # ip地址
NETMASK=255.255.255.0 # 掩码
GATEWAY=192.168.0.1 # 网关地址
DNS1=202.103.24.68 # DNS地址
# 修改内容
ONBOOT=yes # 启动时网络接口有效
BOOTPROTO=none # dhcp改成none dhcp自动获取，static固定，none手动


# 启动网卡
sudo ifup eth0s23
sudo systemctl restart network</code></pre><p>安装网络查看工具</p>
<pre><code>yum install net-tools</code></pre><p>centos默认的命令是</p>
<pre><code>ip addr</code></pre><h3 id="开机需要启动的5个服务"><a href="#开机需要启动的5个服务" class="headerlink" title="开机需要启动的5个服务"></a>开机需要启动的5个服务</h3><pre><code>sshd远程登陆, 
network网络,
rsyslog日志相关,
crond定时任务,
sysstat检测系统性能</code></pre><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><pre><code>su
# 输入密码
useradd test
passwd test
# 输入密码
# 确认密码
su test # 切换成普通用户</code></pre><p>将test用户加入到sudoers用</p>
<pre><code>#visudo命令 # 相当于直接编辑 /etc/sudoers,但用命令方式更安全,推荐
su
cd /etc
chmod 777 sudoers
root    ALL=(ALL)       ALL
test    ALL=(ALL)       ALL  # 新添加的
chmod 440 sudoers   # 权限改成440，必须，否则会报错</code></pre><h3 id="配置ssh"><a href="#配置ssh" class="headerlink" title="配置ssh"></a>配置ssh</h3><p>安装ssh</p>
<pre><code>yum -y install  openssh*


service sshd start    </code></pre><h3 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h3><pre><code>ssh test@192.168.0.160 # 默认22端口
ssh -p 2222 test@192.168.0.160 # 修改端口后</code></pre><p>禁止root用户远程ssh连接</p>
<pre><code>vi /etc/ssh/sshd_congif 
# 最后添加
# 禁止root远程登陆  
PermitRootLogin no</code></pre><h3 id="关闭SELINUX"><a href="#关闭SELINUX" class="headerlink" title="关闭SELINUX"></a>关闭SELINUX</h3><p>修改/etc/selinux/config 文件<br>将SELINUX=enforcing改为SELINUX=disabled<br>setenforce 0 ##设置SELinux 成为permissive模式,临时关闭或者及时起效</p>
<h3 id="centos开启防火墙"><a href="#centos开启防火墙" class="headerlink" title="centos开启防火墙"></a>centos开启防火墙</h3><pre><code>systemctl mask firewalld
systemctl stop firewalld
yum install iptables-services # 如果下面命令报错，则需要安装
systemctl enable iptables
systemctl start iptables
systemctl enable ip6tables
systemctl start ip6tables</code></pre><p>防火墙开机启动</p>
<pre><code>systemctl enable iptables
systemctl disable iptables


# 查看开机运行的服务
systemctl list-unit-files --type=service</code></pre><p>防火墙是否放行ssh端口22</p>
<pre><code>cd /etc/sysconfig/
vi iptables</code></pre><p>在commit前添加以下内容，并注释文件开头信息</p>
<pre><code># sample configuration for iptables service
# you can edit this manually or use system-config-firewall
# please do not ask us to add additional ports/services to this default configuration
*filter
# :INPUT ACCEPT [0:0]
# :FORWARD ACCEPT [0:0]
# :OUTPUT ACCEPT [0:0]
# -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# -A INPUT -p icmp -j ACCEPT
# -A INPUT -i lo -j ACCEPT
# -A INPUT -j REJECT --reject-with icmp-host-prohibited
# -A FORWARD -j REJECT --reject-with icmp-host-prohibited





# 安全设置-防止扫描包
# NONE 包(所有标识bit都没有设置)主要是扫描类的数据包
-A INPUT -p tcp --tcp-flags ALL NONE -j DROP
# 防止sync-flood 攻击
-A INPUT -p tcp ! --syn -m state --state NEW -j DROP
# ALL包（所有的标注bit都被设置了）也是网络扫描的数据包
-A INPUT -p tcp --tcp-flags ALL ALL -j DROP

# 开放对应端口
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT

# 缺省设置
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# 许所有从服务器端发起的连接，由此返回的响应数据应该是允许的,yum操作等
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
# 接受主机localhost的任意请求
-A INPUT -i lo -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited

COMMIT</code></pre><h3 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h3><p>安装及启动</p>
<pre><code>yum install vsftpd
systemctl start vsftpd
systemctl enable vsftpd</code></pre><p>更新防火墙，放行20， 21端口，如果用了代理上传，需要添加被动模式的端口号<br>修改配置项目</p>
<pre><code>vi /etc/vsftpd/vsftpd.conf

anonymous_enable=No # YES改成No,禁止匿名用户
listen=YES # No改成Yes 开启监听
# listen_ipv6=YES  # 此行需要注释掉
tcp_wrappers=YES   # 默认应该就是YES

# 在/etc/vsftpd.chroot_list文件中列出的用户，可以切换到其他目录；
# 未在/etc/vsftpd/chroot_list文件中列出的用户，不能切换到其他目录。
# 需要创建/etc/vsftpd/chroot_list文件
chroot_local_user=YES
chroot_list_enable=YES  
# (default follows) 
chroot_list_file=/etc/vsftpd/chroot_list

# 防止500oops错误 
allow_writeable_chroot=YES 
# 被动模式端口号
pasv_min_port=30000  
pasv_max_port=31000    </code></pre><p>只允许指定ip登陆</p>
<pre><code>vi /etc/hosts.allow
最后添加
vsftpd:192.168.0.19:allow
vsftpd:all:deny</code></pre><p>添加虚拟用户</p>
<pre><code>useradd -g ftp -d /var/ftp/ftpuser -s /sbin/nologin ftpuser 
passwd ftpuser
cd /etc/vsftpd/
touch chroot_list
vi chroot_list
ftpuser # 将用户名称添加到chroot_list里</code></pre><h3 id="LAMP安装"><a href="#LAMP安装" class="headerlink" title="LAMP安装"></a>LAMP安装</h3><p>apache</p>
<pre><code>yum install httpd # 安装apache2
systemctl enable httpd.service
systemctl enable httpd.service</code></pre><p>mysql5.6</p>
<pre><code># 安装rpm包
rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm
# 查看可以安装的资源
yum repolist enabled | grep &quot;mysql.*-community.*&quot;
# 安装
yum install mysql-community-server
systemctl start mysqld
systemctl enable mysqld
mysql_secure_installation # 设置密码等</code></pre><p>php5.4</p>
<pre><code>yum install php
yum install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-snmp php-soap curl curl-devel php-mysql php-devel</code></pre><p>php5.6或者其他</p>
<pre><code>yum -y install epel-release
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
wget https://centos7.iuscommunity.org/ius-release.rpm
rpm -Uvh ius-release*.rpm
yum -y update
yum -y install php56u php56u-opcache php56u-xml php56u-mcrypt php56u-gd php56u-devel php56u-mysql php56u-intl php56u-mbstring php56u-bcmath</code></pre><h3 id="LAMP配置"><a href="#LAMP配置" class="headerlink" title="LAMP配置"></a>LAMP配置</h3><p>apache允许php脚本</p>
<pre><code>vi /etc/httpd/conf/httpd.conf
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz
AddType application/x-httpd-php .php  # 新添加内容</code></pre><p>apache虚拟主机</p>
<pre><code>cd /etc/httpd/conf.d
vi vhost.conf


&lt;VirtualHost *:121&gt;
ServerName phpmyadmin.com
ServerAlias www.phpmyadmin.com
DocumentRoot /var/www/html/phpMyAdmin/
ErrorLog /var/www/web_log/phpMyAdmin.www_error.log # 开启日志需要创建web_log文件夹，否则会报错
CustomLog /var/www/web_log/phpMyAdmin.www_access.log common
&lt;/VirtualHost&gt;
&lt;Directory &quot;/var/www/html/phpMyAdmin/&quot;&gt;
    Options FollowSymLinks
    AllowOverride All
    Require all granted
&lt;/Directory&gt;


&lt;VirtualHost *:108&gt;
ServerName hkmain.com
ServerAlias www.kmain.com
DocumentRoot /var/www/html/NEW/
ErrorLog /var/www/web_log/NEW.www_error.log
CustomLog /var/www/web_log/NEW.www_access.log common
&lt;/VirtualHost&gt;
&lt;Directory &quot;/var/www/html/NEW/&quot;&gt;
    Options FollowSymLinks
    AllowOverride All
    Require all granted
&lt;/Directory&gt;</code></pre><p>apache加载的模块查看</p>
<pre><code>apachectl -M | sort</code></pre><p>网站目录权限配置</p>
<pre><code>chown -R apache:apache WEB_FOLD
chmod 750 WEB_FOLD
cd WEB_FOLD
find -type d -exec chmod 750 {} \;
find -not -type d -exec chmod 640 {} \;
find . -name &quot;Runtime&quot; -type d -exec chmod -R 770 {} \;</code></pre><h3 id="LNMP安装与配置"><a href="#LNMP安装与配置" class="headerlink" title="LNMP安装与配置"></a>LNMP安装与配置</h3><p>参考链接 <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-centos-7" target="_blank" rel="noopener">https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-centos-7</a> nginx安装(apache二选一)</p>
<pre><code># 安装pcre库，使nginx支持rewrite
sudo yum install pcre pcre-devel -y
sudo yum install nginx
sudo systemctl start nginx.service
# 设置开机启动
sudo systemctl enable nginx.service</code></pre><p>mysql5.6</p>
<pre><code># 安装rpm包
rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm
# 查看可以安装的资源
yum repolist enabled | grep &quot;mysql.*-community.*&quot;
# 安装
yum install mysql-community-server
systemctl start mysqld
systemctl enable mysqld
mysql_secure_installation # 设置密码等</code></pre><p>php安装</p>
<pre><code>yum -y install epel-release
sudo yum install php php-mysql php-fpm
sudo yum install php-pecl-memcache</code></pre><p>配置</p>
<pre><code>vim /etc/php.ini
#cgi.fix_poathinfo=1改成
cgi.fix_pathinfo=0


vim /etc/php-php.d/www.conf
# 第一处修改
listen = /var/run/php-fpm/php-fpm.sock
# 第二处修改
listen.owner = nobody
listen.group = nobody
# 第三处修改
user = nginx
group = nginx


# 重启
sudo systemctl start php-fpm
sudo systemctl enable php-fpm


# 安装xcahe
sudo yum -y install php-xcache xcache-admin
# 如果失败请用下面的方法
# xcahe
wget https://kojipkgs.fedoraproject.org//packages/php-xcache/3.1.1/1.el7/x86_64/php-xcache-3.1.1-1.el7.x86_64.rpm
# 图形化管理
wget https://kojipkgs.fedoraproject.org//packages/php-xcache/3.1.1/1.el7/noarch/xcache-admin-3.1.1-1.el7.noarch.rpm</code></pre><p>#配置nginx sudo vi /etc/nginx/conf.d/default.conf server { listen 80; server_name server_domain_name_or_IP; # 注意位置，在括号外 root /usr/share/nginx/html; index index.php index.html index.htm;</p>
<pre><code>location / {
    try_files $uri $uri/ =404;
}
error_page 404 /404.html;
error_page 500 502 503 504 /50x.html;
location = /50x.html {
    root /usr/share/nginx/html;
}
    # 下面是配置fpm
location ~ \.php$ {
    try_files $uri =404;
    fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; (这个值从php-fpm复制来)
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
}</code></pre><p>}</p>
<pre><code># 测试
sudo vi /usr/share/nginx/html/info.php
&lt;?php echo phpinfo();&gt;
sudo systemctl restart php-fpm
sudo systemctl restart nginx</code></pre><h3 id="安装imagemagick"><a href="#安装imagemagick" class="headerlink" title="安装imagemagick"></a>安装imagemagick</h3><pre><code>yum install php-pear gcc
yum install ImageMagick ImageMagick-devel ImageMagick-perl
pecl install imagick # 直接回车
echo extension=imagick.so &gt;&gt; /etc/php.ini # 添加php扩展
systemctl restart httpd</code></pre><h3 id="mysql主从复制主服务器配置"><a href="#mysql主从复制主服务器配置" class="headerlink" title="mysql主从复制主服务器配置"></a>mysql主从复制主服务器配置</h3><pre><code>vi /etc/my.cnf
[mysqld] 
server-id=1     # 配一个唯一的ID编号，1至32  
log-bin=mysql-bin  # 二进制文件存放路径  
binlog-do-db=test1  # 需要同步的数据库名  
binlog-ignore-db=test2  # 不需要同步的数据库名 </code></pre><p>其他参考mysql主从复制</p>
<h3 id="rsycn数据同步"><a href="#rsycn数据同步" class="headerlink" title="rsycn数据同步"></a>rsycn数据同步</h3><pre><code>yum install rsync # 安装，默认端口873  
systemctl start rsyncd
systemctl enable rsyncd



vim rsync.conf# 日志文件位置，启动rsync后自动产生这个文件，无需提前创建
log file = /var/log/rsyncd.log
# pid文件的存放位置
pidfile = /var/run/rsyncd.pid
# 支持max connections参数的锁文件
lock file = /var/run/rsync.lock
# 用户认证配置文件，里面保存用户名称和密码，后面会创建这个文件
secrets file = /etc/rsync.pass
# rsync启动时欢迎信息页面文件位置（文件内容自定义
# motd file = /etc/rsyncd.Motd
#

# 设置rsync运行权限为root
# uid = root
# 设置rsync运行权限为root
# gid = root
# 匿名用户
uid = 0
gid = 0
# 默认端口
port = 873
# 默认为true，修改为no，增加对目录文件软连接的备份
use chroot = no
# 设置rsync服务端文件为读写权限
read only = yes
# 不显示rsync服务端资源列表
list = no
# 最大连接数
max connections = 200
# 设置超时时间
timeout = 600
# 不验证用户密码
strict modes = false
# 执行数据同步的用户名，可以设置多个，用英文状态下逗号隔开
# auth users = test
# 允许进行数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开
hosts allow = 192.168.0.206, 192.168.0.118
# 禁止数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开
# hosts deny = 192.168.21.254

# 自定义名称
[web]
# rsync服务端数据目录路径
path = /var/www/html/HKMAIN_NEW/Upload/product/manual/cn/
#
# 模块名称与自定义名称相同
comment = web

[webe]
path = /var/www/html/HKMAIN_NEW/Upload/product/manual/en/
comment = webe</code></pre><h3 id="centos7-2安装nfs服务器端"><a href="#centos7-2安装nfs服务器端" class="headerlink" title="centos7.2安装nfs服务器端"></a>centos7.2安装nfs服务器端</h3><pre><code># 服务器端安装及配置
# 安装命令
sudo yum install nfs-utils rpcbind
# 查看是否安装成功
$ rpm -aq nfs-utils rpcbind
rpcbind-0.2.0-38.el7.x86_64
nfs-utils-1.3.0-0.33.el7_3.x86_64
# 启动rpcbind
sudo systemctl restart rpcbind
# 查看状态
systemctl status rpcbind
# 开机启动
sudo systemctl enable rpcbind
# 查看是否开机启动
systemctl is-enabled rpcbind # enable表示开机启动，disable表示不开机启动
# 启动及开机启动nfs服务
sudo systemctl restart nfs
sudo systemctl enable nfs
#配置nfs服务
vim /etc/exports
/readonly 192.168.0.160(insecure,ro,no_root_squash) # 指定ip地址，只读
/rwsync 192.168.0.0/24(insecure,rw,sync,no_root_squash) # 指定ip地址段，读写
# 加载配置文件
sudo exportfs -rv
# 查看nfs服务器本地挂载情况
$ showmount -e localhost
Export list for localhost:
/rwsync   192.168.0.0/24
/readonly 192.168.0.160
# 重启服务
sudo systemctl restart nfs


# 客户端安装配置
sudo yum install nfs-utils rpcbind
# 只需启动rpc服务
sudo systemctl restart rpcbind
sudo systemctl enable rpcbind
# 查看可以挂载服务器端的目录
showmount -e 192.168.0.206
Export list for 192.168.0.206:
/rwsync   192.168.0.0/24
/readonly 192.168.0.160
# 挂载
sudo mount -t nfs 192.168.0.206:/readonly /mnt/readonly
sudo mount -t nfs 192.168.0.206:/rwsync /mnt/rwsync
# 查看挂载结果
df -h</code></pre><h3 id="centos7-2安装python3-5"><a href="#centos7-2安装python3-5" class="headerlink" title="centos7.2安装python3.5"></a>centos7.2安装python3.5</h3><pre><code># 安装编译环境
yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel
# 下载文件
wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tgz
# 解压
tar -zxvf Python-3.6.6.tgz
# 编译安装
cd Python-3.5.1
./configure --prefix=/usr/local/python3
make &amp;&amp; make install
# 创建软连接
sudo ln -s /usr/local/python3/bin/python3 /usr/bin/python3
python3 --version
sudo ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3 
pip3 --version

# 添加pip源
vim ~/.pip/pip.conf
[global]
trusted-host =  mirrors.aliyun.com
index-url = https://mirrors.aliyun.com/pypi/simple

### 安装虚拟环境
sudo pip3 uninstall virtualenv
sudo ln -s /usr/local/python3/bin/virtualenv /usr/bin/virtualenv 

### 创建虚拟环境
virtualenv --no-site-packages -p python3 .env
source ./.env/bin/activate</code></pre><h3 id="centos7-2安装node8"><a href="#centos7-2安装node8" class="headerlink" title="centos7.2安装node8"></a>centos7.2安装node8</h3><pre><code># 参考文件 https://nodejs.org/en/download/package-manager/
On RHEL, CentOS or Fedora, for Node.js v8 LTS:

curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
Alternatively for Node.js 10:

curl --silent --location https://rpm.nodesource.com/setup_10.x | sudo bash -
Then install:
sudo yum -y install nodejs


# 安装cnpm
npm install -g cnpm --registry=https://registry.npm.taobao.org</code></pre><h3 id="centos6-8安装nginx"><a href="#centos6-8安装nginx" class="headerlink" title="centos6.8安装nginx"></a>centos6.8安装nginx</h3><pre><code># 安装pcre库，使nginx支持rewrite
yum install pcre pcre-devel -y
# 安装openssl，https服务需要使用
yum install openssl openssl-devel -y
# 安装 gzip 类库
yum -y install zlib zlib-devel
# 安装编译程序
yum -y install make gcc gcc-c++ ncurses-devel
# 创建用户
useradd nginx -s /sbin/nologin -M
# 下载源码
wget -q https://nginx.org/download/nginx-1.6.3.tar.gz 
tar -zxvf nginx-1.6.3.tar.gz
cd nginx-1.6.3
./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-http_ssl_module --with-http_stub_status_module --with-pcre
make
make install


# 启动nginx
/usr/local/nginx/sbin/nginx
# 停止nginx
/usr/local/nginx/sbin/nginx -s quit
# 重新加载配置文件
/usr/local/nginx/sbin/nginx -s reload        
# 测试你的配置文件是否有误
/usr/local/nginx/sbin/nginx -t       
# 查看nginx对应的端口
 lsof -i :80</code></pre><h3 id="centos6-8安装mysql5-7"><a href="#centos6-8安装mysql5-7" class="headerlink" title="centos6.8安装mysql5.7"></a>centos6.8安装mysql5.7</h3><pre><code># yum源直接安装的是mysql5.1版本，抛弃
# 先检查是否有旧版本
rpm -qa | grep mysql
# 删除旧版本
sudo yum -y remove mysql-xx-xx
wget https://dev.mysql.com/get/mysql57-community-release-el6-10.noarch.rpm
sudo yum install mysql57-community-release-el6-10.noarch.rpm
sudo yum install mysql-community-server</code></pre><h3 id="centos7-2-源码安装nginx"><a href="#centos7-2-源码安装nginx" class="headerlink" title="centos7.2 源码安装nginx"></a>centos7.2 源码安装nginx</h3><pre><code># 安装pcre库，使nginx支持rewrite
yum install pcre pcre-devel -y
# 安装openssl，https服务需要使用
yum install openssl openssl-devel -y
# 安装 gzip 类库
yum -y install zlib zlib-devel
# 安装编译程序
yum -y install make gcc gcc-c++ ncurses-devel
# 创建用户
useradd nginx -s /sbin/nologin -M
# 下载源码
wget -q https://nginx.org/download/nginx-1.12.1.tar.gz 
tar -zxvf nginx-1.12.1.tar.gz
cd nginx-1.12.1
./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_gunzip_module --with-http_gzip_static_module --with-threads --with-file-aio --with-ipv6 --with-http_v2_module --with-cc-opt=&apos;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=native&apos;
make
make install


# 创建链接
sudo ln -s /usr/local/nginx/bin/nginx /usr/bin/nginx
# 启动nginx
/usr/local/nginx/sbin/nginx
# 停止nginx
/usr/local/nginx/sbin/nginx -s quit
# 重新加载配置文件
/usr/local/nginx/sbin/nginx -s reload        
# 测试你的配置文件是否有误
/usr/local/nginx/sbin/nginx -t       
# 查看nginx对应的端口
 lsof -i :80</code></pre><h3 id="centos7-2安装php7"><a href="#centos7-2安装php7" class="headerlink" title="centos7.2安装php7"></a>centos7.2安装php7</h3><pre><code># 加源
sudo yum install epel-release yum-utils
sudo yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm
# 选择remi
sudo yum-config-manager --enable remi-php70
sudo yum-config-manager --enable remi-php71
sudo yum-config-manager --enable remi-php72
# 安装相关扩展
sudo yum-config-manager --enable remi-php70
sudo yum install php php-common php-opcache php-mcrypt php-cli php-gd php-curl php-mysql
# 安装 PHP FPM 
sudo yum install php-fpm
sudo systemctl enable php-fpm
sudo systemctl start php-fpm
# 配置
sudo vim /etc/php-fpm.d/www.conf
user = nginx
group = nginx


# 配置nginx虚拟server
server {

    # . . . other code

    location ~ \.php$ {
        try_files $uri =404;
        # fastcgi_pass unix:/run/php-fpm/www.sock;
                fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}</code></pre><h3 id="centos7-2安装redis"><a href="#centos7-2安装redis" class="headerlink" title="centos7.2安装redis"></a>centos7.2安装redis</h3><pre><code>$ sudo yum install redis
$ sudo systemctl enable redis
$ sudo systemctl start redis
# 查看版本号
$ redis-server --version


# 使用方法 http://www.zhuohc.com/articles/redis%E5%9F%BA%E7%A1%80/</code></pre><p><a href="/articles/centos7-2安装及使用docker/">centos7.2安装使用docker</a> <a href="/articles/centos7-2安装使用sentry/">centos7.2安装使用sentry</a> <a href="/articles/centos7-2使用rabbitmq/">centos7.2安装使用rabbitMQ</a> <a href="/articles/postgresql常见命令/">centos7.2安装使用postgresql</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.zhuohc.com/2016/11/10/centos7-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-9f-ba-e7-a1-80-e9-85-8d-e7-bd-ae/" data-id="cjyfelqxc004wcta4tfz1o3bh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/办公/">办公</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/办公/后端/">后端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/办公/后端/运维/">运维</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/办公/运维/">运维</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/后端/运维/">运维</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微信/">微信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDE/" style="font-size: 12.5px;">IDE</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/ubuntu/" style="font-size: 12.5px;">ubuntu</a> <a href="/tags/windows/" style="font-size: 17.5px;">windows</a> <a href="/tags/微信/" style="font-size: 10px;">微信</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/23/测试blog/">测试blog</a>
          </li>
        
          <li>
            <a href="/2019/07/23/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/11/17/e5-9c-a8bash-e6-98-be-e7-a4-bagit-e5-88-86-e6-94-af-e4-bf-a1-e6-81-af/">在bash显示git分支信息</a>
          </li>
        
          <li>
            <a href="/2018/11/16/zabbix-e5-ae-89-e8-a3-85-e5-8f-8a-e4-bd-bf-e7-94-a8/">zabbix安装及使用</a>
          </li>
        
          <li>
            <a href="/2018/11/14/centos7-2-e5-ae-89-e8-a3-85-e4-bd-bf-e7-94-a8openresty/">centos7.2安装使用openResty</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 www.zhuohc.om<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>