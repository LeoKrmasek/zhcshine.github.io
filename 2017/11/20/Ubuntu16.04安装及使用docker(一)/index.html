<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">
<meta property="og:type" content="article">
<meta property="og:title" content="ubuntu16.04安装及使用docker(一)">
<meta property="og:url" content="http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/index.html">
<meta property="og:site_name" content="zhuohc&#39;s blog">
<meta property="og:description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-23T05:51:43.847Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ubuntu16.04安装及使用docker(一)">
<meta name="twitter:description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>ubuntu16.04安装及使用docker(一)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/11/22/最新在linux-ubuntu中安装qq的办法/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/11/08/Linux命令记录/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&text=ubuntu16.04安装及使用docker(一)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&is_video=false&description=ubuntu16.04安装及使用docker(一)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ubuntu16.04安装及使用docker(一)&body=Check out this article: http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&name=ubuntu16.04安装及使用docker(一)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&t=ubuntu16.04安装及使用docker(一)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#删除旧版本"><span class="toc-number">1.</span> <span class="toc-text">删除旧版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将用户加入docker用户组这样不需要输入sudo"><span class="toc-number">3.</span> <span class="toc-text">将用户加入docker用户组，这样不需要输入sudo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动测试"><span class="toc-number">4.</span> <span class="toc-text">启动测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更换镜像源"><span class="toc-number">5.</span> <span class="toc-text">更换镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装ctop查看容器状态"><span class="toc-number">6.</span> <span class="toc-text">安装ctop查看容器状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个实例"><span class="toc-number">7.</span> <span class="toc-text">第一个实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建dockerfile镜像"><span class="toc-number">8.</span> <span class="toc-text">创建dockerfile镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用在线仓库"><span class="toc-number">9.</span> <span class="toc-text">使用在线仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器连接"><span class="toc-number">10.</span> <span class="toc-text">容器连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器的备份"><span class="toc-number">11.</span> <span class="toc-text">容器的备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让docker容器连接互联网"><span class="toc-number">12.</span> <span class="toc-text">让docker容器连接互联网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据卷"><span class="toc-number">13.</span> <span class="toc-text">数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何在开发中使用docker以python-flask为例"><span class="toc-number">14.</span> <span class="toc-text">如何在开发中使用docker,以python flask为例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用配置文件配置开发环境和生产环境"><span class="toc-number">15.</span> <span class="toc-text">使用配置文件配置开发环境和生产环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用compose自动化安装创建运行docker环境"><span class="toc-number">16.</span> <span class="toc-text">使用compose自动化安装创建运行docker环境</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ubuntu16.04安装及使用docker(一)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">zhuohc's blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-11-20T03:45:42.000Z" itemprop="datePublished">2017-11-20</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/后端/">后端</a> › <a class="category-link" href="/categories/后端/运维/">运维</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="删除旧版本">删除旧版本</h3>
<pre><code>sudo apt-get remove docker docker-engine docker.io</code></pre>
<h3 id="安装">安装</h3>
<pre><code>$ sudo apt-get update
# 安装依赖
$ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common
# 添加官方key
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# 查找key
$ sudo apt-key fingerprint 0EBFCD88
pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22
# 获取资源
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;
# 查找合适的版本
$ apt-cache madison docker-ce
docker-ce | 17.09.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages
# 安装
$ sudo apt-get install docker-ce=&lt;VERSION&gt;
# 打印安装结果
$ sudo docker version
Client:
 Version:      17.09.0-ce
 API version:  1.32
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:42:18 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.09.0-ce
 API version:  1.32 (minimum version 1.12)
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:40:56 2017
 OS/Arch:      linux/amd64
 Experimental: false</code></pre>
<h3 id="将用户加入docker用户组这样不需要输入sudo">将用户加入docker用户组，这样不需要输入sudo</h3>
<pre><code>1. sudo cat /etc/group | grep docker 
2. 如果不存在docker组，可以添加sudo groupadd docker 
3. 添加当前用户到docker组，sudo usermod -aG  docker $USER 
4. 重启docker服务,sudo systemctl restart docker 
5. 如果权限不够，sudo chmod a+rw /var/run/docker.sock　
6. sudo chown -R $USER ~/.docker</code></pre>
<h3 id="启动测试">启动测试</h3>
<pre><code>$ sudo  docker run hello-world
Unable to find image &#39;hello-world:latest&#39; locally

latest: Pulling from library/hello-world
9a0669468bf7: Pull complete
Digest: sha256:0e06ef5e1945a718b02a8c319e15bae44f47039005530bc617a5d071190ed3fc
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://cloud.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/engine/userguide/</code></pre>
<h3 id="更换镜像源">更换镜像源</h3>
<pre><code># 可以修改 /etc/docker/daemon.json 文件并添加上 registry-mirrors 键值,没有就创建一个

{
  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]
}</code></pre>
<h3 id="安装ctop查看容器状态">安装ctop查看容器状态</h3>
<pre><code># https://github.com/bcicen/ctop
$ sudo wget https://github.com/bcicen/ctop/releases/download/v0.6.1/ctop-0.6.1-linux-amd64 -O /usr/local/bin/ctop
$ sudo chmod +x /usr/local/bin/ctop</code></pre>
<h3 id="第一个实例">第一个实例</h3>
<pre><code># 第一次使用会下载debian的镜像文件
$ sudo docker run debian echo &#39;hello world&#39;
&gt; Unable to find image &#39;debian&#39; locally
&gt; ......


# -i -t 表示进行交互会话
$ sudo docker run -i -t debian /user/bash
root@622ac5689680:/#  echo &#39;hello world&#39;
&gt; hello world
root@622ac5689680:/# exit
&gt; exit


# 基本命令
$ sudo docker run -h container -i -t debian /bin/bash #-h表示主机名称
$ sudo docker ps  # 查看当前运行的主机
$ sudo docker ps -a # 查看全部的主机
$sudo docker events  # 查看守护进程
$ sudo docker inspect HOST_NAME 　# 查看HOST_NAME的信息
$ sudo docker port HOST_NAME # 查看端口映射信息
$ sudo docker diff HOST_NAME　# 查看更改的信息
$ sudo docker logs HOST_NAME   # 打印log信息
$ sudo docker rm HOST_NAME  # 删除
$ sudo docker pull redis  # 拉取镜像
$ sudo docker create redis # 创建容器
$ sudo docker start zen_brown # 开启容器（kitematic是绿色波浪线）
$ sudo docker stop zen_brown # 停止容器（kitematic是灰色直线）
$ sudo docker pause zen_brown  # 暂停容器kitematic是灰色波浪线）
$ sudo docker commit zen_brown # 将容器变成镜像
$ sudo docker run redis /bin/bash
$ sudo docker attach zen_brown # 查看容器内进程
$ sudo docker cp # 在容器和主机之间复制内容
$ sudo docker exec # 在容器中运行命令
$ sudo docker kill # 容器立即退出</code></pre>
<h3 id="创建dockerfile镜像">创建dockerfile镜像</h3>
<pre><code># 创建项目
$ mkdir cowsay
$ cd cowsay
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ :wq
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile /usr/games/cowsay &#39;Moo&#39;


# 使用entrypoint指令
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ ENTRYPOINTER [&quot;/usr/games/cowsay&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile  &#39;Moo&#39;


# 使用脚本解决entrypoint
$ vim entrypoint.sh
~ #! /bin/bash
~ if [ $# -eq 0 ]; then
~      /usr/games/fortune | /usr/games/cowsay
~  else
~     /usr/games/cowsay &quot;$@&quot;
~   fi
~ :wq
$ chmod +x entrypoint.sh
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile &#39;Moo&#39;</code></pre>
<h3 id="使用在线仓库">使用在线仓库</h3>
<p>在线注册地址：　https://cloud.docker.com</p>
<pre><code># 登陆
$ sudo docker login
$ username:
$ password:
# 填写作者信息
$ vim Dockerfile
~ FROM debian:wheezy
~ MAINTAINER username &lt;username@mail.com&gt;
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t username/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run username/cowsay-dockerfile  &#39;Moo&#39;
# 上传
$ sudo docker push </code></pre>
<h3 id="容器连接">容器连接</h3>
<pre><code>$ sudo docker run --name myredis -d redis # -d表示后台运行
~ a1696406326aaaa6c28931e886b8dd664d191b083de4aed464d584b4720d57b1
$ docker run --rm -it --link myredis:redis redis /bin/bash
&gt; root@9c914447f5e1:/data# redis-cli -h redis -p 6379
&gt; redis:6379&gt; ping
&gt; PONG
&gt; redis:6379&gt; set &quot;abc&quot; 123
&gt; OK
&gt; redis:6379&gt; get &quot;abc&quot;
&gt; &quot;123&quot;
&gt; redis:6379&gt; exit
&gt; root@9c914447f5e1:/data# exit
&gt; exit</code></pre>
<h3 id="容器的备份">容器的备份</h3>
<pre><code># 查看所有的容器
$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
a1696406326a        redis               &quot;docker-entrypoint...&quot;   13 minutes ago      Up 13 minutes       6379/tcp            myredis
# 备份指定的id
$ docker commit -p a1696406326a redis-backup
# 查看镜像
$ docker images
REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE
redis-backup                 latest              fb9d896b3a39        11 seconds ago      107MB
# 上传镜像(docker login &amp;&amp; docker push)
# 或者打包
$ docker save -o ./redis-backup.tar redis-backup
# 恢复容器
$ docker pull ****
# 或者使用包
$ docker load -i ./redis-backup.tar</code></pre>
<h3 id="让docker容器连接互联网">让docker容器连接互联网</h3>
<pre><code># -p 8000:80 表示将主机的8000端口转发至容器的80端口
$ docker run -d -p 8000:80 nginx 

# 容器互联
$ docker run -d --name myredis redis
$ docker run --link myredis:redis debian env  # --link 目标容器:目标容器在主容器内的简称
~ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
~ HOSTNAME=69df45e6f92d
~ REDIS_PORT=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP_ADDR=172.17.0.2
~ REDIS_PORT_6379_TCP_PORT=6379
~ REDIS_PORT_6379_TCP_PROTO=tcp
~ REDIS_NAME=/stupefied_chandrasekhar/redis
~ REDIS_ENV_GOSU_VERSION=1.10
~ REDIS_ENV_REDIS_VERSION=4.0.2
~ REDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-4.0.2.tar.gz
~ REDIS_ENV_REDIS_DOWNLOAD_SHA=b1a0915dbc91b979d06df1977fe594c3fa9b189f1f3d38743a2948c9f7634813
~ HOME=/root</code></pre>
<h3 id="数据卷">数据卷</h3>
<pre><code>#  -v指定数据卷
$ docker run -it --name container-test -h container -v /ddata debian /bin/bash
# 查看数据卷在本机的位置
$ docker inspect -f { {.Mounts}} container-test  
[{volume 4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9 /var/lib/docker/volumes/4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9/_data /ddata local  true }]
# 可以在本机中添加文件并在容器中查看修改结果


### 在dockerfile中设置数据卷
FROM debian:wheezy
RUN useradd foo
# VOLUME /ddata # 此处添加无效果，因为touch chown是在一个临时容器内的数据卷中执行的
RUN touch /data/x
RUN CHOWN -R foo:foo /data
# VOLUME /ddata # 此处添加可以


# docker run -v 指定到特定数据卷
$ docker run -v /home/adrian/data:./data debian ls /data


# 数据容器
$ docker run --name dbdata postgres echo &#39;data-only container for postage&#39; # 创建一个postgreSQL的容器
# 使用--volumes-from参数，使其他容器也可以使用这个数据卷
$ docker run -d --volumes-from dbdata --name db1 postgres</code></pre>
<h3 id="如何在开发中使用docker以python-flask为例">如何在开发中使用docker,以python flask为例</h3>
<pre><code># 创建项目
$ tree identidock
.
├── app
│   └── identidock.py
└── Dockerfile


# 编辑flask文件
$ vim app/identidock.py
from flask import Flask
app = Flask(__name__)

@app.route(&#39;/&#39;)
def hello_world():
    return &#39;hello world&#39;

if __name__ == &#39;__main__&#39;:
    app.run(debug=True, host=&#39;0.0.0.0&#39;)


# 编辑dockerfile文件
$ vim Dockerfile
FROM python:3.4

RUN pip install Flask==0.10.1
WORKDIR /app
COPY app /app
CMD [&quot;python&quot;, &quot;identidock.py&quot;]


# 创建镜像并使用容器
$ docker build -t identidock .
...
$ docker run -d -p 5000:5000 identidock # 后台运行并将主机的5000端口转发到docker
$ curl localhost:5000
~ hello world

# 将开发的代码目录挂载到docker上，这样就不必每次更改代码都需要重新bulid一次．
$ docker run -d -p 5000:5000 -v &quot;$PWD&quot;/app:/app identidock  # -v &quot;$PWD&quot;/app:/app把位于主机的./app目录挂载到容器内，覆盖容器/app目录下的内容
# 可以修改app目录下的文件查看改动情况

# 以wsgi服务器运行flask并且修改设置用户
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi # 创建用户组和用户
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app

EXPOSE 9090 9191  # 声明主机和其他容器可以访问的端口号
USER uwsgi #使用用户运行以下代码，默认docker是以root用户运行的，不安全
CMD [&quot;uwsgi&quot;, &quot;--http&quot;, &quot;0.0.0.0:9090&quot;, &quot;--wsgi-file&quot;, &quot;/app/identidock.py&quot;, &quot;--callable&quot;, &quot;app&quot;, &quot;--stats&quot;, &quot;0.0.0.0:9191&quot;]</code></pre>
<h3 id="使用配置文件配置开发环境和生产环境">使用配置文件配置开发环境和生产环境</h3>
<pre><code># 创建脚本文件cmd.sh
$ tree
.
├── app
│   └── identidock.py
├── cmd.sh
└── Dockerfile

$ vim cmd.sh
#! /bin/bash
set -e

if [ &quot;$ENV&quot; = &#39;DEV&#39; ]; then
  echo &quot;Running Development Server&quot;
  exec python &quot;identidock.py&quot;
else
  echo &quot;Running Production Server&quot;
  exec uwsgi --http 0.0.0.0:9090 --wsgi-file /app/identidock.py --callable app --stats 0.0.0.0:9191
fi

$ chmod +x cmd.sh
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app
COPY cmd.sh /

EXPOSE 9090 9191
USER uwsgi
CMD [&quot;/cmd.sh&quot;]

$ docker build -t identidock .
$ docker run -e &quot;ENV=DEV&quot; -p 5000:5000 identidock # 开发环境
$ docker run -d -P identidock</code></pre>
<h3 id="使用compose自动化安装创建运行docker环境">使用compose自动化安装创建运行docker环境</h3>
<pre><code># 安装环境
# https://docs.docker.com/compose/install/
$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ docker-compose --version


# 配置文件
tree
.
├── app
│   └── identidock.py
├── cmd.sh
├── docker-compose.yml
└── Dockerfile
# 编辑docker-compose文件
$ vim docker-compose.yml
identidock:
  build: .
  ports:
    - &quot;5000:5000&quot;
  environment:
    ENV: DEV
  volumes:
    - ./app:/app
~                    


# 使用方法
$ docker-compose up # 如果有镜像则直接运行，如果没有镜像则先build
$ docker-compose build # 重新构建镜像
$ docker-compose ps 获取由compose管理的容器状态
$ docker-compose logs 输出日志
$ docker-stop 停止容器，但不会删除他们</code></pre>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#删除旧版本"><span class="toc-number">1.</span> <span class="toc-text">删除旧版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将用户加入docker用户组这样不需要输入sudo"><span class="toc-number">3.</span> <span class="toc-text">将用户加入docker用户组，这样不需要输入sudo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动测试"><span class="toc-number">4.</span> <span class="toc-text">启动测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更换镜像源"><span class="toc-number">5.</span> <span class="toc-text">更换镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装ctop查看容器状态"><span class="toc-number">6.</span> <span class="toc-text">安装ctop查看容器状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个实例"><span class="toc-number">7.</span> <span class="toc-text">第一个实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建dockerfile镜像"><span class="toc-number">8.</span> <span class="toc-text">创建dockerfile镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用在线仓库"><span class="toc-number">9.</span> <span class="toc-text">使用在线仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器连接"><span class="toc-number">10.</span> <span class="toc-text">容器连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器的备份"><span class="toc-number">11.</span> <span class="toc-text">容器的备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让docker容器连接互联网"><span class="toc-number">12.</span> <span class="toc-text">让docker容器连接互联网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据卷"><span class="toc-number">13.</span> <span class="toc-text">数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何在开发中使用docker以python-flask为例"><span class="toc-number">14.</span> <span class="toc-text">如何在开发中使用docker,以python flask为例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用配置文件配置开发环境和生产环境"><span class="toc-number">15.</span> <span class="toc-text">使用配置文件配置开发环境和生产环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用compose自动化安装创建运行docker环境"><span class="toc-number">16.</span> <span class="toc-text">使用compose自动化安装创建运行docker环境</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&text=ubuntu16.04安装及使用docker(一)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&is_video=false&description=ubuntu16.04安装及使用docker(一)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ubuntu16.04安装及使用docker(一)&body=Check out this article: http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&title=ubuntu16.04安装及使用docker(一)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&name=ubuntu16.04安装及使用docker(一)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://www.zhuohc.com/2017/11/20/Ubuntu16.04安装及使用docker(一)/&t=ubuntu16.04安装及使用docker(一)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 zhuohanchang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
