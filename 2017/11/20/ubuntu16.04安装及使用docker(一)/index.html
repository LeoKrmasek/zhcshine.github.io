<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">
<meta property="og:type" content="article">
<meta property="og:title" content="ubuntu16.04安装及使用docker(一)">
<meta property="og:url" content="http://www.zhuohc.com/2017/11/20/ubuntu16.04安装及使用docker(一)/index.html">
<meta property="og:site_name" content="饱读诗书">
<meta property="og:description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-07-23T05:51:43.847Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ubuntu16.04安装及使用docker(一)">
<meta name="twitter:description" content="删除旧版本 sudo apt-get remove docker docker-engine docker.io 安装 $ sudo apt-get update # 安装依赖 $ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common # 添加官方key $ curl -f">





  
  
  <link rel="canonical" href="http://www.zhuohc.com/2017/11/20/ubuntu16.04安装及使用docker(一)/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>ubuntu16.04安装及使用docker(一) | 饱读诗书</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">饱读诗书</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">怕什么真理无穷，进一寸有一寸的欢喜。</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">72</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhuohc.com/2017/11/20/ubuntu16.04安装及使用docker(一)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhuohanchang">
      <meta itemprop="description" content="怕什么真理无穷，进一寸有一寸的欢喜。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="饱读诗书">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">ubuntu16.04安装及使用docker(一)

              
            
          </h2>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-20 11:45:42" itemprop="dateCreated datePublished" datetime="2017-11-20T11:45:42+08:00">2017-11-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-23 13:51:43" itemprop="dateModified" datetime="2019-07-23T13:51:43+08:00">2019-07-23</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="删除旧版本">删除旧版本</h3>
<pre><code>sudo apt-get remove docker docker-engine docker.io</code></pre>
<h3 id="安装">安装</h3>
<pre><code>$ sudo apt-get update
# 安装依赖
$ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common
# 添加官方key
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# 查找key
$ sudo apt-key fingerprint 0EBFCD88
pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22
# 获取资源
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;
# 查找合适的版本
$ apt-cache madison docker-ce
docker-ce | 17.09.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages
# 安装
$ sudo apt-get install docker-ce=&lt;VERSION&gt;
# 打印安装结果
$ sudo docker version
Client:
 Version:      17.09.0-ce
 API version:  1.32
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:42:18 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.09.0-ce
 API version:  1.32 (minimum version 1.12)
 Go version:   go1.8.3
 Git commit:   afdb6d4
 Built:        Tue Sep 26 22:40:56 2017
 OS/Arch:      linux/amd64
 Experimental: false</code></pre>
<h3 id="将用户加入docker用户组这样不需要输入sudo">将用户加入docker用户组，这样不需要输入sudo</h3>
<pre><code>1. sudo cat /etc/group | grep docker 
2. 如果不存在docker组，可以添加sudo groupadd docker 
3. 添加当前用户到docker组，sudo usermod -aG  docker $USER 
4. 重启docker服务,sudo systemctl restart docker 
5. 如果权限不够，sudo chmod a+rw /var/run/docker.sock　
6. sudo chown -R $USER ~/.docker</code></pre>
<h3 id="启动测试">启动测试</h3>
<pre><code>$ sudo  docker run hello-world
Unable to find image &#39;hello-world:latest&#39; locally

latest: Pulling from library/hello-world
9a0669468bf7: Pull complete
Digest: sha256:0e06ef5e1945a718b02a8c319e15bae44f47039005530bc617a5d071190ed3fc
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://cloud.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/engine/userguide/</code></pre>
<h3 id="更换镜像源">更换镜像源</h3>
<pre><code># 可以修改 /etc/docker/daemon.json 文件并添加上 registry-mirrors 键值,没有就创建一个

{
  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]
}</code></pre>
<h3 id="安装ctop查看容器状态">安装ctop查看容器状态</h3>
<pre><code># https://github.com/bcicen/ctop
$ sudo wget https://github.com/bcicen/ctop/releases/download/v0.6.1/ctop-0.6.1-linux-amd64 -O /usr/local/bin/ctop
$ sudo chmod +x /usr/local/bin/ctop</code></pre>
<h3 id="第一个实例">第一个实例</h3>
<pre><code># 第一次使用会下载debian的镜像文件
$ sudo docker run debian echo &#39;hello world&#39;
&gt; Unable to find image &#39;debian&#39; locally
&gt; ......


# -i -t 表示进行交互会话
$ sudo docker run -i -t debian /user/bash
root@622ac5689680:/#  echo &#39;hello world&#39;
&gt; hello world
root@622ac5689680:/# exit
&gt; exit


# 基本命令
$ sudo docker run -h container -i -t debian /bin/bash #-h表示主机名称
$ sudo docker ps  # 查看当前运行的主机
$ sudo docker ps -a # 查看全部的主机
$sudo docker events  # 查看守护进程
$ sudo docker inspect HOST_NAME 　# 查看HOST_NAME的信息
$ sudo docker port HOST_NAME # 查看端口映射信息
$ sudo docker diff HOST_NAME　# 查看更改的信息
$ sudo docker logs HOST_NAME   # 打印log信息
$ sudo docker rm HOST_NAME  # 删除
$ sudo docker pull redis  # 拉取镜像
$ sudo docker create redis # 创建容器
$ sudo docker start zen_brown # 开启容器（kitematic是绿色波浪线）
$ sudo docker stop zen_brown # 停止容器（kitematic是灰色直线）
$ sudo docker pause zen_brown  # 暂停容器kitematic是灰色波浪线）
$ sudo docker commit zen_brown # 将容器变成镜像
$ sudo docker run redis /bin/bash
$ sudo docker attach zen_brown # 查看容器内进程
$ sudo docker cp # 在容器和主机之间复制内容
$ sudo docker exec # 在容器中运行命令
$ sudo docker kill # 容器立即退出</code></pre>
<h3 id="创建dockerfile镜像">创建dockerfile镜像</h3>
<pre><code># 创建项目
$ mkdir cowsay
$ cd cowsay
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ :wq
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile /usr/games/cowsay &#39;Moo&#39;


# 使用entrypoint指令
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ ENTRYPOINTER [&quot;/usr/games/cowsay&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile  &#39;Moo&#39;


# 使用脚本解决entrypoint
$ vim entrypoint.sh
~ #! /bin/bash
~ if [ $# -eq 0 ]; then
~      /usr/games/fortune | /usr/games/cowsay
~  else
~     /usr/games/cowsay &quot;$@&quot;
~   fi
~ :wq
$ chmod +x entrypoint.sh
$ vim Dockerfile
~ FROM debian:wheezy
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t test/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run test/cowsay-dockerfile &#39;Moo&#39;</code></pre>
<h3 id="使用在线仓库">使用在线仓库</h3>
<p>在线注册地址：　https://cloud.docker.com</p>
<pre><code># 登陆
$ sudo docker login
$ username:
$ password:
# 填写作者信息
$ vim Dockerfile
~ FROM debian:wheezy
~ MAINTAINER username &lt;username@mail.com&gt;
~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune
~ COPY entrypoint.sh /
~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]
~ :wq 
# 创建
$ sudo docker build -t username/cowsay-dockerfile . 
&gt; Sending build content to Docker .....
&gt; ....
# 运行
$ sudo docker run username/cowsay-dockerfile  &#39;Moo&#39;
# 上传
$ sudo docker push </code></pre>
<h3 id="容器连接">容器连接</h3>
<pre><code>$ sudo docker run --name myredis -d redis # -d表示后台运行
~ a1696406326aaaa6c28931e886b8dd664d191b083de4aed464d584b4720d57b1
$ docker run --rm -it --link myredis:redis redis /bin/bash
&gt; root@9c914447f5e1:/data# redis-cli -h redis -p 6379
&gt; redis:6379&gt; ping
&gt; PONG
&gt; redis:6379&gt; set &quot;abc&quot; 123
&gt; OK
&gt; redis:6379&gt; get &quot;abc&quot;
&gt; &quot;123&quot;
&gt; redis:6379&gt; exit
&gt; root@9c914447f5e1:/data# exit
&gt; exit</code></pre>
<h3 id="容器的备份">容器的备份</h3>
<pre><code># 查看所有的容器
$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
a1696406326a        redis               &quot;docker-entrypoint...&quot;   13 minutes ago      Up 13 minutes       6379/tcp            myredis
# 备份指定的id
$ docker commit -p a1696406326a redis-backup
# 查看镜像
$ docker images
REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE
redis-backup                 latest              fb9d896b3a39        11 seconds ago      107MB
# 上传镜像(docker login &amp;&amp; docker push)
# 或者打包
$ docker save -o ./redis-backup.tar redis-backup
# 恢复容器
$ docker pull ****
# 或者使用包
$ docker load -i ./redis-backup.tar</code></pre>
<h3 id="让docker容器连接互联网">让docker容器连接互联网</h3>
<pre><code># -p 8000:80 表示将主机的8000端口转发至容器的80端口
$ docker run -d -p 8000:80 nginx 

# 容器互联
$ docker run -d --name myredis redis
$ docker run --link myredis:redis debian env  # --link 目标容器:目标容器在主容器内的简称
~ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
~ HOSTNAME=69df45e6f92d
~ REDIS_PORT=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP=tcp://172.17.0.2:6379
~ REDIS_PORT_6379_TCP_ADDR=172.17.0.2
~ REDIS_PORT_6379_TCP_PORT=6379
~ REDIS_PORT_6379_TCP_PROTO=tcp
~ REDIS_NAME=/stupefied_chandrasekhar/redis
~ REDIS_ENV_GOSU_VERSION=1.10
~ REDIS_ENV_REDIS_VERSION=4.0.2
~ REDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-4.0.2.tar.gz
~ REDIS_ENV_REDIS_DOWNLOAD_SHA=b1a0915dbc91b979d06df1977fe594c3fa9b189f1f3d38743a2948c9f7634813
~ HOME=/root</code></pre>
<h3 id="数据卷">数据卷</h3>
<pre><code>#  -v指定数据卷
$ docker run -it --name container-test -h container -v /ddata debian /bin/bash
# 查看数据卷在本机的位置
$ docker inspect -f { {.Mounts}} container-test  
[{volume 4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9 /var/lib/docker/volumes/4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9/_data /ddata local  true }]
# 可以在本机中添加文件并在容器中查看修改结果


### 在dockerfile中设置数据卷
FROM debian:wheezy
RUN useradd foo
# VOLUME /ddata # 此处添加无效果，因为touch chown是在一个临时容器内的数据卷中执行的
RUN touch /data/x
RUN CHOWN -R foo:foo /data
# VOLUME /ddata # 此处添加可以


# docker run -v 指定到特定数据卷
$ docker run -v /home/adrian/data:./data debian ls /data


# 数据容器
$ docker run --name dbdata postgres echo &#39;data-only container for postage&#39; # 创建一个postgreSQL的容器
# 使用--volumes-from参数，使其他容器也可以使用这个数据卷
$ docker run -d --volumes-from dbdata --name db1 postgres</code></pre>
<h3 id="如何在开发中使用docker以python-flask为例">如何在开发中使用docker,以python flask为例</h3>
<pre><code># 创建项目
$ tree identidock
.
├── app
│   └── identidock.py
└── Dockerfile


# 编辑flask文件
$ vim app/identidock.py
from flask import Flask
app = Flask(__name__)

@app.route(&#39;/&#39;)
def hello_world():
    return &#39;hello world&#39;

if __name__ == &#39;__main__&#39;:
    app.run(debug=True, host=&#39;0.0.0.0&#39;)


# 编辑dockerfile文件
$ vim Dockerfile
FROM python:3.4

RUN pip install Flask==0.10.1
WORKDIR /app
COPY app /app
CMD [&quot;python&quot;, &quot;identidock.py&quot;]


# 创建镜像并使用容器
$ docker build -t identidock .
...
$ docker run -d -p 5000:5000 identidock # 后台运行并将主机的5000端口转发到docker
$ curl localhost:5000
~ hello world

# 将开发的代码目录挂载到docker上，这样就不必每次更改代码都需要重新bulid一次．
$ docker run -d -p 5000:5000 -v &quot;$PWD&quot;/app:/app identidock  # -v &quot;$PWD&quot;/app:/app把位于主机的./app目录挂载到容器内，覆盖容器/app目录下的内容
# 可以修改app目录下的文件查看改动情况

# 以wsgi服务器运行flask并且修改设置用户
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi # 创建用户组和用户
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app

EXPOSE 9090 9191  # 声明主机和其他容器可以访问的端口号
USER uwsgi #使用用户运行以下代码，默认docker是以root用户运行的，不安全
CMD [&quot;uwsgi&quot;, &quot;--http&quot;, &quot;0.0.0.0:9090&quot;, &quot;--wsgi-file&quot;, &quot;/app/identidock.py&quot;, &quot;--callable&quot;, &quot;app&quot;, &quot;--stats&quot;, &quot;0.0.0.0:9191&quot;]</code></pre>
<h3 id="使用配置文件配置开发环境和生产环境">使用配置文件配置开发环境和生产环境</h3>
<pre><code># 创建脚本文件cmd.sh
$ tree
.
├── app
│   └── identidock.py
├── cmd.sh
└── Dockerfile

$ vim cmd.sh
#! /bin/bash
set -e

if [ &quot;$ENV&quot; = &#39;DEV&#39; ]; then
  echo &quot;Running Development Server&quot;
  exec python &quot;identidock.py&quot;
else
  echo &quot;Running Production Server&quot;
  exec uwsgi --http 0.0.0.0:9090 --wsgi-file /app/identidock.py --callable app --stats 0.0.0.0:9191
fi

$ chmod +x cmd.sh
$ vim Dockerfile
FROM python:3.4

RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi
RUN pip install Flask==0.10.1 uWSGI==2.0.8
WORKDIR /app
COPY app /app
COPY cmd.sh /

EXPOSE 9090 9191
USER uwsgi
CMD [&quot;/cmd.sh&quot;]

$ docker build -t identidock .
$ docker run -e &quot;ENV=DEV&quot; -p 5000:5000 identidock # 开发环境
$ docker run -d -P identidock</code></pre>
<h3 id="使用compose自动化安装创建运行docker环境">使用compose自动化安装创建运行docker环境</h3>
<pre><code># 安装环境
# https://docs.docker.com/compose/install/
$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ docker-compose --version


# 配置文件
tree
.
├── app
│   └── identidock.py
├── cmd.sh
├── docker-compose.yml
└── Dockerfile
# 编辑docker-compose文件
$ vim docker-compose.yml
identidock:
  build: .
  ports:
    - &quot;5000:5000&quot;
  environment:
    ENV: DEV
  volumes:
    - ./app:/app
~                    


# 使用方法
$ docker-compose up # 如果有镜像则直接运行，如果没有镜像则先build
$ docker-compose build # 重新构建镜像
$ docker-compose ps 获取由compose管理的容器状态
$ docker-compose logs 输出日志
$ docker-stop 停止容器，但不会删除他们</code></pre>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
              <div id="needsharebutton-postbottom">
                <span class="btn">
                  <i class="fa fa-share-alt" aria-hidden="true"></i>
                </span>
              </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/08/linux命令记录/" rel="next" title="linux命令记录">
                <i class="fa fa-chevron-left"></i> linux命令记录
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/22/最新在linux-ubuntu中安装qq的办法/" rel="prev" title="最新在linux/ubuntu中安装qq的办法">
                最新在linux/ubuntu中安装qq的办法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">zhuohanchang</p>
  <div class="site-description motion-element" itemprop="description">怕什么真理无穷，进一寸有一寸的欢喜。</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>













          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#删除旧版本"><span class="nav-number">1.</span> <span class="nav-text">删除旧版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将用户加入docker用户组这样不需要输入sudo"><span class="nav-number">3.</span> <span class="nav-text">将用户加入docker用户组，这样不需要输入sudo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动测试"><span class="nav-number">4.</span> <span class="nav-text">启动测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更换镜像源"><span class="nav-number">5.</span> <span class="nav-text">更换镜像源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装ctop查看容器状态"><span class="nav-number">6.</span> <span class="nav-text">安装ctop查看容器状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第一个实例"><span class="nav-number">7.</span> <span class="nav-text">第一个实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建dockerfile镜像"><span class="nav-number">8.</span> <span class="nav-text">创建dockerfile镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用在线仓库"><span class="nav-number">9.</span> <span class="nav-text">使用在线仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器连接"><span class="nav-number">10.</span> <span class="nav-text">容器连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器的备份"><span class="nav-number">11.</span> <span class="nav-text">容器的备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#让docker容器连接互联网"><span class="nav-number">12.</span> <span class="nav-text">让docker容器连接互联网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据卷"><span class="nav-number">13.</span> <span class="nav-text">数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何在开发中使用docker以python-flask为例"><span class="nav-number">14.</span> <span class="nav-text">如何在开发中使用docker,以python flask为例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用配置文件配置开发环境和生产环境"><span class="nav-number">15.</span> <span class="nav-text">使用配置文件配置开发环境和生产环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用compose自动化安装创建运行docker环境"><span class="nav-number">16.</span> <span class="nav-text">使用compose自动化安装创建运行docker环境</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhuohanchang</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

    
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
        flOptions.iconStyle = "box";
      
        flOptions.boxForm = "horizontal";
      
        flOptions.position = "middleRight";
      
        flOptions.networks = "Weibo,Wechat,Douban";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>


    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  

















  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>














<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
