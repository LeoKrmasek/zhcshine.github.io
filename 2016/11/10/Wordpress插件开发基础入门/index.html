<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="插件 创建 12├── hanchang-copyright│   └── hanchang-copyright.php 1234567891011# hanchang-copyright.php&amp;lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Vers">
<meta name="keywords" content="Php">
<meta property="og:type" content="article">
<meta property="og:title" content="Wordpress插件开发基础入门">
<meta property="og:url" content="http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/index.html">
<meta property="og:site_name" content="zhuohc&#39;s blog">
<meta property="og:description" content="插件 创建 12├── hanchang-copyright│   └── hanchang-copyright.php 1234567891011# hanchang-copyright.php&amp;lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Vers">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-17T10:36:40.734Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wordpress插件开发基础入门">
<meta name="twitter:description" content="插件 创建 12├── hanchang-copyright│   └── hanchang-copyright.php 1234567891011# hanchang-copyright.php&amp;lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Vers">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Wordpress插件开发基础入门</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/11/30/Selenium入门基础/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2016/11/10/PythonTkinter入门基础/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&text=Wordpress插件开发基础入门"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&is_video=false&description=Wordpress插件开发基础入门"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Wordpress插件开发基础入门&body=Check out this article: http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&name=Wordpress插件开发基础入门&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&t=Wordpress插件开发基础入门"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#插件"><span class="toc-number">1.</span> <span class="toc-text">插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建"><span class="toc-number">1.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件启用和停用初始化"><span class="toc-number">1.2.</span> <span class="toc-text">插件启用和停用初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除插件"><span class="toc-number">1.3.</span> <span class="toc-text">删除插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_action"><span class="toc-number">1.4.</span> <span class="toc-text">add_action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见钩子"><span class="toc-number">1.5.</span> <span class="toc-text">常见钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器"><span class="toc-number">1.6.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带参数的过滤器"><span class="toc-number">1.7.</span> <span class="toc-text">带参数的过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见过滤器"><span class="toc-number">1.8.</span> <span class="toc-text">常见过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建菜单"><span class="toc-number">1.9.</span> <span class="toc-text">创建菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小工具"><span class="toc-number">1.10.</span> <span class="toc-text">小工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加元数据框"><span class="toc-number">1.11.</span> <span class="toc-text">添加元数据框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后台常见css样式表"><span class="toc-number">1.12.</span> <span class="toc-text">后台常见css样式表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#保存插件设置到数据库中"><span class="toc-number">1.13.</span> <span class="toc-text">保存插件设置到数据库中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用wordpress内置api设置插件属性"><span class="toc-number">1.14.</span> <span class="toc-text">使用wordpress内置api设置插件属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将插件改写成类的形式"><span class="toc-number">1.15.</span> <span class="toc-text">将插件改写成类的形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将插件设置内容转移到wordpress设置里"><span class="toc-number">1.16.</span> <span class="toc-text">将插件设置内容转移到wordpress设置里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用ajax"><span class="toc-number">1.17.</span> <span class="toc-text">调用ajax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现插件翻译功能"><span class="toc-number">1.18.</span> <span class="toc-text">实现插件翻译功能</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Wordpress插件开发基础入门
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">zhuohc's blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2016-11-10T03:40:48.000Z" itemprop="datePublished">2016-11-10</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/后端/">后端</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Php/">Php</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="插件">插件</h2>
<h3 id="创建">创建</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├── hanchang-copyright</span><br><span class="line">│   └── hanchang-copyright.php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hanchang-copyright</span></span><br><span class="line"><span class="comment">Plugin URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 在页脚显示一段版权信息</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hanchang</span></span><br><span class="line"><span class="comment">Author URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>
<h3 id="插件启用和停用初始化">插件启用和停用初始化</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hanchang-copyright</span></span><br><span class="line"><span class="comment">Plugin URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 在页脚显示一段版权信息</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hanchang</span></span><br><span class="line"><span class="comment">Author URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义插件启动时候调用的方法</span></span><br><span class="line">register_activation_hook( <span class="keyword">__FILE__</span>, <span class="string">'hanchang_copyright_install'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_install</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插件启动，添加一个默认的版权信息</span></span><br><span class="line">    update_option( <span class="string">"hanchang_copyright_text"</span>, <span class="string">"&lt;p style='color:red'&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义插件停用时候调用的方法</span></span><br><span class="line">register_deactivation_hook( <span class="keyword">__FILE__</span>, <span class="string">'hanchang_copyright_deactivation'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_deactivation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插件停用，设置停用标识为1</span></span><br><span class="line">    update_option( <span class="string">"hanchang_copyright_deactivation"</span>, <span class="string">"yes"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除插件">删除插件</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── hanchang-copyright.php</span><br><span class="line">└── uninstall.php # 删除插件执行的文件</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uninstall.php</span></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment">// 如果 uninstall 不是从 WordPress 调用，则退出</span></span><br><span class="line"><span class="keyword">if</span>( !defined( <span class="string">'WP_UNINSTALL_PLUGIN'</span> ) )</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除插件创建的项目，以确保不占用数据库资源</span></span><br><span class="line">delete_option( <span class="string">'hanchang_copyright_deactivation'</span> );</span><br><span class="line">delete_option( <span class="string">'hanchang_copyright_text'</span> );</span><br></pre></td></tr></table></figure>
<h3 id="add_action">add_action</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_action(&quot;$tag钩子名称&quot;, &quot;$function_to_do执行函数&quot;, $priorrity执行优先级, $accepted_arga带参数函数的参数个数)</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert</span></span><br><span class="line">add_action( <span class="string">"wp_footer"</span>, <span class="string">"hc_copyright_insert"</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_copyright_insert</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出一段字符串</span></span><br><span class="line">    <span class="keyword">echo</span> get_option( <span class="string">"hc_copyright_text"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">"wp_head"</span>, <span class="string">"hanchang_copyright_insert_new"</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_insert_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert(1);&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'save_post'</span>, <span class="string">'save_post_meta'</span>, <span class="number">10</span>, <span class="number">2</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">save_post_meta</span><span class="params">( $post_id, $post )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    update_post_meta( $post_id, <span class="string">"save-time"</span>, <span class="string">"更新时间："</span> . date(<span class="string">"Y-m-d H:i:s"</span>) );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常见钩子">常见钩子</h3>
<ul>
<li><p>init 加载初始化</p></li>
<li><p>wp_head 加载添加到head标签中的内容</p></li>
<li><p>wp_enqueue_scripts 加载css或者js文件</p></li>
<li><p>wp_foot 加载添加到底部内容</p></li>
<li><p>save_post 添加保存文章</p></li>
<li><p>wp_trash_post 将文章添加到回收站</p></li>
<li><p>delete_post 将文章删除</p></li>
<li><p>wp_insert_comment 插入评论</p></li>
<li><p>user_register 用户注册</p></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hanchang-copyright</span></span><br><span class="line"><span class="comment">Plugin URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 在页脚显示一段版权信息</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hanchang</span></span><br><span class="line"><span class="comment">Author URI: http://www.zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义插件启动时候调用的方法</span></span><br><span class="line">register_activation_hook( <span class="keyword">__FILE__</span>, <span class="string">'hanchang_copyright_install'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_install</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插件启动，添加一个默认的版权信息</span></span><br><span class="line">    update_option( <span class="string">"hanchang_copyright_text"</span>, <span class="string">"&lt;p style='color:red'&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义插件停用时候调用的方法</span></span><br><span class="line">register_deactivation_hook( <span class="keyword">__FILE__</span>, <span class="string">'hanchang_copyright_deactivation'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_deactivation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插件停用，设置停用标识为1</span></span><br><span class="line">    update_option( <span class="string">"hanchang_copyright_deactivation"</span>, <span class="string">"yes"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insert</span></span><br><span class="line">add_action( <span class="string">"wp_footer"</span>, <span class="string">"hc_copyright_insert"</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_copyright_insert</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出一段字符串</span></span><br><span class="line">    <span class="keyword">echo</span> get_option( <span class="string">"hc_copyright_text"</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_action( <span class="string">"wp_head"</span>, <span class="string">"hanchang_copyright_insert_new"</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_copyright_insert_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert(1);&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'save_post'</span>, <span class="string">'save_post_meta'</span>, <span class="number">10</span>, <span class="number">2</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">save_post_meta</span><span class="params">( $post_id, $post )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    update_post_meta( $post_id, <span class="string">"save-time"</span>, <span class="string">"更新时间："</span> . date(<span class="string">"Y-m-d H:i:s"</span>) );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//在输出内容之前，给页面管理添加摘要功能</span></span><br><span class="line">add_action( <span class="string">'init'</span>, <span class="string">'hc_add_excerpts_to_pages'</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_add_excerpts_to_pages</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给页面管理添加摘要的功能</span></span><br><span class="line">    add_post_type_support( <span class="string">'page'</span>, <span class="keyword">array</span>( <span class="string">'excerpt'</span> ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//wp_head钩子</span></span><br><span class="line">add_action(<span class="string">'wp_head'</span>,<span class="string">'hc_wp_head'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_wp_head</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//只有首页输出描述</span></span><br><span class="line">    <span class="keyword">if</span>( is_home() )&#123; <span class="meta">?&gt;</span></span><br><span class="line">        &lt;meta name=<span class="string">"description"</span> content=<span class="string">"&lt;? bloginfo('description'); ?&gt;"</span> /&gt;</span><br><span class="line">    <span class="meta">&lt;?</span> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义引用样式表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_enqueue_style</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    wp_enqueue_style( <span class="string">'core'</span>, plugins_url(<span class="string">'css/hc_copyrighy.css'</span>, <span class="keyword">__FILE__</span>) , <span class="keyword">false</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义引用脚本文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_enqueue_script</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    wp_enqueue_script( <span class="string">'my-js'</span>, plugins_url(<span class="string">'js/hc_copyrighy.js'</span>, <span class="keyword">__FILE__</span>), <span class="keyword">false</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//引用文件的钩子</span></span><br><span class="line">add_action( <span class="string">'wp_enqueue_scripts'</span>, <span class="string">'hc_enqueue_style'</span>, <span class="number">5</span> );</span><br><span class="line">add_action( <span class="string">'wp_enqueue_scripts'</span>, <span class="string">'hc_enqueue_script'</span>, <span class="number">7</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除所有挂载在 wp_enqueue_scripts 钩子上的方法</span></span><br><span class="line">remove_all_actions( <span class="string">'wp_enqueue_scripts'</span>, <span class="number">5</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//评论被添加的时候触发</span></span><br><span class="line">add_action( <span class="string">'wp_insert_comment'</span>, <span class="string">'comment_inserted'</span>, <span class="number">10</span>, <span class="number">2</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除 wp_insert_comment 钩子上的 comment_inserted 方法</span></span><br><span class="line">remove_action( <span class="string">'wp_insert_comment'</span>, <span class="string">'comment_inserted'</span>, <span class="number">10</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">comment_inserted</span><span class="params">($comment_id, $comment_object )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取该评论所在文章的评论总数</span></span><br><span class="line">    $comments_count = wp_count_comments( $comment_object-&gt;comment_post_ID );</span><br><span class="line"></span><br><span class="line">    $commentarr = <span class="keyword">array</span>();</span><br><span class="line">    $commentarr[<span class="string">'comment_ID'</span>] = $comment_id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改评论的内容，在评论内容前加上 “第&#123;$comments_count-&gt;total_comments&#125;个评论：” 这么一段字符串</span></span><br><span class="line">    $commentarr[<span class="string">'comment_content'</span>] = <span class="string">"第&#123;$comments_count-&gt;total_comments&#125;个评论："</span> . $comment_object-&gt;comment_content;</span><br><span class="line"></span><br><span class="line">    wp_update_comment( $commentarr );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'user_register'</span>, <span class="string">'myplugin_registration_save'</span>, <span class="number">10</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myplugin_registration_save</span><span class="params">( $user_id )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将新用户的个人说明，设置为注册时间</span></span><br><span class="line">    wp_update_user( <span class="keyword">array</span>( <span class="string">'ID'</span> =&gt; $user_id, <span class="string">'description'</span> =&gt; <span class="string">"注册时间："</span> . date(<span class="string">"Y-m-d H:i:s"</span>) ) );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤器">过滤器</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_filter($tag过滤器名称, $function_to_add需要添加的函数, $priority优先级, $acceptedargs添加的参数数量)</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="comment">//一开始，我们设置一个变量</span></span><br><span class="line">$value = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//给名为 hc_filter 的过滤器，挂载一个 hc_filter_fun 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun 方法进行过滤</span></span><br><span class="line"><span class="comment">//add_filter( "hc_filter", "hc_filter_fun" );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给名为 hc_filter 的过滤器，再挂载一个 hc_filter_fun_add_time 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun、hc_filter_fun_add_time 两个方法进行过滤</span></span><br><span class="line"><span class="comment">//add_filter( "hc_filter", "hc_filter_fun_add_time" );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对 $value 值使用名为 hc_filter 的过滤器进行过滤，这个时候，由于 hc_filter 过滤器只挂载了 hc_filter_fun 方法，因此，只使用 hc_filter_fun 方法 过滤了一次，并且返回给 $myvar 变量</span></span><br><span class="line"><span class="comment">//$myvar = apply_filters( "hc_filter", $value );</span></span><br><span class="line"></span><br><span class="line">add_filter( <span class="string">"the_content"</span>, <span class="string">"hc_filter_fun"</span> );</span><br><span class="line">add_filter( <span class="string">"the_content"</span>, <span class="string">"hc_filter_fun_add_time"</span> );</span><br></pre></td></tr></table></figure>
<h3 id="带参数的过滤器">带参数的过滤器</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">suppress_if_blurb</span><span class="params">( $title, $id = null )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( in_category(<span class="string">'wpcj'</span>, $id ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'不显示标题'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $title . <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对 the_title 过滤器挂载一个 suppress_if_blurb 方法，优先级为10，传递的参数有2个</span></span><br><span class="line">add_filter( <span class="string">'the_title'</span>, <span class="string">'suppress_if_blurb'</span>, <span class="number">10</span>, <span class="number">2</span> );</span><br></pre></td></tr></table></figure>
<h3 id="常见过滤器">常见过滤器</h3>
<ul>
<li>the_content 文章内容</li>
<li>content_save_pre 文章保存前</li>
<li>the_title 文章标题</li>
<li>wp_handle_upload_prefilter 上传文件之前</li>
</ul>
<h3 id="创建菜单">创建菜单</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_menu_page  # 添加菜单</span><br><span class="line">add_submenu_page  # 添加子菜单</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="comment">// admin_menu钩子挂载创建菜单方法</span></span><br><span class="line">add_action( <span class="string">'admin_menu'</span>, <span class="string">'hc_create_menu'</span> );</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建顶级菜单</span></span><br><span class="line">    add_menu_page(</span><br><span class="line">        <span class="string">'Hanchang的插件首页'</span>, <span class="comment">// 菜单title标题</span></span><br><span class="line">        <span class="string">'hanchang-copyright'</span>,  <span class="comment">// 菜单名称，显示在后台管理页面侧边栏</span></span><br><span class="line">        <span class="string">'manage_options'</span>, <span class="comment">// 浏览插件所需要的权限=管理员权限</span></span><br><span class="line">        <span class="string">'hanchang_copyright'</span> ,  <span class="comment">// 菜单别名，不能与其他插件冲突</span></span><br><span class="line">        <span class="string">'hanchang_settings_page'</span>,  <span class="comment">// 菜单需要显示的页面，调用的哪个方法</span></span><br><span class="line">        plugins_url( <span class="string">'/images/icon.png'</span>, <span class="keyword">__FILE__</span> )  <span class="comment">// 调用图标</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子菜单</span></span><br><span class="line">    add_submenu_page(</span><br><span class="line">        <span class="string">'hanchang_copyright'</span>,  <span class="comment">// 父级菜单别名</span></span><br><span class="line">        <span class="string">'关于HC的插件'</span>,  <span class="comment">// 菜单title标题</span></span><br><span class="line">        <span class="string">'关于'</span>,  <span class="comment">//  菜单名称，显示在后台管理页面侧边栏</span></span><br><span class="line">        <span class="string">'manage_options'</span>,  <span class="comment">// 浏览插件所需要的权限=管理员权限</span></span><br><span class="line">        <span class="string">'hc_copyright_about'</span>,  <span class="comment">// 菜单别名，不能与其他插件冲突</span></span><br><span class="line">        <span class="string">'hc_create_submenu_menu'</span>  <span class="comment">// 调用方法</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">    <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_create_submenu_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;h2&gt;子菜单&lt;/h2&gt;</span><br><span class="line">    <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小工具">小工具</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#hanchang-copyright.php</span></span><br><span class="line"><span class="comment">// 使用 widgets_init 动作钩子来执行自定义的函数</span></span><br><span class="line">add_action( <span class="string">'widgets_init'</span>, <span class="string">'hc_register_widgets'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册小工具</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_register_widgets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    register_widget( <span class="string">'hc_widget_info'</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 WP_Widget 类来创建小工具</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hc_widget_info</span> <span class="keyword">extends</span> <span class="title">WP_Widget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $widget_ops = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'classname'</span> =&gt; <span class="string">'hc_widget_info'</span>,</span><br><span class="line">            <span class="string">'description'</span> =&gt; <span class="string">'显示作者的个人信息'</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;WP_Widget( <span class="string">'显示作者个人信息'</span>, <span class="string">'作者的小工具'</span>, $widget_ops );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//小工具管理界面</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">form</span><span class="params">( $instance )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        $defaults = <span class="keyword">array</span>( <span class="string">'title'</span> =&gt; <span class="string">'作者的个人信息'</span>, <span class="string">'xingming'</span> =&gt; <span class="string">'作者'</span>, <span class="string">'book'</span> =&gt; <span class="string">'《作者》'</span> );</span><br><span class="line">        $instance = wp_parse_args( (<span class="keyword">array</span>) $instance, $defaults );</span><br><span class="line"></span><br><span class="line">        $title = $instance[<span class="string">'title'</span>];</span><br><span class="line">        $xingming = $instance[<span class="string">'xingming'</span>];</span><br><span class="line">        $book = $instance[<span class="string">'book'</span>];</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">        &lt;p&gt;标题: &lt;input class="widefat" name="&lt;?php echo $this-&gt;get_field_name( 'title' ); ?&gt;" type="text" value="&lt;?php echo esc_attr( $title ); ?&gt;" /&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;姓名: &lt;input class="widefat" name="&lt;?php echo $this-&gt;get_field_name( 'xingming' ); ?&gt; "type="text" value="&lt;?php echo esc_attr( $xingming ); ?&gt; " /&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;著作: &lt;textarea class="widefat" name=" &lt;?php echo $this-&gt;get_field_name( 'book' ); ?&gt; " /&gt;&lt;?php echo esc_attr( $book ); ?&gt;&lt;/textarea&gt; &lt;/p&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存小工具设置</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">( $new_instance, $old_instance )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        $instance = $old_instance;</span><br><span class="line"></span><br><span class="line">        $instance[<span class="string">'title'</span>] = strip_tags( trim( $new_instance[<span class="string">'title'</span>] ) );</span><br><span class="line">        $instance[<span class="string">'xingming'</span>] = strip_tags( trim(  $new_instance[<span class="string">'xingming'</span>] ) );</span><br><span class="line">        $instance[<span class="string">'book'</span>] = strip_tags( trim( $new_instance[<span class="string">'book'</span>] ) );</span><br><span class="line">        <span class="keyword">return</span> $instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示小工具</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">widget</span><span class="params">( $args, $instance )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        extract( $args );</span><br><span class="line"></span><br><span class="line">        $title = apply_filters( <span class="string">'widget_title'</span>, $instance[<span class="string">'title'</span>] );</span><br><span class="line">        $xingming = <span class="keyword">empty</span>( $instance[<span class="string">'xingming'</span>] ) ? <span class="string">' '</span> : $instance[<span class="string">'xingming'</span>];</span><br><span class="line">        $book = <span class="keyword">empty</span>( $instance[<span class="string">'book'</span>] ) ? <span class="string">' '</span> : $instance[<span class="string">'book'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt; 标题: '</span> . $title . <span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt; 姓名: '</span> . $xingming . <span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt; 著作: '</span> . $book . <span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加元数据框">添加元数据框</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hanchang-copyright.php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加一个元数据框到 post 和 page 的管理界面中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myplugin_add_meta_box</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    $screens = <span class="keyword">array</span>( <span class="string">'post'</span>, <span class="string">'page'</span> );</span><br><span class="line"></span><br><span class="line">    add_meta_box(</span><br><span class="line">        <span class="string">'myplugin_sectionid'</span>,  <span class="comment">// 元数据框的html代码中的id值</span></span><br><span class="line">        <span class="string">'转载自'</span>,  <span class="comment">// 元数据框标题</span></span><br><span class="line">        <span class="string">'myplugin_meta_box_callback'</span>,  <span class="comment">// 回调函数名称，输出元数据框中的内容</span></span><br><span class="line">        $screens  <span class="comment">// 元数据框需要添加在哪个分类内的（文章或者页面）</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要给 add_meta_boxes 钩子，挂载一个自定义的方法</span></span><br><span class="line">add_action( <span class="string">'add_meta_boxes'</span>, <span class="string">'myplugin_add_meta_box'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 元数据框展示代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myplugin_meta_box_callback</span><span class="params">( $post )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加一个验证信息，这个在保存元数据的时候用到</span></span><br><span class="line">    wp_nonce_field( <span class="string">'myplugin_save_meta_box_data'</span>, <span class="string">'myplugin_meta_box_nonce'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 输出元数据信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    $value = get_post_meta( $post-&gt;ID, <span class="string">'_zzurl'</span>, <span class="keyword">true</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;label for="myplugin_new_field"&gt;'</span>;</span><br><span class="line">    _e( <span class="string">'本文章转载自：'</span> );</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;/label&gt; '</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;input type="text" id="_zzurl" name="_zzurl" value="'</span> . esc_attr( $value ) . <span class="string">'" size="25" /&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myplugin_save_meta_box_data</span><span class="params">( $post_id )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证是否为有效信息</span></span><br><span class="line">    <span class="keyword">if</span> ( ! <span class="keyword">isset</span>( $_POST[<span class="string">'myplugin_meta_box_nonce'</span>] ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! wp_verify_nonce( $_POST[<span class="string">'myplugin_meta_box_nonce'</span>], <span class="string">'myplugin_save_meta_box_data'</span> ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( defined( <span class="string">'DOING_AUTOSAVE'</span> ) &amp;&amp; DOING_AUTOSAVE ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the user's permissions.</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">isset</span>( $_POST[<span class="string">'post_type'</span>] ) &amp;&amp; <span class="string">'page'</span> == $_POST[<span class="string">'post_type'</span>] ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( ! current_user_can( <span class="string">'edit_page'</span>, $post_id ) ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( ! current_user_can( <span class="string">'edit_post'</span>, $post_id ) ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( ! <span class="keyword">isset</span>( $_POST[<span class="string">'_zzurl'</span>] ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $my_data = sanitize_text_field( $_POST[<span class="string">'_zzurl'</span>] );</span><br><span class="line"></span><br><span class="line">    update_post_meta( $post_id, <span class="string">'_zzurl'</span>, $my_data );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//文章保存的时候，会调用 save_post 钩子，因此我们要借助这个钩子来保存元数据框内的数据</span></span><br><span class="line">add_action( <span class="string">'save_post'</span>, <span class="string">'myplugin_save_meta_box_data'</span> );</span><br></pre></td></tr></table></figure>
<h3 id="后台常见css样式表">后台常见css样式表</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># copyright.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hanchang_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;div class="wrap"&gt;</span><br><span class="line">        &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">        &lt;div id="message" class="updated"&gt;设置保存成功&lt;/div&gt;</span><br><span class="line">        &lt;div id="message" class="error"&gt;保存出现错误&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;input type=<span class="string">"submit"</span> name=<span class="string">"Save"</span> value=<span class="string">"保存设置"</span> /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button" /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button button-primary" /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button button-secondary" /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button button-large" /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button button-small" /&gt;</span><br><span class="line">            &lt;input type="submit" name="Save" value="保存设置" class="button button-hero" /&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;a href=<span class="string">"#"</span>&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button"&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button button-primary"&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button button-secondary"&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button button-large"&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button button-small"&gt;搜索&lt;/a&gt;</span><br><span class="line">            &lt;a href="#" class="button button-hero"&gt;搜索&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form method=<span class="string">"POST"</span> action=<span class="string">""</span>&gt;</span><br><span class="line">            &lt;table class="form-table"&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;th&gt;&lt;label <span class="keyword">for</span>=<span class="string">"xingming"</span>&gt;姓名：&lt;/label&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;td&gt;&lt;input id=<span class="string">"xingming"</span> name=<span class="string">"xingming"</span> /&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;th&gt;&lt;label <span class="keyword">for</span>=<span class="string">"shenfen"</span>&gt;身份：&lt;/label&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;select name=<span class="string">"shenfen"</span>&gt;</span><br><span class="line">                            &lt;option value=<span class="string">"在校"</span>&gt;在校&lt;/option&gt;</span><br><span class="line">                            &lt;option value=<span class="string">"毕业"</span>&gt;毕业&lt;/option&gt;</span><br><span class="line">                        &lt;/select&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;th&gt;&lt;label <span class="keyword">for</span>=<span class="string">"tongyi"</span>&gt;同意注册&lt;/label&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;td&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"tongyi"</span> /&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;th&gt;&lt;label <span class="keyword">for</span>=<span class="string">"xingbie"</span>&gt;性别&lt;/label&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;input type=<span class="string">"radio"</span> name=<span class="string">"xingbie"</span> value=<span class="string">"男"</span> /&gt; 男</span><br><span class="line">                        &lt;input type=<span class="string">"radio"</span> name=<span class="string">"xingbie"</span> value=<span class="string">"女"</span> /&gt; 女</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;th&gt;&lt;label <span class="keyword">for</span>=<span class="string">"beizhu"</span>&gt;备注&lt;/label&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;td&gt;&lt;textarea name=<span class="string">"beizhu"</span>&gt;&lt;/textarea&gt;&lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;tr valign=<span class="string">"top"</span>&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;input type="submit" name="save" value="保存" class="button-primary" /&gt;</span><br><span class="line">                        &lt;input type="submit" name="reset" value="重置" class="button-secondary" /&gt;</span><br><span class="line">                    &lt;/td&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;table class="widefat striped"&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;黄聪&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;<span class="number">2</span>&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;黄聪&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;<span class="number">3</span>&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;黄聪&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;/tbody&gt;</span><br><span class="line">            &lt;tfoot&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;/tfoot&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="tablenav"&gt;</span><br><span class="line">            &lt;div class="tablenav-pages"&gt;</span><br><span class="line">                &lt;span class="displaying-num"&gt;第1页，共458页&lt;/span&gt;</span><br><span class="line">                &lt;span class="page-numbers current"&gt;1&lt;/span&gt;</span><br><span class="line">                &lt;a href="#" class="page-numbers"&gt;2&lt;/a&gt;</span><br><span class="line">                &lt;a href="#" class="page-numbers"&gt;3&lt;/a&gt;</span><br><span class="line">                &lt;a href="#" class="page-numbers"&gt;4&lt;/a&gt;</span><br><span class="line">                &lt;a href="#" class="next page-numbers"&gt;»&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="保存插件设置到数据库中">保存插件设置到数据库中</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── hc-test</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── hc-test.php</span><br><span class="line">│   ├── images</span><br><span class="line">│   └── js</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">hc-test.php</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hc-test</span></span><br><span class="line"><span class="comment">Plugin URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 测试插件</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hc</span></span><br><span class="line"><span class="comment">Author URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置时区为 亚洲/上海</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义插件启动时候调用的方法</span></span><br><span class="line">register_activation_hook( <span class="keyword">__FILE__</span>, <span class="string">'hc_test_install'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_install</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">global</span> $wpdb;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>( $wpdb-&gt;get_var( <span class="string">"SHOW TABLES LIKE '&#123;$wpdb-&gt;prefix&#125;test'"</span> ) != <span class="string">"&#123;$wpdb-&gt;prefix&#125;test"</span> ) </span><br><span class="line">   &#123;</span><br><span class="line">      $sql = <span class="string">"CREATE TABLE IF NOT EXISTS `&#123;$wpdb-&gt;prefix&#125;test` (</span></span><br><span class="line"><span class="string">           `id` int(11) NOT NULL auto_increment COMMENT '编号',</span></span><br><span class="line"><span class="string">           `color` varchar(10) DEFAULT '' COMMENT '字体颜色',</span></span><br><span class="line"><span class="string">           `size`  varchar(10) DEFAULT '' COMMENT '字体大小',</span></span><br><span class="line"><span class="string">           PRIMARY KEY  (`id`)</span></span><br><span class="line"><span class="string">         ) DEFAULT CHARSET=utf8 AUTO_INCREMENT=0;"</span>;</span><br><span class="line">      $wpdb-&gt;query( $sql );</span><br><span class="line"></span><br><span class="line">      $sql = <span class="string">"REPLACE INTO `&#123;$wpdb-&gt;prefix&#125;test` VALUES (1, '#FF0000','20');"</span>;</span><br><span class="line">      $wpdb-&gt;query( $sql );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'admin_menu'</span>, <span class="string">'hc_test_create_menu'</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//创建顶级菜单</span></span><br><span class="line">   add_menu_page( </span><br><span class="line">      <span class="string">'HC-TEST'</span>, </span><br><span class="line">      <span class="string">'HC的插件'</span>,</span><br><span class="line">      <span class="string">'manage_options'</span>, </span><br><span class="line">      <span class="string">'hc_test'</span> ,</span><br><span class="line">      <span class="string">'hc_settings_page'</span>,</span><br><span class="line">      plugins_url( <span class="string">'/images/icon.png'</span>, <span class="keyword">__FILE__</span> )</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">global</span> $wpdb;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//当提交了，并且验证信息正确</span></span><br><span class="line">   <span class="keyword">if</span>( !<span class="keyword">empty</span>( $_POST ) &amp;&amp; check_admin_referer( <span class="string">'hc_test_nonce'</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//更新设置</span></span><br><span class="line">      update_option( <span class="string">'hc_test_bold'</span>, $_POST[<span class="string">'hc_test_bold'</span>] );</span><br><span class="line"></span><br><span class="line">      $wpdb-&gt;update( <span class="string">"&#123;$wpdb-&gt;prefix&#125;test"</span>, <span class="keyword">array</span>( <span class="string">'color'</span> =&gt; $_POST[<span class="string">'color'</span>], <span class="string">'size'</span> =&gt; $_POST[<span class="string">'size'</span>] ), <span class="keyword">array</span>( <span class="string">'id'</span> =&gt; <span class="number">1</span> ) );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;div id="message" class="updated"&gt;</span><br><span class="line">         &lt;p&gt;&lt;strong&gt;保存成功！&lt;/strong&gt;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $sql = <span class="string">"SELECT * FROM `&#123;$wpdb-&gt;prefix&#125;test`"</span>;</span><br><span class="line">   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );</span><br><span class="line"></span><br><span class="line">   $color = $row[<span class="string">'color'</span>];</span><br><span class="line">   $size = $row[<span class="string">'size'</span>];</span><br><span class="line">   <span class="meta">?&gt;</span></span><br><span class="line">   &lt;div class="wrap"&gt;</span><br><span class="line">      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">      &lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">         &lt;p&gt;&lt;label <span class="keyword">for</span>=<span class="string">"color"</span>&gt;字体颜色：&lt;/label&gt;&lt;input type=<span class="string">"text"</span> name=<span class="string">"color"</span> value=<span class="string">"&lt;?php echo $color; ?&gt;"</span> /&gt;&lt;/p&gt;</span><br><span class="line">         &lt;p&gt;&lt;label <span class="keyword">for</span>=<span class="string">"size"</span>&gt;字体大小：&lt;/label&gt;</span><br><span class="line">         &lt;select name=<span class="string">"size"</span>&gt;</span><br><span class="line">            &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">            &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">            &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">            &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">            &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">         &lt;/select&gt;&lt;/p&gt;</span><br><span class="line">         &lt;p&gt;&lt;label <span class="keyword">for</span>=<span class="string">"hc_test_obold"</span>&gt;字体加粗：&lt;/label&gt;&lt;input name=<span class="string">"hc_test_bold"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, get_option( <span class="string">'hc_test_bold'</span> ) ); <span class="meta">?&gt;</span> /&gt; 加粗&lt;/p&gt;</span><br><span class="line">         &lt;p&gt;&lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"保存设置"</span> /&gt;&lt;/p&gt;</span><br><span class="line">         <span class="meta">&lt;?</span></span><br><span class="line">            <span class="comment">//输出一个验证信息</span></span><br><span class="line">            wp_nonce_field(<span class="string">'hc_test_nonce'</span>);</span><br><span class="line">         <span class="meta">?&gt;</span></span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'wp_head'</span>, <span class="string">'hc_test_head_fun'</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">global</span> $wpdb;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取自定义数据库中的设置</span></span><br><span class="line">   $sql = <span class="string">"SELECT * FROM `&#123;$wpdb-&gt;prefix&#125;test`"</span>;</span><br><span class="line">   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取options表中的设置选项</span></span><br><span class="line">   $bold = get_option( <span class="string">"hc_test_bold"</span> ) == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $row[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $row[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用wordpress内置api设置插件属性">使用wordpress内置api设置插件属性</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hc-test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hc-test</span></span><br><span class="line"><span class="comment">Plugin URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 测试插件</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hc</span></span><br><span class="line"><span class="comment">Author URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置时区为 亚洲/上海</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'admin_menu'</span>, <span class="string">'test_create_menu'</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//创建顶级菜单</span></span><br><span class="line">   add_menu_page(</span><br><span class="line">      <span class="string">'HC的插件首页'</span>,</span><br><span class="line">      <span class="string">'HC的插件'</span>,</span><br><span class="line">      <span class="string">'manage_options'</span>,</span><br><span class="line">      <span class="string">'hc_test'</span> ,</span><br><span class="line">      <span class="string">'hc_settings_page'</span>,</span><br><span class="line">      plugins_url( <span class="string">'/images/icon.png'</span>, <span class="keyword">__FILE__</span> )</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'admin_init'</span>, <span class="string">'register_hc_test_setting'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用register_setting()注册要存储的字段</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register_hc_test_setting</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//注册一个选项，用于装载所有插件设置项</span></span><br><span class="line">   $option_group = <span class="string">"hc_test_group"</span>;</span><br><span class="line">   register_setting( $option_group, <span class="string">'hc_test_option'</span> );</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加选项设置区域</span></span><br><span class="line">   $setting_section = <span class="string">"hc_test_setting_section"</span>;</span><br><span class="line">   add_settings_section(</span><br><span class="line">      $setting_section,</span><br><span class="line">      <span class="string">'设置'</span>,  <span class="comment">// 标题</span></span><br><span class="line">      <span class="string">'hc_test_setting_section_function'</span>,  <span class="comment">// 调用方法，自定义输出</span></span><br><span class="line">      $option_group</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="comment">//设置字体颜色</span></span><br><span class="line">   add_settings_field(</span><br><span class="line">      <span class="string">'hc_test_color'</span>,  <span class="comment">// 字段id</span></span><br><span class="line">      <span class="string">'字体颜色'</span>,  <span class="comment">// 字段标题</span></span><br><span class="line">      <span class="string">'hc_test_color_function'</span>, <span class="comment">// 字段对应函数方法</span></span><br><span class="line">      $option_group,  <span class="comment">// 字段对应分组</span></span><br><span class="line">      $setting_section  <span class="comment">// 字段对应设置选项</span></span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="comment">//设置字体大小</span></span><br><span class="line">   add_settings_field(</span><br><span class="line">      <span class="string">'hc_test_size'</span>,</span><br><span class="line">      <span class="string">'字体大小'</span>,</span><br><span class="line">      <span class="string">'hc_test_size_function'</span>,</span><br><span class="line">      $option_group,</span><br><span class="line">      $setting_section</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="comment">//设置字体加粗</span></span><br><span class="line">   add_settings_field(</span><br><span class="line">      <span class="string">'hc_test_bold'</span>,</span><br><span class="line">      <span class="string">'字体加粗'</span>,</span><br><span class="line">      <span class="string">'hc_test_bold_function'</span>,</span><br><span class="line">      $option_group,</span><br><span class="line">      $setting_section</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_bold_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">   <span class="meta">?&gt;</span></span><br><span class="line">   &lt;input name=<span class="string">"hc_test_option[bold]"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, $hc_test_option[<span class="string">"bold"</span>] ); <span class="meta">?&gt;</span> /&gt; 加粗</span><br><span class="line">   <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_size_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">   $size = $hc_test_option[<span class="string">"size"</span>];</span><br><span class="line">   <span class="meta">?&gt;</span></span><br><span class="line">   &lt;select name=<span class="string">"hc_test_option[size]"</span>&gt;</span><br><span class="line">      &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">      &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">   &lt;/select&gt;</span><br><span class="line">   <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_color_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">   <span class="meta">?&gt;</span></span><br><span class="line">   &lt;input name=<span class="string">'hc_test_option[color]'</span> type=<span class="string">'text'</span> value=<span class="string">'&lt;? echo $hc_test_option["color"]; ?&gt;'</span> /&gt;</span><br><span class="line">   <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="meta">?&gt;</span></span><br><span class="line">   &lt;div class="wrap"&gt;</span><br><span class="line">      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">      &lt;form action=<span class="string">"options.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">         <span class="meta">&lt;?</span></span><br><span class="line">         $option_group = <span class="string">"hc_test_group"</span>;</span><br><span class="line"></span><br><span class="line">         <span class="comment">//输出一些必要的字段，包括验证信息等</span></span><br><span class="line">         settings_fields( $option_group );</span><br><span class="line"></span><br><span class="line">         <span class="comment">//输出选项设置区域</span></span><br><span class="line">         do_settings_sections( $option_group );</span><br><span class="line"></span><br><span class="line">         <span class="comment">//输出按钮</span></span><br><span class="line">         submit_button();</span><br><span class="line">         <span class="meta">?&gt;</span></span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   <span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'wp_head'</span>, <span class="string">'hc_test_head_fun'</span> );</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line"></span><br><span class="line">   $bold = $hc_test_option[<span class="string">"bold"</span>] == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line">   <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="将插件改写成类的形式">将插件改写成类的形式</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#hc-test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hc-test</span></span><br><span class="line"><span class="comment">Plugin URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 测试插件</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hc</span></span><br><span class="line"><span class="comment">Author URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置时区为 亚洲/上海</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hcsem_change_font_style</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//声明类里面的属性，用 var 开头</span></span><br><span class="line">   <span class="keyword">var</span> $icon_url = <span class="string">"/images/icon.png"</span>;</span><br><span class="line">   <span class="keyword">var</span> $option_group = <span class="string">"hc_test_group"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//构造方法，创建类的时候调用</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_change_font_style</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建菜单</span></span><br><span class="line">      add_action( <span class="string">'admin_menu'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_create_menu'</span> ) );</span><br><span class="line">      add_action( <span class="string">'admin_init'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'register_hc_test_setting'</span> ) );</span><br><span class="line">      add_action( <span class="string">'wp_head'</span>,  <span class="keyword">array</span>( <span class="keyword">$this</span>,  <span class="string">'hc_test_head_fun'</span> ) );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//使用register_setting()注册要存储的字段</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">register_hc_test_setting</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册一个选项，用于装载所有插件设置项</span></span><br><span class="line">      register_setting( <span class="keyword">$this</span>-&gt;option_group, <span class="string">'hc_test_option'</span> );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//添加选项设置区域</span></span><br><span class="line">      $setting_section = <span class="string">"hc_test_setting_section"</span>;</span><br><span class="line">      add_settings_section(</span><br><span class="line">         $setting_section,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体颜色</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_color'</span>,</span><br><span class="line">         <span class="string">'字体颜色'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_color_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体大小</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_size'</span>,</span><br><span class="line">         <span class="string">'字体大小'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_size_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体加粗</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_bold'</span>,</span><br><span class="line">         <span class="string">'字体加粗'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_bold_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_bold_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">"hc_test_option[bold]"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, $hc_test_option[<span class="string">"bold"</span>] ); <span class="meta">?&gt;</span> /&gt; 加粗</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_size_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      $size = $hc_test_option[<span class="string">"size"</span>];</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;select name=<span class="string">"hc_test_option[size]"</span>&gt;</span><br><span class="line">         &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">      &lt;/select&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_color_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">'hc_test_option[color]'</span> type=<span class="string">'text'</span> value=<span class="string">'&lt;? echo $hc_test_option["color"]; ?&gt;'</span> /&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建顶级菜单</span></span><br><span class="line">      add_menu_page(</span><br><span class="line">         <span class="string">'HC的插件首页'</span>,</span><br><span class="line">         <span class="string">'HC的插件'</span>,</span><br><span class="line">         <span class="string">'manage_options'</span>,</span><br><span class="line">         <span class="string">'hc_test'</span> ,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_settings_page'</span> ),</span><br><span class="line">         plugins_url( <span class="keyword">$this</span>-&gt;icon_url, <span class="keyword">__FILE__</span> )</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;div class="wrap"&gt;</span><br><span class="line">         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">         &lt;form action=<span class="string">"options.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            <span class="meta">&lt;?</span></span><br><span class="line">            <span class="comment">//输出一些必要的字段，包括验证信息等</span></span><br><span class="line">            settings_fields( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出选项设置区域</span></span><br><span class="line">            do_settings_sections( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出按钮</span></span><br><span class="line">            submit_button();</span><br><span class="line">            <span class="meta">?&gt;</span></span><br><span class="line">         &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line"></span><br><span class="line">      $bold = $hc_test_option[<span class="string">"bold"</span>] == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line">      <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> hcsem_change_font_style();</span><br></pre></td></tr></table></figure>
<h3 id="将插件设置内容转移到wordpress设置里">将插件设置内容转移到wordpress设置里</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hc-test.php</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hcsem_change_font_style</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> $option_group = <span class="string">"general"</span>;  <span class="comment">// general常规 writing撰写 reading阅读 discussion讨论 media多媒体 permalink固定链接</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//构造方法，创建类的时候调用</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_change_font_style</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      add_action( <span class="string">'admin_init'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'register_hc_test_setting'</span> ) );</span><br><span class="line">      add_action( <span class="string">'wp_head'</span>,  <span class="keyword">array</span>( <span class="keyword">$this</span>,  <span class="string">'hc_test_head_fun'</span> ) );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//使用register_setting()注册要存储的字段</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">register_hc_test_setting</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册一个选项，用于装载所有插件设置项</span></span><br><span class="line">      register_setting( <span class="keyword">$this</span>-&gt;option_group, <span class="string">'hc_test_option'</span> );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体颜色</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_color'</span>,</span><br><span class="line">         <span class="string">'字体颜色'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_color_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体大小</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_size'</span>,</span><br><span class="line">         <span class="string">'字体大小'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_size_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体加粗</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_bold'</span>,</span><br><span class="line">         <span class="string">'字体加粗'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_bold_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_bold_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">"hc_test_option[bold]"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, $hc_test_option[<span class="string">"bold"</span>] ); <span class="meta">?&gt;</span> /&gt; 加粗</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_size_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      $size = $hc_test_option[<span class="string">"size"</span>];</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;select name=<span class="string">"hc_test_option[size]"</span>&gt;</span><br><span class="line">         &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">      &lt;/select&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_color_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">'hc_test_option[color]'</span> type=<span class="string">'text'</span> value=<span class="string">'&lt;? echo $hc_test_option["color"]; ?&gt;'</span> /&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line"></span><br><span class="line">      $bold = $hc_test_option[<span class="string">"bold"</span>] == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line">      <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> hcsem_change_font_style();</span><br></pre></td></tr></table></figure>
<h3 id="调用ajax">调用ajax</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hc-test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hc-test</span></span><br><span class="line"><span class="comment">Plugin URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 测试插件</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hc</span></span><br><span class="line"><span class="comment">Author URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置时区为 亚洲/上海</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hcsem_change_font_style</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//声明类里面的属性，用 var 开头</span></span><br><span class="line">   <span class="keyword">var</span> $icon_url = <span class="string">"/images/icon.png"</span>;</span><br><span class="line">   <span class="keyword">var</span> $option_group = <span class="string">"hc_test_group"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//构造方法，创建类的时候调用</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_change_font_style</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建菜单</span></span><br><span class="line">      add_action( <span class="string">'admin_menu'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_create_menu'</span> ) );</span><br><span class="line">      add_action( <span class="string">'admin_init'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'register_hc_test_setting'</span> ) );</span><br><span class="line">      add_action( <span class="string">'wp_head'</span>,  <span class="keyword">array</span>( <span class="keyword">$this</span>,  <span class="string">'hc_test_head_fun'</span> ) );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//使用ajax校验信息</span></span><br><span class="line">      wp_enqueue_script( <span class="string">'hc_test'</span>, plugins_url(<span class="string">'js/hc_test.js'</span>, <span class="keyword">__FILE__</span>), <span class="keyword">array</span>(<span class="string">'jquery'</span>) );</span><br><span class="line">      wp_localize_script( <span class="string">'hc_test'</span>, <span class="string">'ajax_object'</span>, <span class="keyword">array</span>( <span class="string">'ajax_url'</span> =&gt; admin_url( <span class="string">'admin-ajax.php'</span> ) ) );</span><br><span class="line"></span><br><span class="line">      add_action( <span class="string">'wp_ajax_color_check_action'</span> , <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'color_check_action_fun'</span>) );</span><br><span class="line">      add_action( <span class="string">'wp_ajax_nopriv_hcsem_description'</span> , <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hcsem_description_fun'</span>) );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">color_check_action_fun</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>( trim( $_POST[<span class="string">'color'</span>] ) != <span class="string">""</span> )&#123; <span class="keyword">echo</span> <span class="string">"ok"</span>; &#125;</span><br><span class="line">      wp_die();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_description_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"hc的笔记本："</span> . $_POST[<span class="string">'description'</span>];</span><br><span class="line">      wp_die();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//使用register_setting()注册要存储的字段</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">register_hc_test_setting</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册一个选项，用于装载所有插件设置项</span></span><br><span class="line">      register_setting( <span class="keyword">$this</span>-&gt;option_group, <span class="string">'hc_test_option'</span> );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//添加选项设置区域</span></span><br><span class="line">      $setting_section = <span class="string">"hc_test_setting_section"</span>;</span><br><span class="line">      add_settings_section(</span><br><span class="line">         $setting_section,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体颜色</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_color'</span>,</span><br><span class="line">         <span class="string">'字体颜色'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_color_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体大小</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_size'</span>,</span><br><span class="line">         <span class="string">'字体大小'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_size_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体加粗</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_bold'</span>,</span><br><span class="line">         <span class="string">'字体加粗'</span>,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_bold_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_bold_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">"hc_test_option[bold]"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, $hc_test_option[<span class="string">"bold"</span>] ); <span class="meta">?&gt;</span> /&gt; 加粗</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_size_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      $size = $hc_test_option[<span class="string">"size"</span>];</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;select name=<span class="string">"hc_test_option[size]"</span>&gt;</span><br><span class="line">         &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">      &lt;/select&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_color_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">'hc_test_option[color]'</span> type=<span class="string">'text'</span> value=<span class="string">'&lt;? echo $hc_test_option["color"]; ?&gt;'</span> /&gt;</span><br><span class="line">      &lt;font id=<span class="string">"error_color"</span>&gt;&lt;/font&gt;&lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建顶级菜单</span></span><br><span class="line">      add_menu_page(</span><br><span class="line">         <span class="string">'HC的插件首页'</span>,</span><br><span class="line">         <span class="string">'HC的插件'</span>,</span><br><span class="line">         <span class="string">'manage_options'</span>,</span><br><span class="line">         <span class="string">'hc_test'</span> ,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_settings_page'</span> ),</span><br><span class="line">         plugins_url( <span class="keyword">$this</span>-&gt;icon_url, <span class="keyword">__FILE__</span> )</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;div class="wrap"&gt;</span><br><span class="line">         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">         &lt;form action=<span class="string">"options.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            <span class="meta">&lt;?</span></span><br><span class="line">            <span class="comment">//输出一些必要的字段，包括验证信息等</span></span><br><span class="line">            settings_fields( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出选项设置区域</span></span><br><span class="line">            do_settings_sections( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出按钮</span></span><br><span class="line">            submit_button();</span><br><span class="line">            <span class="meta">?&gt;</span></span><br><span class="line">         &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line"></span><br><span class="line">      $bold = $hc_test_option[<span class="string">"bold"</span>] == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line">      <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> hcsem_change_font_style();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># js/hc_test.js</span></span><br><span class="line">jQuery(document).ready( <span class="function"><span class="keyword">function</span><span class="params">($)</span> </span>&#123;</span><br><span class="line">   $(<span class="string">"input[name='hc_test_option[color]']"</span>).blur( <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">         type: <span class="string">"POST"</span>,</span><br><span class="line">         data: <span class="string">"color="</span> + $(this).val() + <span class="string">"&amp;action=hc_color_check"</span>,</span><br><span class="line">         url: ajax_object.ajax_url,</span><br><span class="line">         beforeSend: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            $(<span class="string">'#error_color'</span>).html(<span class="string">'校验中...'</span>); </span><br><span class="line">         &#125;,</span><br><span class="line">         success: <span class="function"><span class="keyword">function</span><span class="params">( $data )</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>( $data == <span class="string">'ok'</span>)&#123;</span><br><span class="line">                $(<span class="string">'#error_color'</span>).html(<span class="string">'输入正确'</span>);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $(<span class="string">'#error_color'</span>).html(<span class="string">'颜色不能为空！'</span>); </span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jQuery(document).ready( <span class="function"><span class="keyword">function</span><span class="params">($)</span> </span>&#123;</span><br><span class="line">   $(<span class="string">".description"</span>).click( <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">         type: <span class="string">"POST"</span>,</span><br><span class="line">         data: <span class="string">"description="</span> + $(this).text() + <span class="string">"&amp;action=hcsem_description"</span>,</span><br><span class="line">         url: ajax_object.ajax_url,</span><br><span class="line">         success : <span class="function"><span class="keyword">function</span><span class="params">( $data )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( $data != <span class="string">"0"</span> ) &#123;</span><br><span class="line">               $(<span class="string">".description"</span>).text( $data );</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="实现插件翻译功能">实现插件翻译功能</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── css</span><br><span class="line">│   └── hc_copyrighy.css</span><br><span class="line">├── hc-test.php</span><br><span class="line">├── images</span><br><span class="line">│   └── icon.png</span><br><span class="line">├── js</span><br><span class="line">│   └── hc_test.js</span><br><span class="line">└── languages</span><br><span class="line">    ├── zh_CN.mo</span><br><span class="line">    └── zh_CN.po</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hc-test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Plugin Name: hc-test</span></span><br><span class="line"><span class="comment">Plugin URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">Description: 测试插件</span></span><br><span class="line"><span class="comment">Version: 1.0</span></span><br><span class="line"><span class="comment">Author: hc</span></span><br><span class="line"><span class="comment">Author URI: http://zhuohc.com</span></span><br><span class="line"><span class="comment">License: GPLv2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置时区为 亚洲/上海</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hcsem_change_font_style</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//声明类里面的属性，用 var 开头</span></span><br><span class="line">   <span class="keyword">var</span> $icon_url = <span class="string">"/images/icon.png"</span>;</span><br><span class="line">   <span class="keyword">var</span> $option_group = <span class="string">"hc_test_group"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//构造方法，创建类的时候调用</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_change_font_style</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建菜单</span></span><br><span class="line">      add_action( <span class="string">'admin_menu'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_create_menu'</span> ) );</span><br><span class="line">      add_action( <span class="string">'admin_init'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'register_hc_test_setting'</span> ) );</span><br><span class="line">      add_action( <span class="string">'wp_head'</span>,  <span class="keyword">array</span>( <span class="keyword">$this</span>,  <span class="string">'hc_test_head_fun'</span> ) );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//使用ajax校验信息</span></span><br><span class="line">      wp_enqueue_script( <span class="string">'hc_test'</span>, plugins_url(<span class="string">'js/hc_test.js'</span>, <span class="keyword">__FILE__</span>), <span class="keyword">array</span>(<span class="string">'jquery'</span>) );</span><br><span class="line">      wp_localize_script( <span class="string">'hc_test'</span>, <span class="string">'ajax_object'</span>, <span class="keyword">array</span>( <span class="string">'ajax_url'</span> =&gt; admin_url( <span class="string">'admin-ajax.php'</span> ) ) );</span><br><span class="line"></span><br><span class="line">      add_action( <span class="string">'wp_ajax_color_check_action'</span> , <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'color_check_action_fun'</span>) );</span><br><span class="line">      add_action( <span class="string">'wp_ajax_nopriv_hcsem_description'</span> , <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hcsem_description_fun'</span>) );</span><br><span class="line"></span><br><span class="line">      add_action( <span class="string">'init'</span>, <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hcsem_load_textdomain'</span> ) );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_load_textdomain</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//加载 languages 目录下的翻译文件 zh_CN</span></span><br><span class="line">      $currentLocale = get_locale();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>( !<span class="keyword">empty</span>( $currentLocale ) ) &#123;</span><br><span class="line"></span><br><span class="line">         $moFile = dirname(<span class="keyword">__FILE__</span>) . <span class="string">"/languages/&#123;$currentLocale&#125;.mo"</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span>( @file_exists( $moFile ) &amp;&amp; is_readable( $moFile ) ) load_textdomain( <span class="string">'hc-test'</span>, $moFile );</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">color_check_action_fun</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>( trim( $_POST[<span class="string">'color'</span>] ) != <span class="string">""</span> )&#123; <span class="keyword">echo</span> <span class="string">"ok"</span>; &#125;</span><br><span class="line">      wp_die();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hcsem_description_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"HC的笔记本："</span> . $_POST[<span class="string">'description'</span>];</span><br><span class="line">      wp_die();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//使用register_setting()注册要存储的字段</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">register_hc_test_setting</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册一个选项，用于装载所有插件设置项</span></span><br><span class="line">      register_setting( <span class="keyword">$this</span>-&gt;option_group, <span class="string">'hc_test_option'</span> );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//添加选项设置区域</span></span><br><span class="line">      $setting_section = <span class="string">"hc_test_setting_section"</span>;</span><br><span class="line">      add_settings_section(</span><br><span class="line">         $setting_section,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="string">''</span>,</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体颜色</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_color'</span>,</span><br><span class="line">         __( <span class="string">'color'</span>, <span class="string">'hc-test'</span> ),</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_color_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体大小</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_size'</span>,</span><br><span class="line">         __( <span class="string">'size'</span>, <span class="string">'hc-test'</span> ),</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_size_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置字体加粗</span></span><br><span class="line">      add_settings_field(</span><br><span class="line">         <span class="string">'hc_test_bold'</span>,</span><br><span class="line">         __( <span class="string">'bold'</span>, <span class="string">'hc-test'</span> ),</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_test_bold_function'</span> ),</span><br><span class="line">         <span class="keyword">$this</span>-&gt;option_group,</span><br><span class="line">         $setting_section</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_bold_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">"hc_test_option[bold]"</span> type=<span class="string">"checkbox"</span>  value=<span class="string">"1"</span> <span class="meta">&lt;?</span> checked( <span class="number">1</span>, $hc_test_option[<span class="string">"bold"</span>] ); <span class="meta">?&gt;</span> /&gt; <span class="meta">&lt;?</span> _e( <span class="string">'set bold'</span>, <span class="string">'hc-test'</span> ); <span class="meta">?&gt;</span></span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_size_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      $size = $hc_test_option[<span class="string">"size"</span>];</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;select name=<span class="string">"hc_test_option[size]"</span>&gt;</span><br><span class="line">         &lt;option value=<span class="string">"12"</span> <span class="meta">&lt;?</span> selected( <span class="string">'12'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">12</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"14"</span> <span class="meta">&lt;?</span> selected( <span class="string">'14'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">14</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"16"</span> <span class="meta">&lt;?</span> selected( <span class="string">'16'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">16</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"18"</span> <span class="meta">&lt;?</span> selected( <span class="string">'18'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">18</span>&lt;/option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"20"</span> <span class="meta">&lt;?</span> selected( <span class="string">'20'</span>, $size ); <span class="meta">?&gt;</span>&gt;<span class="number">20</span>&lt;/option&gt;</span><br><span class="line">      &lt;/select&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_color_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;input name=<span class="string">'hc_test_option[color]'</span> type=<span class="string">'text'</span> value=<span class="string">'&lt;? echo $hc_test_option["color"]; ?&gt;'</span> /&gt;</span><br><span class="line">      &lt;font id=<span class="string">"error_color"</span>&gt;&lt;/font&gt;&lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_create_menu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建顶级菜单</span></span><br><span class="line">      add_menu_page(</span><br><span class="line">         <span class="string">'hc的插件首页'</span>,</span><br><span class="line">         <span class="string">'hc的插件'</span>,</span><br><span class="line">         <span class="string">'manage_options'</span>,</span><br><span class="line">         <span class="string">'hc_test'</span> ,</span><br><span class="line">         <span class="keyword">array</span>( <span class="keyword">$this</span>, <span class="string">'hc_settings_page'</span> ),</span><br><span class="line">         plugins_url( <span class="keyword">$this</span>-&gt;icon_url, <span class="keyword">__FILE__</span> )</span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_settings_page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="meta">?&gt;</span></span><br><span class="line">      &lt;div class="wrap"&gt;</span><br><span class="line">         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;</span><br><span class="line">         &lt;form action=<span class="string">"options.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">            <span class="meta">&lt;?</span></span><br><span class="line">            <span class="comment">//输出一些必要的字段，包括验证信息等</span></span><br><span class="line">            settings_fields( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出选项设置区域</span></span><br><span class="line">            do_settings_sections( <span class="keyword">$this</span>-&gt;option_group );</span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出按钮</span></span><br><span class="line">            submit_button();</span><br><span class="line">            <span class="meta">?&gt;</span></span><br><span class="line">         &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      <span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">hc_test_head_fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      $hc_test_option = get_option( <span class="string">"hc_test_option"</span> );</span><br><span class="line"></span><br><span class="line">      $bold = $hc_test_option[<span class="string">"bold"</span>] == <span class="number">1</span> ? <span class="string">"bold"</span> : <span class="string">"normal"</span>;</span><br><span class="line">      <span class="meta">?&gt;</span>&lt;style&gt;body&#123;color:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"color"</span>] <span class="meta">?&gt;</span>;font-size:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $hc_test_option[<span class="string">"size"</span>] <span class="meta">?&gt;</span>px;font-weight:<span class="meta">&lt;?</span> <span class="keyword">echo</span> $bold; <span class="meta">?&gt;</span>;&#125;&lt;/style&gt;<span class="meta">&lt;?</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> hcsem_change_font_style();</span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#插件"><span class="toc-number">1.</span> <span class="toc-text">插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建"><span class="toc-number">1.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件启用和停用初始化"><span class="toc-number">1.2.</span> <span class="toc-text">插件启用和停用初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除插件"><span class="toc-number">1.3.</span> <span class="toc-text">删除插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_action"><span class="toc-number">1.4.</span> <span class="toc-text">add_action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见钩子"><span class="toc-number">1.5.</span> <span class="toc-text">常见钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器"><span class="toc-number">1.6.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带参数的过滤器"><span class="toc-number">1.7.</span> <span class="toc-text">带参数的过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见过滤器"><span class="toc-number">1.8.</span> <span class="toc-text">常见过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建菜单"><span class="toc-number">1.9.</span> <span class="toc-text">创建菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小工具"><span class="toc-number">1.10.</span> <span class="toc-text">小工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加元数据框"><span class="toc-number">1.11.</span> <span class="toc-text">添加元数据框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后台常见css样式表"><span class="toc-number">1.12.</span> <span class="toc-text">后台常见css样式表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#保存插件设置到数据库中"><span class="toc-number">1.13.</span> <span class="toc-text">保存插件设置到数据库中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用wordpress内置api设置插件属性"><span class="toc-number">1.14.</span> <span class="toc-text">使用wordpress内置api设置插件属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将插件改写成类的形式"><span class="toc-number">1.15.</span> <span class="toc-text">将插件改写成类的形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将插件设置内容转移到wordpress设置里"><span class="toc-number">1.16.</span> <span class="toc-text">将插件设置内容转移到wordpress设置里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用ajax"><span class="toc-number">1.17.</span> <span class="toc-text">调用ajax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现插件翻译功能"><span class="toc-number">1.18.</span> <span class="toc-text">实现插件翻译功能</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&text=Wordpress插件开发基础入门"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&is_video=false&description=Wordpress插件开发基础入门"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Wordpress插件开发基础入门&body=Check out this article: http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&title=Wordpress插件开发基础入门"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&name=Wordpress插件开发基础入门&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://www.zhuohc.com/2016/11/10/Wordpress插件开发基础入门/&t=Wordpress插件开发基础入门"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 zhuohanchang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
