<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>音视频基础</title>
      <link href="/2019/12/16/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/12/16/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="音频基础">音频基础</h2><h3 id="声音的本质">声音的本质</h3><blockquote><p>声音其实是一种能量波，因此也有频率和振幅的特征，频率对应于时间轴线，振幅对应于电平轴线。波是无限光滑的，弦线可以看成由无数点组成，由于存储空间是相对有限的，数字编码过程中，必须对弦线的点进行采样。</p></blockquote><p><a href="https://baike.baidu.com/item/%E5%A3%B0%E9%9F%B3%E5%90%AC%E8%A7%89" target="_blank" rel="noopener">声音三要素</a></p><ul><li>音高/音调/音频： 客观上音高大小主要取决于声波基频的高低，频率高则音调高，反之则低，单位用赫兹(Hz）表示。儿童(高音区)-&gt;女生(高音区)-&gt;男生（低音区）</li><li>音量/响度/声强：常说的声音大小，主要取决于声波振幅的大小。</li><li>音色/音品：和材质相关（比如钢琴等），本质是谐波。</li></ul><p>音量和声调 <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/%E9%9F%B3%E9%87%8F%E5%92%8C%E5%A3%B0%E8%B0%83.png"></p><blockquote><p>人类的听觉范围：20Hz-20kHz</p></blockquote><h3 id="音频量化过程">音频量化过程</h3><p>音频量化过程 <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/%E9%9F%B3%E9%A2%91%E9%87%8F%E5%8C%96%E8%BF%87%E7%A8%8B.png"></p><ol type="1"><li>按横轴时间进行切割</li><li>按纵轴振幅(决定音量)进行切割</li><li>编码转成数字信号</li></ol><ul><li><em><font color="#2bbc8a">采样大小</font></em> 一个采样用多个bit存放，常用16位(2<sup>16</sup>=65535)，振幅</li><li><em><font color="#2bbc8a">采样率</font></em> 采样频率8k、16k、32k、44.1k、48k等 <a href="https://baike.baidu.com/item/音频采样率" target="_blank" rel="noopener">采样率概念</a></li><li><em><font color="#2bbc8a">声道数</font></em> 单声道、双声道、多声道</li></ul><p><strong>码率计算</strong></p><ul><li>音频流的码率=采样率×采样大小×声道数</li><li>例如：采样率44.1kHz、采样大小为16bit、双声道的pcm编码wav文件，码率=44.1k×16×2=1411.2kb/s</li></ul><h3 id="音频压缩技术">音频压缩技术</h3><p><strong>消除音频冗余数据</strong></p><ol type="1"><li>删除人耳听觉范围外的音频信号： 20Hz-20kHz</li><li>被掩避掉的音频信号： 频域遮蔽, 时域遮蔽</li><li>哈夫曼无损编码</li></ol><h3 id="音频编解码器">音频编解码器</h3><p>常见的编解码器</p><ol type="1"><li>OPUS： 开源、rmtp协议不支持</li><li>AAC：收费、适合实时互动项目。</li><li>Vorbis：开源</li><li>Speex：开源、优势：还支持一些回音消除、降噪等处理办法</li><li>iLBC</li><li>AMR</li><li>G.711：与固定电话就行融合</li></ol><p>性能对比</p><ol type="1"><li>OPUS &gt; AAC(常用) &gt; Vorbis</li><li>AAC： advanced audio coding</li><li>常见规格： AAC LC（低复杂度，码流128k）、AAC HE V1（）、 AAC HE V2</li><li>AAC LC + SBR = AAC HE V1</li><li>AAC HE V1 + PS = AAC HE V2</li></ol><p>aac规格 <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/aac%E8%A7%84%E6%A0%BC.png"></p><p>AAC格式： * ADIF * ADTS</p><p>AAC编码库： 1. libfdk_aac(常用) 2. ffmpeg aac 3. libfaac 4. libvo_aacenc</p><h2 id="视频基础">视频基础</h2><h3 id="视频编解码器">视频编解码器</h3><ul><li>x264：最流行的</li><li>x265：耗性能</li><li>openH264：支持svc视频技术</li><li>vp8: x264</li><li>vp9: x265</li></ul><h3 id="h264基本概念">H264基本概念</h3><ul><li><p>I帧： 关键帧、采用帧内压缩技术</p></li><li><p>P帧：向前参考帧，采用帧内压缩技术</p></li><li><p>B帧：双向参考帧，采用帧内压缩技术</p></li><li><p>GOF: 一组帧group of frame</p></li><li><p>SPS: Sequence parameter set: 序列参数集：存放一组帧的存放帧数，参考帧数目，解码图像尺寸等</p></li><li><p>PPS： picture parameter set: 图像参数集：存放熵编码模式选择标识、片组数目等</p></li></ul><h3 id="h264压缩技术">H264压缩技术</h3><ul><li>帧内压缩：解决空域数据冗余技术</li><li>帧间压缩：解决时域数据冗余技术</li><li>整数离散余弦变换(DCT)：将空间上的相关性变为频域上无关的数据然后进行量化</li><li>CABAC压缩</li></ul><p>H264结构图 <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/H264%E7%BB%93%E6%9E%84%E5%9B%BE.png"></p><h3 id="h264编码分层">H264编码分层</h3><ul><li>NAL层：network abstraction layer 视频数据网络抽象层</li><li>VCL层：video coding layer 视频数据编码层</li></ul><h3 id="码流">码流</h3><ul><li>SODB: string of data bits 原始数据比特流，它是由vcl层产生的</li><li>RBSP: 在SODB最后一位补1，不按字节对其则补0 EBSP NALU *NAL: HEADER + EBSP</li></ul>]]></content>
      
      
      <categories>
          
          <category> 原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ffmpeg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从前端到&quot;钱&quot;端</title>
      <link href="/2019/12/16/%E4%BB%8E%E5%89%8D%E7%AB%AF%E5%88%B0%E9%92%B1%E7%AB%AF/"/>
      <url>/2019/12/16/%E4%BB%8E%E5%89%8D%E7%AB%AF%E5%88%B0%E9%92%B1%E7%AB%AF/</url>
      
        <content type="html"><![CDATA[<p>转载: InfoQ 二叉树团队</p><blockquote><p>我的心里种下了一颗种子：坚信做前端这件事情是有前途的。</p></blockquote><p>我最早接触前端是在大学的时候，我在中国的黑白棋小圈子里面还是很活跃的，一群棋友经常一起下棋。后来我们的论坛里要有展示棋谱的功能，因为我很擅长，所以就很积极地去研究怎么改进。我花了很长的时间才搞清楚几个带 Java 的技术——Java、JavaScript、Java Applet 都是干嘛用的，然后我就发现 JavaScript 的能力比我想象中的要强得多。</p><p>这时候其实我心里就种下了一颗种子：坚信做前端这件事情是有前途的。这个预判主要是发现了技术的潜力，发现市面上产品跟你预判的技术潜力有差别。后来了解得多了，我发现 W3C 所主导的万维网能力无穷，我就变成了 Web 的信徒。在我看来，这种开放性的东西才是人类软件的未来，私有技术终究会逐渐被标准化，而标准化会越来越强大。</p><p>后来我就开始有意识地去参与一些前端的社区、论坛，我其实是一个很会混社区的人，我在社区基本上是如鱼得水，我很会交“技术大牛”的朋友。比如接触月影、周爱民老师，我一点也不害羞。其实大部分社区中看起来高高在上的大牛，他们都是比较 nice 的。</p><blockquote><p>过去十年，是前端觉醒的十年。</p></blockquote><p>前端这个行业很年轻，更早时候其实是有前端工作但是没有前端岗位。大家觉得这个东西程序员做也行，设计师做也行。前端工作一直存在，但是没有人认为它是一个独立的工种和岗位，也没有人去发展它的工程体系，更没有人去找它的核心价值。<strong>所以如果说过去十年前端是什么样的十年，我认为是觉醒的十年。</strong></p><p>在过去十年中，前端技术的发展大致经历了三个阶段：</p><p>首先是青铜时代，就是 2008 年前后那段时间，前端圈子里流行的是各种特效，比如鼠标跟随、Flash，当时觉得非常炫酷，今天看来有点 low。</p><p>其次是白银时代，大约是 2009 年到 2011 年这段时间。大家的观念开始转变了，从单纯的说我要做一个什么样的效果，开始关注我怎么样做这个效果能够更方便。如果回头来看，jQuery 抓的两个点是很准的：第一点叫做 API 的应用性；第二点叫做浏览器的兼容性。jQuery 以这两点为核心，打造了一套这样的开发框架，白银时代其实就是最终以 jQuery 大获全胜落幕。</p><p>另外就是黄金时代，其实也是我加入手淘的时间点，也是移动前端开始抬头的时间点。这个时候不管是移动前端还是桌面开发前端，都开始进入到了一个正规化阶段，开始关注工程体系，开始关注自身价值，开始关注质量与效率，同时这个时期也是 Node.js 崛起的时期。</p><blockquote><p>加入手机淘宝，它看起来不像是一个会死的产品。</p></blockquote><p>我在毕业找工作的时候，就有意识地去看前端岗位，但是因为那个时候前端岗位级别不高、工资跟客户端也有差距，所以我就“曲线救国”，去做浏览器开发。这段经历让我了解了很多的底层知识。另外很有意思的一点，无论第一份工作在微软，还是后来在盛大，我都是阴差阳错跟移动开发结下不解之缘。</p><p>遗憾的是，我在上两个公司做的产品都不算成功，后来我就在想，我一定要找一个成功的产品。找来找去，发现阿里不错——手机淘宝，这个东西听起来就不像是一个会死的产品，后来我就加入手机淘宝，成为了手机淘宝前端负责人，正式进入前端领域。</p><blockquote><p>前端Leader的焦虑感：为什么没了你不行，有了你一定能有什么东西？</p></blockquote><p>在阿里有几个大的前端团队，我们这些大的前端团队的 Leader，其实内心的焦虑感是很强的——前端作为一个新生职能，怎么才能够像服务端、客户端一样，给团队找到核心价值？如果你的团队只是接需求、做需求，技术再好的人，最后也会变成一个“看摊儿”的人。</p><p>这个里面有一定的必要性，就是说没了你不行；当然还要有一定的充分性，就是有了你就有了什么东西。所以说前端团队其实可以分成两条线，一条是对内的工程上面的一些操作和一些设施的建设，这样能够提升效率，你工程上做得越深越好，结构越合理，你最后的产出就越多，这个是针对必要性的；还有一条线就是充分性，我们做性能、做跟客户端的融合，这些能够给公司带来新的价值。</p><blockquote><p>工程思想在大公司萌芽，仅靠管理方法吃不开。</p></blockquote><p>其实相对于大公司来说，社区产生的还是一些工具的思想，工程的思想还是在大公司产生，主要是因为会有一个大型团队协作上的需求倒逼你一定要这么做，而社区其实是通过规则来保证团队协作的。</p><p>靠规则建立协作，太慢，大公司是接受不了的，它一定需要强有力的推动。比如说我们今天用的东西版本太旧，是不是大家要统一升个级？如果我们用纯粹的管理方法，我写一封邮件要求大家都升级，不升级的今年没有奖金，这是管理的思想。但是其实我们工程团队还有更好的办法，干脆就是对你用的旧版本给你提示，甚至强行推荐你在网上下载最新版本。这个工程思想对于前端行业来说意义深远，但其实前端行业在这个上面已经有点太晚了。另外，未来伴随项目复杂性的提升，工程思想一定还会再进化，再去衍生出更多新的想法。</p><blockquote><p>全栈不是把别人的东西抢过来，而是把自己的东西赋能出去。</p></blockquote><p>工程之后，还有一块比较重要，就是全栈。其实全栈这个想法也是从社区逐渐渗透到公司里的，一开始大家对全栈的理解是很狭隘的，一些前端同学觉得现在有 Node.js，他们也能写服务端的东西。后来发现出现了不可调和的矛盾，尤其是在阿里这样的公司，服务端这么多年下来有很多很重要的基础设施，你去 Node.js 体系下再发展一遍，一是没有必要，二是没有资源，阿里有很多中间件团队，你不管怎么做，都不可能有他们的深度。</p><p>另外这也是我当时犯的一个很基础的错误：前端本来就缺人，你把前端转成全栈去做服务端的事情，你前端更缺人了。后来发现逐渐有人探索出一条路：全栈不是说把自己的能力堆上去，而是你要把自己强势的东西给它赋能出去，让别人具有全栈的能力。</p><p>我们就开始尝试着在这种类型的业务上面，把前端技术工作交给服务端同学去做。我们提供基础设施、组件、工具，又提供培训。一开始服务端的同学都不太高兴，说你们前端就是想偷懒，后来他们发现不对，这是好事情，以前我只能做一部分，我还得跟前端去做一些联调，现在我自己全都做了：一是业绩上好看，二是省去沟通成本，三是个人能力提升了。服务端同学越来越支持这件事，后来淘宝的中后台业务都转向了这种模式。</p><p>而服务端同学也做了很多 API 平台，提供定制 API 的能力，其他部门不需要找服务端去开发新的接口，只需要少量的服务端同学参与。最后大家发现其实全栈不是把别人的东西抢过来，而是把自己的东西赋能、输出出去。其实在企业里面，不能永远是零和游戏（非合作博弈），但是这种赋能输出，是能够把零和变成正和（双赢）的。</p><blockquote><p>从前端到”钱“端：我并不把钱当做工作的目标，但是钱从来也没有亏待我。</p></blockquote><p>圈儿里很多人开玩笑说你们现在都是“钱“端了，因为挣钱多。实际上现在看一个同等水平的前端，他的价格还是略低于服务端的，不过前端最近可以说是涨得快，而且前端胜在竞争少。虽然前端基数大，但是实际上真正懂技术、会写代码的前端非常少。大部分前端就是市场上的前端，基本上是切个图，做一些机械性劳动，对于大企业来讲，是不要那种单纯只会去做机械性劳动的前端的。</p><p>今天我们很多人其实是在尝试把“钱端”的天花板弄得再高一点。其实我更愿意这样看：其实 前端本身不是你的天花板，你的个人能力才是你的天花板。</p><p>今天很多前端同学其实就是关注如何把设计师的设计稿变成一个用代码写出来的样子，那么你对业务的介入是浅的，你也就这样了。其实工程师应该做什么？从工程方面来讲，你怎么样能让更多的团队、更大规模的团队一起去协作？怎么样做出来更大规模的产品？其实还是需要我们把视角转一下——你能够真正以公司利益、以公司业务为导向，去思考你应该做什么，才能真正有晋升机会。</p><p>过去十年对我个人来说，我工作就是两个目标，一个是自我个人成长，一个是自我价值的实现。在这个过程中它必然会产生收入，我并不把钱当做工作的目标，但是钱从来也没有亏待我。我过去的经历都是在大公司，从微软到盛大到阿里，一毕业，拿到的就是差不多国内最好的 offer，后边基本上每换一个工作，工资就涨 50%，工资是其次，说明其实成长是没有耽误的。</p><p>当然 2018 年对我来说会是一个分界线，我希望把目标从自我成长切换到自我价值上来，我要去做教育这件事儿，能不能做成还不知道，但是我愿意去尝试。</p><blockquote><p>前端未来：没有什么东西是做不了的。</p></blockquote><p>如果让我来展望前端发展的话，我认为有两个方面不容忽视：</p><p>一是 AI 与前端的结合，智能研发是我非常看好的领域。我们技术圈里有一个比较流行的观点：一切机械劳动最终都是可以被计算机替代的。</p><p>另一个我比较看好的发展领域就是图形学。因为前端相对来说是一个在封装好的环境下去工作的一个代码环境，所以我认为前端未来应该会更下沉，跟图形学有更多的结合。今天我们前端还是有很多东西说我做不了，当你能够去从更底层去做的时候，就没有什么东西是你真正做不了的。我们就不会看到一个 C++ 的程序员说这个东西我做不了，因为理论上讲它可以操作计算机的所有部件，而且能以非常高的性能去做。</p><blockquote><p>前端很有意思，它充满着工程上面妥协的味道。</p></blockquote><p>说实话我觉得前端领域今天不完美和不满意的地方太多了。前端很有意思，它充满着工程上面的妥协的味道。你做技术总是希望尽善尽美，希望把每个细节都做到最好，但其实 前端是一个建立在标准之上的工作，标准本身又是工业化之后的一个妥协的产物，所以前端的 API 也好，语言也好，包括今天很流行的一些开源实践项目也好，里面有大量今天去看非常差的设计。</p><p>这些比较遗憾的东西，将来始终会作为一个包袱让我们背负着前进，这是前端的一个无奈。我们为了一些事情去付出这样的代价，但是大家还是会尝试逐步去解决这些陈旧的问题，今天我们已经看到很多旧的问题不是说把旧的改掉，而是设计一些新的东西来逐步替代它，它是一个很漫长的过程。所以有人说前端程序员喜新厌旧，说前端同学追新追的很厉害，新框架基本上隔个 4、5 年就出一个新的工具，所以很多人抱怨学不过来了。</p><p>虽然有很多不完美，但是前端也带来了很多新机遇。怎么说呢，这就是前端了。</p>]]></content>
      
      
      <categories>
          
          <category> 职业 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mongodb入门基础</title>
      <link href="/2019/12/03/Mongodb%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/12/03/Mongodb%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="linux安装mongodb">linux安装mongodb</h1><h3 id="arch-linux">arch linux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> aur</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/mongodb-bin.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> mongodb-bin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> mongodb.service</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start mongodb.service</span></span><br></pre></td></tr></table></figure><h1 id="基础命令">基础命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入终端</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mongo</span></span><br><span class="line">MongoDB shell version v4.2.1</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session &#123; "id" : UUID("5ae8192f-e4b1-408f-9795-ea731610d5ad") &#125;</span><br><span class="line">MongoDB server version: 4.2.1</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive help, type "help".</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">        http://docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line">        http://groups.google.com/group/mongodb-user</span><br><span class="line">Server has startup warnings: </span><br><span class="line">2019-12-03T15:18:28.142+0800 I  STORAGE  [initandlisten] </span><br><span class="line">2019-12-03T15:18:28.142+0800 I  STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine</span><br><span class="line">2019-12-03T15:18:28.142+0800 I  STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem</span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] </span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.</span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] </span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] </span><br><span class="line">2019-12-03T15:18:28.728+0800 I  CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 95847 processes, 1048576 files. Number of processes should be at least 524288 : 0.5 times number of files.</span><br><span class="line">---</span><br><span class="line">Enable MongoDB's free cloud-based monitoring service, which will then receive and display</span><br><span class="line">metrics about your deployment (disk utilization, CPU, operation statistics, etc).</span><br><span class="line"></span><br><span class="line">The monitoring data will be available on a MongoDB website with a unique URL accessible to you</span><br><span class="line">and anyone you share the URL with. MongoDB may use this information to make product</span><br><span class="line">improvements and to suggest MongoDB products and deployment options to you.</span><br><span class="line"></span><br><span class="line">To enable free monitoring, run the following command: db.enableFreeMonitoring()</span><br><span class="line">To permanently disable this reminder, run the following command: db.disableFreeMonitoring()</span><br><span class="line">---</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打印当前数据库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> db</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 非关系型数据库 </tag>
            
            <tag> Mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack入门基础</title>
      <link href="/2019/11/08/Webpack%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/11/08/Webpack%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="安装">安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install webpack -g</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install webpack-cli -g</span></span><br></pre></td></tr></table></figure><h3 id="webpack基础命令">webpack基础命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 目录结构</span><br><span class="line">.</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">└── src</span><br><span class="line">    ├── index.html</span><br><span class="line">    ├── js</span><br><span class="line">    │   ├── app.js</span><br><span class="line">    │   ├── module1.js</span><br><span class="line">    │   ├── module2.js</span><br><span class="line">    │   └── module3.js</span><br><span class="line">    └── json</span><br><span class="line">        └── data.json</span><br><span class="line"></span><br><span class="line">4 directories, 7 files</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试环境</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> webpack src/js/app.js -o dist/js/app.js --mode=development</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生产环境</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> webpack src/js/app.js -o dist/js/app.js --mode=production</span></span><br></pre></td></tr></table></figure><p><strong>webpack命令能：</strong></p><ul><li>够编译打包js和json文件</li><li>能将es6的模块化语法转换成浏览器能识别的语法</li><li>能压缩代码</li></ul><p><strong>webpack命令不能：</strong></p><ul><li>不能编译打包css、img等文件</li><li>不能将js的es6基本语法转化为es5以下语法</li></ul><h3 id="配置">配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: []</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> webpack</span></span><br></pre></td></tr></table></figure><h3 id="webpack-js语法检查">webpack js语法检查</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装loader</span></span><br><span class="line">cnpm install eslint-loader eslint --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js 配置loader</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>package.json 添加eslintConfig</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nodelearn"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"测试"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"1.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-loader"</span>: <span class="string">"^3.0.2"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">      <span class="attr">"ecmaVersion"</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="webpack-js语法转换">webpack js语法转换</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install babel-loader @babel/core @babel/preset-env --save-dev</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="webpack打包html文件">webpack打包html文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install html-webpack-plugin --save-dev</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install clean-webpack-plugin --save-dev</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install html-loader --save-dev</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="comment">// 配置插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//引入插件html-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);  <span class="comment">//引入清除文件插件</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>,<span class="comment">// 默认情况下生成的 html 文件叫 index.html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">//把生成的 index.html 文件的内容的没用空格去掉，减少空间</span></span><br><span class="line">            &#125;,</span><br><span class="line">            hash: <span class="literal">true</span>, <span class="comment">//为了更好的 cache，可以在文件名后加个 hash。</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(), <span class="comment">//实例化，参数为目录</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="webpack-自动编译打包运行">webpack 自动编译打包运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install webpack --save-dev</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install webpack-dev-server --save-dev</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install webpack-cli --save-dev</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js 添加devtool, devServer, plugins</span></span><br><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="comment">// 配置插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//引入插件html-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);  <span class="comment">//引入清除文件插件</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,  <span class="comment">// 将编译后的代码映射回原始源代码，更容易地追踪错误和警告</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">'./dist'</span>,  <span class="comment">//项目根路径</span></span><br><span class="line">        hot: <span class="literal">true</span>,  <span class="comment">//开启热模替换功能</span></span><br><span class="line">        open: <span class="literal">true</span>  <span class="comment">//自动打开浏览器</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>,<span class="comment">// 默认情况下生成的 html 文件叫 index.html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">//把生成的 index.html 文件的内容的没用空格去掉，减少空间</span></span><br><span class="line">            &#125;,</span><br><span class="line">            hash: <span class="literal">true</span>, <span class="comment">//为了更好的 cache，可以在文件名后加个 hash。</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(), <span class="comment">//实例化，参数为目录</span></span><br><span class="line">        <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>package.json添加start，dev命令</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nodelearn"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"测试"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"1.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"webpack-dev-server"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"webpack-dev-server"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"@babel/core"</span>: <span class="string">"^7.7.2"</span>,</span><br><span class="line">    <span class="attr">"@babel/preset-env"</span>: <span class="string">"^7.7.1"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^8.0.6"</span>,</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-loader"</span>: <span class="string">"^3.0.2"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.9.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">      <span class="attr">"ecmaVersion"</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生产环境">生产环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">项目目录下新建config/webpack.dev.js, config/webpack.prod.js, 删除webpack.config.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="comment">// 配置插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//引入插件html-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);  <span class="comment">//引入清除文件插件</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/bundle.js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'../dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,  <span class="comment">// 将编译后的代码映射回原始源代码，更容易地追踪错误和警告</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">'./dist'</span>,  <span class="comment">//项目根路径</span></span><br><span class="line">        hot: <span class="literal">true</span>,  <span class="comment">//开启热模替换功能</span></span><br><span class="line">        open: <span class="literal">true</span>  <span class="comment">//自动打开浏览器</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>,<span class="comment">// 默认情况下生成的 html 文件叫 index.html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">//把生成的 index.html 文件的内容的没用空格去掉，减少空间</span></span><br><span class="line">            &#125;,</span><br><span class="line">            hash: <span class="literal">true</span>, <span class="comment">//为了更好的 cache，可以在文件名后加个 hash。</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'development'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入webpack</span></span><br><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="comment">// 配置插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>); <span class="comment">//引入插件html-webpack-plugin</span></span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);  <span class="comment">//引入清除文件插件</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);  <span class="comment">//node内置核心模块，用来设置路径。</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/app.js'</span>,   <span class="comment">// 入口文件</span></span><br><span class="line">    output: &#123;                     <span class="comment">// 输出配置</span></span><br><span class="line">        filename: <span class="string">'./js/[name].[hash:8].js'</span>,      <span class="comment">// 输出文件名</span></span><br><span class="line">        path: resolve(__dirname, <span class="string">'../dist'</span>)   <span class="comment">//输出文件路径配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,  <span class="comment">// 将编译后的代码映射回原始源代码，更容易地追踪错误和警告</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>,<span class="comment">// 默认情况下生成的 html 文件叫 index.html</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">//把生成的 index.html 文件的内容的没用空格去掉，减少空间</span></span><br><span class="line">            &#125;,</span><br><span class="line">            hash: <span class="literal">true</span>, <span class="comment">//为了更好的 cache，可以在文件名后加个 hash。</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,  <span class="comment">//只检测js文件</span></span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">                enforce: <span class="string">"pre"</span>,  <span class="comment">//提前加载使用</span></span><br><span class="line">                use: &#123; <span class="comment">//使用eslint-loader解析</span></span><br><span class="line">                    loader: <span class="string">"eslint-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'production'</span>   <span class="comment">// development, production 二选一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>package.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nodelearn"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"测试"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"1.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"webpack-dev-server --config ./config/webpack.dev.js"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"webpack-dev-server --config ./config/webpack.dev.js"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"webpack --config ./config/webpack.prod.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"@babel/core"</span>: <span class="string">"^7.7.2"</span>,</span><br><span class="line">    <span class="attr">"@babel/preset-env"</span>: <span class="string">"^7.7.1"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^8.0.6"</span>,</span><br><span class="line">    <span class="attr">"clean-webpack-plugin"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="attr">"eslint-loader"</span>: <span class="string">"^3.0.2"</span>,</span><br><span class="line">    <span class="attr">"html-loader"</span>: <span class="string">"^0.5.5"</span>,</span><br><span class="line">    <span class="attr">"html-webpack-plugin"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.41.2"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.3.10"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.9.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">      <span class="attr">"ecmaVersion"</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>项目目录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── config</span><br><span class="line">│   ├── webpack.dev.js</span><br><span class="line">│   └── webpack.prod.js</span><br><span class="line">├── package.json</span><br><span class="line">└── src</span><br><span class="line">    ├── index.html</span><br><span class="line">    ├── js</span><br><span class="line">    │   ├── app.js</span><br><span class="line">    │   ├── module1.js</span><br><span class="line">    │   ├── module2.js</span><br><span class="line">    │   └── module3.js</span><br><span class="line">    └── json</span><br><span class="line">        └── data.json</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> Webpack </tag>
            
            <tag> Nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Anaconda入门基础</title>
      <link href="/2019/11/06/Anaconda%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/11/06/Anaconda%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><h3 id="官方安装">官方安装</h3><p><a href="https://www.anaconda.com/distribution/" target="_blank" rel="noopener">官方下载地址</a></p><h3 id="archlinux安装">archlinux安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ sudo pacman -S anaconda</span><br></pre></td></tr></table></figure><p><strong>验证</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ conda --version</span><br><span class="line">conda 4.7.10</span><br></pre></td></tr></table></figure></p><h2 id="虚拟环境">虚拟环境</h2><h3 id="创建">创建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> conda create --name &lt;env_name&gt; &lt;package_names&gt; &lt;package_names&gt; ....</span></span><br><span class="line">➜ conda create --name ml python=3.7.3 numpy pandas</span><br></pre></td></tr></table></figure><h3 id="进入退出">进入/退出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ conda activate ml</span><br><span class="line">➜ conda deactivate</span><br></pre></td></tr></table></figure><h3 id="列表">列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">(ml)$</span><span class="bash"> conda info --envs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> conda environments:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">ml                    *  /home/zhc/.conda/envs/ml</span><br><span class="line">base                     /opt/anaconda</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line"><span class="meta">(ml)$</span><span class="bash"> conda env list</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> conda environments:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">ml                    *  /home/zhc/.conda/envs/ml</span><br><span class="line">base                     /opt/anaconda</span><br></pre></td></tr></table></figure><h3 id="删除">删除</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove --name &lt;env_name&gt; --all</span><br></pre></td></tr></table></figure><h2 id="包管理">包管理</h2><h3 id="当期环境包列表">当期环境包列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">(ml)$</span><span class="bash"> conda list</span></span><br></pre></td></tr></table></figure><h3 id="当期环境安装包">当期环境安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> (ml)$ conda install &lt;package_name&gt;</span></span><br><span class="line"><span class="meta">(ml)$</span><span class="bash"> conda install jupyter notebook  <span class="comment"># 安装jupyter notebook编辑器</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> jupter notebook  <span class="comment"># 打开编辑器</span></span></span><br></pre></td></tr></table></figure><h3 id="卸载包">卸载包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">(ml)$</span><span class="bash"> conda remove &lt;package_name&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习入门基础</title>
      <link href="/2019/11/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/11/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="概念">概念</h1><h3 id="机器学习方式">机器学习方式</h3><blockquote><p>监督式学习: 给一组数据一个对应的输出结果。从数据中挖掘相关性</p></blockquote><blockquote><p>非监督式学习: 通过预先引入的优化准则进行模型训练</p></blockquote><blockquote><p>强化学习/半监督式学习</p></blockquote><h3 id="机器学习目标">机器学习目标</h3><blockquote><p>分类(监督式学习)</p></blockquote><blockquote><p>根据数据集目标的特征或者属性，划分到已有的分类中</p></blockquote><h1 id="算法">算法</h1><h3 id="常用算法">常用算法</h3><blockquote><p>K近邻(KNN), 逻辑回归， 决策树， 朴素贝叶斯</p></blockquote><h3 id="knn算法">KNN算法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># https://www.imooc.com/video/20172</span></span><br><span class="line"><span class="comment"># 图像展示</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="comment"># 调用knn模型</span></span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="comment"># 引入准确率</span></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"><span class="comment"># 引入数据分离</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 区分属性数据和结果数据</span></span><br><span class="line">    <span class="comment"># 加载iris数据</span></span><br><span class="line">    iris = datasets.load_iris()</span><br><span class="line">    <span class="comment"># 属性数据</span></span><br><span class="line">    <span class="comment"># print(iris.data)</span></span><br><span class="line">    <span class="comment"># 属性数据含义</span></span><br><span class="line">    <span class="comment"># print(iris.feature_names)</span></span><br><span class="line">    <span class="comment"># 结果数据</span></span><br><span class="line">    <span class="comment"># print(iris.target)</span></span><br><span class="line">    <span class="comment"># 结果数据含义</span></span><br><span class="line">    <span class="comment"># print(iris.target_names)</span></span><br><span class="line">    <span class="comment"># 确认属性/结果数据类型</span></span><br><span class="line">    <span class="comment"># print(type(iris.data), type(iris.target))</span></span><br><span class="line">    <span class="comment"># 确认行数一致</span></span><br><span class="line">    <span class="comment"># print(iris.data.shape, iris.target.shape)</span></span><br><span class="line">    <span class="keyword">return</span> iris.data, iris.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">knn_predict</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="comment"># X输入数据赋值 y输出数据赋值</span></span><br><span class="line">    x = data[<span class="number">0</span>]</span><br><span class="line">    y = data[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># knn临近值的设置</span></span><br><span class="line">    k = <span class="number">5</span></span><br><span class="line">    <span class="comment"># 创建实例</span></span><br><span class="line">    knn = KNeighborsClassifier(n_neighbors=k)</span><br><span class="line">    <span class="comment"># 模型训练</span></span><br><span class="line">    knn.fit(X=x, y=y)</span><br><span class="line">    <span class="comment"># 开始预测</span></span><br><span class="line">    x_test = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line">    results = knn.predict(x_test)</span><br><span class="line">    print(results)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">knn_pred</span><span class="params">(data)</span>:</span></span><br><span class="line">    x = data[<span class="number">0</span>]</span><br><span class="line">    y = data[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># knn临近值的设置</span></span><br><span class="line">    k = <span class="number">5</span></span><br><span class="line">    <span class="comment"># 创建实例</span></span><br><span class="line">    knn = KNeighborsClassifier(n_neighbors=k)</span><br><span class="line">    <span class="comment"># 模型训练</span></span><br><span class="line">    knn.fit(X=x, y=y)</span><br><span class="line">    y_pred = knn.predict(x)</span><br><span class="line">    print(y_pred)</span><br><span class="line">    print(y_pred.shape)</span><br><span class="line">    <span class="comment"># 准确率计算</span></span><br><span class="line">    print(accuracy_score(y, y_pred))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练集与预测集 计算准确率</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">knn_test_data</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="comment"># X输入数据赋值 y输出数据赋值</span></span><br><span class="line">    x = data[<span class="number">0</span>]</span><br><span class="line">    y = data[<span class="number">1</span>]</span><br><span class="line">    print(x.shape)</span><br><span class="line">    print(y.shape)</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=<span class="number">0.4</span>)</span><br><span class="line">    print(x_train.shape, x_test.shape, y_train.shape, y_test.shape)</span><br><span class="line">    k = <span class="number">5</span></span><br><span class="line">    knn = KNeighborsClassifier(n_neighbors=k)</span><br><span class="line">    knn.fit(x_train, y_train)</span><br><span class="line">    <span class="comment"># 训练集预测</span></span><br><span class="line">    y_train_pred = knn.predict(x_train)</span><br><span class="line">    print(accuracy_score(y_train, y_train_pred))</span><br><span class="line">    <span class="comment"># 测试集预测</span></span><br><span class="line">    y_test_pred = knn.predict(x_test)</span><br><span class="line">    print(accuracy_score(y_test, y_test_pred))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得最高准确率的k值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">knn_n_neighbors</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="comment"># X输入数据赋值 y输出数据赋值</span></span><br><span class="line">    x = data[<span class="number">0</span>]</span><br><span class="line">    y = data[<span class="number">1</span>]</span><br><span class="line">    k_range = list(range(<span class="number">1</span>, <span class="number">26</span>))</span><br><span class="line">    score_train = []</span><br><span class="line">    score_test = []</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> k_range:</span><br><span class="line">        knn = KNeighborsClassifier(n_neighbors=k)</span><br><span class="line">        knn.fit(x_train, y_train)</span><br><span class="line">        <span class="comment"># 训练集预测</span></span><br><span class="line">        y_train_pred = knn.predict(x_train)</span><br><span class="line">        score_train.append(accuracy_score(y_train, y_train_pred))</span><br><span class="line">        <span class="comment"># 测试集预测</span></span><br><span class="line">        y_test_pred = knn.predict(x_test)</span><br><span class="line">        score_test.append(accuracy_score(y_test, y_test_pred))</span><br><span class="line">    <span class="comment"># 展示k值与训练集测试集准确率关系</span></span><br><span class="line">    <span class="comment"># plt.plot(k_range, score_train)</span></span><br><span class="line">    <span class="comment"># plt.xlabel('K(KNN MODEL)')</span></span><br><span class="line">    <span class="comment"># plt.ylabel('Training Accuracy')</span></span><br><span class="line">    <span class="comment"># plt.show()</span></span><br><span class="line">    plt.plot(k_range, score_test)</span><br><span class="line">    plt.xlabel(<span class="string">'K(KNN MODEL)'</span>)</span><br><span class="line">    plt.ylabel(<span class="string">'Test Accuracy'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    data = load_data()</span><br><span class="line">    <span class="comment"># knn_predict(data)</span></span><br><span class="line">    <span class="comment"># knn_pred(data)</span></span><br><span class="line">    <span class="comment"># knn_test_data(data)</span></span><br><span class="line">    knn_n_neighbors(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    index()</span><br></pre></td></tr></table></figure><h3 id="逻辑回归算法">逻辑回归算法</h3><blockquote><p>用于解决分类问题的一种模型，计算其归属于某一类别的概率P(X), 常用与二分类问题，例如是否是垃圾邮件，是否是猫等等</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="comment"># 逻辑回归模型</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    path = <span class="string">'diabetes.csv'</span></span><br><span class="line">    pima = pd.read_csv(path)</span><br><span class="line">    print(pima.head())</span><br><span class="line">    <span class="comment"># 怀孕次数， 胰岛素水平， 体重指数， 年龄</span></span><br><span class="line">    feature_names = [<span class="string">'Pregnancies'</span>, <span class="string">'Insulin'</span>, <span class="string">'BMI'</span>, <span class="string">'Age'</span>]</span><br><span class="line">    <span class="comment"># x, y赋值</span></span><br><span class="line">    x = pima[feature_names]</span><br><span class="line">    y = pima.Outcome</span><br><span class="line">    <span class="comment"># 维度确认</span></span><br><span class="line">    print(x.shape)</span><br><span class="line">    print(y.shape)</span><br><span class="line">    <span class="comment"># 数据分离  random_state=0表示每次都是相同的分离</span></span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 创建模型实例</span></span><br><span class="line">    logeg = LogisticRegression()</span><br><span class="line">    logeg.fit(x_train, y_train)</span><br><span class="line">    <span class="comment"># 基于测试数据集的预测</span></span><br><span class="line">    y_pred = logeg.predict(x_test)</span><br><span class="line">    <span class="comment"># 使用准确率进行评估</span></span><br><span class="line">    print(metrics.accuracy_score(y_test, y_pred))</span><br><span class="line">    <span class="comment"># 确认正负样本数据量</span></span><br><span class="line">    print(y_test.value_counts())</span><br><span class="line">    <span class="comment"># 1的比例, 0的比例</span></span><br><span class="line">    print(y_test.mean(), <span class="number">1</span>-y_test.mean())</span><br><span class="line">    <span class="comment"># 空准确率</span></span><br><span class="line">    print(max(y_test.mean(), <span class="number">1</span>-y_test.mean()))</span><br><span class="line">    <span class="comment"># 以上发现训练后的模型准确率基本等同与空准确率</span></span><br><span class="line">    <span class="comment"># 引入混淆矩阵</span></span><br><span class="line">    <span class="comment"># 计算混淆矩阵</span></span><br><span class="line">    confusion = metrics.confusion_matrix(y_test, y_pred)</span><br><span class="line">    print(confusion)</span><br><span class="line">    <span class="comment"># 展示部分实际结果与预测结果(25组)</span></span><br><span class="line">    print(<span class="string">"true:"</span>, y_test.values[<span class="number">0</span>:<span class="number">25</span>])</span><br><span class="line">    print(<span class="string">"pred:"</span>, y_pred[<span class="number">0</span>:<span class="number">25</span>])</span><br><span class="line">    <span class="comment"># 四个因子赋值</span></span><br><span class="line">    tn = confusion[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># True Negatives 预测准备 实际为负样本的数量</span></span><br><span class="line">    fp = confusion[<span class="number">0</span>][<span class="number">1</span>]  <span class="comment"># False Positives 预测错误 实际为父样本的数量</span></span><br><span class="line">    fn = confusion[<span class="number">1</span>][<span class="number">0</span>]  <span class="comment"># False Negatives 预测错误 实际为正样本的数量</span></span><br><span class="line">    tp = confusion[<span class="number">1</span>][<span class="number">1</span>]  <span class="comment"># True Positives 预测准确 实际为正样本的数量</span></span><br><span class="line">    print(tn, fp, fn, tp)</span><br><span class="line">    print(<span class="string">'准确率Accuracy: 所有样本中，预测正确的比例'</span>)</span><br><span class="line">    print((tp + tn) / (tp + tn + fp + fn))</span><br><span class="line">    print(<span class="string">'错误率Misclassification Rate： 所有样本中，预测错误的比例'</span>)</span><br><span class="line">    print((fp + fn) / (tp + tn + fp + fn))</span><br><span class="line">    print(<span class="string">'灵敏度(召回率)Sensitivity： 正样本中，预测正确的比例'</span>)</span><br><span class="line">    recall = tp / (tp + fn)</span><br><span class="line">    print(recall)</span><br><span class="line">    print(<span class="string">'特异性Specificity: 负样本中，预测正确的比例'</span>)</span><br><span class="line">    print(tn / (tn + fp))</span><br><span class="line">    print(<span class="string">'精确率Precision: 预测结果为正样本中， 预测正确的比例'</span>)</span><br><span class="line">    precision = tp / (tp + fp)</span><br><span class="line">    print(precision)</span><br><span class="line">    print(<span class="string">'F1分数Score: 综合判断指标'</span>)</span><br><span class="line">    print((<span class="number">2</span>*precision*recall) / (precision+recall))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    index()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker入门基础</title>
      <link href="/2019/09/27/Docker%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/09/27/Docker%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><h3 id="centos7.2">Centos7.2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> https://docs.docker.com/install/linux/docker-ce/centos/<span class="comment">#install-docker-ce</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载旧版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager  --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install docker-ce</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start docker</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> docker</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker run hello-world</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入用户组(记得退出重新登录) https://docs.docker.com/install/linux/linux-postinstall/<span class="comment">#manage-docker-as-a-non-root-user</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装docker-compose</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install epel-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install python-pip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo pip install docker-compose</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 换源https://lug.ustc.edu.cn/wiki/mirrors/<span class="built_in">help</span>/docker</span></span><br></pre></td></tr></table></figure><h3 id="配置国内镜像源">配置国内镜像源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/docker/daemon.json</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [<span class="string">"http://hub-mirror.c.163.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart docker.service</span></span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">常见国内源:</span><br><span class="line"></span><br><span class="line">Docker中国 https://registry.docker-cn.com</span><br><span class="line">网易 http://hub-mirror.c.163.com</span><br><span class="line">ustc  https://docker.mirrors.ustc.edu.cn</span><br><span class="line">中国科技大学 https://docker.mirrors.ustc.edu.cn</span><br><span class="line">阿里云 https://cr.console.aliyun.com/</span><br></pre></td></tr></table></figure><h2 id="概念">概念</h2><h3 id="container-容器">container 容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看全部运行的容器</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker ps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除容器</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker rm container_id</span></span><br></pre></td></tr></table></figure><h3 id="image-镜像">image 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看安装的镜像</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker images</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除镜像</span></span><br><span class="line">sudo docker rmi iamge_id</span><br></pre></td></tr></table></figure><h2 id="dockerfile">Dockerfile</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile编写</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim Dockerfile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 制作镜像</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker build -t zhcshine:docker-sde/tag</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录到hub.docker.com</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker login:</span></span><br><span class="line">username:</span><br><span class="line">password:</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 推送到hub.docker.com</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker push zhcshine:docker-sde</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Svn入门基础</title>
      <link href="/2019/09/09/Svn%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/09/09/Svn%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><h3 id="安装-1">安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install subversion</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看svn目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">which</span> svnserve</span></span><br></pre></td></tr></table></figure><h3 id="重启">重启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭并重启</span></span><br><span class="line">sudo killall svnserve</span><br><span class="line">svnserve -d -r ~/svn</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn --username=username co svn://svn.xxxx.com/repo0  # 克隆项目</span><br></pre></td></tr></table></figure><h2 id="仓库">仓库</h2><h3 id="创建">创建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir ~/svn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> svnadmin create ~/svn/repo0  <span class="comment"># 创建repo0仓库</span></span></span><br></pre></td></tr></table></figure><h3 id="配置">配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置repo0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/svn/repo0/conf/svnserve.conf</span></span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = write</span><br><span class="line">password-db = ../../passwd  # 密码文件地址</span><br><span class="line">authz-db = ../../authz      # 权限认证文件地址</span><br></pre></td></tr></table></figure><h3 id="密码">密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置密码文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/svn/passwd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This file is an example password file for svnserve.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Its format is similar to that of svnserve.conf. As shown in the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## example below it contains one section labelled [users].</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The name and password for each user follow, one account per line.</span></span></span><br><span class="line">[users]</span><br><span class="line">test = testpassword</span><br><span class="line">dev = devpassword</span><br><span class="line">product = productpassword</span><br><span class="line">ui = uipassword</span><br></pre></td></tr></table></figure><h3 id="权限">权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置权限认证文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/svn/authz</span></span><br><span class="line"></span><br><span class="line">[aliases]</span><br><span class="line"><span class="meta">#</span><span class="bash"> joe = /C=XZ/ST=Dessert/L=Snake City/O=Snake Oil, Ltd./OU=Research Institute/CN=Joe Average</span></span><br><span class="line"></span><br><span class="line">[groups]</span><br><span class="line"><span class="meta">#</span><span class="bash"> harry_and_sally = harry,sally</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> harry_sally_and_joe = harry,sally,&amp;joe</span></span><br><span class="line">dev = dev</span><br><span class="line">ui = ui</span><br><span class="line">product = product</span><br><span class="line">test = test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> [/foo/bar]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> harry = rw</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> &amp;joe = r</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * =</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> [repository:/baz/fuz]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> @harry_and_sally = rw</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * = r</span></span><br><span class="line"></span><br><span class="line">[repo0:/]</span><br><span class="line">dev = r</span><br><span class="line">test = r</span><br><span class="line">product = wr</span><br><span class="line">ui = wr</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Svn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android开发入门基础</title>
      <link href="/2019/08/21/Android%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/08/21/Android%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="linux安装环境">linux安装环境</h2><h3 id="安装android-studio">安装android-studio</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> archlinux</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/android-studio.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si</span></span><br></pre></td></tr></table></figure><h3 id="安装sdk">安装sdk</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> https://www.androiddevtools.cn/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载 SDK Tools并解压</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf android-sdk_r24.4.1-linux.tar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv android-sdk-linux ~/android</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载 SDK并解压</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv android-5.0 ~/android/android-sdk-linux/platforms</span></span><br></pre></td></tr></table></figure><h3 id="安装maven">安装maven</h3><a href="/2019/08/16/Java开发maven构建工具入门基础/" title="java开发maven构建工具入门基础">java开发maven构建工具入门基础</a><h3 id="安装maven私服">安装maven私服</h3><p><a href="https://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">Nexus的下载地址</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解压后/home/zhc/nexus</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./nexus/nexus-3.19.1-01/bin/nexus run  <span class="comment"># 启动nexus</span></span></span><br></pre></td></tr></table></figure><p>如果出现以下错误, 按提示安装java jdk <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No suitable Java Virtual Machine could be found on your system.</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 访问地址</span></span><br><span class="line">http://127.0.0.1:8081/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo博客搭建</title>
      <link href="/2019/08/19/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2019/08/19/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="安装基础环境">安装基础环境</h1><a href="/2019/07/26/Node入门基础/" title="node入门基础">node入门基础</a><h1 id="安装hexo">安装hexo</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h1 id="hexo部署配置">hexo部署配置</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim _config.yml</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/zhcshine/zhcshine.github.io.git  # 在github上新建一个page项目</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><h1 id="hexo命令">hexo命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog  # 初始化博客</span><br><span class="line">hexo n test_my_site  # 创建一篇博客文章</span><br><span class="line">hexo g  # 打包</span><br><span class="line">hexo s  # 预览 http://localhost:4000</span><br><span class="line">hexo d  # 发布到线上</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>密码学入门基础</title>
      <link href="/2019/08/19/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/08/19/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="古典密码-替换式密码或移项式密码">古典密码： 替换式密码或移项式密码</h1><h2 id="凯撒密码">凯撒密码</h2><blockquote><p>凯撒密码的替换方法是通过排列明文和密文字母表，密文字母表示通过将明文字母表向左或向右移动一个固定数目的位置。例如，当偏移量是左移3的时候（解密时的密钥就是3）：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">明文字母表：ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line">密文字母表：DEFGHIJKLMNOPQRSTUVWXYZABC</span><br></pre></td></tr></table></figure><h2 id="替换式密码缺点">替换式密码缺点</h2><p>暴力破解，密码本的安全性</p><h1 id="现代密码学hash-散列函数">现代密码学：Hash （散列函数）</h1><blockquote><p>Hash，一般翻译做散列、杂凑，或音译为哈希，是把任意长度的输入（又叫做预映射pre-image）通过散列算法变换成固定长度的输出，该输出就是散列值。这种转换是一种压缩映射，也就是，散列值的空间通常远小于输入的空间，不同的输入可能会散列成相同的输出，所以不可能从散列值来确定唯一的输入值。简单的说就是一种将任意长度的消息压缩到某一固定长度的消息摘要的函数。</p></blockquote><blockquote><p>Hash算法可以将一个数据转换为一个标志，这个标志和源数据的每一个字节都有十分紧密的关系。Hash算法还具有一个特点，就是很难找到逆向规律。</p></blockquote><blockquote><p>Hash算法是一个广义的算法，也可以认为是一种思想，使用Hash算法可以提高存储空间的利用率，可以提高数据的查询效率，也可以做数字签名来保障数据传递的安全性。所以Hash算法被广泛地应用在互联网应用中。</p></blockquote><blockquote><p>Hash算法也被称为散列算法，Hash算法虽然被称为算法，但实际上它更像是一种思想。Hash算法没有一个固定的公式，只要符合散列思想的算法都可以被称为是Hash算法。</p></blockquote><h2 id="md5">MD5</h2><h2 id="sha">SHA</h2><ul><li>SHA-1算法的哈希值大小为160位，其计算输出长度为40位。(SHA-1不再推荐使用)</li><li>SHA-224算法的哈希值大小为224位，其计算输出长度为56位。</li><li>SHA-256算法的哈希值大小为256位，其计算输出长度为64位。</li><li>SHA-384算法的哈希值大小为384位，其计算输出长度为96位。</li><li>SHA-512算法的哈希值大小为384位，其计算输出长度为128位。</li></ul><h1 id="现代密码学对称加密">现代密码学：对称加密</h1><blockquote><p>对称加密算法是应用较早的加密算法，技术成熟。在对称加密算法中，数据发信方将明文（原始数据）和加密密钥（mi yao）一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。收信方收到密文后，若想解读原文，则需要使用加密用过的密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密密钥。</p></blockquote><h2 id="des">DES</h2><blockquote><p>数据加密标准（英语：Data Encryption Standard，缩写为 DES）是一种对称密钥加密块密码算法，1976年被美国联邦政府的国家标准局确定为联邦资料处理标准（FIPS），随后在国际上广泛流传开来</p></blockquote><blockquote><p>DES现在已经不是一种安全的加密方法，主要因为它使用的56位密钥过短。</p></blockquote><blockquote><p>1999年1月，distributed.net与电子前哨基金会合作，在22小时15分钟内即公开破解了一个DES密钥。</p></blockquote><blockquote><p>美国国家标准局倡导的AES即将作为新标准取代DES。</p></blockquote><h2 id="aes">AES</h2><h2 id="对称加密的缺点">对称加密的缺点</h2><p>甲方必须把加密规则告诉乙方，否则无法解密。保存和传递密钥，就成了最头疼的问题。</p><h1 id="现代密码学非对称加密">现代密码学：非对称加密</h1><blockquote><p>公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的</p></blockquote><h2 id="rsa">RSA</h2><h1 id="rsa算法">RSA算法</h1><blockquote><p>1977年，三位数学家Rivest、Shamir 和 Adleman 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字命名，叫做RSA算法。 RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。</p></blockquote><p>RSA算法运用的几个数论知识： 互素关系， 欧拉函数， 欧拉定理， 模逆元</p><h2 id="互素关系">互素关系</h2><p>如果没有大于1的正数既是r的因数也是s的因数，则r和s互素。</p><h2 id="欧拉函数">欧拉函数</h2><p>在数论，对正整数m，欧拉函数φ(m)是小于或等于m的正整数中与m互素的数的数目</p><ol type="1"><li>如果m是素数， φ(m)=m-1, 例如φ(3) = 2</li><li>若m = p * q, φ(m) = (p-1) * (q-1)</li></ol><h2 id="欧拉定理">欧拉定理</h2><p>在数论中，欧拉定理是一个关于同余的性质。欧拉定理表明，若n,a为正整数，且n,a互素，则a^φ(n)≡1 (mod n)</p><h2 id="模逆元">模逆元</h2><p>如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。这时，b就叫做a的"模反元素"。</p><h2 id="rsa公钥密钥生成方法">rsa公钥密钥生成方法</h2><p>公钥，密钥生成方法</p><ol type="1"><li><p>随机取俩个不相等素数p, q; 例如：p=61, q=53 # 实际应用中，这两个质数很大，常常是几百位</p></li><li><p>计算p和q的乘积n， 其中n的长度就是密钥的长度; n=p*q=3233 3233写成二进制是110010100001，一共有12位，所以这个密钥就是12位 # 实际应用中，RSA密钥一般是1024位，重要场合则为2048位</p></li><li><p>计算n的欧拉函数φ(n); φ(n) = (p-1)(q-1) = 60*52 = 3120</p></li><li><p>随机选择一个整数e，条件是1&lt; e &lt; φ(n)，且e与φ(n) 互质; e = 17</p></li><li><p>计算e对于φ(n)的模逆元d</p><ol type="1"><li><p>ed ≡ 1 (mod φ(n)) # 模逆元公式A</p></li><li><p>ed - 1 = kφ(n) # 模逆元公式转换B</p></li><li><p>ed - kφ(n) = 1 # 转换公式</p></li><li><p>ex + φ(n)y = 1 # 转换公式 (e=17, φ(n)=3120, x=d, y=-k)</p></li><li><p>17x + 3120y = 1 # 代入数值</p></li></ol></li><li><p>扩展欧几里得算法求解17x+3120y=1， 一组整数解为 (x,y)=(2753,-15)， 此时计算出d=2753</p></li><li><p>n=3233，e=17，d=2753，所以公钥就是 (3233,17)，私钥就是（3233, 2753）</p></li></ol><p>是否可以破解密钥？</p><ol type="1"><li><p>已知公钥(n, e)</p></li><li><p>已知 ed ≡ 1 (mod φ(n))。只有知道e和φ(n)，才能算出d, 目前只需要算出φ(n)</p></li><li><p>已知 φ(n)=(p-1)(q-1)。只有知道p和q，才能算出φ(n)，目前需要算出p和q</p></li><li><p>已知 n=pq。只有将n因数分解，才能算出p和q，n已知，如果n可以被因数分解，d就可以算出，也就意味着私钥被破解。</p></li><li><p>可是，大整数的因数分解，是一件非常困难的事情。目前，除了暴力破解，还没有发现别的有效方法。</p></li><li><p>维基百科这样写道：</p></li></ol><p>　　"对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。假如有人找到一种快速因数分解的算法，那么RSA的可靠性就会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA密钥才可能被暴力破解。到2008年为止，世界上还没有任何可靠的攻击RSA算法的方式。只要密钥长度足够长，用RSA加密的信息实际上是不能被解破的。"</p><h2 id="rsa加密和解密">rsa加密和解密</h2><p>加密公钥 (n,e)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m^e ≡ c (mod n)  # m是明文， 必须是整数（字符串可以取ascii值或unicode值），且m必须小于n</span><br><span class="line">65^17 ≡ c (mod 3233)  # 本例中n=3233，e=17</span><br><span class="line">c = 2790  # 计算出c=2790, c则是密文</span><br></pre></td></tr></table></figure><p>解密私钥(n,d)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c^d ≡ m (mod n)  # 公式一定成立，下面有介绍</span><br><span class="line">2790^2753 ≡ m (mod 3233)  # 本例中c=2790, d=2753</span><br><span class="line">m = 65  # 计算出明文m=65</span><br></pre></td></tr></table></figure><h2 id="rsa私钥解密证明">rsa私钥解密证明</h2><ol type="1"><li><p>c^d ≡ m (mod n) # 要证明的公式A</p></li><li><p>因为 m^e ≡ c (mod n)， 根据模运算的含义，所以 c = m^e - kn</p></li><li><p>将c代入公式A中， (m^e - kn)^d ≡ m (mod n)</p></li><li><p>将上述方程式的左侧用二项式定理展开，会发现都是n的倍数，模运算为0，所以可以简化为 m<sup>e</sup>d ≡ m (mod n) 即 m^(ed) = m (mod n)</p></li><li><p>因为ed ≡ 1 (modφ(n))， 所以ed = 1 + hφ(n)</p></li><li><p>代入公式B中 m^(1 + hφ(n)) ≡ m (mod n) # 公式C</p></li><li><p>当m与n互素时</p><ol type="1"><li><p>根据欧拉定理m^φ(n) ≡ 1 (mod n) 可得m^φ(n) = kn + 1</p></li><li><p>上述公式两边乘以m得到 m * m^φ(n) = m * (kn + 1)</p></li><li><p>上述公式转换 m^(1 + hφ(n)) = m * (kn + 1) = m + mk * n ≡ m (mod n), 公式C得到证明</p></li></ol></li><li><p>当m与n不互素</p><ol type="1"><li><p>由于n等于质数p和q的乘积，所以m必然等于kp或kq。</p></li><li><p>以 m = kp为例，考虑到这时k与q必然互质，则根据欧拉定理，下面的式子成立： (kp)^(q-1) ≡ 1 (mod q)</p></li><li><p>进一步扩展，可得 [(kp)^(q-1)]^(h(p-1)) × kp ≡ kp (mod q)</p></li><li><p>根据上述可得 (kp)^(ed) ≡ kp (mod q)</p></li><li><p>根据上述可得 (kp)^(ed) = kp + tq</p></li><li><p>显然，t能被p整除， 即t=t’p,可以得出 (kp)^(ed) = kp+t′pq</p></li><li><p>因为m=kp, n=pq, 最后得出 m^(ed) ≡ m (mod n) 公式得证</p></li></ol></li></ol><h1 id="补充模算数">补充：模算数</h1><h2 id="同余">同余</h2><h3 id="同余表达式">同余表达式</h3><p>维基百科</p><blockquote><p>数学上，同余（英语：congruence modulo，符号：≡）是数论中的一种等价关系。当两个整数除以同一个正整数，若得相同余数，则二整数同余。同余是抽象代数中的同余关系的原型。最先引用同余的概念与“≡”符号者为德国数学家高斯。</p></blockquote><p>两个整数a， b，若它们除以正整数m所得的余数相等，则称a，b对于模m同余，记作</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ≡ b (mod m)</span><br></pre></td></tr></table></figure><h3 id="同余换代">同余换代</h3><blockquote><p>在任意一个成立的模同余式中，将任意子表达式替换为一个与其同余的子表达式，所得的模同余式依然成立</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(12 + 4) * 2 ≡ x + 1 (mod 7)</span><br></pre></td></tr></table></figure><p>(12 + 4)(模7)同余与2，故上同余式可表示为</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 * 2  ≡ x + 1 (mod 7)</span><br></pre></td></tr></table></figure><h3 id="代表元">代表元</h3><blockquote><p>每个整数恰好和整数0,1,2,...,m-1中的一个模m同余</p></blockquote><p>例如，在模7的情况下，每个整数和整数0,1,2,3,4,5，6中的一个同余</p><h3 id="商和余数">商和余数</h3><p>b被m除时，r为余数，q为商</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = mq + r</span><br></pre></td></tr></table></figure><p>余数操作运算符一般使用rem表示，例如25 rem 7 = 4</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果a rem m = b rem m, 则 a ≡ b (mod m)</span><br><span class="line">如果 a ≡ b (mod m)， 则a rem m = b rem m</span><br></pre></td></tr></table></figure><h3 id="用rem运算简化模同余数">用rem运算简化模同余数</h3><p>例</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">12 <span class="bullet">* 11 *</span> 10 <span class="bullet">* 9 *</span> 8 * 7 ≡ x (mod 13)</span><br><span class="line">因为</span><br><span class="line">12 * 11 = 132</span><br><span class="line">132 rem 13 = 2</span><br><span class="line">根据同余换代，上式可表示为</span><br><span class="line">2 <span class="bullet">* 10 *</span> 9 <span class="bullet">* 8 *</span> 7 ≡ x (mod 13)</span><br><span class="line">同上，上式可表示为</span><br><span class="line">7 <span class="bullet">* 9 *</span> 8 * 7 ≡ x (mod 13)</span><br><span class="line">11 <span class="bullet">* 8 *</span> 7 ≡ x (mod 13)</span><br><span class="line">10 * 7 ≡ x (mod 13)</span><br><span class="line">5 ≡ x (mod 13)</span><br></pre></td></tr></table></figure><p>现在要求计算 12 * 11 * 10 * 9 * 8 * 7 * 6 rem 13</p><p>上面求出 <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12 <span class="bullet">* 11 *</span> 10 <span class="bullet">* 9 *</span> 8 * 7 ≡ 5 (mod 13)</span><br></pre></td></tr></table></figure></p><p>根据商和余数与模的关系</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果 a ≡ b (mod m)， 则a rem m = b rem m</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12 <span class="bullet">* 11 *</span> 10 <span class="bullet">* 9 *</span> 8 <span class="bullet">* 7 *</span> 6 rem 13 可转为 5 * 6 rem 13</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>java开发spring入门基础</title>
      <link href="/2019/08/16/Java%E5%BC%80%E5%8F%91spring%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/08/16/Java%E5%BC%80%E5%8F%91spring%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="构建项目基础">构建项目基础</h1><a href="/2019/08/16/Java开发maven构建工具入门基础/" title="java开发maven构建工具入门基础">java开发maven构建工具入门基础</a><a href="/2019/08/16/Java开发gradle构建工具入门基础/" title="java开发gradle构建工具入门基础">java开发gradle构建工具入门基础</a><h1 id="构建项目">构建项目</h1><p><a href="https://start.spring.io/" target="_blank" rel="noopener">spring项目初始化</a></p><ul><li>Project: Gradle Project</li><li>Language: Java</li><li>Spring Boot: 2.17</li><li>Project Metadata<ul><li>Group: com.zhuohc</li><li>Artifact: demo</li><li>Options:<ul><li>Name: (默认)</li><li>Description: (默认)</li><li>Package Name: (默认)</li><li>Packaging: Jar/War(Web项目使用)</li><li>Java: 11(根据java版本号选择)</li></ul></li></ul></li></ul><p>Generate the project</p><p>解压后的文件夹即是项目初始化的目录结构</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tree</span></span><br><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── HELP.md</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   │   └── com</span><br><span class="line">    │   │       └── zhuohc</span><br><span class="line">    │   │           └── demo</span><br><span class="line">    │   │               └── Application.java</span><br><span class="line">    │   └── resources</span><br><span class="line">    │       └── application.properties</span><br><span class="line">    └── test</span><br><span class="line">        └── java</span><br><span class="line">            └── com</span><br><span class="line">                └── zhuohc</span><br><span class="line">                    └── demo</span><br><span class="line">                        └── ApplicationTests.java</span><br></pre></td></tr></table></figure><p>修改国内源 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;url &apos;http://maven.aliyun.com/nexus/content/groups/public/&apos;&#125;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>java开发gradle构建工具入门基础</title>
      <link href="/2019/08/16/Java%E5%BC%80%E5%8F%91gradle%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/08/16/Java%E5%BC%80%E5%8F%91gradle%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="linux安装gradle">linux安装gradle</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从官网下载二进制包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://gradle.org/install/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> unzip unzip gradle-5.6-all.zip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mv gradle-5.6 /usr/java_jar</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加环境变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/profile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 最后添加</span></span><br><span class="line">export PATH=$PATH:/usr/java_jar/gradle-5.6/bin</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gradle -v</span></span><br><span class="line">Welcome to Gradle 5.6!</span><br><span class="line"></span><br><span class="line">Here are the highlights of this release:</span><br><span class="line"> - Incremental Groovy compilation</span><br><span class="line"> - Groovy compile avoidance</span><br><span class="line"> - Test fixtures for Java projects</span><br><span class="line"> - Manage plugin versions via settings script</span><br><span class="line"></span><br><span class="line">For more details see https://docs.gradle.org/5.6/release-notes.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Gradle 5.6</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build time:   2019-08-14 21:05:25 UTC</span><br><span class="line">Revision:     f0b9d60906c7b8c42cd6c61a39ae7b74767bb012</span><br><span class="line"></span><br><span class="line">Kotlin:       1.3.41</span><br><span class="line">Groovy:       2.5.4</span><br><span class="line">Ant:          Apache Ant(TM) version 1.9.14 compiled on March 12 2019</span><br><span class="line">JVM:          11.0.4 (Oracle Corporation 11.0.4+10-LTS)</span><br><span class="line">OS:           Linux 4.19.49-1-MANJARO amd64</span><br></pre></td></tr></table></figure><h1 id="配置gradle">配置gradle</h1><h2 id="项目配置国内源">项目配置国内源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置国内aliyun源</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;url 'http://maven.aliyun.com/nexus/content/groups/public/'&#125;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="全局配置国内源">全局配置国内源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.gradle/init.gradle</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">allprojects&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def REPOSITORY_URL = 'http://maven.aliyun.com/nexus/content/groups/public/'</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line">                if (url.startsWith('https://repo1.maven.org/maven2') || url.startsWith('https://jcenter.bintray.com/')) &#123;</span><br><span class="line">                    project.logger.lifecycle "Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL."</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url REPOSITORY_URL</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>java开发maven构建工具入门基础</title>
      <link href="/2019/08/16/Java%E5%BC%80%E5%8F%91maven%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/08/16/Java%E5%BC%80%E5%8F%91maven%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="linux安装maven">linux安装maven</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从官网下载二进制包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://maven.apache.org/download.cgi</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf apache-maven-3.6.1-bin.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mv apache-maven-3.6.1 /usr/java_jar</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加环境变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/profile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 最后添加</span></span><br><span class="line">export PATH=/opt/apache-maven-3.6.1/bin:$PATH</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn -v</span></span><br><span class="line">Apache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-05T03:00:29+08:00)</span><br><span class="line">Maven home: /usr/java_jar/apache-maven-3.6.1</span><br><span class="line">Java version: 11.0.4, vendor: Oracle Corporation, runtime: /usr/java/jdk-11.0.4</span><br><span class="line">Default locale: zh_CN, platform encoding: UTF-8</span><br><span class="line">OS name: "linux", version: "4.19.49-1-manjaro", arch: "amd64", family: "unix"</span><br></pre></td></tr></table></figure><h1 id="常见命令">常见命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个项目</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn archetype:generate</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 选择版本</span></span><br><span class="line">Choose org.apache.maven.archetypes:maven-archetype-quickstart version:                                                                                                                                        </span><br><span class="line">1: 1.0-alpha-1                                                                                                                                                                                                </span><br><span class="line">2: 1.0-alpha-2                                                                                                                                                                                                </span><br><span class="line">3: 1.0-alpha-3                                                                                                                                                                                                </span><br><span class="line">4: 1.0-alpha-4                                                                                                                                                                                                </span><br><span class="line">5: 1.0                                                                                                                                                                                                        </span><br><span class="line">6: 1.1                                                                                                                                                                                                        </span><br><span class="line">7: 1.3                                                                                                                                                                                                        </span><br><span class="line">8: 1.4                                                                                                                                                                                                        </span><br><span class="line">Choose a number: 8:       </span><br><span class="line">Define value for property 'groupId': com.zhuohc.maven03         # groupID 项目名                                                                                                                                                        </span><br><span class="line">Define value for property 'artifactId': maven03-model           # artifactId 项目名-模块名                    </span><br><span class="line">Define value for property 'version' 1.0-SNAPSHOT: :             # version 版本                                                                                                                                                </span><br><span class="line">Define value for property 'package' com.zhuohc.maven03: :                                                                                                                                                      </span><br><span class="line">Confirm properties configuration:                                                                                                                                                                             </span><br><span class="line">groupId: com.zhuohc.maven03                                                                                                                                                                                    </span><br><span class="line">artifactId: maven03-model                                                                                                                                                                                           </span><br><span class="line">version: 1.0-SNAPSHOT                                                                                                                                                                                         </span><br><span class="line">package: com.zhuohc.maven03</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mvn clean         <span class="comment"># 删除</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn compile       <span class="comment"># 编译</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn <span class="built_in">test</span>          <span class="comment"># 测试</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn package       <span class="comment"># 打包</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mvn install       <span class="comment"># 安装当前项目包到本地环境</span></span></span><br></pre></td></tr></table></figure><h1 id="修改下载源">修改下载源</h1><p>修改pom.xml文件repositories属性，添加国内源地址，具体见pom.xml</p><h1 id="pom.xml">pom.xml</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"</span><br><span class="line">         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.imooc.maven01&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven01-model&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class="line">            &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class="line">            &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">    &lt;/repositories&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>node入门基础</title>
      <link href="/2019/07/26/Node%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/07/26/Node%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="安装">安装</h1><p><strong>开发环境</strong></p><p><a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">安装nvm</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加以下代码到~/.bashrc, ~/.profile, or ~/.zshrc</span></span><br><span class="line">export NVM_DIR="$HOME/.nvm"</span><br><span class="line">[ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh"  # This loads nvm</span><br><span class="line">[ -s "$NVM_DIR/bash_completion" ] &amp;&amp; \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion</span><br></pre></td></tr></table></figure><p>nvm命令 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nvm install 6.14.4  <span class="comment"># 安装or 10.10.0, 8.9.1, etc</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nvm ls  <span class="comment"># 查看</span></span></span><br><span class="line">default -&gt; 10.16.0 (-&gt; v10.16.0)</span><br><span class="line">node -&gt; stable (-&gt; v10.16.0) (default)</span><br><span class="line">stable -&gt; 10.16 (-&gt; v10.16.0) (default)</span><br><span class="line">iojs -&gt; N/A (default)</span><br><span class="line">lts/* -&gt; lts/dubnium (-&gt; v10.16.0)</span><br><span class="line">lts/argon -&gt; v4.9.1 (-&gt; N/A)</span><br><span class="line">lts/boron -&gt; v6.17.1 (-&gt; N/A)</span><br><span class="line">lts/carbon -&gt; v8.16.0 (-&gt; N/A)</span><br><span class="line">lts/dubnium -&gt; v10.16.0</span><br><span class="line"><span class="meta">$</span><span class="bash"> nvm use default  <span class="comment"># 使用指定node版本</span></span></span><br></pre></td></tr></table></figure></p><p>安装cnpm <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm --registry=https://registry.npm.taobao.org install cnpm -g</span></span><br></pre></td></tr></table></figure></p><h1 id="node.js-回调函数">node.js 回调函数</h1><blockquote><p>Node.js 异步编程的直接体现就是回调。 异步编程依托于回调来实现，但不能说使用了回调后程序就异步化了。 回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。 例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">let</span> data = fs.readFileSync(<span class="string">'input.txt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data.toString());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行结束!"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文件内容......</span><br><span class="line">程序执行结束!</span><br></pre></td></tr></table></figure><h1 id="node.js-事件驱动">node.js 事件驱动</h1><blockquote><p>Node.js 使用事件驱动模型，当web server接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求。 当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。 这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也称之为非阻塞式IO或者事件驱动IO） 在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数。</p></blockquote><h1 id="node.js-buffer-缓冲区">node.js buffer 缓冲区</h1><blockquote><p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。 但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。 在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。</p></blockquote><p>node.js目前支持 1. ascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。 2. utf8 - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。 3. utf16le - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。 4. ucs2 - utf16le 的别名。 5. base64 - Base64 编码。 6. latin1 - 一种把 Buffer 编码成一字节编码的字符串的方式。 7. binary - latin1 的别名。 8. hex - 将每个字节编码为两个十六进制字符。</p><h1 id="node.js-stream-流">node.js stream 流</h1><blockquote><p>Stream 是一个抽象接口，Node 中有很多对象实现了这个接口。例如，对http 服务器发起请求的request 对象就是一个 Stream，还有stdout（标准输出）。</p></blockquote><h1 id="node.js-模块">node.js 模块</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出一个方法</span></span><br><span class="line">exports.world = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello World'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//hello.js </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> name; </span><br><span class="line">    <span class="keyword">this</span>.setName = <span class="function"><span class="keyword">function</span>(<span class="params">thyName</span>) </span>&#123; </span><br><span class="line">        name = thyName; </span><br><span class="line">    &#125;; </span><br><span class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + name); </span><br><span class="line">    &#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = Hello;</span><br></pre></td></tr></table></figure><h1 id="node.js-全局对象">node.js 全局对象</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前正在执行的脚本的文件名</span></span><br><span class="line"><span class="built_in">console</span>.log( __filename );</span><br><span class="line"><span class="comment">// 当前执行脚本所在的目录</span></span><br><span class="line"><span class="built_in">console</span>.log( __dirname );</span><br><span class="line"><span class="comment">// 定时器, 只执行一次</span></span><br><span class="line"><span class="keyword">let</span> t = setTimeout(printHello, <span class="number">2000</span>);</span><br><span class="line">clearTimeout(t);</span><br><span class="line"><span class="comment">// 全局函数在指定的毫秒(ms)数后执行指定函数(cb)</span></span><br><span class="line">setInterval(printHello, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// process: 一个全局变量，即 global 对象的属性。</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux守护进程</title>
      <link href="/2019/07/26/Linux%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/"/>
      <url>/2019/07/26/Linux%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是守护进程">什么是守护进程？</h1><p><a href="https://zh.wikipedia.org/wiki/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B" target="_blank" rel="noopener">守护进程（Daemon Process）</a>，也就是通常说的 Daemon 进程（精灵进程），是 Linux 中的后台服务进程。它是一个生存期较长的进程，通常独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。</p><p>守护进程是个特殊的孤儿进程，这种进程脱离终端，为什么要脱离终端呢？之所以脱离于终端是为了避免进程被任何终端所产生的信息所打断，其在执行过程中的信息也不在任何终端上显示。由于在 Linux 中，每一个系统与用户进行交流的界面称为终端，每一个从此终端开始运行的进程都会依附于这个终端，这个终端就称为这些进程的控制终端，当控制终端被关闭时，相应的进程都会自动关闭。</p><p>Linux 的大多数服务器就是用守护进程实现的。</p><h1 id="守护进程的分类">守护进程的分类</h1><p>根据守护进程的启动和管理方式，可以分为独立启动守护进程和超级守护进程两类</p><p><strong>独立启动（stand_alone)</strong>:该类进程启动后就常驻内存，所以会一直占用系统资源。其最大的优点就是它会一直启动，当外界有要求时相应速度较快，像httpd等进程；</p><p><strong>超级守护进程</strong>：系统启动时由一个统一的守护进程xinet来负责管理一些进程，当相应请求到来时需要通过xinet的转接才可以唤醒被xinet管理的进程。这种进程的优点时最初只有xinet这一守护进程占有系统资源，其他的内部服务并不一直占有系统资源，只有数据包到来时才会被xinet管理员来唤醒。并且我们还可以通过xinet来对它所管理的进程设置一些访问权限，相当于多了一层管理机制。 如果用两个比喻来形容两类守护进程的话一般会用银行的业务处理窗口来类比：</p><p><strong>独立启动</strong>：银行里有一种单服务的窗口，像取钱，存钱等窗口，这些窗口边上始终会坐着一个人，如果有人来取钱或存钱，可以直接到相应的窗口去办理，这个处理单一服务的始终存在的人就是独立启动的守护进程；</p><p><strong>超级守护进程</strong>：银行里还有一种窗口，提供综合服务，像汇款，转账，提款等业务；这种窗口附近也始终坐着一个人（xinet），她可能不提供具体的服务，提供具体服务的人在里面闲着聊天啊，喝茶啊，但是当有人来汇款时他会大声喊一句，小王，有人汇款啦，然后里面管汇款的小王会立马跑过来帮忙办完汇款业务。其他的人继续聊天，喝茶。这些负责具体业务的人我们就称之为超级守护进程。当然可能汇款人会有一些规则，可能不能往北京汇款，他就会提早告诉xinet，所以如果有人来汇款想汇往北京的话，管理员就直接告诉他这个我们这里办不到的，于是就根本不会去喊汇款员了，相当于提供了一层管理机制。针对这种窗口还存在多线程和单线程的区别：多线程：将所有用户的要求都提上来，里面的人都别闲着了，都一起干活吧；</p><p><strong>单线程</strong>：大家都排好队了，一个一个来，里面的人同一时间只有一个人在工作。</p><p>当然每个守护进程都会监听一个端口（银行窗口），一些常用守护进程的监听端口是固定的，像httpd监听80端口， sshd监听22端口等；我们可以将其理解为责任制，时候等待，有求必应。具体的端口信息可以通过cat /etc/services来查看。</p><h1 id="查看守护进程">查看守护进程</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps axj</span><br></pre></td></tr></table></figure><blockquote><p>a 表示不仅列当前用户的进程，也列出所有其他用户的进程</p></blockquote><blockquote><p>x 表示不仅列有控制终端的进程，也列出所有无控制终端的进程</p></blockquote><blockquote><p>j 表示列出与作业控制相关的信息 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND                                                                                                                                              </span><br><span class="line">   0     1     1     1 ?           -1 Ss       0  12:00 /sbin/init                                                                                                                                           </span><br><span class="line">   0     2     0     0 ?           -1 S        0   0:00 [kthreadd]                                                                                                                                           </span><br><span class="line">   2     3     0     0 ?           -1 I&lt;       0   0:00 [rcu_gp]                                                                                                                                             </span><br><span class="line">   2     4     0     0 ?           -1 I&lt;       0   0:00 [rcu_par_gp]                                                                                                                                         </span><br><span class="line">   2     6     0     0 ?           -1 I&lt;       0   0:00 [kworker/0:0H-kblockd]                                                                                                                               </span><br><span class="line">   2     8     0     0 ?           -1 I&lt;       0   0:00 [mm_percpu_wq]                                                                                                                                       </span><br><span class="line">   2     9     0     0 ?           -1 S        0   3:28 [ksoftirqd/0]                                                                                                                                        </span><br><span class="line">   2    10     0     0 ?           -1 I        0  40:58 [rcu_preempt]                                                                                                                                        </span><br><span class="line">   2    11     0     0 ?           -1 I        0   0:00 [rcu_sched]                                                                                                                                          </span><br><span class="line">   2    12     0     0 ?           -1 I        0   0:00 [rcu_bh]                                                                                                                                             </span><br><span class="line">   2    13     0     0 ?           -1 S        0   5:16 [rcuc/0]                                                                                                                                             </span><br><span class="line">   2    14     0     0 ?           -1 S        0   0:00 [rcub/0]</span><br></pre></td></tr></table></figure></p></blockquote><p>从上图可以看出守护进行的一些特点：</p><blockquote><p>守护进程基本上都是以超级用户启动（ UID 为 0 ）</p></blockquote><blockquote><p>没有控制终端（ TTY 为 ？）</p></blockquote><blockquote><p>终端进程组 ID 为 -1 （ TPGID 表示终端进程组 ID）</p></blockquote><p>一般情况下，守护进程可以通过以下方式启动：</p><blockquote><p>在系统启动时由启动脚本启动，这些启动脚本通常放在 /etc/rc.d 目录下；</p></blockquote><blockquote><p>利用 inetd 超级服务器启动，如 telnet 等；</p></blockquote><blockquote><p>由 cron 定时启动以及在终端用 nohup 启动的进程也是守护进程。</p></blockquote><h1 id="编写守护进程">编写守护进程</h1><p><strong>屏蔽一些控制终端操作的信号</strong></p><p>这是为了防止守护进行在没有运行起来前，控制终端受到干扰退出或挂起。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGTTOU,SIG_IGN);   </span><br><span class="line">signal(SIGTTIN,SIG_IGN);   </span><br><span class="line">signal(SIGTSTP,SIG_IGN);   </span><br><span class="line">signal(SIGHUP ,SIG_IGN);</span><br></pre></td></tr></table></figure><p><strong>在后台运行</strong></p><p>这是为避免挂起控制终端将守护进程放入后台执行。方法是在进程中调用 fork() 使父进程终止， 让守护进行在子进程中后台执行。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( pid = fork() )&#123; <span class="comment">// 父进程  </span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);        <span class="comment">//结束父进程，子进程继续  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>脱离控制终端、登录会话和进程组</strong></p><p>Linux 中的进程与控制终端，登录会话和进程组之间的关系：</p><p>进程属于一个进程组，进程组号（GID）就是进程组长的进程号（PID）。登录会话可以包含多个进程组。这些进程组共享一个控制终端。这个控制终端通常是创建进程的 shell 登录终端。 控制终端、登录会话和进程组通常是从父进程继承下来的。我们的目的就是要摆脱它们 ，使之不受它们的影响。因此需要调用 setsid() 使子进程成为新的会话组长，示例代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsid();</span><br></pre></td></tr></table></figure><p>setsid()调用成功后，进程成为新的会话组长和新的进程组长，并与原来的登录会话和进程组脱离。由于会话过程对控制终端的独占性，进程同时与控制终端脱离。</p><p><strong>禁止进程重新打开控制终端</strong></p><p>现在，进程已经成为无终端的会话组长，但它可以重新申请打开一个控制终端。可以通过使进程不再成为会话组长来禁止进程重新打开控制终端，采用的方法是再次创建一个子进程，示例代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( pid=fork() )&#123; <span class="comment">// 父进程  </span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);      <span class="comment">// 结束第一子进程，第二子进程继续（第二子进程不再是会话组长）   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>关闭打开的文件描述符</strong></p><p>进程从创建它的父进程那里继承了打开的文件描述符。如不关闭，将会浪费系统资源，造成进程所在的文件系统无法卸下以及引起无法预料的错误。按如下方法关闭它们：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NOFILE 为 &lt;sys/param.h&gt; 的宏定义  </span></span><br><span class="line"><span class="comment">// NOFILE 为文件描述符最大个数，不同系统有不同限制  </span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt; NOFILE; ++i)&#123;<span class="comment">// 关闭打开的文件描述符  </span></span><br><span class="line">    close(i);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>改变当前工作目录</strong></p><p>进程活动时，其工作目录所在的文件系统不能卸下。一般需要将工作目录改变到根目录。对于需要转储核心，写运行日志的进程将工作目录改变到特定目录如 /tmp。示例代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">"/"</span>);</span><br></pre></td></tr></table></figure><p><strong>重设文件创建掩模</strong></p><p>进程从创建它的父进程那里继承了文件创建掩模。它可能修改守护进程所创建的文件的存取权限。为防止这一点，将文件创建掩模清除：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umask(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><strong>处理 SIGCHLD 信号</strong></p><p>但对于某些进程，特别是服务器进程往往在请求到来时生成子进程处理请求。如果父进程不等待子进程结束，子进程将成为僵尸进程（zombie）从而占用系统资源。如果父进程等待子进程结束，将增加父进程的负担，影响服务器进程的并发性能。在 Linux 下可以简单地将 SIGCHLD 信号的操作设为 SIG_IGN 。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGCHLD, SIG_IGN);</span><br></pre></td></tr></table></figure><p>这样，内核在子进程结束时不会产生僵尸进程。</p><p>代码示例 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/syslog.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/param.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_daemon</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1）屏蔽一些控制终端操作的信号  </span></span><br><span class="line">    signal(SIGTTOU, SIG_IGN);</span><br><span class="line">    signal(SIGTTIN, SIG_IGN);</span><br><span class="line">    signal(SIGTSTP, SIG_IGN);</span><br><span class="line">    signal(SIGHUP, SIG_IGN);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2）在后台运行 </span></span><br><span class="line">    <span class="keyword">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE); <span class="comment">// 进程创建失败</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);    <span class="comment">// 退出父进程</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3）脱离控制终端、登录会话和进程组  </span></span><br><span class="line">    setsid();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4）禁止进程重新打开控制终端  </span></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);  <span class="comment">// 结束第一子进程，第二子进程继续（第二子进程不再是会话组长） </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5）关闭打开的文件描述符  </span></span><br><span class="line">    <span class="comment">// NOFILE 为 &lt;sys/param.h&gt; 的宏定义  </span></span><br><span class="line">    <span class="comment">// NOFILE 为文件描述符最大个数，不同系统有不同限制  </span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;NOFILE; ++i)&#123;</span><br><span class="line">        close(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6）改变当前工作目录  </span></span><br><span class="line">    chdir(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7）重设文件创建掩模  </span></span><br><span class="line">    umask(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8）处理 SIGCHLD 信号  </span></span><br><span class="line">    signal(SIGCHLD,SIG_IGN);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    init_daemon();</span><br><span class="line">    <span class="keyword">char</span> *msg = <span class="string">"I'm printlg process...\n"</span>;</span><br><span class="line">    <span class="keyword">int</span> msg_len = <span class="built_in">strlen</span>(msg);</span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">"/tmp/test_printlg.log"</span>, O_RDWR | O_CREAT | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"open /tmp/test_printlg.log fail.\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 每隔 3s 输出 msg 到 /tmp/test_printlg.log 文件中</span></span><br><span class="line">        write(fd, msg, msg_len);</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编译</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gcc -o test1 main.c </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./test1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ps axj | grep test1</span></span><br><span class="line"> PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND </span><br><span class="line">21591 31396 31395 31395 ?           -1 R        0   0:03 ./test1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看结果</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /tmp/test_printlg.log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 杀死守护进程</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo <span class="built_in">kill</span> -9 &lt;pid&gt;</span></span><br></pre></td></tr></table></figure><h1 id="守护进程开机自启动">守护进程开机自启动</h1><p>linux系统启动的顺序 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. BIOS</span><br><span class="line">2. MBR (boot loader)</span><br><span class="line">3. kernel loading</span><br><span class="line">4. init program</span><br><span class="line">5. initial script (/etc/rc.d/rc.sysinit)</span><br><span class="line">6. daemon start (/etc/rc.d/rc[0-6].d/*)</span><br><span class="line">7. local setting (/etc/rc.d/rc.local)</span><br></pre></td></tr></table></figure></p><p>每个系统启动级别的守护进程位置不一致，通常有以下位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/rc.d</span><br><span class="line">/etc/rc[N].d</span><br></pre></td></tr></table></figure><p>知道了守护进程的位置，就可以把 test1 放在 /etc/rc5.d/ 下，并且还要改名称，因为系统需要根据指定的名称来使用 for 循环来启动或者关闭每个程序，命名规则如下： 1. S[num][name]：启动守护进程name，例如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2. K[num][name]：禁止启动守护进程name，例如：```K01test1</span><br></pre></td></tr></table></figure></p><p>我们这里肯定要启动了，所以将 <figure class="highlight plain"><figcaption><span>命名为 ```S01test1```：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```shell</span><br><span class="line">mv test1 /etc/rc5.d/S01test1</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>minicat-manjaro-18.0.4-dev</title>
      <link href="/2019/07/24/Minicat-manjaro-18-0-4-dev/"/>
      <url>/2019/07/24/Minicat-manjaro-18-0-4-dev/</url>
      
        <content type="html"><![CDATA[<h1 id="添加中科大源">添加中科大源</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/pacman.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在文件末尾添加</span></span><br><span class="line">[archlinuxcn]</span><br><span class="line">SigLevel = Optional TrustedOnly</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch</span><br></pre></td></tr></table></figure><h1 id="导入gpg-key">导入GPG Key</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring</span></span><br></pre></td></tr></table></figure><h1 id="安装基本开发编译软件">安装基本开发编译软件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S --needed base-devel</span><br></pre></td></tr></table></figure><h1 id="安装git">安装git</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S git</span></span><br></pre></td></tr></table></figure><h1 id="安装chrome">安装chrome</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S google-chrome</span></span><br></pre></td></tr></table></figure><h1 id="安装搜狗拼音输入法">安装搜狗拼音输入法</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S fcitx-im <span class="comment">#默认全部安装</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S fcitx-configtool</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S fcitx-sogoupinyin</span></span><br></pre></td></tr></table></figure><h1 id="编辑输入法配置文件">编辑输入法配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nano ~/.xprofile</span></span><br><span class="line"></span><br><span class="line">export GTK_IM_MODULE=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br><span class="line">export XMODIFIERS="@im=fcitx"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启后输入法就可以正常使用。</span></span><br></pre></td></tr></table></figure><h1 id="安装vim">安装vim</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S vim</span></span><br></pre></td></tr></table></figure><p>安装vim基础配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl https://raw.githubusercontent.com/wklken/vim-for-server/master/vimrc &gt; ~/.vimrc</span></span><br></pre></td></tr></table></figure><h1 id="安装tmux和.tmux">安装tmux和.tmux</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S tmux</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/gpakosz/.tmux.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s -f .tmux/.tmux.conf</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp .tmux/.tmux.conf.local .</span></span><br></pre></td></tr></table></figure><h1 id="安装zsh和oh-my-zsh">安装zsh和oh-my-zsh</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S zsh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span></span><br></pre></td></tr></table></figure><h1 id="安装yaourt">安装yaourt</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S --needed base-devel git wget yajl</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /tmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/package-query.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> package-query/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si &amp;&amp; <span class="built_in">cd</span> /tmp/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/yaourt.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> yaourt/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si</span></span><br></pre></td></tr></table></figure><h1 id="安装shadowsocks">安装shadowsocks</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/shadowsocks-qt5-git.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> shadowsocks-qt5-git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> less PKGBUILD  <span class="comment"># 查看</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si  <span class="comment"># 安装</span></span></span><br></pre></td></tr></table></figure><h1 id="设置ssh连接不断开">设置ssh连接不断开</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim ~/.ssh/config</span></span><br><span class="line">Host *</span><br><span class="line">    ServerAliveInterval 60</span><br></pre></td></tr></table></figure><h1 id="安装jetbrain全家桶">安装jetbrain全家桶</h1><p><a href="http://idea.lanyus.com/" target="_blank" rel="noopener">jetbrain激活参考地址</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/hosts</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加以下两行代码</span></span><br><span class="line">0.0.0.0 account.jetbrains.com</span><br><span class="line">0.0.0.0 www.jetbrains.com</span><br></pre></td></tr></table></figure><h1 id="安装python开发环境">安装python开发环境</h1><a href="/2016/11/09/Python入门基础/" title="python开发环境">python开发环境</a><h1 id="安装rabbitmq">安装rabbitmq</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S rabbitmq rabbitmqadmin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> rabbitmq.service  <span class="comment"># 开机启动</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start rabbitmq.service  <span class="comment"># 启动</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management  <span class="comment"># 开启web界面</span></span></span><br></pre></td></tr></table></figure><h1 id="安装redis">安装redis</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo pacman -S redis</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> redis.service  <span class="comment"># 开机启动</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start redis.service  <span class="comment"># 启动</span></span></span><br></pre></td></tr></table></figure><p>设置密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/redis.conf</span></span><br><span class="line">redispassword password</span><br></pre></td></tr></table></figure><h1 id="安装node">安装node</h1><a href="/2019/07/26/Node入门基础/" title="python开发环境">python开发环境</a><h1 id="其他软件清单">其他软件清单</h1><blockquote><p>peek 录制gif软件</p></blockquote><blockquote><p>github desktop github客户端</p></blockquote><blockquote><p>postman</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> manjaro </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gtk+入门基础</title>
      <link href="/2019/07/24/Gtk+%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/07/24/Gtk+%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="gdk介绍">Gdk+介绍</h2><blockquote><p>Gtk+是c语言编写的用于开发图形界面程序的函数库。Gtk+来源于gimp（gnu image minipulation program），gtk+在gdk（gimp drawing kit）基础上创建，并进行封装。</p></blockquote><h2 id="linux安装">Linux安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http://ftp.gnome.org/pub/gnome/sources/gtk+/3.24/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://ftp.gnome.org/pub/gnome/sources/gtk+/3.24/gtk+-3.24.10.tar.xz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar xvfJ gtk+-3.24.10.tar.xz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/user/include/gtk3.24</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; sudo make install</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ldconfig</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置LD_LIBRARY_PATH</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> LD_LIBRARY_PATH=<span class="string">"/opt/gtk/lib"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> PATH=<span class="string">"/opt/gtk/bin:<span class="variable">$PATH</span>"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> LD_LIBRARY_PATH PATH</span></span><br></pre></td></tr></table></figure><h2 id="教程">教程</h2><h3 id="简单的空白窗口">简单的空白窗口</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    gtk_widget_show(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gcc -o main main.c `pkg-config --libs -cflags gtk+-3.0`</span></span><br></pre></td></tr></table></figure><ul><li><p>gtk_init (&amp;argc, &amp;argv); 所有 GTK应用程序都要调用该函数，而且必须在控件定义之前使用，它为我们设置一些缺省值( 例如视觉和颜色 )映射这个函数将函数库初始化，设置缺省的信号处理函数，并检查通过命令行传递给应用程序的参数，自动完成一些必要的初始化工作。</p></li><li><p>gtk_main()是在每个Gtk应用程序都要调用的函数。程序运行停在这里等待事件(如键盘事件或鼠标事件)的发生，等待用户来操作窗口</p></li><li><p>gtk_window_new()的功能创建一个窗口并返回这个窗口的控件指针。GTK_WINDOW_TOPLEVEL指明窗口的类型为最上层的主窗口，它最常用。接着创建一个GtkWidget <em>类型的window变量来接收。GtkWidget是GTK+控件类型，GtkWidget </em> 能指向任何控件的指针类型。</p></li><li><p>gtk_widget_show(window)；用来显示上一步创建的窗口控件。在这个简单例子里，所有事件都被忽略。用鼠标点击窗口右上角的“×”按钮也不能将窗口关闭。我们可以在终端敲 Ctrl + C 关闭程序。</p></li></ul><h3 id="控件">控件</h3><p>GTK中控件主要分为两类：容器控件，非容器控件。</p><p>容器控件：它可以容纳别的控件，我们可以理解为盒子，盒子拿来装东西。容器控件又分为两类，一类只能容纳一个控件，如窗口，按钮；另一类能容纳多个控件，如布局控件。</p><p>非容器控件：它不可以容纳别的控件，如标签、行编辑。</p><p>前面我们写的空白窗口是能容纳一个控件的控件，现在我们要做的是，给这个窗口添加一个按钮。</p><p>首先，我们需要创建一个按钮，然后需要把按钮添加到窗口，接着，显示按钮控件。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// gtk初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建一个顶层窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建一个button容器</span></span><br><span class="line">    GtkWidget *button = gtk_button_new_with_label(<span class="string">"hello gtk"</span>);</span><br><span class="line">    <span class="comment">// 将button放入窗口中，</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), button);</span><br><span class="line">    <span class="comment">// 显示button</span></span><br><span class="line">    gtk_widget_show(button);</span><br><span class="line">    <span class="comment">// 显示window</span></span><br><span class="line">    gtk_widget_show(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_container_add</span><span class="params">(GtkContainer *container, GtkWidget *widget)</span></span>;</span><br></pre></td></tr></table></figure><p>这里我们是把按钮添加到窗口容器里，widget为按钮指针(以上代码的button)，container为窗口指针(以上代码的window)，这里需要注意的是，我们创建的窗口(window)返回值为GtkWidget <em>类型，而gtk_container_add()的第一个参数为GtkContainer </em>类型，由于 GtkWidget *类型的变量为指向任何控件的万能指针，所以，在函数传参时，根据参数类型进行相应的转换，如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtk_container_add( (GtkContainer *)window, button);</span><br></pre></td></tr></table></figure><p>C语言里，我们常用这种方法转换。在GTK中，很多内部变量指针类型转换都定义了宏定义，如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GTK_CONTAINER(x) (GtkContainer *)(x)</span></span><br></pre></td></tr></table></figure><p>所以，我们还可以这么写：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtk_container_add(GTK_CONTAINER(window), button);</span><br></pre></td></tr></table></figure><p>那么，我们如何知道，哪个类型对应哪个宏定义呢？把要转换类型名字全部变为大写，同时，单词和单词之间以下划线“_”连接，然后，这个名字就是哪个宏定义的名字，如，(GtkButton *)x用宏定义的方法为 GTK_BUTTON(x)。</p><p>上面的代码，我们是按钮和窗口都得通过gtk_widget_show()显示出来：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gtk_widget_show(button);<span class="comment">// 显示按钮</span></span><br><span class="line">gtk_widget_show(window);<span class="comment">// 显示窗口</span></span><br></pre></td></tr></table></figure><p>但是，假如，窗口里有100个控件，还是这样一个一个地显示出来会比较麻烦，这时候，我们可以通过gtk_widget_show_all()显示所有的控件，里面需要传的是容纳控件的那个容器(这里为窗口)。这样，容器上的控件也会跟着显示。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtk_widget_show_all()</span><br></pre></td></tr></table></figure><h3 id="布局容器-水平布局">布局容器-水平布局</h3><p>如果我们希望窗口里多放添加几个控件，直接添加是不成功的，因为窗口只能容纳一个控件的容器。这时候，我们需要借助布局容器，我们先把布局容器添加到窗口里，然后再把所需要添加的控件放在布局容器里。</p><p>布局容器的主要分类：水平布局( GtkHBox)、垂直布局(GtkVBox )、表格布局(GtkTable)、固定布局(GtkFixed )。</p><p><strong>创建一个盒子布局</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// orientation参数: GTK_ORIENTATION_HORIZONTAL GTK_ORIENTATION_VERTICAL 两个可选值 spacing参数是单元格之间的间隙</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gtk_box_new</span><span class="params">(<span class="keyword">int</span> orientation, <span class="keyword">int</span> spacing)</span></span>;</span><br></pre></td></tr></table></figure><p>以下代码显示水平容器布局方式，垂直容器类似</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// gtk初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建一个顶层窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建水平容器</span></span><br><span class="line">    <span class="comment">// GtkWidget *hbox = gtk_hbox_new(TRUE, 10);  // gtk+2版本使用</span></span><br><span class="line">    GtkWidget *hbox = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, <span class="number">10</span>);  <span class="comment">// gtk+3版本使用</span></span><br><span class="line">    <span class="comment">// 将水平容器添加到窗口</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), hbox);</span><br><span class="line">    <span class="comment">// 创建一个button容器</span></span><br><span class="line">    GtkWidget *button1 = gtk_button_new_with_label(<span class="string">"button1"</span>);</span><br><span class="line">    <span class="comment">// 将button放入水平容器中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), button1);</span><br><span class="line">    <span class="comment">// 重复创建两个</span></span><br><span class="line">    GtkWidget *button2 = gtk_button_new_with_label(<span class="string">"button2"</span>);</span><br><span class="line">    GtkWidget *button3 = gtk_button_new_with_label(<span class="string">"button3"</span>);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), button2);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), button3);</span><br><span class="line">    <span class="comment">// 显示全部窗口</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="布局容器-表格布局">布局容器-表格布局</h3><p><strong>添加表格布局容器</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rows: 行数, coumns: 列数, homogeneous：容器内表格的大小是否相等, 返回值：表格布局容器指针</span></span><br><span class="line"><span class="function">GtkWidget *<span class="title">gtk_table_new</span><span class="params">(guint rows, guint columns, gboolean homogeneous)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>布局容器添加控件</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// table: 容纳控件的容器, widget: 要添加的控件, 后四个参数为控件摆放的坐标，规则如下：</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_table_attach_defaults</span><span class="params">(GtkTable *table, GtkWidget *widget, guint left_attach, guint right_attach, guint top_attach, guint bottom_attach)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/gtk%E8%A1%A8%E6%A0%BC%E5%B8%83%E5%B1%80%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// gtk初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建一个顶层窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建一个表格容器</span></span><br><span class="line">    GtkWidget *table = gtk_table_new(<span class="number">2</span>, <span class="number">2</span>, TRUE); <span class="comment">// gtk+2版本</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), table);</span><br><span class="line">    <span class="comment">// 创建button1， button2, button3</span></span><br><span class="line">    GtkWidget *button1 = gtk_button_new_with_label(<span class="string">"button1"</span>);</span><br><span class="line">    GtkWidget *button2 = gtk_button_new_with_label(<span class="string">"button2"</span>);</span><br><span class="line">    GtkWidget *button3 = gtk_button_new_with_label(<span class="string">"button3"</span>);</span><br><span class="line">    <span class="comment">// 将button放入table中</span></span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button1, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button2, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button3, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 显示所有窗口</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="布局容器-固定布局">布局容器-固定布局</h3><p>水平、垂直和表格布局容器，控件会跟着容器大小的变化进行自动适应，而固定布局容器里的控件则不会跟着变化( 则固定不变 )。</p><p><strong>固定布局的创建</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GtkWidget *<span class="title">gtk_fixed_new</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>添加控件</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fixed：容纳控件的容器, widget：要添加的控件, x, y：控件摆放位置的起点坐标</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_fixed_put</span><span class="params">(GtkFixed *fixed, GtkWidget *widget, gint x, gint y )</span></span>;</span><br></pre></td></tr></table></figure><p><strong>设置控件的大小( 宽和高 )</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// widget：需要设置的控件, width：宽度, height：高度</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_widget_set_size_request</span><span class="params">(GtkWidget *widget, gint width, gint height)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>移动固定布局里控件的位置</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fixed：固定布局容器, widget：需要移动的控件, x, y: 移动的位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_fixed_move</span><span class="params">(GtkFixed *fixed, GtkWidget *widget, gint x, gint y)</span></span>;</span><br></pre></td></tr></table></figure><p>示例代码 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// gtk初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建一个顶层窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建一个固定布局容器</span></span><br><span class="line">    GtkWidget *fixed = gtk_fixed_new();</span><br><span class="line">    <span class="comment">// 将fixed添加到window中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), fixed);</span><br><span class="line">    <span class="comment">// 创建button</span></span><br><span class="line">    GtkWidget *button1 = gtk_button_new_with_label(<span class="string">"button1"</span>);</span><br><span class="line">    GtkWidget *button2 = gtk_button_new_with_label(<span class="string">"button2"</span>);</span><br><span class="line">    <span class="comment">// 将button添加到fixed</span></span><br><span class="line">    gtk_fixed_put(GTK_FIXED(fixed), button1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gtk_fixed_put(GTK_FIXED(fixed), button2, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 移动button位置</span></span><br><span class="line">    gtk_fixed_move(GTK_FIXED(fixed), button2, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="comment">// 设置button大小</span></span><br><span class="line">    gtk_widget_set_size_request(button2, <span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">    <span class="comment">// 显示所有窗口</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="容器布局练习-计算器">容器布局练习-计算器</h3><p><strong>编辑控件( GtkEntry )</strong> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建</span></span><br><span class="line"><span class="function">GtkWidget * <span class="title">gtk_entry_new</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="comment">// 编辑</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_entry_set_text</span> <span class="params">(GtkEntry *entry,<span class="keyword">const</span> gchar *text)</span></span>;</span><br><span class="line"><span class="comment">// 设置行编辑是否允许编辑</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_editable_set_editable</span><span class="params">(GtkEditable *editable, gboolean is_editable)</span></span>;</span><br></pre></td></tr></table></figure></p><p>示例代码 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建5行4列的表格容器</span></span><br><span class="line">    GtkWidget *table = gtk_table_new(<span class="number">5</span>, <span class="number">4</span>, TRUE);</span><br><span class="line">    <span class="comment">// 将table放入到容器中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), table);</span><br><span class="line">    <span class="comment">// 创建一个行编辑</span></span><br><span class="line">    GtkWidget *entry = gtk_entry_new();</span><br><span class="line">    <span class="comment">// 设置行编辑的内容</span></span><br><span class="line">    gtk_entry_set_text(GTK_ENTRY(entry), <span class="string">"2+2=4"</span>);</span><br><span class="line">    <span class="comment">// 设置行编辑不允许编辑</span></span><br><span class="line">    gtk_editable_set_editable(GTK_EDITABLE(entry), FALSE);</span><br><span class="line">    <span class="comment">// 创建0-9数字按钮，+-×/=c功能按钮</span></span><br><span class="line">    GtkWidget *button_0 = gtk_button_new_with_label(<span class="string">"0"</span>);</span><br><span class="line">    GtkWidget *button_1 = gtk_button_new_with_label(<span class="string">"1"</span>);</span><br><span class="line">    GtkWidget *button_2 = gtk_button_new_with_label(<span class="string">"2"</span>);</span><br><span class="line">    GtkWidget *button_3 = gtk_button_new_with_label(<span class="string">"3"</span>);</span><br><span class="line">    GtkWidget *button_4 = gtk_button_new_with_label(<span class="string">"4"</span>);</span><br><span class="line">    GtkWidget *button_5 = gtk_button_new_with_label(<span class="string">"5"</span>);</span><br><span class="line">    GtkWidget *button_6 = gtk_button_new_with_label(<span class="string">"6"</span>);</span><br><span class="line">    GtkWidget *button_7 = gtk_button_new_with_label(<span class="string">"7"</span>);</span><br><span class="line">    GtkWidget *button_8 = gtk_button_new_with_label(<span class="string">"8"</span>);</span><br><span class="line">    GtkWidget *button_9 = gtk_button_new_with_label(<span class="string">"9"</span>);</span><br><span class="line">    GtkWidget *button_add = gtk_button_new_with_label(<span class="string">"+"</span>);</span><br><span class="line">    GtkWidget *button_minus = gtk_button_new_with_label(<span class="string">"-"</span>);</span><br><span class="line">    GtkWidget *button_mul = gtk_button_new_with_label(<span class="string">"*"</span>);</span><br><span class="line">    GtkWidget *button_div = gtk_button_new_with_label(<span class="string">"/"</span>);</span><br><span class="line">    GtkWidget *button_equal = gtk_button_new_with_label(<span class="string">"="</span>);</span><br><span class="line">    GtkWidget *button_delete = gtk_button_new_with_label(<span class="string">"c"</span>);</span><br><span class="line">    <span class="comment">// 将table放入表格布局中</span></span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), entry, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_0, <span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_1, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_2, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_3, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_4, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_5, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_6, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_7, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_8, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_9, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_add, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_minus, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_mul , <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_div, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_equal, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_delete, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    <span class="comment">// 循环</span></span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o main main.c `pkg-config --libs -cflags gtk+-3.0`</span><br></pre></td></tr></table></figure><p>运行结果 <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/gtk%E5%AE%B9%E5%99%A8%E5%B8%83%E5%B1%80-%E8%AE%A1%E7%AE%97%E5%99%A81.png"></p><h2 id="信号与回调函数">信号与回调函数</h2><blockquote><p>GTK采用了信号与回调函数来处理窗口外部传来的事件、消息或信号。当信号发生时，程序自动调用为信号连接的回调函数。</p></blockquote><blockquote><p>GTK中的“信号”实际上是一种软件中断。“中断”在我们生活中经常遇到，譬如，我正在房间里打游戏，突然送快递的来了，把正在玩游戏的我给“中断”了，我去签收快递( 处理中断 )，处理完成后，再继续玩我的游戏。GTK中的“信号”就是属于这么一种“中断”，当用户按下按钮的时候，就产生一个“中断”，相当于产生一个信号，接着就会处理这么一个“中断任务”(程序里体验为调用一个函数)。</p></blockquote><blockquote><p>“信号”在GTK中可以认为一种中断的标志，如按下按钮的标志为"pressed",释放按钮的标志为"released"，这些标志就相当于 C语言的关键字一样，我们使用的时候必须完全按照它的名字来写。需要注意的是，每个控件的信号标志不一定都一样，如按钮（GtkButton）里有"pressed"信号，窗口(GtkWindow)里就没这个信号，每个控件具体有哪个信号，应该查看帮助文档来确定。</p></blockquote><p><strong>按钮的常用信号：</strong></p><ul><li><p>"clicked" : 单击按钮时触发</p></li><li><p>"pressed" : 按下按钮时触发</p></li><li><p>"released" : 释放按钮时触发</p></li></ul><p><strong>信号注册函数</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instance：信号发出者，可以认为我们操作的控件，如按下按钮，这个就为按钮指针</span></span><br><span class="line"><span class="comment">// detailed_signal：信号标志，如"pressed"</span></span><br><span class="line"><span class="comment">// c_handler：回调函数的名称，需要用G_CALLBACK()进行转换</span></span><br><span class="line"><span class="comment">// data：给回调函数传的参数，gpointer 相当于C语言的 void *</span></span><br><span class="line"><span class="comment">// 返回值：注册函数的标志</span></span><br><span class="line"><span class="function">gulong <span class="title">g_signal_connect</span><span class="params">(gpointer instance, <span class="keyword">const</span> gchar *detailed_signal, GCallback c_handler, gpointer data)</span></span>;</span><br></pre></td></tr></table></figure><p>例如 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g_signal_connect(button, <span class="string">"pressed"</span>,G_CALLBACK(callback), <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></p><p>当按下button按钮时，就会自动调用回调函数callback(相当于处理中断任务)，回调函数callback可以是任意函数，函数名字我们根据需要自行命名，如果不是库函数，我们还得定义这个回调函数，这里需要注意的是，回调函数的写法(返回值，参数)，不是我们想怎么写就怎么写，帮助文档里已经规定好了回调函数应该如何写，如果不按规定来写，可能产生意想不到的错误。</p><p><a href="https://developer.gnome.org/gtk3/stable/GtkWidget.html" target="_blank" rel="noopener">文档地址</a> 回调函数的定义 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callback</span><span class="params">(GtkButton *button,gpointer data)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>示例 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deal_pressed</span><span class="params">(GtkButton *button, gpointer user_data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *text = gtk_button_get_label(button);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s----%s\n"</span>, (<span class="keyword">char</span> *) user_data, text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 设置窗口边框与内部控件的间隔为15</span></span><br><span class="line">    gtk_container_set_border_width(GTK_CONTAINER(window), <span class="number">15</span>);</span><br><span class="line">    <span class="comment">// 创建一个button</span></span><br><span class="line">    GtkWidget *button = gtk_button_new_with_label(<span class="string">"button1"</span>);</span><br><span class="line">    <span class="comment">// 将button添加到window中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), button);</span><br><span class="line">    <span class="comment">// 创建一个按钮信号</span></span><br><span class="line">    g_signal_connect(button, <span class="string">"pressed"</span>, G_CALLBACK(deal_pressed), <span class="string">"hello, world"</span>);</span><br><span class="line">    <span class="comment">// 显示控件</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="完成计算器计算功能">完成计算器计算功能</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">50</span>] = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deal_num</span><span class="params">(GtkButton *button, gpointer data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *text = gtk_button_get_label(button);</span><br><span class="line">    <span class="comment">// 如果是退格键</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(<span class="string">"c"</span>, text)) &#123;</span><br><span class="line">        buf[<span class="built_in">strlen</span>(buf) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="comment">// 连接buf和新传入的字符串</span></span><br><span class="line">        <span class="built_in">strcat</span>(buf, text);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == <span class="built_in">strcmp</span>(<span class="string">"="</span>, text)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"text=====##%s##\n"</span>, text);</span><br><span class="line">            <span class="comment">// 从一个字符串中读进与指定格式相符的数据</span></span><br><span class="line">            <span class="built_in">sscanf</span>(buf, <span class="string">"%d%c%d"</span>, &amp;a, &amp;c, &amp;b);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"---------001-----%c--\n"</span>, c);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">'+'</span> == c) &#123;</span><br><span class="line">                <span class="built_in">sprintf</span>(buf, <span class="string">"%d"</span>, a + b);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'-'</span> == c) &#123;</span><br><span class="line">                <span class="built_in">sprintf</span>(buf, <span class="string">"%d"</span>, a - b);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'*'</span> == c) &#123;</span><br><span class="line">                <span class="built_in">sprintf</span>(buf, <span class="string">"%d"</span>, a * b);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'/'</span> == c) &#123;</span><br><span class="line">                <span class="built_in">sprintf</span>(buf, <span class="string">"%d"</span>, a / b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    gtk_entry_set_text(GTK_ENTRY(data), buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建5行4列的表格容器</span></span><br><span class="line">    GtkWidget *table = gtk_table_new(<span class="number">5</span>, <span class="number">4</span>, TRUE);</span><br><span class="line">    <span class="comment">// 将table放入到容器中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), table);</span><br><span class="line">    <span class="comment">// 创建一个行编辑</span></span><br><span class="line">    GtkWidget *entry = gtk_entry_new();</span><br><span class="line">    <span class="comment">// 设置行编辑的内容</span></span><br><span class="line">    gtk_entry_set_text(GTK_ENTRY(entry), <span class="string">"2+2=4"</span>);</span><br><span class="line">    <span class="comment">// 设置行编辑不允许编辑</span></span><br><span class="line">    gtk_editable_set_editable(GTK_EDITABLE(entry), FALSE);</span><br><span class="line">    <span class="comment">// 创建0-9数字按钮，+-×/=c功能按钮</span></span><br><span class="line">    GtkWidget *button_0 = gtk_button_new_with_label(<span class="string">"0"</span>);</span><br><span class="line">    GtkWidget *button_1 = gtk_button_new_with_label(<span class="string">"1"</span>);</span><br><span class="line">    GtkWidget *button_2 = gtk_button_new_with_label(<span class="string">"2"</span>);</span><br><span class="line">    GtkWidget *button_3 = gtk_button_new_with_label(<span class="string">"3"</span>);</span><br><span class="line">    GtkWidget *button_4 = gtk_button_new_with_label(<span class="string">"4"</span>);</span><br><span class="line">    GtkWidget *button_5 = gtk_button_new_with_label(<span class="string">"5"</span>);</span><br><span class="line">    GtkWidget *button_6 = gtk_button_new_with_label(<span class="string">"6"</span>);</span><br><span class="line">    GtkWidget *button_7 = gtk_button_new_with_label(<span class="string">"7"</span>);</span><br><span class="line">    GtkWidget *button_8 = gtk_button_new_with_label(<span class="string">"8"</span>);</span><br><span class="line">    GtkWidget *button_9 = gtk_button_new_with_label(<span class="string">"9"</span>);</span><br><span class="line">    GtkWidget *button_add = gtk_button_new_with_label(<span class="string">"+"</span>);</span><br><span class="line">    GtkWidget *button_minus = gtk_button_new_with_label(<span class="string">"-"</span>);</span><br><span class="line">    GtkWidget *button_mul = gtk_button_new_with_label(<span class="string">"*"</span>);</span><br><span class="line">    GtkWidget *button_div = gtk_button_new_with_label(<span class="string">"/"</span>);</span><br><span class="line">    GtkWidget *button_equal = gtk_button_new_with_label(<span class="string">"="</span>);</span><br><span class="line">    GtkWidget *button_delete = gtk_button_new_with_label(<span class="string">"c"</span>);</span><br><span class="line">    <span class="comment">// 将table放入表格布局中</span></span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), entry, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_0, <span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_1, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_2, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_3, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_4, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_5, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_6, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_7, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_8, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_9, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_add, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_minus, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_mul, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_div, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_equal, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    gtk_table_attach_defaults(GTK_TABLE(table), button_delete, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.注册信号函数，把entry传给回调函数deal_num()</span></span><br><span class="line">    g_signal_connect(button_0, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_1, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_2, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_3, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_4, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_5, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_6, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_7, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_8, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_9, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line"></span><br><span class="line">    g_signal_connect(button_add, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_mul, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_div, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_minus, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line">    g_signal_connect(button_equal, <span class="string">"pressed"</span>, G_CALLBACK(deal_num), entry);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    <span class="comment">// 循环</span></span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果(并不完美) <img src="https://zhuohc-com.oss-cn-hangzhou.aliyuncs.com/gtk-%E8%AE%A1%E7%AE%97%E5%99%A8.gif"></p><h3 id="glade">Glade</h3><blockquote><p>Glade是GTK＋的界面辅助设计工具，可以通过拖放控件的方式快速设计出用户界面，这样的优势在于在设计的同时能直观地看到界面上的控件，并且可以随时调整界面上的设计。</p></blockquote><blockquote><p>用glade设计的图形用户界面是以XML格式的文件保存，它描述了控件的结构、每个控件的属性。用户可以动态加载这个界面文件。而且，界面和程序逻辑是完全分离，用户修改了界面，也不需要重新编译程序。</p></blockquote><p><strong>安装</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ubuntu </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install glade libglade2-dev</span></span><br></pre></td></tr></table></figure></p><p><strong>Glade文件</strong> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Generated with glade 3.22.1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interface</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">requires</span> <span class="attr">lib</span>=<span class="string">"gtk+"</span> <span class="attr">version</span>=<span class="string">"3.20"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">"GtkWindow"</span> <span class="attr">id</span>=<span class="string">"window1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>window1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"can_focus"</span>&gt;</span>False<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">translatable</span>=<span class="string">"yes"</span>&gt;</span>第一个顶层窗口<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">type</span>=<span class="string">"titlebar"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">placeholder</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">"GtkLayout"</span> <span class="attr">id</span>=<span class="string">"layout1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>layout1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"visible"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"can_focus"</span>&gt;</span>False<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">"GtkEntry"</span> <span class="attr">id</span>=<span class="string">"entry1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>search_input<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"width_request"</span>&gt;</span>200<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"height_request"</span>&gt;</span>40<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"visible"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"can_focus"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">translatable</span>=<span class="string">"yes"</span>&gt;</span>search_input<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"primary_icon_tooltip_text"</span> <span class="attr">translatable</span>=<span class="string">"yes"</span>&gt;</span>search_input<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">packing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"x"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"y"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">packing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">"GtkButton"</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"label"</span> <span class="attr">translatable</span>=<span class="string">"yes"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>search_button<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"width_request"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"height_request"</span>&gt;</span>40<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"visible"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"can_focus"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receives_default"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">packing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"x"</span>&gt;</span>220<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"y"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">packing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">"GtkButton"</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"label"</span> <span class="attr">translatable</span>=<span class="string">"yes"</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>show_button<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"width_request"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"height_request"</span>&gt;</span>40<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"visible"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"can_focus"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receives_default"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">packing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"x"</span>&gt;</span>350<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"y"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">packing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建GtkBuilder对象</span></span><br><span class="line">    GtkBuilder *builder = gtk_builder_new();</span><br><span class="line">    <span class="comment">// 读取glade文件</span></span><br><span class="line">    <span class="keyword">if</span>(!gtk_builder_add_from_file(builder, <span class="string">"../1.glade"</span>, <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"无法打开文件"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取窗口指针</span></span><br><span class="line">    GtkWidget *window1 = GTK_WIDGET(gtk_builder_get_object(builder, <span class="string">"window1"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    gtk_widget_show_all(window1);</span><br><span class="line">    <span class="comment">// 循环</span></span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="图片控件">图片控件</h3><p>图片控件的创建：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filename：图片的名字，带路径的话需要加上路径( 相对或绝对 )</span></span><br><span class="line"><span class="function">GtkWidget *<span class="title">gtk_image_new_from_file</span><span class="params">( <span class="keyword">const</span> gchar *filename )</span></span>;</span><br></pre></td></tr></table></figure><p>通过上面方法创建的图片控件，以图片默认大小来显示，不能修改其大小。如果要改变图片的大小，我们要借助图片资源对象GdkPixbuf，需要注意的是，GdkPixbuf不属于控件类，它以 Gdk 开头。</p><p>图片资源对象pixbuf的创建：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filename：图片的名字，带路径的话需要加上路径( 相对或绝对 )</span></span><br><span class="line"><span class="comment">// error：储存错误的指针</span></span><br><span class="line"><span class="comment">// 返回值：pixbuf指针</span></span><br><span class="line"><span class="function">GdkPixbuf *<span class="title">gdk_pixbuf_new_from_file</span><span class="params">(<span class="keyword">const</span> gchar *filename, GError **error)</span></span>;</span><br></pre></td></tr></table></figure><p>设置图片的大小：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src：gdk_pixbuf_new_from_file()的返回值</span></span><br><span class="line"><span class="comment">// dest_width：图片的宽度</span></span><br><span class="line"><span class="comment">// dest_height：图片的高度</span></span><br><span class="line"><span class="comment">// interp_type：是一个枚举变量，标志图片的加载速度和质量，常用GDK_INTERP_BILINEAR</span></span><br><span class="line"><span class="comment">// 返回值：指定大小好的pixbuf指针</span></span><br><span class="line"><span class="function">GdkPixbuf *<span class="title">gdk_pixbuf_scale_simple</span><span class="params">(<span class="keyword">const</span> GdkPixbuf *src, <span class="keyword">int</span> dest_width, <span class="keyword">int</span> dest_height, GdkInterpType interp_type)</span></span>;</span><br></pre></td></tr></table></figure><p>通过gdk_pixbuf_new_from_file(), gdk_pixbuf_scale_simple()创建的pixbuf，它会动态分配空间，占用资源，用完后，需要人为释放资源。</p><p>释放资源：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g_object_unref</span><span class="params">(GtkObject *object)</span></span>;</span><br></pre></td></tr></table></figure><p>通过pixbuf来创建图片控件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pixbuf：指定好大小的pixbuf</span></span><br><span class="line"><span class="comment">// 返回值：图片控件指针</span></span><br><span class="line"><span class="function">GtkWidget *<span class="title">gtk_image_new_from_pixbuf</span><span class="params">(GdkPixbuf *pixbuf )</span></span>;</span><br></pre></td></tr></table></figure><p>图片控件重新设置一张图片(pixbuf)：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// image：图片控件指针</span></span><br><span class="line"><span class="comment">// pixbuf：指定好大小的pixbuf</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_image_set_from_pixbuf</span><span class="params">(GtkImage *image, GdkPixbuf *pixbuf )</span></span>;</span><br></pre></td></tr></table></figure><p>示例代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line">    <span class="comment">// 创建一个window</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">// 创建水平容器</span></span><br><span class="line">    GtkWidget *hbox = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 添加到window</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), hbox);</span><br><span class="line">    <span class="comment">// 创建图片控件</span></span><br><span class="line">    GtkWidget *image1 = gtk_image_new_from_file(<span class="string">"../img/1.png"</span>);</span><br><span class="line">    <span class="comment">// 将image添加到box</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), image1);</span><br><span class="line">    <span class="comment">// 创建pixbuf</span></span><br><span class="line">    GdkPixbuf *src = gdk_pixbuf_new_from_file(<span class="string">"../img/1.png"</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">// 修改图片大小</span></span><br><span class="line">    GdkPixbuf *dst = gdk_pixbuf_scale_simple(src, <span class="number">100</span>, <span class="number">100</span>, GDK_INTERP_BILINEAR);</span><br><span class="line">    GtkWidget *image2 = gtk_image_new_from_pixbuf(dst);</span><br><span class="line">    <span class="comment">// 释放pxibuf资源</span></span><br><span class="line">    g_object_unref(src);</span><br><span class="line">    g_object_unref(dst);</span><br><span class="line">    <span class="comment">// 将image2添加到box</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), image2);</span><br><span class="line">    <span class="comment">// 获取控件里的pixbuf</span></span><br><span class="line">    GdkPixbuf *tmp = gtk_image_get_pixbuf(GTK_IMAGE(image2));</span><br><span class="line">    GtkWidget *image3 = gtk_image_new_from_pixbuf(tmp);</span><br><span class="line">    g_object_unref(tmp);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), image3);</span><br><span class="line">    <span class="comment">// 给创建的图片控件重新设置图片</span></span><br><span class="line">    GtkWidget *image4 = gtk_image_new_from_file(<span class="string">"../img/1.png"</span>);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(hbox), image4);</span><br><span class="line">    src = gdk_pixbuf_new_from_file(<span class="string">"../img/2.png"</span>, <span class="literal">NULL</span>);</span><br><span class="line">    dst = gdk_pixbuf_scale_simple(src, <span class="number">200</span>, <span class="number">200</span>, GDK_INTERP_BILINEAR);</span><br><span class="line">    gtk_image_set_from_pixbuf(GTK_IMAGE(image4), dst);</span><br><span class="line">    g_object_unref(src);</span><br><span class="line">    g_object_unref(dst);</span><br><span class="line">    <span class="comment">// 显示所有控件</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line">    <span class="comment">// 循环</span></span><br><span class="line">    gtk_main();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="进度条控件">进度条控件</h3><p><a href="https://developer.gnome.org/gtk3/stable/GtkProgressBar.html#gtk-progress-bar-get-fraction" target="_blank" rel="noopener">文档</a></p><p>进度条的创建</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回值：进度条指针</span></span><br><span class="line"><span class="function">GtkWidget *<span class="title">gtk_progress_bar_new</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><p>设置进度条显示的进度比例</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pbar：需要操作的进度条</span></span><br><span class="line"><span class="comment">// fraction：0.0到1.0</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_progress_bar_set_fraction</span><span class="params">(GtkProgressBar *pbar, gdouble fraction)</span></span>;</span><br></pre></td></tr></table></figure><p>获取进度条显示的进度比例</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pbar：需要操作的进度条</span></span><br><span class="line"><span class="comment">// 返回值：进度比例</span></span><br><span class="line"><span class="function">gdouble  <span class="title">gtk_progress_bar_get_fraction</span> <span class="params">(GtkProgressBar *pbar)</span></span>;</span><br></pre></td></tr></table></figure><p>设置滑槽上的文本显示</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pbar：需要操作的进度条</span></span><br><span class="line"><span class="comment">// text：设置的文本内容</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_progress_bar_set_text</span><span class="params">(GtkProgressBar *pbar, gchar *text)</span></span>;</span><br></pre></td></tr></table></figure><p>设置进度条的移动方向gtk+-2版本</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pbar：需要操作的进度条</span></span><br><span class="line"><span class="comment">// orientation：移动方向，它是一个枚举变量</span></span><br><span class="line"><span class="comment">// GTK_PROGRESS_LEFT_TO_RIGHT：从左向右 </span></span><br><span class="line"><span class="comment">// GTK_PROGRESS_RIGHT_TO_LEFT：从右向左 </span></span><br><span class="line"><span class="comment">// GTK_PROGRESS_BOTTOM_TO_TOP：从下向上 </span></span><br><span class="line"><span class="comment">// GTK_PROGRESS_TOP_TO_BOTTOM：从上向下</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_progress_bar_set_orientation</span><span class="params">(GtkProgressBar *pbar, GtkProgressBarOrientation orientation)</span></span>;</span><br></pre></td></tr></table></figure><p>获取进度条的方向gtk+-2版本</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pbar：需要操作的进度条</span></span><br><span class="line"><span class="comment">// 返回值：进度条的方向，它是一个枚举类型</span></span><br><span class="line">GtkProgressBarOrientationgtk_progress_bar_get_orientation(GtkProgressBar *pbar);</span><br></pre></td></tr></table></figure><p>设置进度条的移动方向gtk+-3版本</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gtk_progress_bar_set_inverted</span> <span class="params">(GtkProgressBar *pbar, gboolean inverted)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">gboolean <span class="title">gtk_progress_bar_get_inverted</span> <span class="params">(GtkProgressBar *pbar)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtk/gtk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//回调函数，切换进度条的移动方向</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">toggle_orientation</span><span class="params">(GtkWidget *widget, gpointer data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (gtk_progress_bar_get_inverted(GTK_PROGRESS_BAR(data)) ) &#123;</span><br><span class="line">        <span class="keyword">case</span> TRUE:</span><br><span class="line">            gtk_progress_bar_set_inverted(GTK_PROGRESS_BAR(data), FALSE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> FALSE:</span><br><span class="line">            gtk_progress_bar_set_inverted(GTK_PROGRESS_BAR(data), TRUE);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//回调函数，更新进度条，这样可以看到进度条的移动</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callback</span><span class="params">(GtkWidget *widget, gpointer data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gdouble new_val = gtk_progress_bar_get_fraction(GTK_PROGRESS_BAR(data)) +<span class="number">0.05</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (new_val &gt; <span class="number">1.0</span>) &#123;</span><br><span class="line">        new_val = <span class="number">0.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置进度条新值</span></span><br><span class="line">    gtk_progress_bar_set_fraction(GTK_PROGRESS_BAR(data), new_val);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.gtk环境的初始化</span></span><br><span class="line">    gtk_init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.创建一个窗口</span></span><br><span class="line">    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);</span><br><span class="line">    <span class="comment">//设置窗口的标题</span></span><br><span class="line">    gtk_window_set_title(GTK_WINDOW(window), <span class="string">"gtk_progress_bar"</span>);</span><br><span class="line">    <span class="comment">//设置窗口边框宽度</span></span><br><span class="line">    gtk_container_set_border_width(GTK_CONTAINER(window), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置窗口的最小大小</span></span><br><span class="line">    gtk_widget_set_size_request(window, <span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.窗口关联destroy信号到gtk_main_quit</span></span><br><span class="line">    g_signal_connect(window, <span class="string">"destroy"</span>, G_CALLBACK(gtk_main_quit), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.创建一个垂直容器</span></span><br><span class="line">    GtkWidget *vbox = gtk_box_new(GTK_ORIENTATION_VERTICAL, <span class="number">5</span>);</span><br><span class="line">    <span class="comment">//将vbox添加到window中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(window), vbox);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.创建一个进度条</span></span><br><span class="line">    GtkWidget *progress = gtk_progress_bar_new();</span><br><span class="line">    <span class="comment">//将progress添加到vbox中</span></span><br><span class="line">    gtk_container_add(GTK_CONTAINER(vbox), progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.设置进度条的百分比为50%</span></span><br><span class="line">    gtk_progress_bar_set_fraction(GTK_PROGRESS_BAR(progress), <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8.设置进度条上显示的文字</span></span><br><span class="line">    gtk_progress_bar_set_text(GTK_PROGRESS_BAR(progress), <span class="string">"some text"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//9.添加一个button1按钮,切换方向</span></span><br><span class="line">    GtkWidget *button1 = gtk_button_new_with_label(<span class="string">"right to lift"</span>);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(vbox), button1);</span><br><span class="line">    g_signal_connect(button1, <span class="string">"clicked"</span>, G_CALLBACK(    toggle_orientation   ), progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//10.添加一个button2，移动进度条</span></span><br><span class="line">    GtkWidget *button2 = gtk_button_new_with_label(<span class="string">"add"</span>);</span><br><span class="line">    gtk_container_add(GTK_CONTAINER(vbox), button2);</span><br><span class="line">    g_signal_connect(button2, <span class="string">"clicked"</span>, G_CALLBACK(callback), progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//11.显示所欲窗口</span></span><br><span class="line">    gtk_widget_show_all(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//12.主事件循环</span></span><br><span class="line">    gtk_main();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Gtk+ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ffmpeg入门基础</title>
      <link href="/2019/07/24/Ffmpeg%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/07/24/Ffmpeg%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="ffmpeg基本流程">Ffmpeg基本流程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件-&gt;音视频流: demuxer解封装</span><br><span class="line">音视频流-&gt;数据包: decoder解码</span><br><span class="line">数据包-&gt;音视频流: encoder编码</span><br><span class="line">音视频流-&gt;文件: muxer封装</span><br></pre></td></tr></table></figure><h2 id="ffmpeg基本定义">Ffmpeg基本定义</h2><ol type="1"><li>文件：也叫容器Container，比如mp4文件、flv文件等，容器的类型决定了信息被存放在文件中的位置。</li><li>音视频流：</li></ol><h2 id="ffmpeg录制">Ffmpeg录制</h2><h3 id="录制设备查询">录制设备查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">➜  $ ffmpeg -hide_banner -devices</span><br><span class="line">Devices:</span><br><span class="line"> D. = Demuxing supported</span><br><span class="line"> .E = Muxing supported</span><br><span class="line"> --</span><br><span class="line"> DE alsa            ALSA audio output</span><br><span class="line"> DE fbdev           Linux framebuffer</span><br><span class="line"> D  iec61883        libiec61883 (new DV1394) A/V input device</span><br><span class="line"> D  jack            JACK Audio Connection Kit</span><br><span class="line"> D  kmsgrab         KMS screen capture</span><br><span class="line"> D  lavfi           Libavfilter virtual input device</span><br><span class="line"> DE oss             OSS (Open Sound System) playback</span><br><span class="line"> DE pulse           Pulse audio output</span><br><span class="line">  E sdl,sdl2        SDL2 output device</span><br><span class="line"> DE video4linux2,v4l2 Video4Linux2 output device</span><br><span class="line"> D  x11grab         X11 screen capture, using XCB</span><br><span class="line">  E xv              XV (XVideo) output device</span><br></pre></td></tr></table></figure><ul><li>D：输入设备</li><li>E：输出设备</li></ul><p><a href="https://ffmpeg.org/ffmpeg-devices.html#Input-Devices" target="_blank" rel="noopener">ffmpeg输入设备列表</a></p><p><em><font color="#2bbc8a">ALSA</font></em>是Advanced Linux Sound Architecture的缩写，高级Linux声音架构的简称,它在Linux操作系统上提供了音频和MIDI（Musical Instrument Digital Interface，音乐设备数字化接口）的支持，需要安装libasound库</p><p><em><font color="#2bbc8a">android_camera</font></em>Android相机输入设备。 此输入设备使用Android Camera2 NDK API，该API可在API级别为24+的设备上使用。在配置期间自动检测android_camera的可用性。 该设备允许从Android设备上的所有摄像头进行捕获，这些摄像头集成在Camera2 NDK API中。 可用的摄像机在内部枚举，可以使用camera_index参数进行选择。输入文件字符串被丢弃。 通常，后置摄像头的索引为0，而前置摄像头的索引为1。</p><p><em><font color="#2bbc8a">avfoundation</font></em>音视频 苹果设备</p><p><em><font color="#2bbc8a">bktr</font></em> BSD 视频输入设备</p><p><em><font color="#2bbc8a">decklink</font></em> BlackMagic Decklink是一款影像采集编辑产品，接口类型PCI-33/66、PCI-X 133&amp;100MHz 。</p><p><em><font color="#2bbc8a">dshow</font></em> Windows DirectShow input device.</p><p><em><font color="#2bbc8a">fbdev</font></em> Linux framebuffer（Linux帧缓冲）输入设备，只能录制终端的视频 Linux framebuffer是一种独立于硬件的图像抽象层，它用于在计算机屏幕上显示图像,通常是在控制台（环境）。它可以通过一个文件设备节点访问，通常为：<code>/dev/fb0</code></p><p><em><font color="#2bbc8a">gdigrab</font></em> Win32 GDI 屏幕截取设备, 这个设备允许你截取显示在Windows（系统）上的屏幕区域。</p><p><em><font color="#2bbc8a">iec61883</font></em> 使用<code>iec61883</code>的FireWire（火线） DV/HDV输入设备。 要允许这个输入设备，需要<code>libiec61883</code>, <code>libraw1394</code> 和 <code>libavc1394</code>被安装到系统中。此外还要在编译时配置<code>--enable-libiec61883</code>以支持。</p><p><em><font color="#2bbc8a">jack</font></em> JACK输入设备。为了能使用JACK设备，需要系统上存在<code>libjack</code></p><p><em><font color="#2bbc8a">kmsgrab</font></em></p><p><em><font color="#2bbc8a">lavfi</font></em> <code>Libavfilter</code>输入虚拟设备, 这个输入设备可以从<code>libavfilter</code>滤镜链图的一个开放输出端口读取数据。 对于每个滤镜链图开放输出端口，这个输入设备将创建一个对应的流映射到这个端口进行输出。当前只支持视频数据。滤镜链图是通过选项<code>graph</code>描述的。</p><p><em><font color="#2bbc8a">libcdio</font></em> 基于<code>libcdio</code>的音乐CD输入设备。需要系统中有<code>libcdio</code>才能启用，且编译时需要用<code>--enable-libcdio</code>配置选项允许。</p><p><em><font color="#2bbc8a">libdc1394</font></em> IIDC1394输入设备，其基于<code>libdc1394</code>和<code>libraw1394</code>, 编译允许需要配置<code>--enable-libdc1394</code></p><p><em><font color="#2bbc8a">openal</font></em> 这个OpenAL输入设备支持在所有实现了<code>OpenAL 1.1</code>的系统上进行音频捕获。 要编译使用它需要系统包含<code>OpenAL</code>头和<code>libraries</code>库，并且设置编译选项<code>--enable-openal</code></p><p><em><font color="#2bbc8a">oss</font></em></p><p><em><font color="#2bbc8a">pulse</font></em> PulseAudio（脉冲音频）输入设备, 要使用须编译配置设置<code>--enable-libpulse</code></p><p><em><font color="#2bbc8a">sndio</font></em> sndio输入设备。要使用它需要系统安装并配置有<code>libsndio</code>库</p><p><em><font color="#2bbc8a">video4linux2, v4l2</font></em> Video4Linux2 输入视频设备, "v4l2"是"video4linux2"的别名 编译需要<code>v4l-utiles</code>支持（<code>--enable-libv4l2</code>编译选项被配置），也可用于<code>-use_libv4l2</code>输入设备选项。 捕获的设备名是一个文件设备节点，通常Linux系统在设备（例如USB摄像头）插入到系统时自动创建这样的节点，会被命名为<code>/dev/videoN</code>，<code>N</code>是设备索引序号 Video4Linux设备通常只支持有限的分辨率（<code>width x height</code>）和帧率,通过<code>-list_formats all</code>选项来获取支持情况。一些设备，例如电视卡可以支持1个或者多个标准，它支持的标准可以通过<code>-list_standards all</code>来了解。 时间戳时基单位为1microsecond。根据内核版本和配置，时间戳可以基于实时间（real time clock——绝对时间，一种起源于Unix的表示方式）或者单调时钟（monotonic clock——通常源自启动时间，不受NTP或者手动改变）。<code>-timestamps abs</code>或者<code>-ts abs</code>选择启用实时间。</p><p><em><font color="#2bbc8a">vfwcap</font></em> vfw（Video for Windows）捕获输入端 文件名必须是捕获设备索引，范围0-9可以用<code>list</code>作为文件名，将输出一个设备列表。任何数字外其它文件名被视作设备索引0。</p><p><em><font color="#2bbc8a">x11grab</font></em> X11 视频输入设备, 使用需要<code>libxcb</code>库，它会在编译时自动检测。</p><h3 id="fbdev">fbdev</h3><p><em>linux终端录制设备</em></p><p>查看使用指定采集设备参数 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -hide_banner -h demuxer=fbdev</span></span><br><span class="line">Demuxer fbdev [Linux framebuffer]:</span><br><span class="line">fbdev indev AVOptions:</span><br><span class="line">  -framerate         &lt;video_rate&gt; .D.......  (default "25")</span><br><span class="line"><span class="meta">#</span><span class="bash"> framerate 帧数 默认25帧</span></span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ffmpeg -framerate 30  -f fbdev -i /dev/fb0 output.mp4</span></span><br></pre></td></tr></table></figure><h3 id="v412">v412</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -hide_banner -h demuxer=Video4Linux2</span></span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr class="odd"><td>-standard</td><td>字符串</td><td>设置tv标准</td></tr><tr class="even"><td>-channel</td><td>整数</td><td>设置tv通道</td></tr><tr class="odd"><td>-video_size</td><td>图像大小</td><td>设置采集视频频帧大小</td></tr><tr class="even"><td>-pixel_format</td><td>字符串</td><td>设置采集视频的分辨率</td></tr><tr class="odd"><td>-input_format</td><td>字符串</td><td>设置采集视频的分辨率</td></tr><tr class="even"><td>-framerate</td><td>字符串</td><td>设置采集视频帧率</td></tr><tr class="odd"><td>-list_formats</td><td>整数</td><td>列举输入视频信号的信息</td></tr><tr class="even"><td>-list_standards</td><td>整数</td><td>列举标准信息</td></tr><tr class="odd"><td>-timestamps</td><td>整数</td><td>设置时间戳</td></tr><tr class="even"><td>-ts</td><td>整数</td><td>设置模拟器分析帧使用的时间戳</td></tr><tr class="odd"><td>-use_libv4l2</td><td>布尔</td><td>使用第三方库libv412选项</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -hide_banner -f Video4Linux2 -list_formats all -i /dev/video0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /dev/video0根据自己的摄像头来设置</span></span><br></pre></td></tr></table></figure><h3 id="x11grab">x11grab</h3><p><em>linux桌面录制设备</em></p><p><a href="https://trac.ffmpeg.org/wiki/Capture/Desktop" target="_blank" rel="noopener">桌面录制方法</a></p><p>linux环境下如果此方法报错 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cannot open display :0.0, error 1.</span><br><span class="line">:0.0: Input/output error</span><br></pre></td></tr></table></figure></p><p>则需要查看$DISPLAY， 在Linux/Unix类操作系统上, DISPLAY用来设置将图形显示到何处. 直接登陆图形界面或者登陆命令行界面后使用startx启动图形, DISPLAY环境变量将自动设置为:0:0 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$DISPLAY</span></span></span><br><span class="line">:1</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -video_size 1024x768 -framerate 25 -f x11grab -i :1+100,200 output.mp4</span></span><br></pre></td></tr></table></figure><ul><li>video_size 字符串 输入采集视频的分辨率</li><li>framerate 字符串 输入采集的视频帧率</li><li>-f 指定输入设备</li><li>-i 指定输入内容（此处为显示器）+100, 200 代表从100, 200处位移</li></ul><p>使用pulse录制音频 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pactl list sources  <span class="comment"># 查看全部输入设备</span></span></span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f pulse -i default pulse.wav</span></span><br></pre></td></tr></table></figure><p>同时录制视频和音频 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -video_size 1366x768 -framerate 25 -f x11grab -i :1 -f pulse -ac 2 -i 1 output.mkv</span></span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -video_size 1024x768 -framerate 25 -f x11grab -i :1+100,200 -f alsa -ac 2 -i hw:0 output.mkv</span></span><br></pre></td></tr></table></figure><h2 id="ffmpeg直播">Ffmpeg直播</h2><h3 id="推流">推流</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -re -i out.mp4 -c copy -f flv rtmp://server/live/streamName</span></span><br></pre></td></tr></table></figure><ul><li>-re 保持本地视频和流媒体服务器帧率一致</li><li>-c 不做操作，直接复制</li><li>-f 格式</li></ul><h3 id="拉流">拉流</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i rmtp://server/live/streamName -c copy dump.flv</span></span><br></pre></td></tr></table></figure><h2 id="ffmpeg封装与解封装">Ffmpeg封装与解封装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i input.mkv -vcodec copy -acodec copy output.mp4</span></span><br></pre></td></tr></table></figure><ul><li>-i 输入文件</li><li>-vcodec copy 视频编码处理方式</li><li>-acodec copy 音频编码处理方式</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i input.mp4 -vn -acodec copy output.aac  <span class="comment"># 抽出音频</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i input.mp4 -vcodec copy -an output.h264  <span class="comment"># 抽出视频</span></span></span><br></pre></td></tr></table></figure><h3 id="提取yuv数据">提取YUV数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i input.mp4 -an -c:v rawvideo -pix_fmt yuv420p out.yuv</span></span><br></pre></td></tr></table></figure><ul><li>-i 输入设备</li><li>-an 不需要音频</li><li>-c:v 使用rawvideo对视频进行编码</li><li>-pix_fmt 像素格式</li></ul><p><em>播放源文件</em> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffplay -video_size 1366x768 out.yuv</span></span><br></pre></td></tr></table></figure></p><ul><li>-video_size 指定像素</li></ul><h3 id="提取pcm数据">提取PCM数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i input.mp4 -vn -ar 44100 -ac 2 -f s16le out.pcm</span></span><br></pre></td></tr></table></figure><ul><li>-i 输入设备</li><li>-vn 不需要视频</li><li>-ar 44100 -a 音频 read 音频采样率44.1k</li><li>-ac 2 -a 音频 c2 channel 2 双声道</li><li>-f 数据存储格式 s16le s: 有符号的</li></ul><p><em>播放源文件</em> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffplay -ar 44100 -ac 2 -f s16le out.pcm</span></span><br></pre></td></tr></table></figure></p><h2 id="ffmpeg滤镜">Ffmpeg滤镜</h2><h3 id="裁剪滤镜">裁剪滤镜</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i output.mkv -vf crop=in_w-400:in_h-200 -c:v libx264 -c:a copy output.mp4</span></span><br></pre></td></tr></table></figure><ul><li>-i 输入</li><li>-vf -v 视频 f 滤镜 crop 裁剪滤镜</li><li>-c:v</li><li>-c:a copy 音频直接复制</li></ul><h3 id="视频裁剪">视频裁剪</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i output.mkv -ss 00:00:00 -t 10 output.mp4</span></span><br></pre></td></tr></table></figure><ul><li>-ss 开始时间(时:分:秒) *-t 时常(秒)</li></ul><h3 id="视频合并">视频合并</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f concat -i inputs.txt output.mp4</span></span><br></pre></td></tr></table></figure><ul><li>-f concat 拼接</li><li>-i 输入文件 inputs.txt 记录全部等待拼接的文件</li><li>inputs.txt每一行为“file filename”</li><li>file 'out1.mp4'</li><li>file 'out2.mp4'</li><li>output.mp4 输出文件</li></ul><h3 id="视频转图片">视频转图片</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i output.mp4 -r 1 -f image2 image-%3d.jpeg</span></span><br></pre></td></tr></table></figure><ul><li>-i 输入文件</li><li>-r 1, r 帧率， 1 每秒一张图片</li><li>-f image2, 转成image2格式</li><li>image-%3d.jpeg 输出文件</li></ul><h3 id="图片转视频">图片转视频</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -i image-%3d.jpeg output.mp4</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ffmpeg </tag>
            
            <tag> C </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix入门基础</title>
      <link href="/2018/11/16/Zabbix%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/11/16/Zabbix%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="安装服务器端">安装服务器端</h1><p><a href="https://www.zabbix.com/download" target="_blank" rel="noopener">官方</a> 1. 根据实际情况选择数据库 2. 根据实际情况选择操作系统</p><h1 id="汉化">汉化</h1><p><img src="/wp-content/uploads/2018/11/2018-11-16-17-36-53屏幕截图.png"> 错误提示</p><blockquote><p>You are not able to choose some of the languages, because locales for them are not installed on the web server.</p></blockquote><pre><code># 选中zh-CN UTF-8sudo dpkg-reconfigure localessudo service apache2 restart</code></pre><h1 id="安装客户端">安装客户端</h1><p><a href="https://www.zabbix.com/documentation/3.2/manual/installation/install_from_packages/agent_installation" target="_blank" rel="noopener">官方</a> <a href="https://tecadmin.net/install-zabbix-agent-on-centos-rhel/" target="_blank" rel="noopener">参考</a></p><h1 id="设置邮件报警">设置邮件报警</h1><p>Media types <img src="/wp-content/uploads/2018/11/zabbix-email.png"> <img src="/wp-content/uploads/2018/11/zabbix-email-1.png"></p><h1 id="交换分区错误问题">交换分区错误问题</h1><pre><code>Lack of free swap space</code></pre><p>现在的云主机默认没有交换分区 Configuration-&gt;Templates-&gt;Template OS Linux-&gt;Triggers-&gt;Lack of free swap space on {HOST.NAME}-&gt;Expression</p><pre><code>{Template OS Linux:system.swap.size[,pfree].last(0)}&lt;50改成{Template OS Linux:system.swap.size[,pfree].last(0)}&lt;50 and {Template OS Linux:system.swap.size[,free].last(0)}&lt;&gt;0</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenResty入门基础</title>
      <link href="/2018/11/14/OpenResty%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/11/14/OpenResty%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install pcre-devel openssl-devel gcc curl</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://openresty.org/download/openresty-1.13.6.2.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf openresty-1.13.6.2.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> openresty-1.13.6.2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认安装到/usr/<span class="built_in">local</span>/openresty, 可以指定./configure --prefix=/your/path/openresty设置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认安装的组件https://openresty.org/cn/components.html</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --with-luajit \</span></span><br><span class="line">            --without-http_redis2_module \</span><br><span class="line">            --with-http_iconv_module \</span><br><span class="line">            --with-http_postgres_module</span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; sudo make install</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建软链接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/openresty/nginx/sbin/nginx /usr/<span class="built_in">local</span>/nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动/重启/停止</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nginx </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nginx -s reload</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nginx -s stop</span></span><br></pre></td></tr></table></figure><h2 id="配置">配置</h2><blockquote><p>openResty的Nginx和普通Nginx配置一致</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenResty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux环境nginx/php-fpm权限问题</title>
      <link href="/2018/11/10/Linux%E7%8E%AF%E5%A2%83nginx-php-fpm%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/"/>
      <url>/2018/11/10/Linux%E7%8E%AF%E5%A2%83nginx-php-fpm%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="当前用户hanchang-nginx用户nginx">当前用户hanchang, nginx用户nginx</h1><pre><code>vim /etc/nginx/nginx.confuser hanchang;vim /etc/php-fpm.d/www.conf user = hanchanggroup = nginxlisten.owner = hanchanglisten.group = nginxlisten.mode = 0660</code></pre><h1 id="划重点-将当前用户加入nginx用户组">划重点 将当前用户加入nginx用户组</h1><pre><code>sudo usermod -a -G nginx hanchang</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu16.04安装及使用SVN</title>
      <link href="/2018/10/09/Ubuntu16.04%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8SVN/"/>
      <url>/2018/10/09/Ubuntu16.04%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8SVN/</url>
      
        <content type="html"><![CDATA[<h1 id="服务器端安装">服务器端安装</h1><p><a href="https://help.ubuntu.com/lts/serverguide/subversion.html.en/" target="_blank" rel="noopener">官方推荐</a></p><pre><code># 安装包sudo apt install subversion apache2 libapache2-svn# 创建目录及两个svn项目mkdir svnsvnadmin create svn/doneself-appsvnadmin create svn/doneself-web# 多个项目公用一个权限文件cp -rf svn/doneself/conf/passwd snv/cp -rf svn/doneself/conf/authz snv/# 编辑每个项目的配置文件vim svn/doneself/conf/svnserve.conf[general]   # 匿名用户没有权限anon-access = none# 验证用户写权限auth-access = write# 账号密码文件路径password-db = ../../passwd # 权限文件路径authz-db = ../../authz# 编写账号密码文件vim svn/passwd[users] ui = ui  # 注意空格# 编写组和权限文件vim svn/[groups]ui = ui  [doneself-app:/]  ui = wr</code></pre><h1 id="启动svn服务器">启动svn服务器</h1><pre><code># 启动,默认端口号3690sudo svnserve -d -r /home/svn# 结束sudo pkill svnserve</code></pre>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue.js</title>
      <link href="/2018/09/26/Vuejs%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/09/26/Vuejs%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="安装nodejs">安装nodejs</h1><a href="/2019/07/26/Node入门基础/" title="node入门基础">node入门基础</a><h1 id="安装vue-cli">安装vue-cli</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install -g @vue/cli</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vue --version</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vue add eslint</span></span><br></pre></td></tr></table></figure><h1 id="创建项目">创建项目</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>vue create hello-world</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sentry入门基础</title>
      <link href="/2018/09/08/Sentry%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/09/08/Sentry%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 先安装docker  https://docs.docker.com/install/linux/docker-ce/centos/<span class="comment">#install-docker-ce</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 后安装sentry   https://github.com/getsentry/onpremise</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir sentry</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> sentry</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p data/&#123;sentry,postgres&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/getsentry/onpremise</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> onpremise</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose run --rm web config generate-secret-key <span class="comment"># 创建一个secret key并配置到docker-compose.yml中的SENTRY_SECRET_KEY.</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose run --rm web upgrade <span class="comment"># 创建数据库</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up -d  <span class="comment"># 后台执行</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOs </tag>
            
            <tag> Sentry </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMq入门基础</title>
      <link href="/2018/09/08/RabbitMq%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/09/08/RabbitMq%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><h3 id="安装erlang">安装Erlang</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 Erlang</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install epel-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install erlang socat</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否安装成功</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> erl -version</span></span><br></pre></td></tr></table></figure><h3 id="安装rabbitmq">安装RabbitMq</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装rabbitMQ3.6版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.10/rabbitmq-server-3.6.10-1.el7.noarch.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -Uvh rabbitmq-server-3.6.10-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用,开机启动,状态</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start rabbitmq-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> rabbitmq-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl status rabbitmq-server</span></span><br></pre></td></tr></table></figure><h3 id="图形界面">图形界面</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动图形界面管理</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">chown -R rabbitmq:rabbitmq /var/lib/rabbitmq/</span><br><span class="line">rabbitmqctl add_user admin StrongPassword  # 踩坑:密码不要以';'结尾</span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line">rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自定义配置文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在rabbitmq 3.7.0 之前，rabbitmq.conf 使用了Erlang语法配置格式，新的版本使用了sysctl 格式.</span></span><br><span class="line">cd /etc/rabbitmq</span><br><span class="line">touch rabbitmq.conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 访问图形界面</span></span><br><span class="line">http://Your_Server_IP:15672/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> api文档</span></span><br><span class="line">http://Your_Server_IP:15672/api</span><br></pre></td></tr></table></figure><h2 id="常见错误处理">常见错误处理</h2><h3 id="文件大小限制">文件大小限制</h3><blockquote><p>Recovering 69477 queues, available file handles: 924. Please increase max open file handles limit to at least 69477!</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打开文件大小限制</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://stackoverflow.com/questions/46240032/rabbitmq-file-descriptor-limit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl edit rabbitmq-server.service <span class="comment"># 找到systemd service 地址</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/systemd/system/rabbitmq-server.service.d/limits.conf</span></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">LimitNOFILE=300000</span><br></pre></td></tr></table></figure><h3 id="mnesia-is-overloaded">Mnesia is overloaded</h3><blockquote><p>Mnesia is overloaded: {dump_log,write_threshold}</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编辑配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/rabbitmq/rabbitmq.config</span></span><br><span class="line">[</span><br><span class="line">    &#123;mnesia, [&#123;dump_log_write_threshold, 5000&#125;]&#125;,</span><br><span class="line">    &#123;rabbit, [&#123;tcp_listeners, [5673]&#125;]&#125;</span><br><span class="line">].</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PostgresSql入门基础</title>
      <link href="/2018/08/07/PostgresSql%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/08/07/PostgresSql%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="manjaro安装">manjaro安装</h1><h2 id="安装postgresql">安装postgresql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://aur.archlinux.org/postgresql-9.6.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> postgresql-9.6-git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> less PKGBUILD  <span class="comment"># 查看</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> makepkg -si  <span class="comment"># 安装</span></span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化数据</span></span><br><span class="line">$ sudo su postgres -l </span><br><span class="line">$ initdb --locale <span class="variable">$LANG</span> -E UTF8 -D <span class="string">'/var/lib/postgres/data/'</span></span><br><span class="line">$ <span class="keyword">exit</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动及开机启动</span></span><br><span class="line">sudo systemctl start postgresql.service </span><br><span class="line">sudo systemctl <span class="builtin-name">enable</span> postgresql.service</span><br></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line"><span class="variable">$ </span>sudo su postgres -l</span><br><span class="line"><span class="variable">$ </span>psql</span><br></pre></td></tr></table></figure><h2 id="安装postgis">安装postgis</h2><p>1, 安装proj4.9</p><p>下载源码 <a href="https://proj.org/download.html" target="_blank" rel="noopener">地址</a></p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar xfz proj-<span class="number">4.9</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">cd proj-<span class="number">4.9</span>.<span class="number">3</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="comment"># 安装postgis时，如果没有找到库则需要复制动态库</span></span><br><span class="line">sudo ln -s /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">libproj</span>.<span class="title">so</span>.12 /<span class="title">usr</span>/<span class="title">lib</span>/<span class="title">libproj</span>.<span class="title">so</span>.12</span></span><br></pre></td></tr></table></figure><p>2, 安装postgis2.5.2</p><p>下载源码 <a href="https://postgis.net/source/" target="_blank" rel="noopener">地址</a></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.osgeo.org/postgis/<span class="keyword">source</span>/postgis-<span class="number">2.5</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">tar xfz postgis-<span class="number">2.5</span>.<span class="number">2</span>.tar.gz</span><br><span class="line"><span class="keyword">cd</span> postgis-<span class="number">2.5</span>.<span class="number">2</span></span><br><span class="line">./configure</span><br><span class="line"><span class="keyword">make</span></span><br><span class="line">sudo <span class="keyword">make</span> install</span><br><span class="line">sudo ldconfig</span><br><span class="line">sudo <span class="keyword">make</span> comments-install</span><br></pre></td></tr></table></figure><h2 id="创建库">创建库</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一件事是使用\password命令，为postgres用户设置一个密码。</span></span><br><span class="line"><span class="attr">postgres</span>=<span class="comment"># \password postgres</span></span><br><span class="line"><span class="comment"># 第二件事是创建数据库用户dbuser（刚才创建的是Linux系统用户），并设置密码。</span></span><br><span class="line"><span class="attr">postgres</span>=<span class="comment"># CREATE USER dbuser WITH PASSWORD 'password';</span></span><br><span class="line"><span class="comment"># 第三件事是创建用户数据库，这里为exampledb，并指定所有者为dbuser。</span></span><br><span class="line"><span class="attr">postgres</span>=<span class="comment"># CREATE DATABASE exampledb OWNER dbuser;</span></span><br><span class="line"><span class="comment"># 第四件事是将exampledb数据库的所有权限都赋予dbuser，否则dbuser只能登录控制台，没有数据库操作权限。</span></span><br><span class="line"><span class="attr">postgres</span>=<span class="comment"># GRANT ALL PRIVILEGES ON DATABASE exampledb to dbuser;</span></span><br></pre></td></tr></table></figure><h1 id="ubuntucentos安装">ubuntu/centos安装</h1><p><a href="https://www.postgresql.org/download/linux/ubuntu/" target="_blank" rel="noopener">ubuntu安装</a> <a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="noopener">centos安装</a> centos7.2 安装postgresql9.6</p><pre><code># 添加RPMyum install https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm# 安装PostgreSQL 9.6# postgresql96-server 数据库核心服务端# postgresql96-contrib 附加第三方扩展# postgresql96-devel C语言开发Header头文件和库yum install postgresql96-server postgresql96-contrib postgresql96-devel# 验证是否安装成功rpm -aq| grep postgres# 设置目录（可省略）cd /mntsudo mkdir vdb1sudo chown -R postgres:postgres vdb1sudo chmod 700 vdb1vi /usr/lib/systemd/system/postgresql-9.6.serviceEnvironment=PGDATA=/mnt/vdb1/ 修改为自己的新的数据路径# 初始化数据库sudo /usr/pgsql-9.6/bin/postgresql96-setup initdb# 开启服务sudo service postgresql-9.6 start 或者 systemctl start postgresql-9.6.service# 开机启动sudo sudo chkconfig postgresql-9.6 on 或者 systemctl enable postgresql-9.6.service# 配置文件 /var/lib/pgsql/9.6/data/postgresql.conf 通用设置 /var/lib/pgsql/9.6/data/pg_hba.conf  控制访问安全 /var/lib/pgsql/9.6/data/pg_ident.conf 配合pg_hba.conf使用  sudo su postgrespsql # 进入命令行模式# 修改密码ALTER USER postgres WITH PASSWORD &#39;密码&#39;; # 创建用户CREATE USER userdoneself WITH PASSWORD &#39;密码passworddoneself&#39;;# 创建数据库create --encoding=UTF8 database dbdoneself owner userdoneself;# 赋予权限grant all privileges on database dbdoneself to userdoneself;\q# 安装postgresql时，系统会自动创建postgres用户# 开启远程访问vi /var/lib/pgsql/9.6/data/postgresql.conf 或者  vi /mnt/vdb1/postgresql.conf(创建了目录)修改#listen_addresses = &#39;localhost&#39; 为  listen_addresses=&#39;*&#39;# 连接数据库先配置登录权限vim pg_hba.conf# 是否远程登录 数据库 用户名 ip地段 方式# 允许doneself用户远程访问host doneself doneself 127.0.0.1/32 md5# 允许管理员密码登录local all postgres  md5# 如果不知道怎么配置， 将全部登录方式改成md5# 查看版本/usr/pgsql-9.6/bin/psql --version</code></pre><h1 id="安装postgis2">安装postgis2</h1><p>centos7.2</p><pre><code>sudo yum install postgis2_96  # 96和安装的postgresql一致sudo yum install ogr_fdw96  # 安装ogrfdwsudo yum install pgrouting_96 # 安装pgrouting# 用管理员登录postgerysql&gt;-- Enable PostGIS (includes raster)CREATE EXTENSION postgis;-- Enable TopologyCREATE EXTENSION postgis_topology;-- Enable PostGIS Advanced 3D-- and other geoprocessing algorithms-- sfcgal not available with all distributionsCREATE EXTENSION postgis_sfcgal;-- fuzzy matching needed for TigerCREATE EXTENSION fuzzystrmatch;-- rule based standardizerCREATE EXTENSION address_standardizer;-- example rule data setCREATE EXTENSION address_standardizer_data_us;-- Enable US Tiger GeocoderCREATE EXTENSION postgis_tiger_geocoder;# 验证是否安装成功#postgres=&gt; postgis_full_version();</code></pre><h1 id="安装postgresql中文全文搜索zhparser">安装postgresql中文全文搜索zhparser</h1><p>centos7.2</p><pre><code> yum install bzip2  # 安装解压包 # 安装SCWS中文分词 https://github.com/hightman/scws wget http://www.xunsearch.com/scws/down/scws-1.2.3.tar.bz2 tar -jxvf scws-1.2.3.tar.bz2  cd scws-1.2.3 ./configure make install # 测试 scws &#39;请问怎么自己动手做西红柿蛋炒饭&#39; -c utf-8 # 安装zhparser git clone https://github.com/amutu/zhparser.git cd zhparserexport PATH=$PATH:/usr/pgsql-9.6/bin/cmake &amp;&amp; make install# 登录（第一次登录）&gt; sudo su - postgres# 修改可以md5登录后&gt; &gt; psql -U user -D database -W&gt;  输入口令# 创建用户user=&gt;  CREATE USER dbuser WITH PASSWORD &#39;password&#39;;# 修改密码user=&gt;  ALTER USER dbuser WITH PASSWORD &#39;newpassword&#39;;# 赋予权限user=&gt;  GRANT ALL PRIVILEGES ON DATABASE exampledb to dbuser;# 允许用户创建数据库user=&gt; ALTER USER doneself CREATEDB;# 设置为超级管理员user=&gt; ALTER ROLE doneself SUPERUSER;# 创建数据库user=&gt;  Create database exampledb owner=dbuser  template= template1  ENCODING = &#39;UTF8&#39;;# 选择数据库user=&gt; \c database# 查看当前数据库所有表user=&gt;  \dtuser=&gt;  \d 数据库 —— 得到所有表的名字user=&gt;  \d 表名 —— 得到表结构</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>java入门基础</title>
      <link href="/2018/01/31/Java%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/01/31/Java%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="linux安装java开发环境">linux安装java开发环境</h1><h2 id="安装java">安装java</h2><p>下载源码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从官方网站下载javaLTS版本源码并复制到当前目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载地址: https://www.oracle.com/technetwork/java/javase/downloads/index.html</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mkdir /usr/java</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo <span class="built_in">cd</span> /usr/java</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo cp -rf ~/Download/jdk-11.0.3_linux-x64_bin.tar.gz .</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tar -zxvf jdk-11.0.3_linux-x64_bin.tar.gz &amp;&amp; rm  jdk-11.0.3_linux-x64_bin.tar.gz</span></span><br></pre></td></tr></table></figure><p>设置环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/profile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> java environment</span></span><br><span class="line">JAVA_HOME=/usr/java/jdk-11.0.3</span><br><span class="line">JRE_HOME=/usr/java/jdk-11.0.3/jre  # 如果安装包中没有jre文件夹，则改成和JAVA_HOME一致</span><br><span class="line">CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line">export JAVA_HOME JRE_HOME CLASS_PATH PATH</span><br></pre></td></tr></table></figure><p>验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">which</span> java</span></span><br><span class="line">/usr/java/jdk-11.0.3/bin/java</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> java -version</span></span><br><span class="line">java version "11.0.3" 2019-04-16 LTS</span><br><span class="line">Java(TM) SE Runtime Environment 18.9 (build 11.0.3+12-LTS)                                           </span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.3+12-LTS, mixed mode)</span><br></pre></td></tr></table></figure><h2 id="linux安装tomcat">linux安装tomcat</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /home/zhc/java</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://tomcat.apache.org/download-90.cgi</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-9/v9.0.22/bin/apache-tomcat-9.0.22.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf apache-tomcat-9.0.22.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv apache-tomcat-9.0.22 tomcat</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 http://127.0.0.1:8080</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./tomcat/bin/startup.sh</span></span><br><span class="line">Using CATALINA_BASE:   /home/zhc/work/java/tomcat</span><br><span class="line">Using CATALINA_HOME:   /home/zhc/work/java/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /home/zhc/work/java/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr/java/jdk-11.0.4</span><br><span class="line">Using CLASSPATH:       /home/zhc/work/java/tomcat/bin/bootstrap.jar:/home/zhc/work/java/tomcat/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./tomcat-9/bin/shutdown.sh</span></span><br></pre></td></tr></table></figure><p><a href="https://www.vultr.com/docs/how-to-install-apache-tomcat-8-on-centos-7" target="_blank" rel="noopener">centos设置为系统启动</a></p><h3 id="idea配置tomcat服务">idea配置tomcat服务</h3><ul><li>修改虚拟路径 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 以下两个配置需要保持一致</span></span><br><span class="line">RUN/DEBUG Configurations -&gt; Server -&gt; URL http://localhost:8080/&#123;ProjectName&#125;_war_exploded/ </span><br><span class="line">RUN/DEBUG Configurations -&gt; Deployment -&gt; Application content /&#123;ProjectName&#125;_war_exploded</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装maven">安装maven</h2><a href="/2019/08/16/Java开发maven构建工具入门基础/" title="java开发maven构建工具入门基础">java开发maven构建工具入门基础</a><h2 id="安装gradle">安装gradle</h2><a href="/2019/08/16/Java开发gradle构建工具入门基础/" title="java开发gradle构建工具入门基础">java开发gradle构建工具入门基础</a><h2 id="安装commons-logging">安装commons-logging</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从官网下载二进制文件包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://commons.apache.org/proper/commons-logging/download_logging.cgi</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://mirrors.tuna.tsinghua.edu.cn/apache//commons/logging/binaries/commons-logging-1.2-bin.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf commons-logging-1.2-bin.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mv commons-logging-1.2 /usr/java_jar/</span></span><br></pre></td></tr></table></figure><h2 id="使用sdkman管理sdk">使用sdkman管理sdk</h2><p><a href="https://sdkman.io/install" target="_blank" rel="noopener">sdkman</a></p><h1 id="打包">打包</h1><h2 id="创建jar包">创建jar包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写应用程序</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim com/zhuohc/jar/HelloWorld.java</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuohc.jar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello world!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> javac com/zhuohc/jar/HelloWorld.java  <span class="comment"># 编译</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> jar cvf hello.jar com/zhuohc/jar/HelloWorld.class  <span class="comment"># 打包 参数c: 创建， 参数v: 输出具体文件信息， 参数f: 指定输出文件名</span></span></span><br><span class="line">已添加清单</span><br><span class="line">正在添加: com/zhuohc/jar/HelloWorld.class(输入 = 441) (输出 = 302)(压缩了 31%)</span><br></pre></td></tr></table></figure><h2 id="查看jar包信息">查看jar包信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jar tvf hello.jar  <span class="comment"># 查看 参数t： 查看</span></span></span><br><span class="line">0 Fri Aug 16 14:21:06 CST 2019 META-INF/</span><br><span class="line">66 Fri Aug 16 14:21:06 CST 2019 META-INF/MANIFEST.MF</span><br><span class="line">441 Fri Aug 16 14:20:20 CST 2019 com/zhuohc/jar/HelloWorld.class</span><br></pre></td></tr></table></figure><h2 id="提取jar包信息">提取jar包信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jar xvf hello.jar <span class="comment"># 解压 参数x： 提取extract</span></span></span><br><span class="line">已创建: META-INF/</span><br><span class="line">已解压: META-INF/MANIFEST.MF</span><br><span class="line">已解压: com/zhuohc/jar/HelloWorld.class</span><br></pre></td></tr></table></figure><h2 id="jar包清单文件">jar包清单文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建清单文件</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim Manifest.txt</span></span><br></pre></td></tr></table></figure><p>Manifest.txt指定程序入口 警告： 文本文件必须以新行或回车符结束。如果最后一行不以新行或回车结束，则不会正确解析.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Manifest.txt</span></span><br><span class="line">Main-Class: com.zhuohc.jar.HelloWorld</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重新打包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> jar cvfm hello.jar Manifest.txt com/zhuohc/jar/HelloWorld.class  <span class="comment"># 参数m: 指定清单文件地址</span></span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 执行jar文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> java -jar hello.jar</span></span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Manifest.txt 其他信息</span></span><br><span class="line">Name: com/zhuohc/jar</span><br><span class="line">Specification-Title: Java Utility Classes</span><br><span class="line">Specification-Version: 1.2</span><br><span class="line">Specification-Vendor: Example Tech, Inc.</span><br><span class="line">Implementation-Title: com.zhuohc.jar</span><br><span class="line">Implementation-Version: build57</span><br><span class="line">Implementation-Vendor: Example Tech, Inc.</span><br><span class="line">Main-Class: com.zhuohc.jar.HelloWorld</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微信本地开发及线上环境搭建</title>
      <link href="/2018/01/29/%E5%BE%AE%E4%BF%A1%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E5%8F%8A%E7%BA%BF%E4%B8%8A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2018/01/29/%E5%BE%AE%E4%BF%A1%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E5%8F%8A%E7%BA%BF%E4%B8%8A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="微信开发者中心">微信开发者中心</h1><p>https://open.weixin.qq.com 1. 注册线上账号，开发者资质认证 2. 注册本地账号，开发者资质认证</p><h1 id="网站应用">网站应用</h1><ol type="1"><li>添加相关信息，并盖章认证，添加授权回调域example.com</li><li>认证通过后获取AppId, AppSecret</li></ol><h1 id="公众号应用">公众号应用</h1><h1 id="本地环境配置">本地环境配置</h1><ol type="1"><li>将回调的url www.example.com 添加到host文件中</li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis基础</title>
      <link href="/2018/01/11/Redis%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/01/11/Redis%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>REmote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。 Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。 它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p><h1 id="redis安装">redis安装</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ubuntu</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo apt-get update</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo apt-get install redis-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-cli</span></span><br></pre></td></tr></table></figure><h1 id="redis配置">redis配置</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ubuntu  <span class="variable">$sudo</span> vim /etc/redis.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置为守护进程</span></span><br><span class="line">protected-mode yes</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置密码</span></span><br><span class="line">requirepass redispassword</span><br><span class="line"><span class="meta">#</span><span class="bash"> port</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 127.0.0.1</span></span><br><span class="line">bing 0.0.0.0 # 允许远程访问</span><br></pre></td></tr></table></figure><h1 id="客户端远程登录">客户端远程登录</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379 -a redispassword</span><br></pre></td></tr></table></figure><h1 id="redis客户端">redis客户端</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> redis-commander，基于nodejs</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install -g redis-commander</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> redis-commander</span></span><br></pre></td></tr></table></figure><h1 id="通用命令">通用命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; del name <span class="comment"># 删除数据</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; <span class="built_in">type</span> name <span class="comment"># 查看数据类型</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; rename name <span class="comment"># 重命名</span></span></span><br></pre></td></tr></table></figure><h1 id="数据结构">数据结构</h1><h2 id="字符串string">字符串string</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  <span class="built_in">set</span> string-name value</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; get string-name</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  del string-name</span></span><br></pre></td></tr></table></figure><h2 id="列表list-相当于默认键的数组">列表list： 相当于默认键的数组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; lpush list-name value1 value2 value3 ... <span class="comment"># 左侧插入列表值</span></span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; rpush list-name value4 value5 value6... <span class="comment"># 右侧插入列表值</span></span></span><br><span class="line">(integer) 6</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  lindex list-name 1 <span class="comment"># 获取第1个的值</span></span></span><br><span class="line">"value2"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  lrange list-name 1 2 <span class="comment"># 获取从第1位置到2位置的列表值</span></span></span><br><span class="line">1) "value2"</span><br><span class="line">2) "value1"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  lpop list-name <span class="comment"># 弹出最左边值</span></span></span><br><span class="line">"value3"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; rpop list-name <span class="comment"># 弹出最右边值</span></span></span><br><span class="line">"value6"</span><br></pre></td></tr></table></figure><h2 id="集合set无序不重复的列表">集合set：无序，不重复的列表</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt;  sadd <span class="built_in">set</span>-name value1 value2 value3 <span class="comment"># 设置无序列表值</span></span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; smembers <span class="built_in">set</span>-name  <span class="comment"># 查看所有值</span></span></span><br><span class="line">1) "value3"</span><br><span class="line">2) "value2"</span><br><span class="line">3) "value1"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; srem <span class="built_in">set</span>-name value1 <span class="comment"># 删除值</span></span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; sismember <span class="built_in">set</span>-name value2 <span class="comment"># 查看是否在无序列表内</span></span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><h2 id="散列值hash相当于自定义键的数组">散列值hash：相当于自定义键的数组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HSET <span class="built_in">hash</span>-name key1 value1 <span class="comment">#设置键值对</span></span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HGET <span class="built_in">hash</span>-name key1 <span class="comment"># 获取指定键的值</span></span></span><br><span class="line">"value1"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HSET <span class="built_in">hash</span>-name key1 value2 <span class="comment"># 更新键的值</span></span></span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HGET <span class="built_in">hash</span>-name key1 </span></span><br><span class="line">"value2"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HSET <span class="built_in">hash</span>-name key2 value2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HGETALL <span class="built_in">hash</span>-name <span class="comment"># 查找所有键值对</span></span></span><br><span class="line">1) "key1"</span><br><span class="line">2) "value2"</span><br><span class="line">3) "key2"</span><br><span class="line">4) "value2"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; HDEL <span class="built_in">hash</span>-name key1 <span class="comment"># 删除hash键值对</span></span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><h2 id="有序集合zset成员分值分值必须是浮点数通过浮点数进行排序">有序集合zset：成员+分值，分值必须是浮点数，通过浮点数进行排序</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; zadd zset-name 100 member1 <span class="comment"># 添加键值对</span></span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; zadd zset-name 202 member2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; zadd zset-name 803 member3</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; ZRANGE zset-name 0 -1 <span class="comment"># 获取多个元素</span></span></span><br><span class="line">1) "member1"</span><br><span class="line">2) "member2"</span><br><span class="line">3) "member3"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; ZRANGE zset-name 0 -1 withscores <span class="comment"># 获取多个元素</span></span></span><br><span class="line">1) "member1"</span><br><span class="line">2) "100"</span><br><span class="line">3) "member2"</span><br><span class="line">4) "202"</span><br><span class="line">5) "member3"</span><br><span class="line">6) "803"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; ZRANGEBYSCORE zset-name 0 300 withscores <span class="comment"># 按score获取多个元素</span></span></span><br><span class="line">1) "member1"</span><br><span class="line">2) "100"</span><br><span class="line">3) "member2"</span><br><span class="line">4) "202"</span><br><span class="line"><span class="meta">$</span><span class="bash"> 127.0.0.1:6379&gt; ZREM zset-name member1 <span class="comment"># 移除一个元素</span></span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><h1 id="错误信息提示">错误信息提示</h1><blockquote><p>MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error.</p></blockquote><blockquote><p>Redis被配置为保存数据库快照，但它目前不能持久化到硬盘。用来修改集合数据的命令不能用。请查看Redis日志的详细错误信息。</p></blockquote><p>原因</p><p>强制关闭Redis快照导致不能持久化。</p><p>解决方案 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config set stop-writes-on-bgsave-error no</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫scrapy框架入门基础</title>
      <link href="/2018/01/10/Python%E7%88%AC%E8%99%ABscrapy%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2018/01/10/Python%E7%88%AC%E8%99%ABscrapy%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。 其最初是为了页面抓取 (更确切来说, 网络抓取 )所设计的， 也可以应用在获取API所返回的数据(例如 Amazon Associates Web Services ) 或者通用的网络爬虫。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试</p><h3 id="scrapy主要包括了以下组件">Scrapy主要包括了以下组件：</h3><ol type="1"><li>引擎(Scrapy): 用来处理整个系统的数据流处理, 触发事务(框架核心)</li><li>调度器(Scheduler): 用来接受引擎发过来的请求, 压入队列中, 并在引擎再次请求的时候返回. 可以想像成一个URL（抓取网页的网址或者说是链接）的优先队列, 由它来决定下一个要抓取的网址是什么, 同时去除重复的网址</li><li>下载器(Downloader): 用于下载网页内容, 并将网页内容返回给蜘蛛(Scrapy下载器是建立在twisted这个高效的异步模型上的)</li><li>爬虫(Spiders): 爬虫是主要干活的, 用于从特定的网页中提取自己需要的信息, 即所谓的实体(Item)。用户也可以从中提取出链接,让Scrapy继续抓取下一个页面</li><li>项目管道(Pipeline): 负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。当页面被爬虫解析后，将被发送到项目管道，并经过几个特定的次序处理数据。</li><li>下载器中间件(Downloader Middlewares): 位于Scrapy引擎和下载器之间的框架，主要是处理Scrapy引擎与下载器之间的请求及响应。</li><li>爬虫中间件(Spider Middlewares): 介于Scrapy引擎和爬虫之间的框架，主要工作是处理蜘蛛的响应输入和请求输出。</li><li>调度中间件(Scheduler Middewares): 介于Scrapy引擎和调度之间的中间件，从Scrapy引擎发送到调度的请求和响应。</li></ol><h3 id="scrapy运行流程大概如下">Scrapy运行流程大概如下：</h3><p>首先，引擎从调度器中取出一个链接(URL)用于接下来的抓取 引擎把URL封装成一个请求(Request)传给下载器，下载器把资源下载下来，并封装成应答包(Response) 然后，爬虫解析Response 若是解析出实体（Item）,则交给实体管道进行进一步的处理。 若是解析出的是链接（URL）,则把URL交给Scheduler等待抓取</p><h3 id="备忘">备忘</h3><h1 id="使用selector提取数据">使用Selector提取数据</h1><h1 id="xpath语法和基本函数">xpath语法和基本函数</h1><pre><code>/...ELEMENT//ELEMENT*text@ALTER@*position()last()string()</code></pre><h1 id="css选择器">css选择器</h1><pre><code>*EE1&gt;E2E1+E2.CLASS#ID[ATTR][ATTR=VALUE]E:nth-child(n)E:first-child</code></pre><h1 id="使用item和field封装数据">使用Item和Field封装数据</h1><p>Field(serializer=lambda)设置存储数据</p><h1 id="使用item-pipeline处理数据">使用Item Pipeline处理数据</h1><p>修改数据,过滤重复数据,将数据写入到数据库等</p><h1 id="linkextractor提取链接">LinkExtractor提取链接</h1><pre><code>LinkExtractor参数allow 允许链接deny 拒绝链接allow_domains 允许域名deny_domains 拒绝域名restrict_xpaths 允许xpath链接restrict_css 允许css选择器链接</code></pre><h1 id="exporter导出数据">Exporter导出数据</h1><p>默认包含以下</p><pre><code>JSON, JSON LINES, CSV, XML, PICKLE, MARSHAL</code></pre><p>可配置导出格式和存放文件地址, 可自定义导出格式,例如xls</p><h1 id="下载文件和图片">下载文件和图片</h1><p>FIlesPipeline</p><pre><code>setting.pyITEM_PIPELINES = {&#39;scrapy.pipelines.files.FilesPipeline&#39;: 1}FILES_STORE = &#39;/home/hanchang/download&#39;</code></pre><p>ImagesPipeline</p><h1 id="模拟登录">模拟登录</h1><p>使用FromRequest ORC识别验证码:pillow, pytesseract 付费网络平台识别 人工识别:爬取登录页面的验证码图片,调用Image.show方法,肉眼识别并输入到内置的input函数中 Cookie登录: 获取浏览器的cookie值(browsercookie包), 利用BrowserCookiesMiddleware将获取的cookie值添加到CookieJar中</p><h1 id="动态页面抓取">动态页面抓取</h1><p>Splash是Scrapy官方推荐的javascript渲染引擎, Webkit无界面浏览器</p><pre><code># 安装sudo apt-get install dockersudo docker pull scrapinghub/splashsudo docker run -p 8050:8050 -p 8051:8051 scrapinghub/splash</code></pre><p>splash常见服务端点 http://localhost:8050/render.html GET/POST 返回html 参数: url, timeout, proxy, wait, images, js_source http://localhost:8050/excute 传递模拟的动作给splash,例如等待页面渲染，执行代码，等等</p><h2 id="scrapy使用splash">scrapy使用splash</h2><pre><code>安装pip install scrapy-splashsetting.py# splash服务器地址SPLASH_URL = &#39;http://localhost:8050&#39;# 开启splash的两个下载中间件并调整HttpCompressionMiddleware的次序DOWNLOADER_MIDDLEWARES = {    &#39;scrapy_splash.SplashCookiesMiddleware&#39;: 723,        &#39;scrapy_splash.SplashMiddleware&#39;: 725,        &#39;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#39;: 810,}# 过滤去重函数DUPEFILTER_CLASS = &#39;scrapy_splash.SplashAwareDupeFilter&#39;,# 用户支持cahce_argsSPIDER_MIDDLEWARES = {  &#39;scrapy_splash.SplashDeduplicateArgsMiddleware&#39;: 100,}</code></pre><h1 id="分布式爬取">分布式爬取</h1><p>使用scrapy-redis</p><pre><code># 安装pip install scrapypip install scrapy-redis# 在配置文件setting.py中添加scrapy-redis相关信息# redis服务器REDIS_URL = &#39;redis://127.0.0.1:6379&#39;# 使用scrapy_redis调度器替代原生调度器SCHEDULER = &#39;scrapy_redis.scheduler.Scheduler&#39;# 使用scrapy_redis的RFPDupeFilter作为去重过滤器DUPEFILTER_CLASS = &#39;scrapy_redis.dupefilter.RFPDupeFilter&#39;# 将爬取的数据存储到redis中ITEM_PIPELINES = {    &#39;scrapy_redis.pipelines.RedisPipeline&#39;: 300,}# 爬虫停止后,保留/清除Reids中的请求队列以及去重集合SCHEDULER_PERSIST = False# 修改爬虫spider.pyfrom scrapy_redis.spiders import RedisSpiderclass BookSpider(RedisSpider):    # 注释start_urls    # start_urls = []# 手动添加start_urlsredis-cli -h 127.0.0.1lpush books:start_urls &#39;http://www.books.com/&#39;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>最新在linux/ubuntu中安装qq的办法</title>
      <link href="/2017/11/22/%E6%9C%80%E6%96%B0%E5%9C%A8linux-ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85qq%E7%9A%84%E5%8A%9E%E6%B3%95/"/>
      <url>/2017/11/22/%E6%9C%80%E6%96%B0%E5%9C%A8linux-ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85qq%E7%9A%84%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>通过docker镜像文件的方式安装qq 1, 首先需要在主机上安装docker 2, 下载镜像文件 https://hub.docker.com/r/bestwu/qq/</p><pre><code>sudo docker pull bestwu/qq # 速度慢可以换镜像源</code></pre><p>3, 编辑启动脚本</p><pre><code>vim qq.shsudo docker run -d --name qq --device /dev/snd --net=host \-v /tmp/.X11-unix:/tmp/.X11-unix \-v /home/YOURUSERNAME/TencentFiles:/TencentFiles \ # 此处数据卷的目录填写自己的目录-e DISPLAY=unix$DISPLAY \-e XMODIFIERS=@im=fcitx \-e QT_IM_MODULE=fcitx \-e GTK_IM_MODULE=fcitx \-e AUDIO_GID=63 \-e GID=1000 \-e UID=1000 \bestwu/qq:latest # 此处版本自行选择，作者提供了im (QQ) light,latest (QQLight) office (TIM)三个版本</code></pre><p>4, 启动脚本</p><pre><code>./qq.sh</code></pre><p>5, 感谢作者提供的镜像，本镜像基于深度操作系统.</p>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu16.04安装及使用docker(一)</title>
      <link href="/2017/11/20/Ubuntu16.04%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8docker(%E4%B8%80)/"/>
      <url>/2017/11/20/Ubuntu16.04%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8docker(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h3 id="删除旧版本">删除旧版本</h3><pre><code>sudo apt-get remove docker docker-engine docker.io</code></pre><h3 id="安装">安装</h3><pre><code>$ sudo apt-get update# 安装依赖$ sudo apt-get install  apt-transport-https ca-certificates curl software-properties-common# 添加官方key$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -# 查找key$ sudo apt-key fingerprint 0EBFCD88pub   4096R/0EBFCD88 2017-02-22      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;sub   4096R/F273FCD8 2017-02-22# 获取资源sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;# 查找合适的版本$ apt-cache madison docker-cedocker-ce | 17.09.0~ce-0~ubuntu | https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages# 安装$ sudo apt-get install docker-ce=&lt;VERSION&gt;# 打印安装结果$ sudo docker versionClient: Version:      17.09.0-ce API version:  1.32 Go version:   go1.8.3 Git commit:   afdb6d4 Built:        Tue Sep 26 22:42:18 2017 OS/Arch:      linux/amd64Server: Version:      17.09.0-ce API version:  1.32 (minimum version 1.12) Go version:   go1.8.3 Git commit:   afdb6d4 Built:        Tue Sep 26 22:40:56 2017 OS/Arch:      linux/amd64 Experimental: false</code></pre><h3 id="将用户加入docker用户组这样不需要输入sudo">将用户加入docker用户组，这样不需要输入sudo</h3><pre><code>1. sudo cat /etc/group | grep docker 2. 如果不存在docker组，可以添加sudo groupadd docker 3. 添加当前用户到docker组，sudo usermod -aG  docker $USER 4. 重启docker服务,sudo systemctl restart docker 5. 如果权限不够，sudo chmod a+rw /var/run/docker.sock　6. sudo chown -R $USER ~/.docker</code></pre><h3 id="启动测试">启动测试</h3><pre><code>$ sudo  docker run hello-worldUnable to find image &#39;hello-world:latest&#39; locallylatest: Pulling from library/hello-world9a0669468bf7: Pull completeDigest: sha256:0e06ef5e1945a718b02a8c319e15bae44f47039005530bc617a5d071190ed3fcStatus: Downloaded newer image for hello-world:latestHello from Docker!This message shows that your installation appears to be working correctly.To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub. 3. The Docker daemon created a new container from that image which runs the    executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it    to your terminal.To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bashShare images, automate workflows, and more with a free Docker ID: https://cloud.docker.com/For more examples and ideas, visit: https://docs.docker.com/engine/userguide/</code></pre><h3 id="更换镜像源">更换镜像源</h3><pre><code># 可以修改 /etc/docker/daemon.json 文件并添加上 registry-mirrors 键值,没有就创建一个{  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]}</code></pre><h3 id="安装ctop查看容器状态">安装ctop查看容器状态</h3><pre><code># https://github.com/bcicen/ctop$ sudo wget https://github.com/bcicen/ctop/releases/download/v0.6.1/ctop-0.6.1-linux-amd64 -O /usr/local/bin/ctop$ sudo chmod +x /usr/local/bin/ctop</code></pre><h3 id="第一个实例">第一个实例</h3><pre><code># 第一次使用会下载debian的镜像文件$ sudo docker run debian echo &#39;hello world&#39;&gt; Unable to find image &#39;debian&#39; locally&gt; ......# -i -t 表示进行交互会话$ sudo docker run -i -t debian /user/bashroot@622ac5689680:/#  echo &#39;hello world&#39;&gt; hello worldroot@622ac5689680:/# exit&gt; exit# 基本命令$ sudo docker run -h container -i -t debian /bin/bash #-h表示主机名称$ sudo docker ps  # 查看当前运行的主机$ sudo docker ps -a # 查看全部的主机$sudo docker events  # 查看守护进程$ sudo docker inspect HOST_NAME 　# 查看HOST_NAME的信息$ sudo docker port HOST_NAME # 查看端口映射信息$ sudo docker diff HOST_NAME　# 查看更改的信息$ sudo docker logs HOST_NAME   # 打印log信息$ sudo docker rm HOST_NAME  # 删除$ sudo docker pull redis  # 拉取镜像$ sudo docker create redis # 创建容器$ sudo docker start zen_brown # 开启容器（kitematic是绿色波浪线）$ sudo docker stop zen_brown # 停止容器（kitematic是灰色直线）$ sudo docker pause zen_brown  # 暂停容器kitematic是灰色波浪线）$ sudo docker commit zen_brown # 将容器变成镜像$ sudo docker run redis /bin/bash$ sudo docker attach zen_brown # 查看容器内进程$ sudo docker cp # 在容器和主机之间复制内容$ sudo docker exec # 在容器中运行命令$ sudo docker kill # 容器立即退出</code></pre><h3 id="创建dockerfile镜像">创建dockerfile镜像</h3><pre><code># 创建项目$ mkdir cowsay$ cd cowsay$ vim Dockerfile~ FROM debian:wheezy~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune~ :wq# 创建$ sudo docker build -t test/cowsay-dockerfile . &gt; Sending build content to Docker .....&gt; ....# 运行$ sudo docker run test/cowsay-dockerfile /usr/games/cowsay &#39;Moo&#39;# 使用entrypoint指令$ vim Dockerfile~ FROM debian:wheezy~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune~ ENTRYPOINTER [&quot;/usr/games/cowsay&quot;]~ :wq # 创建$ sudo docker build -t test/cowsay-dockerfile . &gt; Sending build content to Docker .....&gt; ....# 运行$ sudo docker run test/cowsay-dockerfile  &#39;Moo&#39;# 使用脚本解决entrypoint$ vim entrypoint.sh~ #! /bin/bash~ if [ $# -eq 0 ]; then~      /usr/games/fortune | /usr/games/cowsay~  else~     /usr/games/cowsay &quot;$@&quot;~   fi~ :wq$ chmod +x entrypoint.sh$ vim Dockerfile~ FROM debian:wheezy~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune~ COPY entrypoint.sh /~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]~ :wq # 创建$ sudo docker build -t test/cowsay-dockerfile . &gt; Sending build content to Docker .....&gt; ....# 运行$ sudo docker run test/cowsay-dockerfile &#39;Moo&#39;</code></pre><h3 id="使用在线仓库">使用在线仓库</h3><p>在线注册地址：　https://cloud.docker.com</p><pre><code># 登陆$ sudo docker login$ username:$ password:# 填写作者信息$ vim Dockerfile~ FROM debian:wheezy~ MAINTAINER username &lt;username@mail.com&gt;~ RUN apt-get update &amp;&amp; apt-get install -y cowsay fortune~ COPY entrypoint.sh /~ ENTRYPOINTER [&quot;/entrypoint.sh&quot;]~ :wq # 创建$ sudo docker build -t username/cowsay-dockerfile . &gt; Sending build content to Docker .....&gt; ....# 运行$ sudo docker run username/cowsay-dockerfile  &#39;Moo&#39;# 上传$ sudo docker push </code></pre><h3 id="容器连接">容器连接</h3><pre><code>$ sudo docker run --name myredis -d redis # -d表示后台运行~ a1696406326aaaa6c28931e886b8dd664d191b083de4aed464d584b4720d57b1$ docker run --rm -it --link myredis:redis redis /bin/bash&gt; root@9c914447f5e1:/data# redis-cli -h redis -p 6379&gt; redis:6379&gt; ping&gt; PONG&gt; redis:6379&gt; set &quot;abc&quot; 123&gt; OK&gt; redis:6379&gt; get &quot;abc&quot;&gt; &quot;123&quot;&gt; redis:6379&gt; exit&gt; root@9c914447f5e1:/data# exit&gt; exit</code></pre><h3 id="容器的备份">容器的备份</h3><pre><code># 查看所有的容器$ docker ps -aCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMESa1696406326a        redis               &quot;docker-entrypoint...&quot;   13 minutes ago      Up 13 minutes       6379/tcp            myredis# 备份指定的id$ docker commit -p a1696406326a redis-backup# 查看镜像$ docker imagesREPOSITORY                   TAG                 IMAGE ID            CREATED             SIZEredis-backup                 latest              fb9d896b3a39        11 seconds ago      107MB# 上传镜像(docker login &amp;&amp; docker push)# 或者打包$ docker save -o ./redis-backup.tar redis-backup# 恢复容器$ docker pull ****# 或者使用包$ docker load -i ./redis-backup.tar</code></pre><h3 id="让docker容器连接互联网">让docker容器连接互联网</h3><pre><code># -p 8000:80 表示将主机的8000端口转发至容器的80端口$ docker run -d -p 8000:80 nginx # 容器互联$ docker run -d --name myredis redis$ docker run --link myredis:redis debian env  # --link 目标容器:目标容器在主容器内的简称~ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin~ HOSTNAME=69df45e6f92d~ REDIS_PORT=tcp://172.17.0.2:6379~ REDIS_PORT_6379_TCP=tcp://172.17.0.2:6379~ REDIS_PORT_6379_TCP_ADDR=172.17.0.2~ REDIS_PORT_6379_TCP_PORT=6379~ REDIS_PORT_6379_TCP_PROTO=tcp~ REDIS_NAME=/stupefied_chandrasekhar/redis~ REDIS_ENV_GOSU_VERSION=1.10~ REDIS_ENV_REDIS_VERSION=4.0.2~ REDIS_ENV_REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-4.0.2.tar.gz~ REDIS_ENV_REDIS_DOWNLOAD_SHA=b1a0915dbc91b979d06df1977fe594c3fa9b189f1f3d38743a2948c9f7634813~ HOME=/root</code></pre><h3 id="数据卷">数据卷</h3><pre><code>#  -v指定数据卷$ docker run -it --name container-test -h container -v /ddata debian /bin/bash# 查看数据卷在本机的位置$ docker inspect -f { {.Mounts}} container-test  [{volume 4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9 /var/lib/docker/volumes/4687a1d9a80dff56d951f14704a8125f1b642b50c78dac63d3a02a42ff05ffb9/_data /ddata local  true }]# 可以在本机中添加文件并在容器中查看修改结果### 在dockerfile中设置数据卷FROM debian:wheezyRUN useradd foo# VOLUME /ddata # 此处添加无效果，因为touch chown是在一个临时容器内的数据卷中执行的RUN touch /data/xRUN CHOWN -R foo:foo /data# VOLUME /ddata # 此处添加可以# docker run -v 指定到特定数据卷$ docker run -v /home/adrian/data:./data debian ls /data# 数据容器$ docker run --name dbdata postgres echo &#39;data-only container for postage&#39; # 创建一个postgreSQL的容器# 使用--volumes-from参数，使其他容器也可以使用这个数据卷$ docker run -d --volumes-from dbdata --name db1 postgres</code></pre><h3 id="如何在开发中使用docker以python-flask为例">如何在开发中使用docker,以python flask为例</h3><pre><code># 创建项目$ tree identidock.├── app│   └── identidock.py└── Dockerfile# 编辑flask文件$ vim app/identidock.pyfrom flask import Flaskapp = Flask(__name__)@app.route(&#39;/&#39;)def hello_world():    return &#39;hello world&#39;if __name__ == &#39;__main__&#39;:    app.run(debug=True, host=&#39;0.0.0.0&#39;)# 编辑dockerfile文件$ vim DockerfileFROM python:3.4RUN pip install Flask==0.10.1WORKDIR /appCOPY app /appCMD [&quot;python&quot;, &quot;identidock.py&quot;]# 创建镜像并使用容器$ docker build -t identidock ....$ docker run -d -p 5000:5000 identidock # 后台运行并将主机的5000端口转发到docker$ curl localhost:5000~ hello world# 将开发的代码目录挂载到docker上，这样就不必每次更改代码都需要重新bulid一次．$ docker run -d -p 5000:5000 -v &quot;$PWD&quot;/app:/app identidock  # -v &quot;$PWD&quot;/app:/app把位于主机的./app目录挂载到容器内，覆盖容器/app目录下的内容# 可以修改app目录下的文件查看改动情况# 以wsgi服务器运行flask并且修改设置用户$ vim DockerfileFROM python:3.4RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgi # 创建用户组和用户RUN pip install Flask==0.10.1 uWSGI==2.0.8WORKDIR /appCOPY app /appEXPOSE 9090 9191  # 声明主机和其他容器可以访问的端口号USER uwsgi #使用用户运行以下代码，默认docker是以root用户运行的，不安全CMD [&quot;uwsgi&quot;, &quot;--http&quot;, &quot;0.0.0.0:9090&quot;, &quot;--wsgi-file&quot;, &quot;/app/identidock.py&quot;, &quot;--callable&quot;, &quot;app&quot;, &quot;--stats&quot;, &quot;0.0.0.0:9191&quot;]</code></pre><h3 id="使用配置文件配置开发环境和生产环境">使用配置文件配置开发环境和生产环境</h3><pre><code># 创建脚本文件cmd.sh$ tree.├── app│   └── identidock.py├── cmd.sh└── Dockerfile$ vim cmd.sh#! /bin/bashset -eif [ &quot;$ENV&quot; = &#39;DEV&#39; ]; then  echo &quot;Running Development Server&quot;  exec python &quot;identidock.py&quot;else  echo &quot;Running Production Server&quot;  exec uwsgi --http 0.0.0.0:9090 --wsgi-file /app/identidock.py --callable app --stats 0.0.0.0:9191fi$ chmod +x cmd.sh$ vim DockerfileFROM python:3.4RUN groupadd -r uwsgi &amp;&amp; useradd -r -g uwsgi uwsgiRUN pip install Flask==0.10.1 uWSGI==2.0.8WORKDIR /appCOPY app /appCOPY cmd.sh /EXPOSE 9090 9191USER uwsgiCMD [&quot;/cmd.sh&quot;]$ docker build -t identidock .$ docker run -e &quot;ENV=DEV&quot; -p 5000:5000 identidock # 开发环境$ docker run -d -P identidock</code></pre><h3 id="使用compose自动化安装创建运行docker环境">使用compose自动化安装创建运行docker环境</h3><pre><code># 安装环境# https://docs.docker.com/compose/install/$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose$ sudo chmod +x /usr/local/bin/docker-compose$ docker-compose --version# 配置文件tree.├── app│   └── identidock.py├── cmd.sh├── docker-compose.yml└── Dockerfile# 编辑docker-compose文件$ vim docker-compose.ymlidentidock:  build: .  ports:    - &quot;5000:5000&quot;  environment:    ENV: DEV  volumes:    - ./app:/app~                    # 使用方法$ docker-compose up # 如果有镜像则直接运行，如果没有镜像则先build$ docker-compose build # 重新构建镜像$ docker-compose ps 获取由compose管理的容器状态$ docker-compose logs 输出日志$ docker-stop 停止容器，但不会删除他们</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linux命令记录</title>
      <link href="/2017/11/08/Linux%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/"/>
      <url>/2017/11/08/Linux%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="查看文件夹大小">查看文件夹大小</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -h your_path --max-depth=1</span><br></pre></td></tr></table></figure><p><strong>参数：</strong> &gt; -a或-all 为每个指定文件显示磁盘使用情况，或者为目录中每个文件显示各自磁盘使用情况。</p><blockquote><p>-b或-bytes 显示目录或文件大小时，以byte为单位。</p></blockquote><blockquote><p>-c或–total 除了显示目录或文件的大小外，同时也显示所有目录或文件的总和。</p></blockquote><blockquote><p>-D或–dereference-args 显示指定符号连接的源文件大小。</p></blockquote><blockquote><p>-h或–human-readable 以K，M，G为单位，提高信息的可读性。</p></blockquote><blockquote><p>-H或–si 与-h参数相同，但是K，M，G是以1000为换算单位,而不是以1024为换算单位。</p></blockquote><blockquote><p>-k或–kilobytes 以1024 bytes为单位。</p></blockquote><blockquote><p>-l或–count-links 重复计算硬件连接的文件。</p></blockquote><blockquote><p>-L<符号连接>或–dereference<符号连接> 显示选项中所指定符号连接的源文件大小。</符号连接></符号连接></p></blockquote><blockquote><p>-m或–megabytes 以1MB为单位。</p></blockquote><blockquote><p>-s或–summarize 仅显示总计，即当前目录的大小。</p></blockquote><blockquote><p>-S或–separate-dirs 显示每个目录的大小时，并不含其子目录的大小。</p></blockquote><blockquote><p>-x或–one-file-xystem 以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。</p></blockquote><blockquote><p>-X<文件>或–exclude-from=<文件> 在<文件>指定目录或文件。</文件></文件></文件></p></blockquote><blockquote><p>–exclude=<目录或文件> 略过指定的目录或文件。</目录或文件></p></blockquote><blockquote><p>–max-depth=<目录层数> 超过指定层数的目录后，予以忽略。</目录层数></p></blockquote><blockquote><p>–help 显示帮助。</p></blockquote><blockquote><p>–version 显示版本信息</p></blockquote><h1 id="pkg-config">pkg-config</h1><p><strong>作用</strong> &gt; 检查库的版本号。如果所需要的库的版本不满足要求，它会打印出错误信息，避免链接错误版本的库文件。</p><blockquote><p>获得编译预处理参数，如宏定义，头文件的位置。</p></blockquote><blockquote><p>获得链接参数，如库及依赖的其它库的位置，文件名及其它一些连接参数。</p></blockquote><blockquote><p>自动加入所依赖的其它库的设置。</p></blockquote><p><strong>命令</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pkg-config --cflags --libs gdk-3.0</span></span><br><span class="line">-I/usr/include/gtk-3.0 -I/usr/include/pango-1.0 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/lib/libffi-3.2.1/include -I/usr/include/fribidi -I/usr/include/harfbuzz -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/uuid -I/usr/include/cairo -I/usr/include/pixman-1 -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libmount -I/usr/include/blkid -I/usr/include/gio-unix-2.0 -pthread -I/usr/include/libdrm -lgdk-3 -lz -lpangocairo-1.0 -lpango-1.0 -lgdk_pixbuf-2.0 -lcairo-gobject -lcairo -lgobject-2.0 -lglib-2.0</span><br></pre></td></tr></table></figure></p><p><strong>PKG_CONFIG_PATH</strong> 环境变量PKG_CONFIG_PATH是用来设置.pc文件的搜索路径的，pkg-config按照设置路径的先后顺序进行搜索，直到找到指定的.pc 文件为止。这样，库的头文件的搜索路径的设置实际上就变成了对.pc文件搜索路径的设置。</p><p>在安装完一个需要使用的库后，比如Glib，一是将相应的.pc文件，如glib-2.0.pc拷贝到/usr/lib/pkgconfig目录下，二是通过设置环境变量PKG_CONFIG_PATH添加glib-2.0.pc文件的搜索路径。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加环境变量PKG_CONFIG_PATH，在bash中应该进行如下设置：</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PKG_CONFIG_PATH=/opt/gtk/lib/pkgconfig:<span class="variable">$PKG_CONFIG_PATH</span></span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 可以执行下面的命令检查是否 /opt/gtk/lib/pkgconfig 路径已经设置在PKG_CONFIG_PATH环境变量中：</span></span><br><span class="line">echo $PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure><p><strong>原理</strong> 正常情况下，库文件在编译通过后会生成prefix/lib/pkgconfig目录，目录下会包含.pc文件，例如：  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls -la /usr/include/gtk3.24/lib/pkgconfig</span></span><br><span class="line">总用量 40</span><br><span class="line">drwxr-xr-x 2 root root 4096  7月 24 15:56 .</span><br><span class="line">drwxr-xr-x 4 root root 4096  7月 24 15:56 ..</span><br><span class="line">-rw-r--r-- 1 root root  277  7月 24 15:56 gail-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  608  7月 24 15:56 gdk-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  608  7月 24 15:56 gdk-wayland-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  608  7月 24 15:56 gdk-x11-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  631  7月 24 15:56 gtk+-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  405  7月 24 15:56 gtk+-unix-print-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  631  7月 24 15:56 gtk+-wayland-3.0.pc</span><br><span class="line">-rw-r--r-- 1 root root  631  7月 24 15:56 gtk+-x11-3.0.pc</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim gtk+-3.0</span></span><br><span class="line"></span><br><span class="line">prefix=/usr/include/gtk3.24</span><br><span class="line">exec_prefix=$&#123;prefix&#125;</span><br><span class="line">libdir=$&#123;exec_prefix&#125;/lib</span><br><span class="line">includedir=$&#123;prefix&#125;/include</span><br><span class="line">targets=x11 wayland</span><br><span class="line"> </span><br><span class="line">gtk_binary_version=3.0.0</span><br><span class="line">gtk_host=x86_64-pc-linux-gnu</span><br><span class="line"> </span><br><span class="line">Name: GTK+</span><br><span class="line">Description: GTK+ Graphical UI Library</span><br><span class="line">Version: 3.24.10</span><br><span class="line">Requires: gdk-3.0 atk &gt;= 2.15.1 cairo &gt;= 1.14.0 cairo-gobject &gt;= 1.14.0 gdk-pixbuf-2.0 &gt;= 2.30.0 gio-2.0 &gt;= 2.53.4                                                                                        </span><br><span class="line">Requires.private: atk atk-bridge-2.0 wayland-client &gt;= 1.9.91 wayland-protocols &gt;= 1.12 xkbcommon &gt;= 0.2.0 wayland-cursor &gt;= 1.9.91 wayland-egl  epoxy &gt;= 1.4 fribidi &gt;= 0.19.7 pangoft2 gio-unix-2.0 &gt;= 2</span><br><span class="line">Libs: -L$&#123;libdir&#125; -lgtk-3</span><br><span class="line">Cflags: -I$&#123;includedir&#125;/gtk-3.0</span><br></pre></td></tr></table></figure><h1 id="端口与进程">端口与进程</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo netstat -nap | grep 5555  <span class="comment"># 查看指定端口被什么应用及进程号占用</span></span></span><br><span class="line">tcp        0      0 0.0.0.0:5555            0.0.0.0:*               LISTEN      8362/python</span><br><span class="line">tcp6       0      0 :::5555                 :::*                    LISTEN      8362/python</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo netstat -nap | grep 8362  <span class="comment"># 同上，查看端口号</span></span></span><br><span class="line">tcp        0      0 0.0.0.0:5555            0.0.0.0:*               LISTEN      8362/python                                       │apps                 product.sh        tmp</span><br><span class="line">tcp6       0      0 :::5555                 :::*                    LISTEN      8362/python                                       │➜  api git:(master) source .env/bin/activate</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     75201340 8362/python                                                            │(.env) ➜  api git:(master) pwd</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     75201341 8362/python                          </span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo <span class="built_in">kill</span> -s 9 pid  <span class="comment"># 杀死进程pid</span></span></span><br></pre></td></tr></table></figure><h1 id="systemctl">systemctl</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 可以返回systemd service文件路径</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl edit rabbitmq-server.service</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu本地配置SSL</title>
      <link href="/2017/11/07/Ubuntu%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AESSL/"/>
      <url>/2017/11/07/Ubuntu%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AESSL/</url>
      
        <content type="html"><![CDATA[<pre><code># 安装相关模块sudo a2enmod ssl   //启用ssl模块sudo apt-get install openssl  //安装openssl# 创建证书openssl genrsa -des3 -out server.key 1024  //创建CA签名(不使用密码去除-des3选项)openssl req -new -key server.key -out server.csr  //创建CSR(Certificate Signing Request)openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt  //自己签发证书sudo cp server.crt /etc/ssl/certssudo cp server.key /etc/ssl/private# 修改虚拟主机信息在&lt;VirtualHost *:80&gt;段中，DocumentRoot一行的下方加入内容：SSLEngine OnSSLOptions +StrictRequireSSLCertificateFile /etc/ssl/certs/server.crtSSLCertificateKeyFile /etc/ssl/private/server.key端口修改为：443，即&lt;VirtualHost *:443&gt;(ssl的端口)# 重启apache2sudo /etc/init.d/apache2 force-reloadsudo /etc/init.d/apache2 restart</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu配置Gitlab服务</title>
      <link href="/2017/06/19/Ubuntu%E9%85%8D%E7%BD%AEGitlab%E6%9C%8D%E5%8A%A1/"/>
      <url>/2017/06/19/Ubuntu%E9%85%8D%E7%BD%AEGitlab%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="安装">安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装相关服务 postfix为邮件服务</span></span><br><span class="line">sudo apt-get install curl openssh-server ca-certificates postfix</span><br><span class="line"><span class="comment"># 安装gitlab服务包</span></span><br><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br><span class="line">sudo apt-get install gitlab-ce</span><br></pre></td></tr></table></figure><h1 id="配置">配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置服务</span></span><br><span class="line">sudo vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line"><span class="comment">## GitLab URL</span></span><br><span class="line"><span class="comment">##! URL on which GitLab will be reachable.</span></span><br><span class="line"><span class="comment">##! For more details on configuring external_url see:</span></span><br><span class="line"><span class="comment">##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab</span></span><br><span class="line">external_url <span class="string">'http:/192.168.0.19:1500'</span>    <span class="comment"># 地址</span></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment"># 邮件基本设置</span></span><br><span class="line"><span class="comment">### Email Settings</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'Gitlab'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_reply_to'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_subject_suffix'</span>] = <span class="string">'Gitlab'</span></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment">### GitLab email server settings</span></span><br><span class="line"><span class="comment">###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html</span></span><br><span class="line"><span class="comment">###! **Use smtp instead of sendmail/postfix.**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_enable'] = true</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_address'] = "smtp.server"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_port'] = 465</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_user_name'] = "smtp user"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_password'] = "smtp password"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_domain'] = "example.com"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_authentication'] = "login"</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_enable_starttls_auto'] = true</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_tls'] = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮件服务地址</span></span><br><span class="line"><span class="comment"># QQ exmail (腾讯企业邮箱)</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"admin@uscnk.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"xxxxxxxxx"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'admin@uscnk.com'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx基本设置</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">## GitLab Nginx</span></span><br><span class="line"><span class="comment">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"></span><br><span class="line">nginx[<span class="string">'listen_addresses'</span>] = [<span class="string">'192.168.0.19'</span>]</span><br><span class="line">nginx[<span class="string">'losten_port'</span>] = 1500</span><br></pre></td></tr></table></figure><h1 id="启动">启动</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line"><span class="comment"># 重启邮件服务</span></span><br><span class="line">sudo /etc/init.d/postfix restart</span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">http://192.168.0.19:1500</span><br><span class="line">Username: root</span><br><span class="line">Password: 5iveL!fe</span><br></pre></td></tr></table></figure><h1 id="github与gitlab共存">github与gitlab共存</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># github账户邮箱， 将id_rsa改名成id_rsa_github</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"xxxxx@gmail.com"</span></span><br><span class="line"><span class="comment"># gitlab公司邮箱， 将id_rsa改名成id_rsa_gitlab</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"xxxxxx@work.com"</span></span><br><span class="line"><span class="comment"># 添加私钥</span></span><br><span class="line">ssh-add ~/.ssh/id_rsa_github</span><br><span class="line">ssh-add ~/.ssh/id_rsa_gitlab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在 ~/.ssh 目录下新建一个config文件</span></span><br><span class="line">touch config</span><br><span class="line">chmod 755 conifg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并添加以下内容</span></span><br><span class="line"><span class="comment"># gitlab</span></span><br><span class="line">Host github.com</span><br><span class="line">    HostName github.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line"><span class="comment"># github</span></span><br><span class="line">Host gitlib.com</span><br><span class="line">    HostName gitlib.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_gitlab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将id_rsa_github.pab内容添加到github中</span></span><br><span class="line"><span class="comment"># 测试结果</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment"># 将id_rsa_gitlab.pab内容添加到gitlab中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/mytest</span><br><span class="line"><span class="comment"># 在github中测试</span></span><br><span class="line">git remote add github https://github.com/zhcshine/mytest.git</span><br><span class="line">git push -u github master</span><br><span class="line"><span class="comment"># 在gitlab中测试</span></span><br><span class="line">git remote add gitlab http://192.168.0.19:1500/zhcshine/mytest.git</span><br><span class="line">git push -u gitlab master</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nagios监控集群服务</title>
      <link href="/2017/04/20/Nagios%E7%9B%91%E6%8E%A7%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1/"/>
      <url>/2017/04/20/Nagios%E7%9B%91%E6%8E%A7%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="安装服务器端">安装服务器端</h2><h3 id="安装lamp环境">安装lamp环境</h3><h3 id="配置nagios服务">配置nagios服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 192.168.0.206</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建nagiso用户</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo useradd nagios</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建apache用户，yum安装httpd服务会自动创建</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo useradd apache -M -s /sbin/nologin</span></span><br><span class="line">useradd：用户“apache”已存在</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建nagcmd用户组</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo groupadd nagcmd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将usermod加入nagcmd用户组</span></span><br><span class="line">sudo usermod -a -G nagcmd nagios</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将apache用户加入nagcmd用户组</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo usermod -a -G nagcmd apache</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看nagios用户所属的组</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> id -n -G nagios</span></span><br><span class="line">nagios nagcmd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看apace用户所属的组</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> id -n -G apache</span></span><br><span class="line">apache nagcmd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装nagiso服务</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo yum install nagios</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo yum install nagios-plugins-all</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装nrpe（服务器端和客户端都需要安装）</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo yum install nrpe</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动和开机启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo systemctl start nagios</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo systemctl <span class="built_in">enable</span> nagios</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo systemctl start nrpe</span></span><br><span class="line"><span class="meta">$</span><span class="bash">sudo systemctl <span class="built_in">enable</span> nrpe</span></span><br></pre></td></tr></table></figure><h3 id="配置web">配置web</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 取消认证</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/nagios/cgi.cfg</span></span><br><span class="line">use_authentication=0 # 此处将1改为0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ls /etc/httpd/conf.d</span></span><br><span class="line">autoindex.conf  nagios.conf  php.conf  README  userdir.conf  welcome.conf  xcache.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 其中nagiso.conf就是nagios的web配置文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 访问http://192.168.0.206/nagios，其中登陆密码在/etc/nagios/passwd文件中，具体文件位置可以在/etc/httpd/conf.d/nagios.conf中查看</span></span><br></pre></td></tr></table></figure><h2 id="安装客户端">安装客户端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 192.168.0.208</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装mysql，参考上方链接，配合生成check_mysql插件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装nrpe（服务器端和客户端都需要安装）</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum -y install epel-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install nrpe</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install nagios-plugins-all</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置nagios客户端</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/nagios/nrpe.cfg</span></span><br><span class="line">allowed_hosts=127.0.0.1,192.168.0.206 # 监控当前客户端的nagios服务器地址</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart nrpe</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> nrpe</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查启动结果</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo netstat -lntup | grep nrpe</span></span><br><span class="line">tcp        0      0 0.0.0.0:5666            0.0.0.0:*               LISTEN      2540/nrpe           </span><br><span class="line">tcp6       0      0 :::5666                 :::*                    LISTEN      2540/nrpe</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ps -ef | grep nrpe | grep -v grep</span></span><br><span class="line">nrpe      2540     1  0 11:59 ?        00:00:00 /usr/sbin/nrpe -c /etc/nagios/nrpe.cfg -d</span><br></pre></td></tr></table></figure><h2 id="配置服务器端">配置服务器端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 192.168.0.206</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tree /etc/nagios</span></span><br><span class="line">.</span><br><span class="line">├── cgi.cfg  </span><br><span class="line">├── conf.d  # 添加新的监视客户端信息</span><br><span class="line">│   └── web_one.cfg</span><br><span class="line">├── nagios.cfg  # 配置服务器端nagios</span><br><span class="line">├── nrpe.cfg # 配置服务器端nrpe</span><br><span class="line">├── objects</span><br><span class="line">│   ├── commands.cfg</span><br><span class="line">│   ├── contacts.cfg</span><br><span class="line">│   ├── localhost.cfg</span><br><span class="line">│   ├── printer.cfg</span><br><span class="line">│   ├── switch.cfg</span><br><span class="line">│   ├── templates.cfg</span><br><span class="line">│   ├── timeperiods.cfg</span><br><span class="line">│   └── windows.cfg</span><br><span class="line">├── passwd</span><br><span class="line">└── private</span><br><span class="line">    └── resource.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp /etc/nagios/objects/localhost.cfg  /etc/nagios/conf.d/web_one.cfg</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/nagios/conf.d/web_one.cfg <span class="comment"># 将localhost 改成web_one</span></span></span><br><span class="line">define host&#123;</span><br><span class="line">        use                     linux-server  </span><br><span class="line">        host_name         web_one</span><br><span class="line">        alias                   web_one</span><br><span class="line">        address              192.168.0.208</span><br><span class="line">&#125;</span><br><span class="line">define service&#123;</span><br><span class="line">        use                             local-service </span><br><span class="line">        host_name                 web_one</span><br><span class="line">        service_description    PING</span><br><span class="line">        check_command        check_ping!100.0,20%!500.0,60%</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nagios </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keepalived实现高可用集群</title>
      <link href="/2017/04/19/Keepalived%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"/>
      <url>/2017/04/19/Keepalived%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="centos6.8-192.168.0.106-master">CENTOS6.8 192.168.0.106 MASTER</h3><pre><code># 安装sudo yum install keepalived# 配置sudo vim /etc/keepalived/keepalived.conf! Configuration File for keepalivedglobal_defs {    # 这些信息是配置报警发邮件信息   notification_email {     acassen@firewall.loc     failover@firewall.loc     sysadmin@firewall.loc   }   notification_email_from Alexandre.Cassen@firewall.loc   smtp_server 192.168.200.1   smtp_connect_timeout 30     # 路由标识，同一局域网应该唯一   router_id lb01}vrrp_instance VI_1 {    # 当前角色是master    state MASTER        # 对外提供网络的接口    interface eth0        # 虚拟路由id标识，数字，必须和backup里相同实例一致    virtual_router_id 55        # 优先级，数字必须比backup大    priority 150    advert_int 1        # 权限认证，和backup一致    authentication {        auth_type PASS        auth_pass 1111    }    virtual_ipaddress {       192.168.0.200    }}# 重启sudo /etc/init.d/keepalived restart# 查看结果ip addr | grep 192.168.0.200</code></pre><h3 id="centos7.2-192.168.0.209-backup">CENTOS7.2 192.168.0.209 BACKUP</h3><pre><code># 安装sudo yum install keepalived# 配置sudo vim /etc/keepalived/keepalived.conf! Configuration File for keepalivedglobal_defs {   notification_email {     acassen@firewall.loc     failover@firewall.loc     sysadmin@firewall.loc   }   notification_email_from Alexandre.Cassen@firewall.loc   smtp_server 192.168.200.1   smtp_connect_timeout 30   router_id lb02  # 和master不一致}vrrp_instance VI_1 {    state BACKUP      # 和MASTER不一致    interface enp0s3    virtual_router_id 55    priority 100      # 和master不一致    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    virtual_ipaddress {        192.168.0.200    }}# 重启sudo systemctl restart keepalived# 查看结果ip addr | grep 192.168.0.200</code></pre><h3 id="centos6.8-192.168.0.106-nginx配置">CENTOS6.8 192.168.0.106 nginx配置</h3><pre><code># nginx配置文件    server {        listen       192.168.0.200:80; # 这里需要指定虚拟vip监听        server_name  localhost;        location / {                  # 只访问web站点           proxy_pass http://www_server_pools;        }        error_page   500 502 503 504  /50x.html;        location = /50x.html {            root   html;        }    }</code></pre><h3 id="centos7.2-192.168.0.209-配置nginx">CENTOS7.2 192.168.0.209 配置nginx</h3><pre><code># nginx配置文件   server {        listen       192.168.0.200:80;        server_name  localhost;        location / {                     # 只访问phone站点           proxy_pass http://www_phone_pools;        }        error_page   500 502 503 504  /50x.html;        location = /50x.html {            root   html;        }    }</code></pre><h3 id="测试结果">测试结果</h3><pre><code># 开启192.168.0.106，192.168.0.209的keepalive服务# 查看192.168.0.106$ ip addr | grep 192.168.0.200inet 192.168.0.200/32 scope global eth0 # 应该有这行结果# 查看192.168.0.209$ ip addr | grep 192.168.0.200 # 结果应该为空，如果有结果，表示脑裂，检查相关配置和防火墙# 访问http://192.168.200 curl 192.168.0.200 # 结果应该只访问web网站# 关停192.168.0.106的keepalive服务# 访问http://192.168.200 curl 192.168.0.200 # 结果应该只访问phone网站# 查看192.168.0.106$ ip addr | grep 192.168.0.200inet 192.168.0.200/32 scope global eth0 # 结果应该为空# 查看192.168.0.209$ ip addr | grep 192.168.0.200 inet 192.168.0.200/32 scope global enp0s3 # 此时有这行结果# 重启192.168.0.106的keepalive服务，应该恢复之前的测试结果</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>unittest单元测试</title>
      <link href="/2016/11/30/Unittest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
      <url>/2016/11/30/Unittest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="unittest基础使用方法">unittest基础使用方法</h1><pre><code># -*- coding:utf-8 -*-# calculator.py# 需要测试的类class Count:    def __init__(self, a, b):        self.a = int(a)        self.b = int(b)    def add(self):        return self.a + self.b# -*- coding: utf-8 -*-# test.py 测试类from calculator import Countimport unittestclass TestCount(unittest.TestCase):    def setUp(self):        print &#39;test start&#39;    def test_add(self):        j = Count(2,3)        self.assertEqual(j.add(), 5)    def test_add2(self):        j = Count(41, 76)        self.assertEqual(j.add(), 115, &#39;not equal&#39;)    def tearDown(self):        print &#39;test end&#39;if __name__ == &#39;__main__&#39;:    # 测试全部方法    # unittest.main()    # 构造测试集    suite = unittest.TestSuite()    # 指定测试方法    suite.addTest(TestCount(&#39;test_add2&#39;))    # 执行测试    runner = unittest.TextTestRunner()    runner.run(suite)</code></pre><h1 id="自动识别测试用例">自动识别测试用例</h1><pre><code># -*- coding:utf-8 -*-# calculator.py# 需要测试的类class Count:    def __init__(self, a, b):        self.a = int(a)        self.b = int(b)    def add(self):        return self.a + self.b    def sub(self):        return self.a - self.b# -*- coding: utf-8 -*-# testadd.py 测试类from calculator import Countimport unittestclass TestAdd(unittest.TestCase):    def setUp(self):        print &#39;test add start&#39;    def test_add(self):        j = Count(2,3)        self.assertEqual(j.add(), 5)    def test_add2(self):        j = Count(41, 76)        self.assertEqual(j.add(), 115, &#39;not equal&#39;)    def tearDown(self):        print &#39;test add end&#39;if __name__ == &#39;__main__&#39;:    # 测试全部方法    unittest.main()# -*- coding: utf-8 -*-# testsub.py 测试类from calculator import Countimport unittestclass TestSub(unittest.TestCase):    def setUp(self):        print &#39;test sub start&#39;    def test_sub(self):        j = Count(2,3)        self.assertEqual(j.sub(), 5)    def test_sub2(self):        j = Count(41, 76)        self.assertEqual(j.sub(), 115, &#39;not equal&#39;)    def tearDown(self):        print &#39;test sub end&#39;if __name__ == &#39;__main__&#39;:    # 测试全部方法    unittest.main()# -*- coding: utf-8 -*-# runtest.pyimport unittesttest_dir = &#39;./&#39;discover = unittest.defaultTestLoader.discover(test_dir, pattern=&#39;test*.py&#39;)if __name__ == &#39;__main__&#39;:    runner = unittest.TextTestRunner()    runner.run(discover)</code></pre><h1 id="断言方法啊">断言方法啊</h1><pre><code># unittest.TestCase.assertEqual(a, b, msg=None)   a == b# unittest.TestCase.assertNotEqual(a, b) a !=b  # unittest.TestCase.assertTrue(x)   x is True# unittest.TestCase.assertFalse(x)  x is False# unittest.TestCase.assertIs(a, b)  x is b# unittest.TestCase.assertIsNot(a, b)  a is not b# unittest.TestCase.assertIsNotNone(x)  x is not None# unittest.TestCase.assertIn(a, b)  a in b# unittest.TestCase.assertNotIn(a, b) a not in b# unittest.TestCase.assertNotIsInstance(a, b) isinstance(a,b)# unittest.TestCase.assertNotIsInstance(a, b) not isinstance(a,b)</code></pre><h1 id="跳过测试与预期失败">跳过测试与预期失败</h1><pre><code># -*- coding: utf-8 -*-# test.pyimport unittestclass MyTest(unittest.TestCase):    def setUp(self):        pass    def tearDown(self):        pass    @unittest.skip(u&#39;直接跳过测试&#39;)    def test_skip(self):        print &#39;test aaa&#39;    @unittest.skipIf(3 &gt; 2, u&#39;条件满足时跳过测试&#39;)    def test_skip_if(self):        print &#39;test bbb&#39;    @unittest.skipUnless(3 &gt; 2, u&#39;条件满足时执行测试&#39;)    def test_skip_unless(self):        print &#39;test ccc&#39;    # 不管测试成功与否，都标记为失败    @unittest.expectedFailure    def test_expected_failure(self):        print &#39;test ddd&#39;        self.assertEqual(2, 3)if __name__ == &#39;__main__&#39;:    unittest.main()</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>selenium入门基础</title>
      <link href="/2016/11/30/Selenium%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/30/Selenium%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="安装及基本操作">安装及基本操作</h1><pre><code># -*- coding:utf-8 -*-# 环境: ubuntu14.04# pip install seleninum# firefox# https://github.com/mozilla/geckodriver/releases 下载对应版本放在$PATH目录下# google# https://sites.google.com/a/chromium.org/chromedriver/downloads 下载对应版本放在$PATH目录下# http://www.seleniumhq.org/download/    其他浏览器参考# sudo apt-get install phantomjs  安装无界面webkit浏览器引擎from selenium import webdriverfrom selenium.webdriver.common.by import Bydriver = webdriver.Firefox()# driver = webdriver.Chrome()# driver =  webdriver.PhantomJS(executable_path=&#39;/usr/bin/phantomjs&#39;)driver.get(&#39;http://www.baidu.com&#39;)# 定位元素# 根据id定位find_id = driver.find_element_by_id(&#39;wrapper&#39;)find_id = driver.find_element(By.ID, &#39;wrapper&#39;)# 根据name属性定位find_name = driver.find_element_by_name(&#39;wd&#39;)find_name = driver.find_element(By.NAME, &#39;wd&#39;)# 根据class定位find_class = driver.find_element_by_class_name(&#39;head_wrapper&#39;)find_class = driver.find_element(By.CLASS_NAME, &#39;head_wrapper&#39;)# 根据标签名称定位find_tag = driver.find_element_by_tag_name(&#39;div&#39;)find_tag = driver.find_element(By.TAG_NAME, &#39;div&#39;)# 根据链接文本定位find_a_text = driver.find_element_by_link_text(&#39;hao123&#39;)find_a_text = driver.find_element(By.LINK_TEXT, &#39;hao123&#39;)# 根据部分链接文本定位find_a_text = driver.find_element_by_partial_link_text(&#39;hao&#39;)find_a_text = driver.find_element(By.PARTIAL_LINK_TEXT, &#39;hao&#39;)# 根据绝对位置定位find_x_path = driver.find_elements_by_xpath(&#39;/html/body/div&#39;)find_x_path = driver.find_element(By.XPATH, &#39;/html/body/div&#39;)# 支持层级，属性，逻辑运算符结合使用find_x_path = driver.find_element_by_xpath(&quot;//input[@id=&#39;kw&#39;]&quot;)  # // 当前目录下的某个目录下# Css定位find_css = driver.find_elements_by_css_selector(&#39;.s_ipt&#39;)find_css = driver.find_element(By.CSS_SELECTOR, &#39;.s_ipt&#39;)# 设置浏览器宽高driver.set_window_size(480, 800)driver.get(&#39;http://www.126.com&#39;)# 控制浏览器前进倒退driver.back()driver.forward()# 刷新浏览器(F5)driver.refresh()# 当前页面print driver.current_url()# 元素操作# dom = driver.find_element(By.ID, &#39;kw&#39;)# dom.clear()  # 清除文本# dom.send_keys()  # 模拟键盘输入# dom.click()  # 点击元素# dom.submit()  # 模拟表单提交# dom.size()  # 返回元素的尺寸# dom.text()  # 返回元素的文本# dom.get_attribute(name)  # 返回元素的属性值# dom.is_displayed()  # 设置该元素是否可见# 鼠标操作from selenium.webdriver.common.action_chains import ActionChainsdriver.get(&#39;http://www.baidu.com&#39;)# context_click 鼠标右键点击right_click = driver.find_element_by_id(&#39;xx&#39;)# perform 执行所有ActionChains中存储的动作ActionChains(driver).context_click(right_click).perform()# above 鼠标悬停above = driver.find_element_by_id(&#39;xxx&#39;)ActionChains(driver).move_to_element(above).perform()# double_click 鼠标双击# drag_and_drop(source, target) 鼠标拖放# 键盘事件from selenium.webdriver.common.keys import Keysfind_id.send_keys(Keys.BACK_SPACE) # 删除键find_id.send_keys(Keys.SPACE)  # 空格键find_id.send_keys(Keys.TAB)  # tab键find_id.send_keys(Keys.ESCAPE)  # ESCfind_id.send_keys(Keys.ENTER)  # 回车键find_id.send_keys(Keys.CONTROL, &#39;c&#39;)  # 复制find_id.send_keys(Keys.CONTROL, &#39;v&#39;)  # 剪贴find_id.send_keys(Keys.F1) # F1# driver.quit()</code></pre><h1 id="webdriver原理">webdriver原理</h1><pre><code># -*- coding:utf-8 -*-from selenium import webdriverimport logginglogging.basicConfig(level=logging.DEBUG)driver = webdriver.Firefox()driver.get(&#39;http://www.baidu.com&#39;)driver.find_element_by_id(&#39;kw&#39;).send_keys(&#39;selenium&#39;)driver.find_element_by_id(&#39;su&#39;).click()driver.quit()</code></pre><h1 id="显示等待">显示等待</h1><pre><code># -*- coding:utf-8 -*-# 显示等待from selenium import webdriverfrom selenium.webdriver.common.by import Byfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECdriver = webdriver.Firefox()driver.get(&#39;http://www.baidu.com&#39;)# 显示等待# 参数driver： 浏览器驱动# 参数timeout： 最大超时时间，单位秒# 参数poll_frequency： 检测的间隔时间，默认为0.5秒# 参数ignored_exceptions: 超时异常信息，默认为NoSuchElementException# WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)# until(method, message=&#39;&#39;) 调用该方法提供的驱动程序作为参数，直到返回True# until_not(method, message=&#39;&#39;) 调用该方法提供的驱动程序作为参数，直到返回False# EC.title_is 判断当前页面的标题是否是否等于预期# EC.title_contains 判断当前页面的标题是否包含预期的字符串# EC.presence_of_element_located 判断元素是否被加载在DOM树中，并不代表当前元素可见# EC.visibility_of_element_located 判断元素是否可见（可见并非代表元素非隐藏，并且元素的宽和高均不等于0）# EC.visibility_of 与visibility_of_element_located相同，该方法接受的参数为定位后的元素# EC.presence_of_all_elements_located 判断是否至少有一个元素存在与DOM树中# EC.text_to_be_present_in_element 判断某个元素的text是否包含预期的字符串# EC.text_to_be_present_in_element_value 判断某个元素的vaule属性是否包含了预期的字符串# EC.frame_to_be_available_and_switch_to_it 判断该表单是否可以切换进去，如果可以，返回True并switch进去，否则返回false# EC.invisibility_of_element_located 判断某个元素是否不存在于DOM树中或者不可见# EC.element_to_be_clickable 判断某个元素是否可以点击# EC.staleness_of 等到一个元素从DOM树中移除# EC.element_to_be_selected 判断某个元素是否被选中，一般用于下拉菜单# EC.element_selection_state_to_be 判断某个元素的选中状态是否符合预期, 参数为定位后的元素# EC.element_located_selection_state_to_be 判断某个元素的选中状态是否符合预期,该方法接受的参数为定位# EC.alert_is_present 判断页面上是否有alert# driver.find_element_by_id().is_displayed() 判断元素是否可见element = WebDriverWait(driver, 5, 0.5).until(EC.presence_of_element_located((By.ID, &#39;kw&#39;)))element.send_keys(&#39;selenium&#39;)# driver.quit()</code></pre><h1 id="隐式等待">隐式等待</h1><pre><code># -*- coding:utf-8 -*-# 隐式等待from selenium import webdriverfrom selenium.common.exceptions import NoSuchElementExceptionfrom time import ctimefrom time import sleepdriver = webdriver.Firefox()# sleep(10)driver.implicitly_wait(10)driver.get(&#39;http://www.baidu.com&#39;)print ctime()try:    driver.find_element_by_id(&#39;kw22&#39;).send_keys(&#39;selenium&#39;)except NoSuchElementException as e:    print efinally:    print ctime()</code></pre><h1 id="执行js代码">执行js代码</h1><pre><code># -*- coding:utf-8 -*-# 执行js代码from selenium import webdriverfrom time import sleep# 访问百度driver = webdriver.Firefox()driver.get(&#39;http://www.baidu.com&#39;)driver.set_window_size(600, 600)driver.find_element_by_id(&#39;kw&#39;).send_keys(&#39;selenium&#39;)driver.find_element_by_id(&#39;su&#39;).click()sleep(2)js = &#39;window.scrollTo(100, 450);&#39;driver.execute_script(js)sleep(3)# driver.quit()</code></pre><h1 id="处理cookie">处理cookie</h1><pre><code># -*- coding:utf-8 -*-# cookie处理from selenium import webdriverdriver = webdriver.Firefox()driver.get(&#39;http://www.youdao.com&#39;)driver.add_cookie({&#39;name&#39;: &#39;name-a&#39;, &#39;value&#39;: &#39;value-b&#39;})# 获取cookie信息cookies = driver.get_cookies()print cookiesfor cookie in cookies:    print cookie    print &#39;{} -&gt; {}&#39;.format(cookie[&#39;name&#39;], cookie[&#39;value&#39;])driver.quit()</code></pre><h1 id="截图">截图</h1><pre><code># -*- coding:utf-8 -*-# 窗口截图from selenium import webdriverfrom time import sleep# driver = webdriver.Firefox()driver =  webdriver.PhantomJS(executable_path=&#39;/usr/bin/phantomjs&#39;)driver.get(&#39;http://www.baidu.com&#39;)driver.find_element_by_id(&#39;kw&#39;).send_keys(&#39;selenium&#39;)driver.find_element_by_id(&#39;su&#39;).click()sleep(2)driver.get_screenshot_as_file(&#39;./screen.png&#39;)driver.quit()</code></pre><h1 id="播放视频">播放视频</h1><pre><code># -*- coding:utf-8 -*-from selenium import webdriverfrom time import sleepdriver = webdriver.Firefox()driver.get(&#39;http://videojs.com&#39;)video = driver.find_element_by_xpath(&#39;body/Setion[1]/div/video&#39;)# 返回播放文件地址url = driver.execute_script(&#39;return arguments[0].currentSrc;&#39;, video)print url# 播放视频print &#39;start&#39;driver.execute_script(&#39;return arguments[0].play()&#39;, video)# 播放15秒sleep(15)# 暂停播放print &#39;stop&#39;driver.execute_script(&#39;arguments[0].pause()&#39;, video)# driver.quit()</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wordpress插件开发基础入门</title>
      <link href="/2016/11/10/Wordpress%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
      <url>/2016/11/10/Wordpress%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="创建插件">创建插件</h1><pre><code>├── hanchang-copyright│   └── hanchang-copyright.php# hanchang-copyright.php&lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Version: 1.0Author: hanchangAuthor URI: http://www.zhuohc.comLicense: GPLv2*/</code></pre><h1 id="插件启用和停用初始化">插件启用和停用初始化</h1><pre><code># hanchang-copyright.php&lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Version: 1.0Author: hanchangAuthor URI: http://www.zhuohc.comLicense: GPLv2*///定义插件启动时候调用的方法register_activation_hook( __FILE__, &#39;hanchang_copyright_install&#39;);function hanchang_copyright_install() {    //插件启动，添加一个默认的版权信息    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&#39;color:red&#39;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );}//定义插件停用时候调用的方法register_deactivation_hook( __FILE__, &#39;hanchang_copyright_deactivation&#39;);function hanchang_copyright_deactivation() {    //插件停用，设置停用标识为1    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );}</code></pre><h1 id="删除插件">删除插件</h1><pre><code>.├── hanchang-copyright.php└── uninstall.php # 删除插件执行的文件# uninstall.php&lt;?// 如果 uninstall 不是从 WordPress 调用，则退出if( !defined( &#39;WP_UNINSTALL_PLUGIN&#39; ) )exit();//删除插件创建的项目，以确保不占用数据库资源delete_option( &#39;hanchang_copyright_deactivation&#39; );delete_option( &#39;hanchang_copyright_text&#39; );</code></pre><h1 id="add_action">add_action</h1><pre><code>add_action(&quot;$tag钩子名称&quot;, &quot;$function_to_do执行函数&quot;, $priorrity执行优先级, $accepted_arga带参数函数的参数个数)# hanchang-copyright.php//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insertadd_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );function hc_copyright_insert(){    //输出一段字符串    echo get_option( &quot;hc_copyright_text&quot; );}add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );function hanchang_copyright_insert_new() {    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;}add_action( &#39;save_post&#39;, &#39;save_post_meta&#39;, 10, 2 );function save_post_meta( $post_id, $post ) {    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );}</code></pre><h1 id="常见钩子">常见钩子</h1><pre><code>init 加载初始化wp_head 加载添加到head标签中的内容wp_enqueue_scripts 加载css或者js文件wp_foot 加载添加到底部内容save_post 添加保存文章wp_trash_post 将文章添加到回收站delete_post 将文章删除wp_insert_comment 插入评论user_register 用户注册# hanchang-copyright.php&lt;?php/*Plugin Name: hanchang-copyrightPlugin URI: http://www.zhuohc.comDescription: 在页脚显示一段版权信息Version: 1.0Author: hanchangAuthor URI: http://www.zhuohc.comLicense: GPLv2*///定义插件启动时候调用的方法register_activation_hook( __FILE__, &#39;hanchang_copyright_install&#39;);function hanchang_copyright_install() {    //插件启动，添加一个默认的版权信息    update_option( &quot;hanchang_copyright_text&quot;, &quot;&lt;p style=&#39;color:red&#39;&gt;本站点所有文章均为原创，转载请注明出处！&lt;/p&gt;&quot; );}//定义插件停用时候调用的方法register_deactivation_hook( __FILE__, &#39;hanchang_copyright_deactivation&#39;);function hanchang_copyright_deactivation() {    //插件停用，设置停用标识为1    update_option( &quot;hanchang_copyright_deactivation&quot;, &quot;yes&quot; );}//为 wp_footer 钩子挂载一个新的动作 hc_copyright_insertadd_action( &quot;wp_footer&quot;, &quot;hc_copyright_insert&quot; );function hc_copyright_insert(){    //输出一段字符串    echo get_option( &quot;hc_copyright_text&quot; );}add_action( &quot;wp_head&quot;, &quot;hanchang_copyright_insert_new&quot; );function hanchang_copyright_insert_new() {    echo &quot;&lt;script&gt;alert(1);&lt;/script&gt;&quot;;}add_action( &#39;save_post&#39;, &#39;save_post_meta&#39;, 10, 2 );function save_post_meta( $post_id, $post ) {    update_post_meta( $post_id, &quot;save-time&quot;, &quot;更新时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) );}//在输出内容之前，给页面管理添加摘要功能add_action( &#39;init&#39;, &#39;hc_add_excerpts_to_pages&#39; );function hc_add_excerpts_to_pages() {    //给页面管理添加摘要的功能    add_post_type_support( &#39;page&#39;, array( &#39;excerpt&#39; ) );}//wp_head钩子add_action(&#39;wp_head&#39;,&#39;hc_wp_head&#39;);function hc_wp_head() {    //只有首页输出描述    if( is_home() ){ ?&gt;        &lt;meta name=&quot;description&quot; content=&quot;&lt;? bloginfo(&#39;description&#39;); ?&gt;&quot; /&gt;    &lt;? }}//自定义引用样式表function hc_enqueue_style() {    wp_enqueue_style( &#39;core&#39;, plugins_url(&#39;css/hc_copyrighy.css&#39;, __FILE__) , false );}//自定义引用脚本文件function hc_enqueue_script() {    wp_enqueue_script( &#39;my-js&#39;, plugins_url(&#39;js/hc_copyrighy.js&#39;, __FILE__), false );}//引用文件的钩子add_action( &#39;wp_enqueue_scripts&#39;, &#39;hc_enqueue_style&#39;, 5 );add_action( &#39;wp_enqueue_scripts&#39;, &#39;hc_enqueue_script&#39;, 7 );//删除所有挂载在 wp_enqueue_scripts 钩子上的方法remove_all_actions( &#39;wp_enqueue_scripts&#39;, 5 );//评论被添加的时候触发add_action( &#39;wp_insert_comment&#39;, &#39;comment_inserted&#39;, 10, 2 );//移除 wp_insert_comment 钩子上的 comment_inserted 方法remove_action( &#39;wp_insert_comment&#39;, &#39;comment_inserted&#39;, 10 );function comment_inserted($comment_id, $comment_object ) {    //获取该评论所在文章的评论总数    $comments_count = wp_count_comments( $comment_object-&gt;comment_post_ID );    $commentarr = array();    $commentarr[&#39;comment_ID&#39;] = $comment_id;    //修改评论的内容，在评论内容前加上 “第{$comments_count-&gt;total_comments}个评论：” 这么一段字符串    $commentarr[&#39;comment_content&#39;] = &quot;第{$comments_count-&gt;total_comments}个评论：&quot; . $comment_object-&gt;comment_content;    wp_update_comment( $commentarr );}add_action( &#39;user_register&#39;, &#39;myplugin_registration_save&#39;, 10, 1 );function myplugin_registration_save( $user_id ) {    //将新用户的个人说明，设置为注册时间    wp_update_user( array( &#39;ID&#39; =&gt; $user_id, &#39;description&#39; =&gt; &quot;注册时间：&quot; . date(&quot;Y-m-d H:i:s&quot;) ) );}?&gt;</code></pre><h1 id="过滤器">过滤器</h1><pre><code>add_filter($tag过滤器名称, $function_to_add需要添加的函数, $priority优先级, $acceptedargs添加的参数数量)# hanchang-copyright.php//一开始，我们设置一个变量$value = &quot;hello&quot;;//给名为 hc_filter 的过滤器，挂载一个 hc_filter_fun 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun 方法进行过滤//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun&quot; );//给名为 hc_filter 的过滤器，再挂载一个 hc_filter_fun_add_time 方法，传递给 hc_filter 的变量都会经过 hc_filter_fun、hc_filter_fun_add_time 两个方法进行过滤//add_filter( &quot;hc_filter&quot;, &quot;hc_filter_fun_add_time&quot; );//对 $value 值使用名为 hc_filter 的过滤器进行过滤，这个时候，由于 hc_filter 过滤器只挂载了 hc_filter_fun 方法，因此，只使用 hc_filter_fun 方法 过滤了一次，并且返回给 $myvar 变量//$myvar = apply_filters( &quot;hc_filter&quot;, $value );add_filter( &quot;the_content&quot;, &quot;hc_filter_fun&quot; );add_filter( &quot;the_content&quot;, &quot;hc_filter_fun_add_time&quot; );</code></pre><h1 id="带参数的过滤器">带参数的过滤器</h1><pre><code># hanchang-copyright.phpfunction suppress_if_blurb( $title, $id = null ) {    if ( in_category(&#39;wpcj&#39;, $id ) ) {        return &#39;不显示标题&#39;;    }    return $title . &quot;...&quot;;}//对 the_title 过滤器挂载一个 suppress_if_blurb 方法，优先级为10，传递的参数有2个add_filter( &#39;the_title&#39;, &#39;suppress_if_blurb&#39;, 10, 2 );</code></pre><h1 id="常见过滤器">常见过滤器</h1><pre><code>the_content 文章内容 content_save_pre 文章保存前the_title 文章标题wp_handle_upload_prefilter 上传文件之前</code></pre><h1 id="创建菜单">创建菜单</h1><pre><code>add_menu_page  # 添加菜单add_submenu_page  # 添加子菜单# hanchang-copyright.php// admin_menu钩子挂载创建菜单方法add_action( &#39;admin_menu&#39;, &#39;hc_create_menu&#39; );function hc_create_menu() {    // 创建顶级菜单    add_menu_page(        &#39;Hanchang的插件首页&#39;, // 菜单title标题        &#39;hanchang-copyright&#39;,  // 菜单名称，显示在后台管理页面侧边栏        &#39;manage_options&#39;, // 浏览插件所需要的权限=管理员权限        &#39;hanchang_copyright&#39; ,  // 菜单别名，不能与其他插件冲突        &#39;hanchang_settings_page&#39;,  // 菜单需要显示的页面，调用的哪个方法        plugins_url( &#39;/images/icon.png&#39;, __FILE__ )  // 调用图标    );    // 创建子菜单    add_submenu_page(        &#39;hanchang_copyright&#39;,  // 父级菜单别名        &#39;关于HC的插件&#39;,  // 菜单title标题        &#39;关于&#39;,  //  菜单名称，显示在后台管理页面侧边栏        &#39;manage_options&#39;,  // 浏览插件所需要的权限=管理员权限        &#39;hc_copyright_about&#39;,  // 菜单别名，不能与其他插件冲突        &#39;hc_create_submenu_menu&#39;  // 调用方法    );}function hanchang_settings_page() {    ?&gt;    &lt;h2&gt;插件顶级菜单&lt;/h2&gt;    &lt;?}function hc_create_submenu_menu() {    ?&gt;    &lt;h2&gt;子菜单&lt;/h2&gt;    &lt;?}</code></pre><p>#开发 小工具</p><pre><code>#hanchang-copyright.php// 使用 widgets_init 动作钩子来执行自定义的函数add_action( &#39;widgets_init&#39;, &#39;hc_register_widgets&#39; );// 注册小工具function hc_register_widgets() {    register_widget( &#39;hc_widget_info&#39; );}//使用 WP_Widget 类来创建小工具class hc_widget_info extends WP_Widget {    //构造函数    public function __construct() {        $widget_ops = array(            &#39;classname&#39; =&gt; &#39;hc_widget_info&#39;,            &#39;description&#39; =&gt; &#39;显示作者的个人信息&#39;        );        $this-&gt;WP_Widget( &#39;显示作者个人信息&#39;, &#39;作者的小工具&#39;, $widget_ops );    }    //小工具管理界面    public function form( $instance ) {        $defaults = array( &#39;title&#39; =&gt; &#39;作者的个人信息&#39;, &#39;xingming&#39; =&gt; &#39;作者&#39;, &#39;book&#39; =&gt; &#39;《作者》&#39; );        $instance = wp_parse_args( (array) $instance, $defaults );        $title = $instance[&#39;title&#39;];        $xingming = $instance[&#39;xingming&#39;];        $book = $instance[&#39;book&#39;];        ?&gt;        &lt;p&gt;标题: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &#39;title&#39; ); ?&gt;&quot; type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $title ); ?&gt;&quot; /&gt;&lt;/p&gt;        &lt;p&gt;姓名: &lt;input class=&quot;widefat&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( &#39;xingming&#39; ); ?&gt; &quot;type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $xingming ); ?&gt; &quot; /&gt;&lt;/p&gt;        &lt;p&gt;著作: &lt;textarea class=&quot;widefat&quot; name=&quot; &lt;?php echo $this-&gt;get_field_name( &#39;book&#39; ); ?&gt; &quot; /&gt;&lt;?php echo esc_attr( $book ); ?&gt;&lt;/textarea&gt; &lt;/p&gt;        &lt;?php    }    //保存小工具设置    public function update( $new_instance, $old_instance ) {        $instance = $old_instance;        $instance[&#39;title&#39;] = strip_tags( trim( $new_instance[&#39;title&#39;] ) );        $instance[&#39;xingming&#39;] = strip_tags( trim(  $new_instance[&#39;xingming&#39;] ) );        $instance[&#39;book&#39;] = strip_tags( trim( $new_instance[&#39;book&#39;] ) );        return $instance;    }    //显示小工具    public function widget( $args, $instance ) {        extract( $args );        $title = apply_filters( &#39;widget_title&#39;, $instance[&#39;title&#39;] );        $xingming = empty( $instance[&#39;xingming&#39;] ) ? &#39; &#39; : $instance[&#39;xingming&#39;];        $book = empty( $instance[&#39;book&#39;] ) ? &#39; &#39; : $instance[&#39;book&#39;];        echo &#39;&lt;p&gt; 标题: &#39; . $title . &#39;&lt;/p&gt;&#39;;        echo &#39;&lt;p&gt; 姓名: &#39; . $xingming . &#39;&lt;/p&gt;&#39;;        echo &#39;&lt;p&gt; 著作: &#39; . $book . &#39;&lt;/p&gt;&#39;;    }}</code></pre><h1 id="添加元数据框">添加元数据框</h1><pre><code># hanchang-copyright.php/** * 添加一个元数据框到 post 和 page 的管理界面中 */function myplugin_add_meta_box() {    $screens = array( &#39;post&#39;, &#39;page&#39; );    add_meta_box(        &#39;myplugin_sectionid&#39;,  // 元数据框的html代码中的id值        &#39;转载自&#39;,  // 元数据框标题        &#39;myplugin_meta_box_callback&#39;,  // 回调函数名称，输出元数据框中的内容        $screens  // 元数据框需要添加在哪个分类内的（文章或者页面）    );}//需要给 add_meta_boxes 钩子，挂载一个自定义的方法add_action( &#39;add_meta_boxes&#39;, &#39;myplugin_add_meta_box&#39; );/** * 元数据框展示代码 */function myplugin_meta_box_callback( $post ) {    // 添加一个验证信息，这个在保存元数据的时候用到    wp_nonce_field( &#39;myplugin_save_meta_box_data&#39;, &#39;myplugin_meta_box_nonce&#39; );    /*     * 输出元数据信息     */    $value = get_post_meta( $post-&gt;ID, &#39;_zzurl&#39;, true );    echo &#39;&lt;label for=&quot;myplugin_new_field&quot;&gt;&#39;;    _e( &#39;本文章转载自：&#39; );    echo &#39;&lt;/label&gt; &#39;;    echo &#39;&lt;input type=&quot;text&quot; id=&quot;_zzurl&quot; name=&quot;_zzurl&quot; value=&quot;&#39; . esc_attr( $value ) . &#39;&quot; size=&quot;25&quot; /&gt;&#39;;}function myplugin_save_meta_box_data( $post_id ) {    //验证是否为有效信息    if ( ! isset( $_POST[&#39;myplugin_meta_box_nonce&#39;] ) ) {        return;    }    if ( ! wp_verify_nonce( $_POST[&#39;myplugin_meta_box_nonce&#39;], &#39;myplugin_save_meta_box_data&#39; ) ) {        return;    }    if ( defined( &#39;DOING_AUTOSAVE&#39; ) &amp;&amp; DOING_AUTOSAVE ) {        return;    }    // Check the user&#39;s permissions.    if ( isset( $_POST[&#39;post_type&#39;] ) &amp;&amp; &#39;page&#39; == $_POST[&#39;post_type&#39;] ) {        if ( ! current_user_can( &#39;edit_page&#39;, $post_id ) ) {            return;        }    } else {        if ( ! current_user_can( &#39;edit_post&#39;, $post_id ) ) {            return;        }    }    if ( ! isset( $_POST[&#39;_zzurl&#39;] ) ) {        return;    }    $my_data = sanitize_text_field( $_POST[&#39;_zzurl&#39;] );    update_post_meta( $post_id, &#39;_zzurl&#39;, $my_data );}//文章保存的时候，会调用 save_post 钩子，因此我们要借助这个钩子来保存元数据框内的数据add_action( &#39;save_post&#39;, &#39;myplugin_save_meta_box_data&#39; );</code></pre><h1 id="后台常见css样式表">后台常见css样式表</h1><pre><code># copyright.phpfunction hanchang_settings_page() {    ?&gt;    &lt;div class=&quot;wrap&quot;&gt;        &lt;h2&gt;插件顶级菜单&lt;/h2&gt;        &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;设置保存成功&lt;/div&gt;        &lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;保存出现错误&lt;/div&gt;        &lt;p&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-primary&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-secondary&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-large&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-small&quot; /&gt;            &lt;input type=&quot;submit&quot; name=&quot;Save&quot; value=&quot;保存设置&quot; class=&quot;button button-hero&quot; /&gt;        &lt;/p&gt;        &lt;p&gt;            &lt;a href=&quot;#&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button button-primary&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button button-secondary&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button button-large&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button button-small&quot;&gt;搜索&lt;/a&gt;            &lt;a href=&quot;#&quot; class=&quot;button button-hero&quot;&gt;搜索&lt;/a&gt;        &lt;/p&gt;        &lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;            &lt;table class=&quot;form-table&quot;&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;th&gt;&lt;label for=&quot;xingming&quot;&gt;姓名：&lt;/label&gt;&lt;/th&gt;                    &lt;td&gt;&lt;input id=&quot;xingming&quot; name=&quot;xingming&quot; /&gt;&lt;/td&gt;                &lt;/tr&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;th&gt;&lt;label for=&quot;shenfen&quot;&gt;身份：&lt;/label&gt;&lt;/th&gt;                    &lt;td&gt;                        &lt;select name=&quot;shenfen&quot;&gt;                            &lt;option value=&quot;在校&quot;&gt;在校&lt;/option&gt;                            &lt;option value=&quot;毕业&quot;&gt;毕业&lt;/option&gt;                        &lt;/select&gt;                    &lt;/td&gt;                &lt;/tr&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;th&gt;&lt;label for=&quot;tongyi&quot;&gt;同意注册&lt;/label&gt;&lt;/th&gt;                    &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;tongyi&quot; /&gt;&lt;/td&gt;                &lt;/tr&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;th&gt;&lt;label for=&quot;xingbie&quot;&gt;性别&lt;/label&gt;&lt;/th&gt;                    &lt;td&gt;                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;男&quot; /&gt; 男                        &lt;input type=&quot;radio&quot; name=&quot;xingbie&quot; value=&quot;女&quot; /&gt; 女                    &lt;/td&gt;                &lt;/tr&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;th&gt;&lt;label for=&quot;beizhu&quot;&gt;备注&lt;/label&gt;&lt;/th&gt;                    &lt;td&gt;&lt;textarea name=&quot;beizhu&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;                &lt;/tr&gt;                &lt;tr valign=&quot;top&quot;&gt;                    &lt;td&gt;                        &lt;input type=&quot;submit&quot; name=&quot;save&quot; value=&quot;保存&quot; class=&quot;button-primary&quot; /&gt;                        &lt;input type=&quot;submit&quot; name=&quot;reset&quot; value=&quot;重置&quot; class=&quot;button-secondary&quot; /&gt;                    &lt;/td&gt;                &lt;/tr&gt;            &lt;/table&gt;        &lt;/form&gt;        &lt;table class=&quot;widefat striped&quot;&gt;            &lt;thead&gt;            &lt;tr&gt;                &lt;th&gt;序号&lt;/th&gt;                &lt;th&gt;姓名&lt;/th&gt;            &lt;/tr&gt;            &lt;/thead&gt;            &lt;tbody&gt;            &lt;tr&gt;                &lt;td&gt;1&lt;/td&gt;                &lt;td&gt;黄聪&lt;/td&gt;            &lt;/tr&gt;            &lt;tr&gt;                &lt;td&gt;2&lt;/td&gt;                &lt;td&gt;黄聪&lt;/td&gt;            &lt;/tr&gt;            &lt;tr&gt;                &lt;td&gt;3&lt;/td&gt;                &lt;td&gt;黄聪&lt;/td&gt;            &lt;/tr&gt;            &lt;/tbody&gt;            &lt;tfoot&gt;            &lt;tr&gt;                &lt;th&gt;序号&lt;/th&gt;                &lt;th&gt;姓名&lt;/th&gt;            &lt;/tr&gt;            &lt;/tfoot&gt;        &lt;/table&gt;        &lt;div class=&quot;tablenav&quot;&gt;            &lt;div class=&quot;tablenav-pages&quot;&gt;                &lt;span class=&quot;displaying-num&quot;&gt;第1页，共458页&lt;/span&gt;                &lt;span class=&quot;page-numbers current&quot;&gt;1&lt;/span&gt;                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;2&lt;/a&gt;                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;3&lt;/a&gt;                &lt;a href=&quot;#&quot; class=&quot;page-numbers&quot;&gt;4&lt;/a&gt;                &lt;a href=&quot;#&quot; class=&quot;next page-numbers&quot;&gt;»&lt;/a&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;    &lt;?}</code></pre><h1 id="保存插件设置到数据库中">保存插件设置到数据库中</h1><pre><code>├── hc-test│   ├── css│   ├── hc-test.php│   ├── images│   └── jshc-test.php&lt;?php/*Plugin Name: hc-testPlugin URI: http://zhuohc.comDescription: 测试插件Version: 1.0Author: hcAuthor URI: http://zhuohc.comLicense: GPLv2*///设置时区为 亚洲/上海date_default_timezone_set(&#39;Asia/Shanghai&#39;);//定义插件启动时候调用的方法register_activation_hook( __FILE__, &#39;hc_test_install&#39;);function hc_test_install() {   global $wpdb;   if( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE &#39;{$wpdb-&gt;prefix}test&#39;&quot; ) != &quot;{$wpdb-&gt;prefix}test&quot; )    {      $sql = &quot;CREATE TABLE IF NOT EXISTS `{$wpdb-&gt;prefix}test` (           `id` int(11) NOT NULL auto_increment COMMENT &#39;编号&#39;,           `color` varchar(10) DEFAULT &#39;&#39; COMMENT &#39;字体颜色&#39;,           `size`  varchar(10) DEFAULT &#39;&#39; COMMENT &#39;字体大小&#39;,           PRIMARY KEY  (`id`)         ) DEFAULT CHARSET=utf8 AUTO_INCREMENT=0;&quot;;      $wpdb-&gt;query( $sql );      $sql = &quot;REPLACE INTO `{$wpdb-&gt;prefix}test` VALUES (1, &#39;#FF0000&#39;,&#39;20&#39;);&quot;;      $wpdb-&gt;query( $sql );   }}add_action( &#39;admin_menu&#39;, &#39;hc_test_create_menu&#39; );function hc_test_create_menu() {   //创建顶级菜单   add_menu_page(       &#39;HC-TEST&#39;,       &#39;HC的插件&#39;,      &#39;manage_options&#39;,       &#39;hc_test&#39; ,      &#39;hc_settings_page&#39;,      plugins_url( &#39;/images/icon.png&#39;, __FILE__ )   );}function hc_settings_page() {   global $wpdb;   //当提交了，并且验证信息正确   if( !empty( $_POST ) &amp;&amp; check_admin_referer( &#39;hc_test_nonce&#39; ) ) {      //更新设置      update_option( &#39;hc_test_bold&#39;, $_POST[&#39;hc_test_bold&#39;] );      $wpdb-&gt;update( &quot;{$wpdb-&gt;prefix}test&quot;, array( &#39;color&#39; =&gt; $_POST[&#39;color&#39;], &#39;size&#39; =&gt; $_POST[&#39;size&#39;] ), array( &#39;id&#39; =&gt; 1 ) );      ?&gt;      &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;         &lt;p&gt;&lt;strong&gt;保存成功！&lt;/strong&gt;&lt;/p&gt;      &lt;/div&gt;      &lt;?   }   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );   $color = $row[&#39;color&#39;];   $size = $row[&#39;size&#39;];   ?&gt;   &lt;div class=&quot;wrap&quot;&gt;      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;      &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;         &lt;p&gt;&lt;label for=&quot;color&quot;&gt;字体颜色：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;color&quot; value=&quot;&lt;?php echo $color; ?&gt;&quot; /&gt;&lt;/p&gt;         &lt;p&gt;&lt;label for=&quot;size&quot;&gt;字体大小：&lt;/label&gt;         &lt;select name=&quot;size&quot;&gt;            &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;            &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;            &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;            &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;            &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;         &lt;/select&gt;&lt;/p&gt;         &lt;p&gt;&lt;label for=&quot;hc_test_obold&quot;&gt;字体加粗：&lt;/label&gt;&lt;input name=&quot;hc_test_bold&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, get_option( &#39;hc_test_bold&#39; ) ); ?&gt; /&gt; 加粗&lt;/p&gt;         &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;保存设置&quot; /&gt;&lt;/p&gt;         &lt;?            //输出一个验证信息            wp_nonce_field(&#39;hc_test_nonce&#39;);         ?&gt;      &lt;/form&gt;   &lt;/div&gt;   &lt;?}add_action( &#39;wp_head&#39;, &#39;hc_test_head_fun&#39; );function hc_test_head_fun() {   global $wpdb;   //获取自定义数据库中的设置   $sql = &quot;SELECT * FROM `{$wpdb-&gt;prefix}test`&quot;;   $row = $wpdb-&gt;get_row( $sql, ARRAY_A );   //获取options表中的设置选项   $bold = get_option( &quot;hc_test_bold&quot; ) == 1 ? &quot;bold&quot; : &quot;normal&quot;;   ?&gt;&lt;style&gt;body{color:&lt;? echo $row[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $row[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?}</code></pre><h1 id="使用wordpress内置api设置插件属性">使用wordpress内置api设置插件属性</h1><pre><code># hc-test.php&lt;?php/*Plugin Name: hc-testPlugin URI: http://zhuohc.comDescription: 测试插件Version: 1.0Author: hcAuthor URI: http://zhuohc.comLicense: GPLv2*///设置时区为 亚洲/上海date_default_timezone_set(&#39;Asia/Shanghai&#39;);add_action( &#39;admin_menu&#39;, &#39;test_create_menu&#39; );function test_create_menu() {   //创建顶级菜单   add_menu_page(      &#39;HC的插件首页&#39;,      &#39;HC的插件&#39;,      &#39;manage_options&#39;,      &#39;hc_test&#39; ,      &#39;hc_settings_page&#39;,      plugins_url( &#39;/images/icon.png&#39;, __FILE__ )   );}add_action( &#39;admin_init&#39;, &#39;register_hc_test_setting&#39; );//使用register_setting()注册要存储的字段function register_hc_test_setting() {   //注册一个选项，用于装载所有插件设置项   $option_group = &quot;hc_test_group&quot;;   register_setting( $option_group, &#39;hc_test_option&#39; );   //添加选项设置区域   $setting_section = &quot;hc_test_setting_section&quot;;   add_settings_section(      $setting_section,      &#39;设置&#39;,  // 标题      &#39;hc_test_setting_section_function&#39;,  // 调用方法，自定义输出      $option_group   );   //设置字体颜色   add_settings_field(      &#39;hc_test_color&#39;,  // 字段id      &#39;字体颜色&#39;,  // 字段标题      &#39;hc_test_color_function&#39;, // 字段对应函数方法      $option_group,  // 字段对应分组      $setting_section  // 字段对应设置选项   );   //设置字体大小   add_settings_field(      &#39;hc_test_size&#39;,      &#39;字体大小&#39;,      &#39;hc_test_size_function&#39;,      $option_group,      $setting_section   );   //设置字体加粗   add_settings_field(      &#39;hc_test_bold&#39;,      &#39;字体加粗&#39;,      &#39;hc_test_bold_function&#39;,      $option_group,      $setting_section   );}function hc_test_bold_function() {   $hc_test_option = get_option( &quot;hc_test_option&quot; );   ?&gt;   &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗   &lt;?}function hc_test_size_function() {   $hc_test_option = get_option( &quot;hc_test_option&quot; );   $size = $hc_test_option[&quot;size&quot;];   ?&gt;   &lt;select name=&quot;hc_test_option[size]&quot;&gt;      &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;      &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;      &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;      &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;      &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;   &lt;/select&gt;   &lt;?}function hc_test_color_function() {   $hc_test_option = get_option( &quot;hc_test_option&quot; );   ?&gt;   &lt;input name=&#39;hc_test_option[color]&#39; type=&#39;text&#39; value=&#39;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&#39; /&gt;   &lt;?}function hc_settings_page() {   ?&gt;   &lt;div class=&quot;wrap&quot;&gt;      &lt;h2&gt;插件顶级菜单&lt;/h2&gt;      &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;         &lt;?         $option_group = &quot;hc_test_group&quot;;         //输出一些必要的字段，包括验证信息等         settings_fields( $option_group );         //输出选项设置区域         do_settings_sections( $option_group );         //输出按钮         submit_button();         ?&gt;      &lt;/form&gt;   &lt;/div&gt;   &lt;?}add_action( &#39;wp_head&#39;, &#39;hc_test_head_fun&#39; );function hc_test_head_fun() {   $hc_test_option = get_option( &quot;hc_test_option&quot; );   $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;   ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?}</code></pre><h1 id="将插件改写成类的形式">将插件改写成类的形式</h1><pre><code>#hc-test.php&lt;?php/*Plugin Name: hc-testPlugin URI: http://zhuohc.comDescription: 测试插件Version: 1.0Author: hcAuthor URI: http://zhuohc.comLicense: GPLv2*///设置时区为 亚洲/上海date_default_timezone_set(&#39;Asia/Shanghai&#39;);class hcsem_change_font_style {   //声明类里面的属性，用 var 开头   var $icon_url = &quot;/images/icon.png&quot;;   var $option_group = &quot;hc_test_group&quot;;   //构造方法，创建类的时候调用   function hcsem_change_font_style() {      //创建菜单      add_action( &#39;admin_menu&#39;, array( $this, &#39;hc_create_menu&#39; ) );      add_action( &#39;admin_init&#39;, array( $this, &#39;register_hc_test_setting&#39; ) );      add_action( &#39;wp_head&#39;,  array( $this,  &#39;hc_test_head_fun&#39; ) );   }   //使用register_setting()注册要存储的字段   function register_hc_test_setting() {      //注册一个选项，用于装载所有插件设置项      register_setting( $this-&gt;option_group, &#39;hc_test_option&#39; );      //添加选项设置区域      $setting_section = &quot;hc_test_setting_section&quot;;      add_settings_section(         $setting_section,         &#39;&#39;,         &#39;&#39;,         $this-&gt;option_group      );      //设置字体颜色      add_settings_field(         &#39;hc_test_color&#39;,         &#39;字体颜色&#39;,         array( $this, &#39;hc_test_color_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体大小      add_settings_field(         &#39;hc_test_size&#39;,         &#39;字体大小&#39;,         array( $this, &#39;hc_test_size_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体加粗      add_settings_field(         &#39;hc_test_bold&#39;,         &#39;字体加粗&#39;,         array( $this, &#39;hc_test_bold_function&#39; ),         $this-&gt;option_group,         $setting_section      );   }   function hc_test_bold_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗      &lt;?   }   function hc_test_size_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $size = $hc_test_option[&quot;size&quot;];      ?&gt;      &lt;select name=&quot;hc_test_option[size]&quot;&gt;         &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;         &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;         &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;         &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;         &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;      &lt;/select&gt;      &lt;?   }   function hc_test_color_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&#39;hc_test_option[color]&#39; type=&#39;text&#39; value=&#39;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&#39; /&gt;      &lt;?   }   function hc_create_menu() {      //创建顶级菜单      add_menu_page(         &#39;HC的插件首页&#39;,         &#39;HC的插件&#39;,         &#39;manage_options&#39;,         &#39;hc_test&#39; ,         array( $this, &#39;hc_settings_page&#39; ),         plugins_url( $this-&gt;icon_url, __FILE__ )      );   }   function hc_settings_page() {      ?&gt;      &lt;div class=&quot;wrap&quot;&gt;         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;            &lt;?            //输出一些必要的字段，包括验证信息等            settings_fields( $this-&gt;option_group );            //输出选项设置区域            do_settings_sections( $this-&gt;option_group );            //输出按钮            submit_button();            ?&gt;         &lt;/form&gt;      &lt;/div&gt;      &lt;?   }   function hc_test_head_fun() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?   }}new hcsem_change_font_style();</code></pre><h1 id="将插件设置内容转移到wordpress设置里">将插件设置内容转移到wordpress设置里</h1><pre><code># hc-test.phpclass hcsem_change_font_style {   var $option_group = &quot;general&quot;;  // general常规 writing撰写 reading阅读 discussion讨论 media多媒体 permalink固定链接   //构造方法，创建类的时候调用   function hcsem_change_font_style() {      add_action( &#39;admin_init&#39;, array( $this, &#39;register_hc_test_setting&#39; ) );      add_action( &#39;wp_head&#39;,  array( $this,  &#39;hc_test_head_fun&#39; ) );   }   //使用register_setting()注册要存储的字段   function register_hc_test_setting() {      //注册一个选项，用于装载所有插件设置项      register_setting( $this-&gt;option_group, &#39;hc_test_option&#39; );      //设置字体颜色      add_settings_field(         &#39;hc_test_color&#39;,         &#39;字体颜色&#39;,         array( $this, &#39;hc_test_color_function&#39; ),         $this-&gt;option_group      );      //设置字体大小      add_settings_field(         &#39;hc_test_size&#39;,         &#39;字体大小&#39;,         array( $this, &#39;hc_test_size_function&#39; ),         $this-&gt;option_group      );      //设置字体加粗      add_settings_field(         &#39;hc_test_bold&#39;,         &#39;字体加粗&#39;,         array( $this, &#39;hc_test_bold_function&#39; ),         $this-&gt;option_group      );   }   function hc_test_bold_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗      &lt;?   }   function hc_test_size_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $size = $hc_test_option[&quot;size&quot;];      ?&gt;      &lt;select name=&quot;hc_test_option[size]&quot;&gt;         &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;         &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;         &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;         &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;         &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;      &lt;/select&gt;      &lt;?   }   function hc_test_color_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&#39;hc_test_option[color]&#39; type=&#39;text&#39; value=&#39;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&#39; /&gt;      &lt;?   }   function hc_test_head_fun() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?   }}new hcsem_change_font_style();</code></pre><h1 id="调用ajax">调用ajax</h1><pre><code># hc-test.php&lt;?php/*Plugin Name: hc-testPlugin URI: http://zhuohc.comDescription: 测试插件Version: 1.0Author: hcAuthor URI: http://zhuohc.comLicense: GPLv2*///设置时区为 亚洲/上海date_default_timezone_set(&#39;Asia/Shanghai&#39;);class hcsem_change_font_style {   //声明类里面的属性，用 var 开头   var $icon_url = &quot;/images/icon.png&quot;;   var $option_group = &quot;hc_test_group&quot;;   //构造方法，创建类的时候调用   function hcsem_change_font_style() {      //创建菜单      add_action( &#39;admin_menu&#39;, array( $this, &#39;hc_create_menu&#39; ) );      add_action( &#39;admin_init&#39;, array( $this, &#39;register_hc_test_setting&#39; ) );      add_action( &#39;wp_head&#39;,  array( $this,  &#39;hc_test_head_fun&#39; ) );      //使用ajax校验信息      wp_enqueue_script( &#39;hc_test&#39;, plugins_url(&#39;js/hc_test.js&#39;, __FILE__), array(&#39;jquery&#39;) );      wp_localize_script( &#39;hc_test&#39;, &#39;ajax_object&#39;, array( &#39;ajax_url&#39; =&gt; admin_url( &#39;admin-ajax.php&#39; ) ) );      add_action( &#39;wp_ajax_color_check_action&#39; , array( $this, &#39;color_check_action_fun&#39;) );      add_action( &#39;wp_ajax_nopriv_hcsem_description&#39; , array( $this, &#39;hcsem_description_fun&#39;) );   }   function color_check_action_fun(){      if( trim( $_POST[&#39;color&#39;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }      wp_die();   }   function hcsem_description_fun() {      echo &quot;hc的笔记本：&quot; . $_POST[&#39;description&#39;];      wp_die();   }   //使用register_setting()注册要存储的字段   function register_hc_test_setting() {      //注册一个选项，用于装载所有插件设置项      register_setting( $this-&gt;option_group, &#39;hc_test_option&#39; );      //添加选项设置区域      $setting_section = &quot;hc_test_setting_section&quot;;      add_settings_section(         $setting_section,         &#39;&#39;,         &#39;&#39;,         $this-&gt;option_group      );      //设置字体颜色      add_settings_field(         &#39;hc_test_color&#39;,         &#39;字体颜色&#39;,         array( $this, &#39;hc_test_color_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体大小      add_settings_field(         &#39;hc_test_size&#39;,         &#39;字体大小&#39;,         array( $this, &#39;hc_test_size_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体加粗      add_settings_field(         &#39;hc_test_bold&#39;,         &#39;字体加粗&#39;,         array( $this, &#39;hc_test_bold_function&#39; ),         $this-&gt;option_group,         $setting_section      );   }   function hc_test_bold_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; 加粗      &lt;?   }   function hc_test_size_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $size = $hc_test_option[&quot;size&quot;];      ?&gt;      &lt;select name=&quot;hc_test_option[size]&quot;&gt;         &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;         &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;         &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;         &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;         &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;      &lt;/select&gt;      &lt;?   }   function hc_test_color_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&#39;hc_test_option[color]&#39; type=&#39;text&#39; value=&#39;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&#39; /&gt;      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;      &lt;?   }   function hc_create_menu() {      //创建顶级菜单      add_menu_page(         &#39;HC的插件首页&#39;,         &#39;HC的插件&#39;,         &#39;manage_options&#39;,         &#39;hc_test&#39; ,         array( $this, &#39;hc_settings_page&#39; ),         plugins_url( $this-&gt;icon_url, __FILE__ )      );   }   function hc_settings_page() {      ?&gt;      &lt;div class=&quot;wrap&quot;&gt;         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;            &lt;?            //输出一些必要的字段，包括验证信息等            settings_fields( $this-&gt;option_group );            //输出选项设置区域            do_settings_sections( $this-&gt;option_group );            //输出按钮            submit_button();            ?&gt;         &lt;/form&gt;      &lt;/div&gt;      &lt;?   }   function hc_test_head_fun() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?   }}new hcsem_change_font_style();# js/hc_test.jsjQuery(document).ready( function($) {   $(&quot;input[name=&#39;hc_test_option[color]&#39;]&quot;).blur( function() {      $.ajax({         type: &quot;POST&quot;,         data: &quot;color=&quot; + $(this).val() + &quot;&amp;action=hc_color_check&quot;,         url: ajax_object.ajax_url,         beforeSend: function() {            $(&#39;#error_color&#39;).html(&#39;校验中...&#39;);          },         success: function( $data ) {            if( $data == &#39;ok&#39;){                $(&#39;#error_color&#39;).html(&#39;输入正确&#39;);              } else {                $(&#39;#error_color&#39;).html(&#39;颜色不能为空！&#39;);             }         }      });   });});jQuery(document).ready( function($) {   $(&quot;.description&quot;).click( function() {      $.ajax({         type: &quot;POST&quot;,         data: &quot;description=&quot; + $(this).text() + &quot;&amp;action=hcsem_description&quot;,         url: ajax_object.ajax_url,         success : function( $data ) {            if( $data != &quot;0&quot; ) {               $(&quot;.description&quot;).text( $data );            }         }      });   });});</code></pre><h1 id="实现插件翻译功能">实现插件翻译功能</h1><pre><code>.├── css│   └── hc_copyrighy.css├── hc-test.php├── images│   └── icon.png├── js│   └── hc_test.js└── languages    ├── zh_CN.mo    └── zh_CN.po# hc-test.php&lt;?php/*Plugin Name: hc-testPlugin URI: http://zhuohc.comDescription: 测试插件Version: 1.0Author: hcAuthor URI: http://zhuohc.comLicense: GPLv2*///设置时区为 亚洲/上海date_default_timezone_set(&#39;Asia/Shanghai&#39;);class hcsem_change_font_style {   //声明类里面的属性，用 var 开头   var $icon_url = &quot;/images/icon.png&quot;;   var $option_group = &quot;hc_test_group&quot;;   //构造方法，创建类的时候调用   function hcsem_change_font_style() {      //创建菜单      add_action( &#39;admin_menu&#39;, array( $this, &#39;hc_create_menu&#39; ) );      add_action( &#39;admin_init&#39;, array( $this, &#39;register_hc_test_setting&#39; ) );      add_action( &#39;wp_head&#39;,  array( $this,  &#39;hc_test_head_fun&#39; ) );      //使用ajax校验信息      wp_enqueue_script( &#39;hc_test&#39;, plugins_url(&#39;js/hc_test.js&#39;, __FILE__), array(&#39;jquery&#39;) );      wp_localize_script( &#39;hc_test&#39;, &#39;ajax_object&#39;, array( &#39;ajax_url&#39; =&gt; admin_url( &#39;admin-ajax.php&#39; ) ) );      add_action( &#39;wp_ajax_color_check_action&#39; , array( $this, &#39;color_check_action_fun&#39;) );      add_action( &#39;wp_ajax_nopriv_hcsem_description&#39; , array( $this, &#39;hcsem_description_fun&#39;) );      add_action( &#39;init&#39;, array( $this, &#39;hcsem_load_textdomain&#39; ) );   }   function hcsem_load_textdomain() {      //加载 languages 目录下的翻译文件 zh_CN      $currentLocale = get_locale();      if( !empty( $currentLocale ) ) {         $moFile = dirname(__FILE__) . &quot;/languages/{$currentLocale}.mo&quot;;         if( @file_exists( $moFile ) &amp;&amp; is_readable( $moFile ) ) load_textdomain( &#39;hc-test&#39;, $moFile );      }   }   function color_check_action_fun(){      if( trim( $_POST[&#39;color&#39;] ) != &quot;&quot; ){ echo &quot;ok&quot;; }      wp_die();   }   function hcsem_description_fun() {      echo &quot;HC的笔记本：&quot; . $_POST[&#39;description&#39;];      wp_die();   }   //使用register_setting()注册要存储的字段   function register_hc_test_setting() {      //注册一个选项，用于装载所有插件设置项      register_setting( $this-&gt;option_group, &#39;hc_test_option&#39; );      //添加选项设置区域      $setting_section = &quot;hc_test_setting_section&quot;;      add_settings_section(         $setting_section,         &#39;&#39;,         &#39;&#39;,         $this-&gt;option_group      );      //设置字体颜色      add_settings_field(         &#39;hc_test_color&#39;,         __( &#39;color&#39;, &#39;hc-test&#39; ),         array( $this, &#39;hc_test_color_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体大小      add_settings_field(         &#39;hc_test_size&#39;,         __( &#39;size&#39;, &#39;hc-test&#39; ),         array( $this, &#39;hc_test_size_function&#39; ),         $this-&gt;option_group,         $setting_section      );      //设置字体加粗      add_settings_field(         &#39;hc_test_bold&#39;,         __( &#39;bold&#39;, &#39;hc-test&#39; ),         array( $this, &#39;hc_test_bold_function&#39; ),         $this-&gt;option_group,         $setting_section      );   }   function hc_test_bold_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&quot;hc_test_option[bold]&quot; type=&quot;checkbox&quot;  value=&quot;1&quot; &lt;? checked( 1, $hc_test_option[&quot;bold&quot;] ); ?&gt; /&gt; &lt;? _e( &#39;set bold&#39;, &#39;hc-test&#39; ); ?&gt;      &lt;?   }   function hc_test_size_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $size = $hc_test_option[&quot;size&quot;];      ?&gt;      &lt;select name=&quot;hc_test_option[size]&quot;&gt;         &lt;option value=&quot;12&quot; &lt;? selected( &#39;12&#39;, $size ); ?&gt;&gt;12&lt;/option&gt;         &lt;option value=&quot;14&quot; &lt;? selected( &#39;14&#39;, $size ); ?&gt;&gt;14&lt;/option&gt;         &lt;option value=&quot;16&quot; &lt;? selected( &#39;16&#39;, $size ); ?&gt;&gt;16&lt;/option&gt;         &lt;option value=&quot;18&quot; &lt;? selected( &#39;18&#39;, $size ); ?&gt;&gt;18&lt;/option&gt;         &lt;option value=&quot;20&quot; &lt;? selected( &#39;20&#39;, $size ); ?&gt;&gt;20&lt;/option&gt;      &lt;/select&gt;      &lt;?   }   function hc_test_color_function() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      ?&gt;      &lt;input name=&#39;hc_test_option[color]&#39; type=&#39;text&#39; value=&#39;&lt;? echo $hc_test_option[&quot;color&quot;]; ?&gt;&#39; /&gt;      &lt;font id=&quot;error_color&quot;&gt;&lt;/font&gt;&lt;/div&gt;      &lt;?   }   function hc_create_menu() {      //创建顶级菜单      add_menu_page(         &#39;hc的插件首页&#39;,         &#39;hc的插件&#39;,         &#39;manage_options&#39;,         &#39;hc_test&#39; ,         array( $this, &#39;hc_settings_page&#39; ),         plugins_url( $this-&gt;icon_url, __FILE__ )      );   }   function hc_settings_page() {      ?&gt;      &lt;div class=&quot;wrap&quot;&gt;         &lt;h2&gt;插件顶级菜单&lt;/h2&gt;         &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;            &lt;?            //输出一些必要的字段，包括验证信息等            settings_fields( $this-&gt;option_group );            //输出选项设置区域            do_settings_sections( $this-&gt;option_group );            //输出按钮            submit_button();            ?&gt;         &lt;/form&gt;      &lt;/div&gt;      &lt;?   }   function hc_test_head_fun() {      $hc_test_option = get_option( &quot;hc_test_option&quot; );      $bold = $hc_test_option[&quot;bold&quot;] == 1 ? &quot;bold&quot; : &quot;normal&quot;;      ?&gt;&lt;style&gt;body{color:&lt;? echo $hc_test_option[&quot;color&quot;] ?&gt;;font-size:&lt;? echo $hc_test_option[&quot;size&quot;] ?&gt;px;font-weight:&lt;? echo $bold; ?&gt;;}&lt;/style&gt;&lt;?   }}new hcsem_change_font_style();</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythontkinter入门基础</title>
      <link href="/2016/11/10/Pythontkinter%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/10/Pythontkinter%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>python基础环境</p><pre><code>sudo apt-get install pythonsudo apt-get install python-pip</code></pre><p>Tkinter安装</p><pre><code>sudo apt-get install python-tk</code></pre><p>配置组件外观</p><pre><code>#!/usr/bin/python# -*- coding: UTF-8 -*-from Tkinter import *root = Tk()# 定义图标if sys.platform == &#39;win32&#39;:    root.iconbitmap(&#39;favicon.ico&#39;)else:    icon = PhotoImage(file=&#39;phone.gif&#39;)    root.tk.call(&#39;wm&#39;, &#39;iconphoto&#39;, root._w, icon)# 定义字体，字号，类型label_font = (&#39;Ubuntu&#39;, 20, &#39;bold underline italic&#39;)# 创建组件widget = Label(root, text=&#39;Hello,云克隆&#39;, padx=100, pady=20)# 配置组件字体widget.config(font=label_font)# 组件宽，高widget.config(height=3, width=20)# 组件背景颜色widget.config(bg=&#39;#FF0&#39;)# 组件字体颜色widget.config(fg=&#39;#F0F&#39;)# 组件边框宽度widget.config(bd=3)# 组件边框外形, FLAT扁平, SUNKEN凹陷, RAISED凸起, GROOVE凹槽, SOLID加粗, RIDGE脊状,widget.config(relief=SUNKEN)# 组件鼠标手势, &#39;gumby&#39;, &#39;watch&#39;, &#39;pencil&#39;, &#39;crdss&#39;, hand2widget.config(cursor=&#39;gumby&#39;)# 组件状态, DISABLE禁用, NORMAL正常, READONLY只读widget.config(state=DISABLED)# 布置组件# expand设置是否可以扩展，fill表示随父组件扩展方向，可以设置BOTH, X, Y# 设置组件padding值# side表示按钮布置窗口的位置widget.pack(expand=True, fill=X, padx=10, pady=50, side=LEFT)root.mainloop()</code></pre><h1 id="标准弹出框">标准弹出框</h1><pre><code># -*- coding: UTF-8 -*-from Tkinter import *from tkMessageBox import *# python3# from Tkinter.messagebox import *def callback():    if askyesno(&#39;Verify&#39;, &#39;Do you ready want to quit?&#39;):        showwarning(&#39;Yes&#39;, &#39;Quit not yet&#39;)    else:        showinfo(&#39;No&#39;, &#39;Quit has been cancelled&#39;)errmsg = &#39;Sorry, no spam allowed&#39;Button(None, text=&#39;Quit&#39;, command=callback).pack(fill=X)Button(None, text=&#39;spam&#39;, command=(lambda: showerror(&#39;spam&#39;, errmsg))).pack(fill=X)mainloop()</code></pre><h1 id="常见弹框">常见弹框</h1><pre><code># gui6.py# -*- coding: UTF-8 -*-from Tkinter import *from tkMessageBox import *from tkFileDialog import *from tkColorChooser import *from tkSimpleDialog import *demos = {    &#39;Open&#39;: askopenfilename,    &#39;Color&#39;: askcolor,    &#39;Query&#39;: lambda: askquestion(&#39;Warning&#39;, &#39;You typed &quot;rm *&quot;\nconfirm?&#39;),    &#39;Error&#39;: lambda: showerror(&#39;Error!&#39;, &#39;He is dead&#39;),    &#39;Input&#39;: lambda: askfloat(&#39;Entry&#39;, &#39;Enter credit card number&#39;)}class Demo(Frame):    def __init__(self, parent=None, **options):        Frame.__init__(self, parent, **options)        self.pack()        Label(self, text=&#39;Basic demos&#39;).pack()        for (key, value) in demos.items():            Button(self, text=key, command=value).pack(side=TOP, fill=BOTH)if __name__ == &#39;__main__&#39;:    Demo().mainloop()自定义弹框# -*- coding: UTF-8 -*-import sysfrom Tkinter import *makemodal = (len(sys.argv) &gt; 1)def dialog():    win = Toplevel()    Label(win, text=&#39;Hard drive reformatted!&#39;).pack()    Button(win, text=&#39;OK&#39;, command=win.destroy).pack()    if makemodal:        # 获取输入的焦点        win.focus_set()        # 打开的时候，禁用其他窗口        win.grab_set()        # 在win销毁之前，继续等待        win.wait_window()    print &#39;dialog exit&#39;root = Tk()Button(root, text=&#39;popup&#39;, command=dialog).pack()root.mainloop()</code></pre><h1 id="绑定事件">绑定事件</h1><pre><code># -*- coding: UTF-8 -*-from Tkinter import *def showPosEvent(event):    print(&#39;Widget=%s, X=%s, Y=%s&#39; % (event.widget, event.x, event.y))def showAllEvent(event):    print(event)    for attr in dir(event):        if not attr.startswith(&#39;__&#39;):            print(attr, &#39;=&gt;&#39;, getattr(event, attr))def onKeyPress(event):    print(&#39;Got key press: &#39;, event.char)def onArrowKey(event):    print(&#39;Got up arrow key press&#39;)def onReturnKey(event):    print(&#39;Got return key press&#39;)def onLeftClick(event):    print(&#39;Got left mouse button click: &#39;)    showPosEvent(event)def onRightClick(event):    print(&#39;Got right mouse button click: &#39;)    showPosEvent(event)def onMiddleClick(event):    print(&#39;Got middle mouse button click: &#39;)    showPosEvent(event)    showAllEvent(event)def onLeftDrag(event):    print(&#39;Got left mouse drag click: &#39;)    showPosEvent(event)def onDoubleLeftClick(event):    print(&#39;Got double left mouse click: &#39;)    showPosEvent(event)    tkroot.quit()tkroot = Tk()labelfont = (&#39;courier&#39;, 20, &#39;bold&#39;)widget = Label(tkroot, text=&#39;Hello bind world&#39;)widget.config(bg=&#39;red&#39;, font=labelfont)widget.config(height=5, width=20)widget.pack(expand=YES, fill=BOTH)# 绑定单击左键widget.bind(&#39;&lt;Button-1&gt;&#39;, onLeftClick)# 绑定单击右键widget.bind(&#39;&lt;Button-3&gt;&#39;, onRightClick)# 绑定单击中键widget.bind(&#39;&lt;Button-2&gt;&#39;, onMiddleClick)# 绑定双击左键widget.bind(&#39;&lt;Double-1&gt;&#39;, onDoubleLeftClick)# 绑定拖拽 B1表示点击左键，Motion表示拖拽widget.bind(&#39;&lt;B1-Motion&gt;&#39;, onLeftDrag)# 绑定键盘按键widget.bind(&#39;&lt;KeyPress&gt;&#39;, onKeyPress)# 绑定按下箭头键widget.bind(&#39;&lt;Up&gt;&#39;, onArrowKey)# 绑定回车，返回键widget.bind(&#39;&lt;Return&gt;&#39;, onReturnKey)widget.focus()tkroot.title(&#39;CLICK ME&#39;)tkroot.mainloop()# &lt;ButtonPress&gt; 按下按钮# &lt;ButtonRelease&gt; 松开按钮# &lt;Motion&gt; 鼠标指针移动# &lt;Configure&gt; 窗口大小，位置改变时候# &lt;Destroy&gt; 销毁窗口# &lt;FocusIn&gt; 获取焦点# &lt;FocusOut&gt; 失去焦点# &lt;Map&gt; 窗口打开# &lt;Unmap&gt; 窗口最小化# &lt;Escape&gt;, &lt;BackSpace&gt;, &lt;Tab&gt; 捕获特点ESC键，回车键，tab键# &lt;Down&gt;, &lt;Up&gt;, &lt;Left&gt;, &lt;Right&gt; 捕获方向键# &lt;B1-Motion&gt; 按下左键并拖拽# &lt;KeyPress-a&gt; 按下按键“a”，大小写敏感</code></pre><h1 id="输入框">输入框</h1><pre><code># -*- coding: UTF-8 -*-from Tkinter import *from quitGui import Quitterfields = &#39;Name&#39;, &#39;Job&#39;, &#39;Pay&#39;def fetch(entries):    for entry in entries:        print(&#39;Input =&gt; %s&#39; % entry.get())  # 获取文本信息def makeform(root, fields):    entries = []    for field in fields:        row = Frame(root)        lab = Label(row, width=5, text=field)        ent = Entry(row)        row.pack(side=TOP, fill=X)        lab.pack(side=LEFT)        ent.pack(side=RIGHT, expand=YES, fill=X)        entries.append(ent)    return entriesdef show(entries, popup):    fetch(entries)  # 必须在销毁前取出    popup.destroy()  # 如果修改了stmt， order， msgs会随之失败def ask():    popup = Toplevel()  # 在模拟对话框窗口中显示表单    ents = makeform(popup, fields)    Button(popup, text=&#39;OK&#39;, command=(lambda: show(ents, popup))).pack()    popup.grab_set()  # 打开的时候，禁用其他窗口    popup.focus_set()  # 获取输入的焦点    popup.wait_window()  # 在这里等待销毁if __name__ == &#39;__main__&#39;:    root = Tk()    Button(root, text=&#39;Dialog&#39;, command=ask).pack()    root.mainloop()</code></pre><h1 id="复选框">复选框</h1><pre><code># gui13.py# -*- coding: UTF-8 -*-from Tkinter import *from gui6 import demosfrom quitGui import Quitterclass Demo(Frame):    def __init__(self, parent=None, **options):        Frame.__init__(self, parent, **options)        self.pack()        self.tools()        Label(self, text=&#39;Ckech demos&#39;).pack()        self.vars = []        for key in demos:            var = IntVar()            Checkbutton(self, text=key, variable=var, command=demos[key]).pack(side=LEFT)            self.vars.append(var)    def report(self):        for var in self.vars:            print(var.get())  # 当前开关设置1或者0        print()    def tools(self):        frm = Frame(self)        frm.pack(side=RIGHT)        Button(frm, text=&#39;State&#39;, command=self.report).pack(fill=X)        Quitter(frm).pack(fill=X)if __name__ == &#39;__main__&#39;:    Demo().mainloop()</code></pre><h1 id="单选按钮">单选按钮</h1><pre><code>#gui14.py# -*- coding: UTF-8 -*-from Tkinter import *from gui6 import demosfrom quitGui import Quitterclass Demo(Frame):    def __init__(self, parent=None, **options):        Frame.__init__(self, parent, **options)        self.pack()        Label(self, text=&#39;Radio demos&#39;).pack(side=TOP)        self.var = StringVar()        # variable表示单选按钮的变量，相当与html的name标签        # value表示单选按钮的变量值，相当与html的value标签        for key in demos:            Radiobutton(self, text=key, command=self.onPress, variable=self.var, value=key).pack(anchor=NW)        self.var.set(key)  # 选中最后一个开始        Button(self, text=&#39;State&#39;, command=self.report).pack(fill=X)        Quitter(self).pack(fill=X)    def onPress(self):        pick = self.var.get()        print(&#39;you pressed&#39;, pick)        print(&#39;result: &#39;, demos[pick]())  # 按钮使用返回的值    def report(self):        print(self.var.get())if __name__ == &#39;__main__&#39;:    Demo().mainloop()</code></pre><h1 id="标尺滚动条">标尺滚动条</h1><pre><code># gui16.py# -*- coding: UTF-8 -*-from Tkinter import *from gui6 import demosfrom quitGui import Quitterclass Demo(Frame):    def __init__(self, parent=None, **options):        Frame.__init__(self, parent, **options)        self.pack()        Label(self, text=&#39;Scale demos&#39;).pack()        self.var = IntVar()        Scale(self, label=&#39;Pick demo number&#39;,              command=self.onMove, variable=self.var,              from_=0, to=len(demos)-1).pack()        Scale(self, label=&#39;Pick demo number&#39;,  # 标尺的文本              command=self.onMove,  # 绑定回调              variable=self.var,  # 变量              from_=0,   # 标尺最小值              to=len(demos) - 1,   # 标尺最大值              length = 200,  # 长度              tickinterval = 2,   # 每隔几个单位显示标记单位              showvalue = YES,  # 显示或隐藏标尺滑动条旁边的当前值              orient = &#39;horizontal&#39;  # 横向展示              ).pack()        Quitter(self).pack(side=RIGHT)        Button(self, text=&#39;Run demo&#39;, command=self.onRun).pack(side=LEFT)        Button(self, text=&#39;State&#39;, command=self.report).pack(side=RIGHT)    def onMove(self, value):        print(&#39;in onMove&#39;, value)    def onRun(self):        pos = self.var.get()        print(&#39;you picked&#39;, pos)        demo = list(demos.values())[pos]        print(demo())    def report(self):        print(self.var.get())if __name__ == &#39;__main__&#39;:    print(list(demos.keys()))    Demo().mainloop()</code></pre><h1 id="创建图片">创建图片</h1><pre><code># gui17.py# -*- coding: UTF-8 -*-from Tkinter import *gifdir = &#39;./gif/&#39;win = Tk()igm = PhotoImage(file=gifdir + &#39;logo.png&#39;)# 按钮上绑定图片# Button(win, image=igm).pack()# win.mainloop()# 创建画布can = Canvas(win)can.pack(fill=BOTH)can.config(width=igm.width() + 4, height=igm.height() + 4)can.create_image(2,  # x坐标                 2,  # y坐标                 image=igm, anchor=NW)win.mainloop()</code></pre><h3 id="按钮随机读取图片">按钮随机读取图片</h3><pre><code># gui18.py# -*- coding: UTF-8 -*-from glob import globfrom gui13 import *import randomgifdir = &#39;./gif/&#39;&quot; 按钮随机读取图片 &quot;class ButtonPicsDemo(Frame):    def __init__(self, gifdir=gifdir, parent=None):        Frame.__init__(self, parent)        self.pack()        self.lbl = Label(self, text=&#39;none&#39;, bg=&#39;blue&#39;, fg=&#39;red&#39;)        self.pix = Button(self, text=&#39;press me&#39;, command=self.draw, bg=&#39;white&#39;)        self.lbl.pack(fill=BOTH)        self.pix.pack(pady=10)        Demo(self, relief=SUNKEN, bd=2).pack(fill=BOTH)        # glob模块， glob方法，返回所有匹配的文件列表        files = glob(gifdir + &#39;*.png&#39;)        self.images = [(x, PhotoImage(file=x)) for x in files]        print(files)    def draw(self):        name, photo = random.choice(self.images)        self.lbl.config(text=name)        self.pix.config(image=photo)if __name__ == &#39;__main__&#39;:    if __name__ == &#39;__main__&#39;:        ButtonPicsDemo().mainloop()</code></pre><h1 id="缩略图">缩略图</h1><pre><code># gui19.py# -*- coding: UTF-8 -*-import osimport mathimport PILfrom PIL import Imagefrom Tkinter import *def make_thumbs(img_dir, size=(100, 100), subdir=&#39;thumbs&#39;):    thumb_dir = os.path.join(img_dir, subdir)    if not os.path.exists(thumb_dir):        os.mkdir(thumb_dir)    thumbs = []    for img_file in os.listdir(img_dir):        thumb_path = os.path.join(thumb_dir, img_file)        if os.path.exists(thumb_path):            thumb_obj = PIL.Image.open(thumb_path)            thumbs.append((img_file, thumb_obj))        else:            print(&#39;making&#39;, thumb_path)            img_path = os.path.join(img_dir, img_file)            try:                img_obj = PIL.Image.open(img_path)                img_obj.thumbnail(size, PIL.Image.ANTIALIAS)                img_obj.save(thumb_path)                thumbs.append((img_file, img_obj))            except Exception, e:                print(&#39;skipping: &#39;, img_path)                print e    return thumbsclass ViewOne(Toplevel):    def __init__(self, img_dir, img_file):        Toplevel.__init__(self)        self.title(img_file)        img_path = os.path.join(img_dir, img_file)        img_obj = PhotoImage(file=img_path)        Label(self, image=img_obj).pack()        print(img_path, img_obj.width(), img_obj.height())        self.savephoto = img_objdef viewer(img_dir, kind=Toplevel, cols=None):    win = kind()    win.title(&#39;VIEWER: &#39; + img_dir)    thumbs = make_thumbs(img_dir)    if not cols:        # 固定大小 或者N×N        cols = int(math.ceil(math.sqrt(len(thumbs))))    savephotos = []    while thumbs:        thumbs_row, thumbs = thumbs[:cols], thumbs[cols:]        row = Frame(win)        row.pack(fill=BOTH)        for(img_file, img_obj) in thumbs_row:            size = max(img_obj.size)            photo = PhotoImage(file=os.path.join(img_dir, &#39;thumbs&#39;, img_file))            link = Button(row, image=photo)        handler = lambda savefile=img_file: ViewOne(img_dir, savefile)        link.config(command=handler, width=size, height=size)        link.pack(side=LEFT, expand=YES)        savephotos.append(photo)    Button(win, text=&#39;Quit&#39;, command=win.quit, bg=&#39;beige&#39;).pack(fill=X)    return win, savephotosif __name__ == &#39;__main__&#39;:    img_dir = len(sys.argv) &gt; 1 and sys.argv[1] or &#39;gif&#39;    main, save = viewer(img_dir, kind=Tk)    main.mainloop()</code></pre><h3 id="创建基础顶级菜单">创建基础顶级菜单</h3><pre><code># gui20.py# -*- coding: UTF-8 -*-from Tkinter import *from tkMessageBox import *def not_done():    showerror(&#39;Not implemented&#39;, &#39;Not yet available&#39;)def make_menu(win):    top = Menu(win)  # 定义顶级菜单    win.config(menu=top)    file = Menu(top, tearoff=True)  # 一级菜单 tearoff:设置菜单下的虚线是否显示    file.add_command(label=&#39;New...&#39;, command=not_done, underline=0)    file.add_command(label=&#39;Open...&#39;, command=not_done, underline=0)    file.add_command(label=&#39;Quit...&#39;, command=win.quit,  underline=0)    top.add_cascade(label=&#39;File&#39;, menu=file, underline=0)  # 在顶级菜单中添加一级菜单    edit = Menu(top, tearoff=False)  # 一级菜单    edit.add_command(label=&#39;Cut&#39;, command=not_done, underline=0)    edit.add_command(label=&#39;Paste&#39;, command=not_done, underline=0)    edit.add_separator()  # 添加下划线    top.add_cascade(label=&#39;Edit&#39;, menu=edit, underline=0)    submenu = Menu(edit, tearoff=True)  # 二级菜单    submenu.add_command(label=&#39;Spam&#39;, command=win.quit, underline=0)    submenu.add_command(label=&#39;Eggs&#39;, command=not_done, underline=0)    edit.add_cascade(label=&#39;Stuff&#39;, menu=submenu, underline=0)  # 在一级菜单中添加二级菜单if __name__ == &#39;__main__&#39;:    root = Tk()    root.title(&#39;menu_win&#39;)    make_menu(root)    msg = Label(root, text=&#39;Window menu basic&#39;)    msg.pack(expand=YES, fill=BOTH)    msg.config(relief=SUNKEN, width=40, height=7, bg=&#39;beige&#39;)    root.mainloop()</code></pre><h1 id="创建框架级别菜单">创建框架级别菜单</h1><pre><code># gui21.py# -*- coding: UTF-8 -*-from Tkinter import *from tkMessageBox import *def not_done():    showerror(&#39;Not implemented&#39;, &#39;Not yet available&#39;)def make_menu(parent):    menu_bar = Frame(parent)    menu_bar.pack(side=TOP, fill=X)    f_button = Menubutton(menu_bar, text=&#39;File&#39;, underline=0)    f_button.pack(side=LEFT)    file = Menu(f_button)    file.add_command(label=&#39;New...&#39;, command=not_done, underline=0)    file.add_command(label=&#39;Open...&#39;, command=not_done, underline=0)    file.add_command(label=&#39;Quit...&#39;, command=parent.quit,  underline=0)    f_button.config(menu=file)    e_button = Menubutton(menu_bar, text=&#39;Edit&#39;, underline=0)    e_button.pack(side=LEFT)    edit = Menu(e_button)    edit.add_command(label=&#39;Cut&#39;, command=not_done, underline=0)    edit.add_command(label=&#39;Paste&#39;, command=not_done, underline=0)    edit.add_separator()    e_button.config(menu=edit)    sub_menu = Menu(edit, tearoff=True)    sub_menu.add_command(label=&#39;Spam&#39;, command=parent.quit, underline=0)    sub_menu.add_command(label=&#39;Eggs&#39;, command=not_done, underline=0)    edit.add_cascade(label=&#39;Stuff&#39;, menu=sub_menu, underline=0)    return menu_barif __name__ == &#39;__main__&#39;:    root = Tk()    root.title(&#39;menu_fra&#39;)    for i in range(2):        mnu = make_menu(root)        mnu.config(bd=2, relief=RAISED)        Label(root, bg=&#39;black&#39;, height=5, width=25).pack(expand=YES, fill=BOTH)    Button(root, text=&#39;Bye&#39;, command=root.quit).pack()    root.mainloop()</code></pre><h1 id="图片菜单">图片菜单</h1><pre><code># gui22.py# -*- coding:UTF-8 -*-from Tkinter import *from tkMessageBox import *class NewMenuDemo(Frame):    def __init__(self, parent=None):        Frame.__init__(self, parent)        self.pack(expand=YES, fill=BOTH)        self.create_widgets()    def create_widgets(self):        self.make_menubar()        self.make_toolbar()        l = Label(self, text=&#39;Menu and Toolbar Demo&#39;)        l.config(relief=SUNKEN, width=40, height=10, bg=&#39;white&#39;)        l.pack(expand=YES, fill=BOTH)    def make_toolbar(self, size=(30, 30)):        toolbar = Frame(self, cursor=&#39;hand2&#39;, relief=SUNKEN, bd=2)        toolbar.pack(side=BOTTOM, fill=X)        Button(toolbar, text=&#39;Quit&#39;, command=self.quit).pack(side=RIGHT)        photo_files = (&#39;at.png&#39;, &#39;bd.png&#39;, &#39;dk.png&#39;)        self.tool_photo_objs = []        for file in photo_files:            img = PhotoImage(file=&#39;./gif/thumbs/&#39; + file)            btn = Button(toolbar, image=img, command=self.greeting)            btn.config(bd=5, relief=RIDGE)            btn.config(width=size[0], height=size[0])            btn.pack(side=LEFT)            self.tool_photo_objs.append(img)        Button(toolbar, text=&#39;Hello&#39;, command=self.greeting).pack(side=LEFT)    def make_menubar(self):        self.menubar = Menu(self.master)        self.master.config(menu=self.menubar)        self.file_menu()        self.edit_menu()        self.image_menu()    def file_menu(self):        pulldown = Menu(self.menubar)        pulldown.add_command(label=&#39;OPEN...&#39;, command=self.notdone)        pulldown.add_command(label=&#39;QUIT&#39;, command=self.quit)        self.menubar.add_cascade(label=&#39;FILE&#39;, underline=0, menu=pulldown)    def edit_menu(self):        pulldown = Menu(self.menubar)        pulldown.add_command(label=&#39;PASTE&#39;, command=self.notdone)        pulldown.add_command(label=&#39;SPAM&#39;, command=self.greeting)        pulldown.add_separator()        pulldown.add_command(label=&#39;DELETE&#39;, command=self.greeting)        pulldown.entryconfig(4, state=DISABLED)        self.menubar.add_cascade(label=&#39;EDIT&#39;, underline=0, menu=pulldown)    def image_menu(self):        photo_files = (&#39;at.png&#39;, &#39;bd.png&#39;, &#39;dk.png&#39;)        pulldown = Menu(self.menubar)        self.photo_objs = []        for file in photo_files:            img = PhotoImage(file=&#39;./gif/&#39; + file)            pulldown.add_command(image=img, command=self.notdone)            self.photo_objs.append(img)        self.menubar.add_cascade(label=&#39;IMAGE&#39;, underline=0, menu=pulldown)    def greeting(self):        showinfo(&#39;greeting&#39;, &#39;GREETING&#39;)    def notdone(self):        showerror(&#39;NOT DONE&#39;, &#39;NOT DONE&#39;)    def quit(self):        if askyesno(&#39;Verify quit&#39;, &#39;Sure?&#39;):            Frame.quit(self)if __name__ == &#39;__main__&#39;:    NewMenuDemo().mainloop()</code></pre><h1 id="滚动条与列表">滚动条与列表</h1><pre><code># gui23.py# -*- coding: UTF-8 -*-from Tkinter import *class ScrolledList(Frame):    def __init__(self, options, parent=None):        Frame.__init__(self, parent)        self.pack(expand=YES, fill=BOTH)        self.makeWidgets(options)    def handle_list(self, event):        index = self.listbox.curselection()  # 鼠标选中的行        label = self.listbox.get(index)  # 获取鼠标选中的值        self.runCommand(label)  # 打印出值    def makeWidgets(self, options):        # sbar = Scrollbar(self, orient=&#39;horizontal&#39;)  # 横向滚动        sbar = Scrollbar(self)        list = Listbox(self, relief=SUNKEN)        sbar.config(command=list.yview)  # 移动滚动条启用回调： 按比例调节列表框的显示，        list.config(yscrollcommand=sbar.set)  # 移动列表框启用回调：按比例调节滚动条        sbar.pack(side=RIGHT, fill=Y)        list.pack(side=LEFT, expand=YES, fill=BOTH)        pos = 0        for label in options:            list.insert(pos, label)            pos += 1        # selectmode 选择模式SINGLE(单选), BROWSE(默认单选), MULTIPLE(多选), EXTENDED(多选)        # 启用多选时， curselection返回列表        # 启用单选时， curselection返回字符串        list.config(selectmode=EXTENDED, setgrid=1)        list.bind(&#39;&lt;Double-1&gt;&#39;, self.handle_list)        self.listbox = list    def runCommand(self, selection):        print(&#39;YOU SELECTED:&#39;, selection)if __name__ == &#39;__main__&#39;:    options = ((&#39;Lumberjack-%s&#39; % x) for x in range(20))    ScrolledList(options).mainloop()</code></pre><h1 id="text组件">TEXT组件</h1><pre><code>gui24.py# -*- coding: UTF-8 -*-from Tkinter import *class ScrollText(Frame):    def __init__(self, parent=None, text=&#39;&#39;, file=None):        Frame.__init__(self, parent)        self.pack(expand=YES, fill=BOTH)        self.make_widgets()        self.set_text(text, file)    def make_widgets(self):        sbar = Scrollbar(self)        text = Text(self, relief=SUNKEN)        sbar.config(command=text.yview)        text.config(yscrollcommand=sbar.set)        sbar.pack(side=RIGHT, fill=Y)        text.pack(side=LEFT, expand=YES, fill=BOTH)        self.text = text    def set_text(self, text=&#39;&#39;, file=None):        if file:            text = open(file, &#39;r&#39;).read()        # 1.0表示第一行，第0列（行从1开始，列从0开始）        # END表示最末一个字符后面第一个位置        self.text.delete(&#39;1.0&#39;, END)  # 删除从第一行第0列开始到最后的字符串，即删除全部        self.text.insert(&#39;1.0&#39;, text)  # 从第一行第0列开始填充数据        # mark_set 设置text标志        self.text.mark_set(INSERT, &#39;1.0&#39;)  # 设置将光标设置在文本开始位置        # self.text.mark_set(&#39;line_two&#39;, &#39;2.2&#39;)  # 自定义标志位置 可以用mark_unset取消        self.text.focus()        # TEXT的tag标签        # SEL是内置的标签，表示当前选中的文本        # text = self.text.get(SEL_FIRST, SEL_LAST)        # text = self.text.get(&#39;sel.first&#39;, &#39;sel.last&#39;)        # self.text.tag_add(&#39;alltext&#39;, &#39;1.0&#39;, END)  # 选中所有文本        # self.text.tag_add(SEL, index1, index2)  # 将一定范围内的文本添加到内建的SEL标签        # self.text.tag_remove(SEL, &#39;1.0&#39;, END)  # 将字符串所有字符从SEL标签中删除        # self.text.tag_delete(SEL)  # 删除SEL标签        # self.text.tag_add(&#39;demo&#39;, &#39;1.5&#39;, &#39;1.7&#39;)        # self.text.tag_add(&#39;demo&#39;, &#39;3.0&#39;, &#39;5.7&#39;)        # self.text.tag_config(&#39;demo&#39;, background=&#39;purple&#39;)        # self.text.tag_config(&#39;demo&#39;, fontground=&#39;white&#39;)        # self.text.tag_config(&#39;demo&#39;, font=(&#39;times&#39;, 16, &#39;underline&#39;))        # self.text.tag_bind(&#39;demo&#39;, &#39;&lt;Double-1&gt;&#39;, func)        # see方法        # self.text.see(&#39;1.0&#39;)  # 滚动到第一行第0列        # self.text.see(INSERT)  # 滚动到光标插入处        # self.text.see(SEL_FIRST)  # 滚动到选中文本第一个字符串    def get_text(self):        # -1c 表示往回数一个字符串        # +1l 表示往前数一行        return self.text.get(&#39;1.0&#39;, END + &#39;-1c&#39;)if __name__ == &#39;__main__&#39;:    root = Tk()    if len(sys.argv) &gt; 1:        st = ScrollText(file=sys.argv[1])    else:        st = ScrollText(text=&#39;Words\ngo here&#39;)    def show(event):        print(repr(st.get_text()))    root.bind(&#39;&lt;Key-Escape&gt;&#39;, show)    root.mainloop()</code></pre><h1 id="简单的文本编辑器">简单的文本编辑器</h1><pre><code># gui25.py# -*- coding: UTF-8 -*-from Tkinter import *from tkSimpleDialog import askstringfrom tkFileDialog import asksaveasfilenamefrom quitGui import Quitterfrom gui24 import ScrollTextclass SimpleEditor(ScrollText):    def __init__(self, parent=None, file=None):        frm = Frame(parent)        frm.pack(fill=X)        Button(frm, text=&#39;Save&#39;, command=self.on_save).pack(side=LEFT)        Button(frm, text=&#39;Cut&#39;, command=self.on_cut).pack(side=LEFT)        Button(frm, text=&#39;Paste&#39;, command=self.on_paste).pack(side=LEFT)        Button(frm, text=&#39;Find&#39;, command=self.on_find).pack(side=LEFT)        Quitter(frm).pack(side=LEFT)        ScrollText.__init__(self, parent, file=file)        self.text.config(font=(&#39;courier&#39;, 9, &#39;normal&#39;))    def on_save(self):        filename = asksaveasfilename()        if filename:            alltext = self.get_text()            open(filename, &#39;w&#39;).write(alltext)    def on_cut(self):        text = self.text.get(SEL_FIRST, SEL_LAST)        self.text.delete(SEL_FIRST, SEL_LAST)        self.clipboard_clear()        self.clipboard_append(text)    def on_paste(self):        try:            text = self.selection_get(selection=&#39;CLIPBOARD&#39;)            self.text.insert(INSERT, text)        except TclError:            pass    def on_find(self):        target = askstring(&#39;SimpleEdit&#39;, &#39;Search string?&#39;)        if target:            where = self.text.search(target, INSERT, END)            if where:                print(where)                pastit = where + (&#39;+%dc&#39; % len(target))                self.text.tag_remove(SEL, &#39;1.0&#39;, END)                self.text.tag_add(SEL, where, pastit)                self.text.mark_set(INSERT, pastit)                self.text.see(INSERT)                self.text.focus()if __name__ == &#39;__main__&#39;:    if len(sys.argv) &gt; 1:        SimpleEditor(file=sys.argv[1]).mainloop()    else:        SimpleEditor().mainloop()</code></pre><h1 id="创建基础画布">创建基础画布</h1><pre><code># gui26.py# -*- coding: UTF-8 -*-from Tkinter import *canvas = Canvas(width=525, height=300, bg=&#39;white&#39;)canvas.pack(expand=YES, fill=BOTH)canvas.create_line(100, 100, 200, 200)canvas.create_line(100, 200, 200, 300)for i in range(1, 20, 2):    canvas.create_line(0, i, 50, i)canvas.create_oval(20, 20, 300, 100, width=10, fill=&#39;yellow&#39;)d = {1:PIESLICE,2:CHORD,3:ARC}for i in d:    canvas.create_arc(        (10,10 + 60*i,110,110 + 60*i),        style=d[i],   #指定样式        start=30,     #指定起始角度        extent=30     #指定角度偏移量        )canvas.create_arc(0, 0, 100, 200, fill=&#39;black&#39;)canvas.create_rectangle(200, 200, 300, 300, width=5, fill=&#39;red&#39;)canvas.create_line(0, 300, 150, 150, width=10, fill=&#39;green&#39;)photo = PhotoImage(file=&#39;./gif/lightmachine.png&#39;)canvas.create_image(325,25, image=photo, anchor=NW)widget = Label(canvas, text=&#39;Spam&#39;, fg=&#39;white&#39;, bg=&#39;black&#39;)widget.pack()canvas.create_window(100, 100, window=widget)canvas.create_text(100, 280, text=&#39;CLOUD CLONE CORP.&#39;)# id = canvas.create_line(fromX, fromY, toX, toY)  # 创建直线# id = canvas.create_oval(fromX, fromY, toX, toY) # 创建椭圆# id = canvas.create_arc(fromX, fromY, toX, toY)  # 创建扇形# id =canvas.create_rectangle(fromX, fromY, toX, toY)  # 创建矩形# canvas.move(id, offsetX, offsetY)  # 移动对象# canvas.delete(id)  # 删除对象# canvas.tkraise(id)  # 将对象移动到前端# canvas.lower(id)  # 将对象移动到底部# canvas.itemconfig(id, fill=&#39;red&#39;)  # 修改对象属性# 画布标签# canvas.create_line(fromX, fromY, toX, toY, tag=&#39;bubbles&#39;) # canvas.create_line(fromX, fromY, toX, toY, tag=&#39;bubbles&#39;) # id = canvas.create_line(fromX, fromY, toX, toY)# canvas.addtag_withtag(&#39;bubbles&#39;, id)# canvas.move(&#39;bubbles&#39;, diffX, diffY)mainloop()</code></pre><h1 id="canvas与滚动条">canvas与滚动条</h1><pre><code># gui27.py# -*- coding: UTF-8 -*-from Tkinter import *class ScrolledCanvas(Frame):    def __init__(self, parent=None, color=&#39;brown&#39;):        Frame.__init__(self, parent)        self.pack(expand=YES, fill=BOTH)        canv = Canvas(self, bg=color, relief=SUNKEN)        canv.config(width=300, height=200)        canv.config(scrollregion=(0, 0, 300, 1000))        canv.config(highlightthickness=0)        sbar = Scrollbar(self)        sbar.config(command=canv.yview)        canv.config(yscrollcommand=sbar.set)        sbar.pack(side=RIGHT, fill=Y)        canv.pack(side=LEFT, expand=YES, fill=BOTH)        self.fillContent(canv)        canv.bind(&#39;&lt;Double-1&gt;&#39;, self.onDoubleClick)        self.canvas = canv    def fillContent(self, canv):        for i in range(10):            canv.create_text(150, 50+(i*100), text=&#39;spam&#39;+str(i), fill=&#39;beige&#39;)    def onDoubleClick(self, event):        print(event.x, event.y)        print(self.canvas.canvasx(event.x), self.canvas.canvasy(event.y))if __name__ == &#39;__main__&#39;:    ScrolledCanvas().mainloop()</code></pre><h1 id="canvas绑定事件">canvas绑定事件</h1><pre><code># gui28.py# -*- coding: UTF-8 -*-from Tkinter import *trace = Falseclass CanvasEventDemo:    def __init__(self, parent=None):        canvas = Canvas(width=300, height=300, bg=&#39;beige&#39;)        canvas.pack()        canvas.bind(&#39;&lt;ButtonPress-1&gt;&#39;, self.on_start)        canvas.bind(&#39;&lt;B1-Motion&gt;&#39;, self.on_grow)        canvas.bind(&#39;&lt;Double-1&gt;&#39;, self.on_clear)        canvas.bind(&#39;&lt;ButtonPress-3&gt;&#39;, self.on_move)        self.canvas = canvas        self.drawn = None        self.kinds = [canvas.create_oval, canvas.create_rectangle]    def on_start(self, event):        self.shape =self.kinds[0]        self.kinds = self.kinds[1:] + self.kinds[:1]        self.start = event        self.drawn = None    def on_grow(self, event):        canvas = event.widget        if self.drawn:            canvas.delete(self.drawn)        object_id = self.shape(self.start.x, self.start.y, event.x, event.y)        if trace:            print(object_id)        self.drawn = object_id    def on_clear(self, event):        event.widget.delete(&#39;all&#39;)    def on_move(self, event):        if self.drawn:            if trace:                print(self.drawn)            canvas = event.widget            diffx, diffy = (event.x - self.start.x), (event.y - self.start.y)            canvas.move(self.drawn, diffx, diffy)            self.start = eventif __name__ == &#39;__main__&#39;:    CanvasEventDemo()    mainloop()</code></pre><h1 id="grid布局和pack布局实现自动扩展">grid布局和pack布局实现自动扩展</h1><pre><code># gui29.py# -*- coding: UTF-8 -*-from Tkinter import *colors = [&#39;red&#39;, &#39;green&#39;, &#39;orange&#39;, &#39;white&#39;, &#39;yellow&#39;, &#39;blue&#39;]def gridbox(root):    Label(root, text=&#39;GRID&#39;).grid(columnspan=2)  # 跨两列    row = 1    for color in colors:        lab = Label(root, text=color, relief=RIDGE, width=25)        ent = Entry(root, bg=color, relief=SUNKEN, width=50)        lab.grid(row=row, column=0, sticky=NSEW)  # 向4个方向扩展        ent.grid(row=row, column=1, sticky=NSEW)        root.rowconfigure(row, weight=1)  # 循环行自动扩展        row += 1    root.columnconfigure(0, weight=1)  # 第一列自动扩展    root.columnconfigure(1, weight=1)  # 第二列自动扩展def packbox(root):    Label(root, text=&#39;PACK&#39;).pack()    for color in colors:        row = Frame(root)        lab = Label(row, text=color, relief=RIDGE, width=25)        ent = Entry(row, bg=color, relief=SUNKEN, width=50)        row.pack(side=TOP, expand=YES, fill=BOTH)        lab.pack(side=LEFT, expand=YES, fill=BOTH)        ent.pack(side=RIGHT, expand=YES, fill=BOTH)if __name__ == &#39;__main__&#39;:    root = Tk()    gridbox(Toplevel(root))    packbox(Toplevel(root))    Button(root, text=&#39;Quit&#39;, command=root.quit).pack()    mainloop()</code></pre><h3 id="pilpython-imaging-library">PIL：Python Imaging Library</h3><h1 id="安装">安装</h1><pre><code>sudo apt-get install python-imaging或者sudo easy_install PIL</code></pre><p>window系统选择</p><pre><code>pip install Pillow</code></pre><p>图像操作</p><pre><code>import Image# 打开一个jpg图像文件，注意路径要改成你自己的:im = Image.open(&#39;/Users/michael/test.jpg&#39;)# 获得图像尺寸:w, h = im.size# 缩放到50%:im.thumbnail((w//2, h//2))# 把缩放后的图像用jpeg格式保存:im.save(&#39;/Users/michael/thumbnail.jpg&#39;, &#39;jpeg&#39;)</code></pre><p>模糊效果</p><pre><code>import Image, ImageFilterim = Image.open(&#39;/Users/hanchang/test.jpg&#39;)im2 = im.filter(ImageFilter.BLUR)im2.save(&#39;/Users/hanchang/blur.jpg&#39;, &#39;jpeg&#39;)</code></pre><p>自定义图像验证码</p><pre><code>import Image, ImageDraw, ImageFont, ImageFilterimport random# 随机字母:def rndChar():    return chr(random.randint(65, 90))# 随机颜色1:def rndColor():    return (random.randint(64, 255), random.randint(64, 255), random.randint(64, 255))# 随机颜色2:def rndColor2():    return (random.randint(32, 127), random.randint(32, 127), random.randint(32, 127))# 240 x 60:width = 60 * 4height = 60image = Image.new(&#39;RGB&#39;, (width, height), (255, 255, 255))# 创建Font对象:font = ImageFont.truetype(&#39;Arial.ttf&#39;, 36)# 创建Draw对象:draw = ImageDraw.Draw(image)# 填充每个像素:for x in range(width):    for y in range(height):        draw.point((x, y), fill=rndColor())# 输出文字:for t in range(4):    draw.text((60 * t + 10, 10), rndChar(), font=font, fill=rndColor2())# 模糊:image = image.filter(ImageFilter.BLUR)image.save(&#39;code.jpg&#39;, &#39;jpeg&#39;);自定义字符串生成图片</code></pre><p><code>from PIL import Image,ImageDraw,ImageFont,ImageOps &lt;h1&gt;生成图片&lt;/h1&gt; def create\_image(str, line, name, dir): img\_size = (400, (line*20) + 10) img\_mode = 'RGB' img\_font = ImageFont.truetype('UbuntuMono-R.ttf', 14) img\_bg = '#FFF' img\_fg = '#000' img = Image.new(mode=img\_mode, size=img\_size, color=img\_bg) draw = ImageDraw.Draw(img) draw.text((10, 10), str, fill=img\_fg, font=img_font) img.save( dir + name + '.png', 'png')</code></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu14.04服务器基础配置</title>
      <link href="/2016/11/10/Ubuntu14.04%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/"/>
      <url>/2016/11/10/Ubuntu14.04%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="登陆ssh">登陆ssh</h1><pre><code>ssh root@ipaddress password:</code></pre><h1 id="首次登陆出现的错误">首次登陆出现的错误</h1><pre><code>perl: warning: Setting locale failed.perl: warning: Please check that your locale settings:# 安装 localepurge 管理语言文件sudo apt-get install localepurge# 或者之后自行配置sudo dpkg-reconfigure localepurge# 生成自己需要的语言sudo locale-gen zh_CN.UTF-8 en_US.UTF-8# 打印结果locale# ssh连接时候指定语言LC_ALL=en_US.UTF-8 ssh &lt;host&gt;</code></pre><h1 id="创建用户">创建用户</h1><pre><code>adduser hanchangpassword:retry password:</code></pre><h1 id="将用户添加到sudo用户组">将用户添加到sudo用户组</h1><p>错误提示</p><pre><code>username is not in the sudoers file.su -password：chmod u+w /etc/sudoers   # 添加文件写权限root ALL=(ALL) ALL 下面添加以下代码hanchang ALL=(ALL) NOPASSWD: ALL:wq 退出chmod u-w /etc/sudoers  # 取消文件写权限</code></pre><p>修改root密码</p><pre><code>sudo passwdpassword:retry password:</code></pre><h1 id="禁止root用户远程登陆ssh">禁止root用户远程登陆ssh</h1><pre><code>cd /e   tc/ssh/sudo vim sshd_configPermitRootLogin yes改成PermitRootLogin noservice sshd restart    或者 /etc/init.d/sshd restart（ssh服务器重启）</code></pre><h1 id="指定ip地址登陆">指定IP地址登陆</h1><pre><code>vim  /etc/hosts.allowsshd:192.168.220.164:allow  # 最后添加vim /etc/hosts.denysshd:ALL #最后添加</code></pre><h1 id="避免sshd连接超时">避免sshd连接超时</h1><p>修改客户端</p><pre><code>sudo vim /etc/ssh/ssh_config# 添加ServerAliveInterval 30   # 每30秒向服务器发起心跳ServerAliveCountMax 6 # 允许6次无响应</code></pre><p>或者修改服务器端</p><pre><code># 打开sudo vim /etc/ssh/sshd_config# 添加ClientAliveInterval 30ClientAliveCountMax 6</code></pre><h1 id="流量监控">流量监控</h1><pre><code># 安装监控软件sudo apt-get install vnstat# 安装好后运行以下命令初始化数据库# eth0可以通过ifconfig查看sudo vnstat -u -i eth1# 修改配置文件sudo vim /etc/vnstat.confInterface &quot;eth1&quot; #此处修改需要监控的网卡# 启动守护进程sudo /etc/init.d/vnstat start# 默认开机启动sudo update-rc.d vnstat enable</code></pre><h1 id="查看是否安装iptables">查看是否安装iptables</h1><pre><code>iptables: /sbin/iptables /usr/share/iptables /usr/share/man/man8/iptables.8.gz #表示已经安装iptablesapt-get install iptables #如果默认没有安装，请运行此命令安装防火墙</code></pre><p>编辑iptables配置文件</p><pre><code>sudo vi /etc/iptables.rules*filter:INPUT DROP [0:0]:FORWARD ACCEPT [0:0]:OUTPUT ACCEPT [0:0]:syn-flood - [0:0]-A INPUT -i lo -j ACCEPT-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 20 -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT-A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT-A INPUT -p icmp -m limit --limit 100/sec --limit-burst 100 -j ACCEPT-A INPUT -p icmp -m limit --limit 1/s --limit-burst 10 -j ACCEPT-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood-A INPUT -j REJECT --reject-with icmp-host-prohibited-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN-A syn-flood -j REJECT --reject-with icmp-port-unreachableCOMMIT# sudo iptables-restore &lt; /etc/iptables.rules #使防火墙规则生效，重启主机执行此命令# 重启主机会使以上配置失效，以下内容为如何配置开机自动启动防火墙# vi /etc/network/if-pre-up.d/iptables #创建文件，添加以下内容，使防火墙开机启动#!/bin/bashiptables-restore &lt; /etc/iptables.rules# chmod +x /etc/network/if-pre-up.d/iptables #添加执行权限# sudo iptables -L -n查看规则是否生效.</code></pre><h1 id="挂载新的硬盘">挂载新的硬盘</h1><pre><code>fdisk -l如果出现Disk /dev/sdb doesn&#39;t contain a valid partition table说明没有分区,需要处理fdisk /dev/sdbCommand (m for help):  m为查看选项，这里我们输入n表示创建一个新的分区选中默认，在分区大小中填写分区大小 +500G</code></pre><p>第二步：使新创建的分区在系统中立即生效 root#partprobe 第三步：格式化新创建的分区</p><pre><code>mkfs.ext3 /dev/hdb1</code></pre><p>第四步：使新创建的分区挂载/mnt/ssd_one 目录下</p><pre><code>mount /dev/hda1 /mnt/rhce01</code></pre><p>查看已经挂载的信息</p><pre><code>sudo vim /etc/mtab</code></pre><p>第五步：开机自动挂载</p><pre><code>sudo vim /etc/fstab# 底部添加/dev/sdb1              /mnt/hdd_one              ext3    defaults        0 0</code></pre><p>查看现在的硬盘信息</p><pre><code>root@m1095:~# df -hlFilesystem      Size  Used Avail Use% Mounted onudev             12G  4.0K   12G   1% /devtmpfs           2.4G  632K  2.4G   1% /run/dev/sda2        71G  1.2G   66G   2% /none            4.0K     0  4.0K   0% /sys/fs/cgroupnone            5.0M     0  5.0M   0% /run/locknone             12G     0   12G   0% /run/shmnone            100M     0  100M   0% /run/user/dev/sda1       226M   35M  175M  17% /boot/dev/sdb1       493G   70M  467G   1% /mnt/hdd_one</code></pre><h1 id="ftp服务器搭建">ftp服务器搭建</h1><pre><code>sudo apt-get install vsftpd</code></pre><p>编辑配置文件</p><pre><code>sudo vim /etc/vsftpd.confanonymous_enable=NO   # 禁止匿名用户local_enable=YES   # 允许本地用户write_enable=YES # 允许写入chroot_local_user=YES  # 登陆用户被限制在自己的home目录下allow_writeable_chroot=YES # 配合chroot_local_user=YES使用# 当chroot_local_user=YES表示chroot_list为可以访问其他目录的用户# 当chroot_local_user=NO表示chroot_list为不可以访问其他目录的用户，# chroot_list_enable=YES  # chroot_list_file=/etc/vsftpd.chroot_list# 以下内容为添加内容# 设置为YES表示开启用户登陆过滤，设置为NO表示不开启用户过滤，所有用户都可以访问userlist_enable=YES# 在userlist_enable=YES的前提下，设置是否阻扯user_list文件中的用户登录FTP服务器# YES表示user_list为黑名单，在文件中的用户不能访问，不在文件中的用户可以访问# NO表示user_list 为白名单，在文件中的用户可以访问，不在文件中的用户不能访问userlist_deny=YESsudo vim /etc/vsftpd.user_list添加root到文件中</code></pre><p>出现500 OOPS: vsftpd: refusing to run with writable root inside chroot()错误的时候 原因：chroot设置为yes的时候，需要取消ftp根目录的写权限</p><pre><code># 在配置文件中添加此设置allow_writeable_chroot=YES </code></pre><h1 id="开启防火墙后vsftpd连接错误处理">开启防火墙后vsftpd连接错误处理</h1><p>载入以下2个模块</p><pre><code>sudo modprobe ip_nat_ftpsudo modprobe ip_conntrack_ftpsudo vi /etc/modules# Add these lines:ip_nat_ftpip_conntrack_ftp</code></pre><p>重启vsftpd服务</p><h1 id="安装lamp服务">安装lamp服务</h1><p>安装apache</p><pre><code>sudo apt-get install apache2# 将用户添加到apache用户组中sudo usermod -a -G www-data username # www-data 为apache用户组名，username为登陆用户名# apache2安装rewritesudo a2enmod rewritesudo service apache2 restart# 删除显示的版本信息ServerTokens ProdServerSignature Off </code></pre><p>配置虚拟主机</p><pre><code>sudo vim /etc/apache.2/apache2.conf# 添加以下内容&lt;Directory /home/zhc/www/&gt;        Options FollowSymLinks　#　不要加Index        AllowOverride All        Require all granted&lt;/Directory&gt;</code></pre><p>安装mysql</p><pre><code>sudo apt-get install mysql-server php5-mysql＃配置mysqlsudo mysql_secure_installation</code></pre><p>查看mysql是否开启慢查询日志</p><pre><code>mysql&gt; show variables like &#39;%slow%&#39;;+---------------------------+---------------------------------------+| Variable_name             | Value                                 |+---------------------------+---------------------------------------+| log_slow_admin_statements | OFF                                   || log_slow_slave_statements | OFF                                   || slow_launch_time          | 2                                     || slow_query_log            | OFF                                   || slow_query_log_file       | /var/lib/mysql/NC-PH-1551-49-slow.log |+---------------------------+---------------------------------------+5 rows in set (0.00 sec)#开启慢查询mysql&gt; set global log_slow_queries  = &#39;ON&#39;;mysql&gt; show variables like &#39;%slow%&#39;;#开启常规查询vim /etc/myql/mysql.conf.d/mysqld.confgeneral_log_file        = /var/log/mysql/mysql.loggeneral_log             = 1#开启错误查询log_error = /var/log/mysql/error.log#　防止innodb ibdata1文件过大innodb_file_per_table=1　</code></pre><p>安装php</p><pre><code>sudo apt-get install php5 libapache2-mod-php5 php5-mcrypt#ubuntu16.04安装方法# Add the PPAapt-get install software-properties-common #如果提示没有 add-apt-repository，需要执行此命令安装sudo add-apt-repository ppa:ondrej/php# If you get add-apt-repository: command not found run the following command first :sudo apt-get install software-properties-commonsudo apt-get updatesudo apt-get install php5.6sudo apt-get install php5.6-*</code></pre><p>配置php</p><pre><code>vim /etc/php/5.6/apache/php.iniexpose_php = Off # 隐藏php版本信息</code></pre><h1 id="静态文件同步">静态文件同步</h1><p>定时任务 crontab -e # 编辑当前用户的定时任务 crontab -u hanchang -e # 编辑指定用户的定时任务</p><pre><code># m h  dom mon dow   command# 分钟 小时 日期 月份 星期 命令0 0 * * * /bin/sh /home/hanchang/www/scripts/rsyncHK.sh</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOs7.2服务器基础配置</title>
      <link href="/2016/11/10/CentOs7.2%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/"/>
      <url>/2016/11/10/CentOs7.2%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="查看当前版本">查看当前版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/version </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/redhat-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> Centos Linux release 7.2.1511 (Core)</span></span><br></pre></td></tr></table></figure><h2 id="用户管理">用户管理</h2><h3 id="修改root密码">修改root密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> passwd root</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 输入密码</span></span><br></pre></td></tr></table></figure><h3 id="创建用户">创建用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入密码</span></span><br><span class="line">useradd test</span><br><span class="line">passwd test</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 确认密码</span></span><br><span class="line">su test # 切换成普通用户</span><br></pre></td></tr></table></figure><p><strong>将test用户加入到sudoers用</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">visudo命令 <span class="comment"># 相当于直接编辑 /etc/sudoers,但用命令方式更安全,推荐</span></span></span><br><span class="line">su</span><br><span class="line">cd /etc</span><br><span class="line">chmod 777 sudoers</span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">test    ALL=(ALL)       ALL  # 新添加的</span><br><span class="line">chmod 440 sudoers   # 权限改成440，必须，否则会报错</span><br></pre></td></tr></table></figure></p><h2 id="配置网络">配置网络</h2><h3 id="网络配置地址">网络配置地址</h3><ul><li>/etc/sysconfig/network Centos设置主机名和网络配置<br></li><li>/etc/sysconfig/network-scripts/ifcfg-eth0针对特定的网卡进行设置<br></li><li>/etc/resolv.conf设置DNS<br></li><li>/etc/hosts设置指定的域名解析地址</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/sysconfig/network-scripts/</span><br><span class="line">vi ifcfg-enp0s23</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最后添加内容</span></span><br><span class="line">IPADDR=192.168.0.160  # ip地址</span><br><span class="line">NETMASK=255.255.255.0 # 掩码</span><br><span class="line">GATEWAY=192.168.0.1 # 网关地址</span><br><span class="line">DNS1=202.103.24.68 # DNS地址</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改内容</span></span><br><span class="line">ONBOOT=yes # 启动时网络接口有效</span><br><span class="line">BOOTPROTO=none # dhcp改成none dhcp自动获取，static固定，none手动</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动网卡</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ifup eth0s23</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart network</span></span><br></pre></td></tr></table></figure><h3 id="安装网络查看工具">安装网络查看工具</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install net-tools</span></span><br></pre></td></tr></table></figure><h2 id="ssh服务">SSH服务</h2><h3 id="配置ssh">配置Ssh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装ssh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install  openssh*</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> service sshd start</span></span><br></pre></td></tr></table></figure><h3 id="ssh连接">Ssh连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh <span class="built_in">test</span>@192.168.0.160 <span class="comment"># 默认22端口</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh -p 2222 <span class="built_in">test</span>@192.168.0.160 <span class="comment"># 修改端口后</span></span></span><br></pre></td></tr></table></figure><p><strong>禁止root用户远程ssh连接</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_congif </span><br><span class="line"><span class="meta">#</span><span class="bash"> 最后添加</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁止root远程登陆  </span></span><br><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure></p><h2 id="安全">安全</h2><h3 id="关闭selinux">关闭SeLinux</h3><p>修改/etc/selinux/config 文件<br>将SELINUX=enforcing改为SELINUX=disabled<br>setenforce 0 ##设置SELinux 成为permissive模式,临时关闭或者及时起效</p><h3 id="开启防火墙">开启防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> systemctl mask firewalld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl stop firewalld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install iptables-services <span class="comment"># 如果下面命令报错，则需要安装</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> iptables</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start iptables</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> ip6tables</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start ip6tables</span></span><br></pre></td></tr></table></figure><p><strong>防火墙开机启动</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> iptables</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">disable</span> iptables</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看开机运行的服务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl list-unit-files --<span class="built_in">type</span>=service</span></span><br></pre></td></tr></table></figure></p><p><strong>火墙是否放行ssh端口22</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /etc/sysconfig/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi iptables</span></span><br></pre></td></tr></table></figure></p><p>在commit前添加以下内容，并注释文件开头信息 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sample configuration <span class="keyword">for</span> iptables service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you can edit this manually or use system-config-firewall</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> please <span class="keyword">do</span> not ask us to add additional ports/services to this default configuration</span></span><br><span class="line">*filter</span><br><span class="line"><span class="meta">#</span><span class="bash"> :INPUT ACCEPT [0:0]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> :FORWARD ACCEPT [0:0]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> :OUTPUT ACCEPT [0:0]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -A INPUT -p icmp -j ACCEPT</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -A INPUT -i lo -j ACCEPT</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -A INPUT -j REJECT --reject-with icmp-host-prohibited</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -A FORWARD -j REJECT --reject-with icmp-host-prohibited</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安全设置-防止扫描包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NONE 包(所有标识bit都没有设置)主要是扫描类的数据包</span></span><br><span class="line">-A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span><br><span class="line"><span class="meta">#</span><span class="bash"> 防止sync-flood 攻击</span></span><br><span class="line">-A INPUT -p tcp ! --syn -m state --state NEW -j DROP</span><br><span class="line"><span class="meta">#</span><span class="bash"> ALL包（所有的标注bit都被设置了）也是网络扫描的数据包</span></span><br><span class="line">-A INPUT -p tcp --tcp-flags ALL ALL -j DROP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放对应端口</span></span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 缺省设置</span></span><br><span class="line">:INPUT DROP [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 许所有从服务器端发起的连接，由此返回的响应数据应该是允许的,yum操作等</span></span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="meta">#</span><span class="bash"> 接受主机localhost的任意请求</span></span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure></p><h2 id="ftp服务">FTP服务</h2><h3 id="安装">安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install vsftpd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start vsftpd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> vsftpd</span></span><br></pre></td></tr></table></figure><h3 id="配置">配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新防火墙，放行20， 21端口，如果用了代理上传，需要添加被动模式的端口号  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置项目</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">    </span><br><span class="line">anonymous_enable=No # YES改成No,禁止匿名用户</span><br><span class="line">listen=YES # No改成Yes 开启监听</span><br><span class="line"><span class="meta">#</span><span class="bash"> listen_ipv6=YES  <span class="comment"># 此行需要注释掉</span></span></span><br><span class="line">tcp_wrappers=YES   # 默认应该就是YES</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在/etc/vsftpd.chroot_list文件中列出的用户，可以切换到其他目录；</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 未在/etc/vsftpd/chroot_list文件中列出的用户，不能切换到其他目录。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 需要创建/etc/vsftpd/chroot_list文件</span></span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES  </span><br><span class="line"><span class="meta">#</span><span class="bash"> (default follows) </span></span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 防止500oops错误 </span></span><br><span class="line">allow_writeable_chroot=YES </span><br><span class="line"><span class="meta">#</span><span class="bash"> 被动模式端口号</span></span><br><span class="line">pasv_min_port=30000  </span><br><span class="line">pasv_max_port=31000</span><br></pre></td></tr></table></figure><p><strong>只允许指定ip登陆</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/hosts.allow</span></span><br><span class="line">最后添加</span><br><span class="line">vsftpd:192.168.0.19:allow</span><br><span class="line">vsftpd:all:deny</span><br></pre></td></tr></table></figure></p><p>添加虚拟用户 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> useradd -g ftp -d /var/ftp/ftpuser -s /sbin/nologin ftpuser </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> passwd ftpuser</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /etc/vsftpd/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> touch chroot_list</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi chroot_list</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ftpuser <span class="comment"># 将用户名称添加到chroot_list里</span></span></span><br></pre></td></tr></table></figure></p><h2 id="lamp服务">LAMP服务</h2><h3 id="apache">Apache</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yum install httpd # 安装apache2</span><br><span class="line">$ systemctl enable httpd.service</span><br><span class="line">$ systemctl enable httpd.service</span><br></pre></td></tr></table></figure><h3 id="mysql5.6">Mysql5.6</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装rpm包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看可以安装的资源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum repolist enabled | grep <span class="string">"mysql.*-community.*"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install mysql-community-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> mysqld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mysql_secure_installation <span class="comment"># 设置密码等</span></span></span><br></pre></td></tr></table></figure><h3 id="php5.4">Php5.4</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install php</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-snmp php-soap curl curl-devel php-mysql php-devel</span></span><br></pre></td></tr></table></figure><h3 id="php5.6或者其他">Php5.6或者其他</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y install epel-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://centos7.iuscommunity.org/ius-release.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -Uvh ius-release*.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install php56u php56u-opcache php56u-xml php56u-mcrypt php56u-gd php56u-devel php56u-mysql php56u-intl php56u-mbstring php56u-bcmath</span></span><br></pre></td></tr></table></figure><h3 id="配置-1">配置</h3><p><strong>Apache允许php脚本</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/httpd/conf/httpd.conf</span></span><br><span class="line">AddType application/x-compress .Z</span><br><span class="line">AddType application/x-gzip .gz .tgz</span><br><span class="line">AddType application/x-httpd-php .php  # 新添加内容</span><br></pre></td></tr></table></figure><p><strong>Apache虚拟主机</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /etc/httpd/conf.d</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi vhost.conf    </span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:121&gt;</span><br><span class="line">ServerName phpmyadmin.com</span><br><span class="line">ServerAlias www.phpmyadmin.com</span><br><span class="line">DocumentRoot /var/www/html/phpMyAdmin/</span><br><span class="line">ErrorLog /var/www/web_log/phpMyAdmin.www_error.log # 开启日志需要创建web_log文件夹，否则会报错</span><br><span class="line">CustomLog /var/www/web_log/phpMyAdmin.www_access.log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;Directory "/var/www/html/phpMyAdmin/"&gt;</span><br><span class="line">    Options FollowSymLinks</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:108&gt;</span><br><span class="line">ServerName hkmain.com</span><br><span class="line">ServerAlias www.kmain.com</span><br><span class="line">DocumentRoot /var/www/html/NEW/</span><br><span class="line">ErrorLog /var/www/web_log/NEW.www_error.log</span><br><span class="line">CustomLog /var/www/web_log/NEW.www_access.log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;Directory "/var/www/html/NEW/"&gt;</span><br><span class="line">    Options FollowSymLinks</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p><p><strong>Apache加载的模块查看</strong> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> apachectl -M | sort</span></span><br></pre></td></tr></table></figure></p><p>网站目录权限配置 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chown -R apache:apache WEB_FOLD</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 750 WEB_FOLD</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> WEB_FOLD</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod 750 &#123;&#125; \;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find -not -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod 640 &#123;&#125; \;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find . -name <span class="string">"Runtime"</span> -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod -R 770 &#123;&#125; \;</span></span><br></pre></td></tr></table></figure></p><h2 id="lnmp服务">LNMP服务</h2><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-centos-7" target="_blank" rel="noopener">参考链接</a></p><h3 id="nginx安装">Nginx安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装pcre库，使nginx支持rewrite</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install pcre pcre-devel -y</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install nginx</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start nginx.service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置开机启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> nginx.service</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/nginx/conf.d/default.conf</span></span><br><span class="line"></span><br><span class="line">server &#123; </span><br><span class="line">    listen 80; server\_name server\_domain\_name\_or_IP; # 注意位置，在括号外 root /usr/share/nginx/html; index index.php index.html index.htm;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">        # 下面是配置fpm</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        try_files $uri =404;</span><br><span class="line">        fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; (这个值从php-fpm复制来)</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="源码安装nginx">源码安装Nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装pcre库，使nginx支持rewrite</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install pcre pcre-devel -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装openssl，https服务需要使用</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install openssl openssl-devel -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 gzip 类库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install zlib zlib-devel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装编译程序</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install make gcc gcc-c++ ncurses-devel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建用户</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> useradd nginx -s /sbin/nologin -M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载源码</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget -q https://nginx.org/download/nginx-1.12.1.tar.gz </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf nginx-1.12.1.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> nginx-1.12.1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_gunzip_module --with-http_gzip_static_module --with-threads --with-file-aio --with-ipv6 --with-http_v2_module --with-cc-opt=<span class="string">'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=native'</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建链接</span></span><br><span class="line">sudo ln -s /usr/local/nginx/bin/nginx /usr/bin/nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动nginx</span></span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止nginx</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新加载配置文件</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload        </span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试你的配置文件是否有误</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -t       </span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看nginx对应的端口</span></span><br><span class="line"> lsof -i :80</span><br></pre></td></tr></table></figure><h3 id="mysql5.6-1">Mysql5.6</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装rpm包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看可以安装的资源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum repolist enabled | grep <span class="string">"mysql.*-community.*"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install mysql-community-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start mysqld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> mysqld</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mysql_secure_installation <span class="comment"># 设置密码等</span></span></span><br></pre></td></tr></table></figure><h2 id="php">Php</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y install epel-release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install php php-mysql php-fpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install php-pecl-memcache</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/php.ini</span></span><br><span class="line"><span class="meta">#</span><span class="bash">cgi.fix_poathinfo=1改成</span></span><br><span class="line">cgi.fix_pathinfo=0</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/php-php.d/www.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第一处修改</span></span><br><span class="line">listen = /var/run/php-fpm/php-fpm.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二处修改</span></span><br><span class="line">listen.owner = nobody</span><br><span class="line">listen.group = nobody</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第三处修改</span></span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start php-fpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> php-fpm</span></span><br></pre></td></tr></table></figure><h3 id="php7">Php7</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash"> 加源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install epel-release yum-utils</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 选择remi</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager --<span class="built_in">enable</span> remi-php70</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager --<span class="built_in">enable</span> remi-php71</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager --<span class="built_in">enable</span> remi-php72</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装相关扩展</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum-config-manager --<span class="built_in">enable</span> remi-php70</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install php php-common php-opcache php-mcrypt php-cli php-gd php-curl php-mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 PHP FPM </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install php-fpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> php-fpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start php-fpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/php-fpm.d/www.conf</span></span><br><span class="line"></span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置nginx虚拟server</span></span><br><span class="line">server &#123;</span><br><span class="line">    # . . . other code</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        try_files $uri =404;</span><br><span class="line">        # fastcgi_pass unix:/run/php-fpm/www.sock;</span><br><span class="line">                fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xcache">Xcache</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装xcahe</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum -y install php-xcache xcache-admin</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果失败请用下面的方法</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> xcahe</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://kojipkgs.fedoraproject.org//packages/php-xcache/3.1.1/1.el7/x86_64/php-xcache-3.1.1-1.el7.x86_64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 图形化管理</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://kojipkgs.fedoraproject.org//packages/php-xcache/3.1.1/1.el7/noarch/xcache-admin-3.1.1-1.el7.noarch.rpm</span></span><br></pre></td></tr></table></figure><h3 id="示例">示例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">sudo vi /usr/share/nginx/html/info.php</span><br><span class="line">&lt;?php echo phpinfo();&gt;</span><br><span class="line">sudo systemctl restart php-fpm</span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="imagemagick">ImageMagick</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install php-pear gcc</span><br><span class="line">yum install ImageMagick ImageMagick-devel ImageMagick-perl</span><br><span class="line">pecl install imagick # 直接回车</span><br><span class="line">echo extension=imagick.so &gt;&gt; /etc/php.ini # 添加php扩展</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h2 id="mysql主从复制">Mysql主从复制</h2><a href="/2016/11/09/Mysql主从复制/" title="mysql主从复制">mysql主从复制</a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/my.cnf</span></span><br><span class="line">[mysqld] </span><br><span class="line">server-id=1     # 配一个唯一的ID编号，1至32  </span><br><span class="line">log-bin=mysql-bin  # 二进制文件存放路径  </span><br><span class="line">binlog-do-db=test1  # 需要同步的数据库名  </span><br><span class="line">binlog-ignore-db=test2  # 不需要同步的数据库名</span><br></pre></td></tr></table></figure><h2 id="rsycn数据同步">Rsycn数据同步</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install rsync <span class="comment"># 安装，默认端口873  </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start rsyncd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> rsyncd</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 日志文件位置，启动rsync后自动产生这个文件，无需提前创建</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim rsync.conf</span></span><br><span class="line"></span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> pid文件的存放位置</span></span><br><span class="line">pidfile = /var/run/rsyncd.pid</span><br><span class="line"><span class="meta">#</span><span class="bash"> 支持max connections参数的锁文件</span></span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户认证配置文件，里面保存用户名称和密码，后面会创建这个文件</span></span><br><span class="line">secrets file = /etc/rsync.pass</span><br><span class="line"><span class="meta">#</span><span class="bash"> rsync启动时欢迎信息页面文件位置（文件内容自定义</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> motd file = /etc/rsyncd.Motd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置rsync运行权限为root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> uid = root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置rsync运行权限为root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gid = root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 匿名用户</span></span><br><span class="line">uid = 0</span><br><span class="line">gid = 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认端口</span></span><br><span class="line">port = 873</span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认为<span class="literal">true</span>，修改为no，增加对目录文件软连接的备份</span></span><br><span class="line">use chroot = no</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置rsync服务端文件为读写权限</span></span><br><span class="line">read only = yes</span><br><span class="line"><span class="meta">#</span><span class="bash"> 不显示rsync服务端资源列表</span></span><br><span class="line">list = no</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大连接数</span></span><br><span class="line">max connections = 200</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置超时时间</span></span><br><span class="line">timeout = 600</span><br><span class="line"><span class="meta">#</span><span class="bash"> 不验证用户密码</span></span><br><span class="line">strict modes = false</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行数据同步的用户名，可以设置多个，用英文状态下逗号隔开</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> auth users = <span class="built_in">test</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许进行数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开</span></span><br><span class="line">hosts allow = 192.168.0.206, 192.168.0.118</span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁止数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hosts deny = 192.168.21.254</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自定义名称</span></span><br><span class="line">[web]</span><br><span class="line"><span class="meta">#</span><span class="bash"> rsync服务端数据目录路径</span></span><br><span class="line">path = /var/www/html/HKMAIN_NEW/Upload/product/manual/cn/</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 模块名称与自定义名称相同</span></span><br><span class="line">comment = web</span><br><span class="line"></span><br><span class="line">[webe]</span><br><span class="line">path = /var/www/html/HKMAIN_NEW/Upload/product/manual/en/</span><br><span class="line">comment = webe</span><br></pre></td></tr></table></figure><h2 id="nfs">Nfs</h2><h3 id="服务器端">服务器端</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 服务器端安装及配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装命令</span></span><br><span class="line">sudo yum install nfs-utils rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否安装成功</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rpm -aq nfs-utils rpcbind</span></span><br><span class="line">rpcbind-0.2.0-38.el7.x86_64</span><br><span class="line">nfs-utils-1.3.0-0.33.el7_3.x86_64</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动rpcbind</span></span><br><span class="line">sudo systemctl restart rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看状态</span></span><br><span class="line">systemctl status rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机启动</span></span><br><span class="line">sudo systemctl enable rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否开机启动</span></span><br><span class="line">systemctl is-enabled rpcbind # enable表示开机启动，disable表示不开机启动</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动及开机启动nfs服务</span></span><br><span class="line">sudo systemctl restart nfs</span><br><span class="line">sudo systemctl enable nfs</span><br><span class="line"><span class="meta">#</span><span class="bash">配置nfs服务</span></span><br><span class="line">vim /etc/exports</span><br><span class="line">/readonly 192.168.0.160(insecure,ro,no_root_squash) # 指定ip地址，只读</span><br><span class="line">/rwsync 192.168.0.0/24(insecure,rw,sync,no_root_squash) # 指定ip地址段，读写</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载配置文件</span></span><br><span class="line">sudo exportfs -rv</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看nfs服务器本地挂载情况</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> showmount -e localhost</span></span><br><span class="line">Export list for localhost:</span><br><span class="line">/rwsync   192.168.0.0/24</span><br><span class="line">/readonly 192.168.0.160</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">sudo systemctl restart nfs</span><br></pre></td></tr></table></figure><h3 id="客户端">客户端</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 客户端安装配置</span></span><br><span class="line">sudo yum install nfs-utils rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 只需启动rpc服务</span></span><br><span class="line">sudo systemctl restart rpcbind</span><br><span class="line">sudo systemctl enable rpcbind</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看可以挂载服务器端的目录</span></span><br><span class="line">showmount -e 192.168.0.206</span><br><span class="line">Export list for 192.168.0.206:</span><br><span class="line">/rwsync   192.168.0.0/24</span><br><span class="line">/readonly 192.168.0.160</span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂载</span></span><br><span class="line">sudo mount -t nfs 192.168.0.206:/readonly /mnt/readonly</span><br><span class="line">sudo mount -t nfs 192.168.0.206:/rwsync /mnt/rwsync</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看挂载结果</span></span><br><span class="line">df -h</span><br></pre></td></tr></table></figure><h2 id="python3.5">python3.5</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装编译环境</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tgz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf Python-3.6.6.tgz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> Python-3.5.1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/python3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; make install</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建软连接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ln -s /usr/<span class="built_in">local</span>/python3/bin/python3 /usr/bin/python3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 --version</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ln -s /usr/<span class="built_in">local</span>/python3/bin/pip3 /usr/bin/pip3 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip3 --version</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加pip源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.pip/pip.conf</span></span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">trusted-host =  mirrors.aliyun.com</span><br><span class="line">index-url = https://mirrors.aliyun.com/pypi/simple</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 安装虚拟环境</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo pip3 uninstall virtualenv</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ln -s /usr/<span class="built_in">local</span>/python3/bin/virtualenv /usr/bin/virtualenv </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 创建虚拟环境</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> virtualenv --no-site-packages -p python3 .env</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ./.env/bin/activate</span></span><br></pre></td></tr></table></figure><h2 id="node8">Node8</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 参考文件 https://nodejs.org/en/download/package-manager/</span></span><br><span class="line">On RHEL, CentOS or Fedora, for Node.js v8 LTS:</span><br><span class="line"></span><br><span class="line">curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -</span><br><span class="line">Alternatively for Node.js 10:</span><br><span class="line"></span><br><span class="line">curl --silent --location https://rpm.nodesource.com/setup_10.x | sudo bash -</span><br><span class="line">Then install:</span><br><span class="line">sudo yum -y install nodejs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装cnpm</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h2 id="redis">Redis</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install redis</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> redis</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看版本号</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> redis-server --version</span></span><br></pre></td></tr></table></figure><h2 id="docker">Docker</h2><a href="/2019/09/27/Docker入门基础/" title="Docker入门基础">Docker入门基础</a><h2 id="sentry">Sentry</h2><a href="/2018/09/08/Sentry入门基础/" title="Sentry入门基础">Sentry入门基础</a><h2 id="rabbitmq">RabbitMQ</h2><a href="/2018/09/08/RabbitMq入门基础/" title="RabbitMq入门基础">RabbitMq入门基础</a><h2 id="postgressql">PostgresSql</h2><a href="/2018/08/07/PostgresSql入门基础/" title="PostgresSql入门基础">PostgresSql入门基础</a><h2 id="supervisor">Supervisor</h2><h3 id="安装-1">安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install -y supervisor</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> supervisord <span class="comment"># 开机自启动</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl start supervisord <span class="comment"># 启动supervisord服务</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl status supervisord <span class="comment"># 查看supervisord服务状态</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ps -ef|grep supervisord <span class="comment"># 查看是否存在supervisord进程</span></span></span><br></pre></td></tr></table></figure><h3 id="配置-2">配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置web访问</span></span><br><span class="line">[inet_http_server]</span><br><span class="line">port=*:9001                                                  </span><br><span class="line">username=username</span><br><span class="line">password=password </span><br><span class="line">[include]                                                                                   │(.env-api) ➜  supervisord.d sudo vim doneself-api.ini                 </span><br><span class="line">files = supervisord.d/*.ini   # 配置文件地址</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim xxx.ini</span></span><br><span class="line">[program:doneself-api-uwsgi]</span><br><span class="line">command = /home/doneself/code/web/.env-api/bin/uwsgi --ini /home/doneself/code/web/api/uwsgi.ini</span><br><span class="line">autostart = true</span><br><span class="line">autorestart = true</span><br><span class="line">stopsignal= QUIT</span><br><span class="line">user= doneself</span><br><span class="line">redirect_stderr=false</span><br><span class="line">stdout_logfile = /home/doneself/code/web/api/log/uwsgi_stdout.log</span><br><span class="line">stderr_logfile = /home/doneself/code/web/api/log/uwsgi_stderr.log</span><br></pre></td></tr></table></figure><p><a href="http://supervisord.org/" target="_blank" rel="noopener">其他信息</a></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> CentOs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript入门基础</title>
      <link href="/2016/11/10/Javascript%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/10/Javascript%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="数据类型">数据类型</h3><blockquote><p>object(包含Function，Array，Date等)<br>number<br>string<br>boolean<br>null<br>undefined</p></blockquote><h3 id="类型检测">类型检测</h3><p>typeof 基本类型，function， null可以用===判断</p><pre><code>typeof 100           // &quot;number&quot;   typeof true          // &quot;boolean&quot;    typeof function      // &quot;function&quot;    typeof undefined     // &quot;undefined&quot;  typeof new Object()  // &quot;object&quot;  typeof [1, 2]        // &quot;object&quot;  typeof NaN           // &quot;number&quot;  typeof null          // &quot;object&quot;  </code></pre><p>instanceof</p><pre><code>// 不同window或iframe下返回false[1, 2] instanceof Array === true  new Object instanceof Array === fasle</code></pre><p>Object.prototype.toString</p><pre><code>Object.prototype.toString.apply([1, 2, 3]) === &quot;[object Array]&quot;;  Object.prototype.toString.apply(function(){}) === &quot;[object Function]&quot;  Object.prototype.toString.apply(null) === &quot;[object Null]&quot;  // ie678返回[object Object]  Object.prototype.toString.apply(undefined) === &quot;[object Undefined]&quot;  Object.prototype.toString.apply(12313) === &quot;[object Number]&quot;  Object.prototype.toString.apply(&#39;12313&#39;) === &quot;[object String]&quot;</code></pre><p>constructor<br>duck type</p><h3 id="表达式">表达式</h3><p>表达式是一种js短语，可使js解释器用来产生一个值</p><pre><code>// 原始表达式3.14, &quot;test&quot;      // 常量，直接量null, this, true  // 关键字i, j, k;           // 变量// 复合表达式10 * 20;           // 原始表达式+运算符+原始表达式// 初始化表达式[1, 2];[1,,2];{x: 1, y: 2};// 函数表达式var fe = function(){};(function(){console.log(&#39;1111&#39;);}){};// 属性访问表达式var o = {x:1};o.x;o[&#39;x&#39;];// 调用表达式func();// 对象创建表达式new Func(1, 2);new Object;</code></pre><h3 id="运算符">运算符</h3><blockquote><p>一元（+num）<br>二元（a + b）<br>三元（c：a：b） 赋值(x += 1)<br>比较(a == b)<br>算术（a - b）<br>位 （a | b）<br>逻辑 (exp1 &amp;&amp; exp2)<br>字符串("a" + "b")<br>特殊</p></blockquote><h3 id="特殊运算符">特殊运算符</h3><blockquote><p>c? a:b<br>var val = (1, 2, 3) // 逗号运算符<br>delete obj.x // 删除对象属性<br>'x' in window; // in 运算符<br>instanceof, typeof // 判断类型<br>new Foo(); // new 运算符<br>this // this运算符<br>void 0 // undefined</p></blockquote><h3 id="语句">语句</h3><p>块语句block<br>块语句是没有作用域的</p><pre><code>{  var str = &#39;hi&#39;;  console.log(str);  }  </code></pre><p>声明语句 var<br>var a=1, b=1; 函数语句function</p><pre><code>// 函数声明语句  function fd() {      return true;  }    // 函数表达式  var fe = function() {    //do sth};</code></pre><p>for in 语句</p><pre><code>var p;  var obj = {x:1, y:2};  for(p in obj) {    // 顺序不确定  }</code></pre><p>swith语句</p><pre><code>var val = 2;switch (val) {    case 1:        console.log(1);        break;    case 2:        console.log(2);        break;    case 3:        console.log(3);        break;    default:        console.log(0);        break;}</code></pre><p>循环语句</p><pre><code>while (isTrue) {    // do sth}do {    // do sth} while (isTrue)var i;for (i = 0; i &lt; n; i++) {    // do sth}</code></pre><p>with语句 // 不使用 try catch语句</p><pre><code>try {    try {        throw new Error(&#39;oops&#39;);    } catch(ex) {        console.error(&#39;inner catch&#39;, ex.message);        throw ex;    } finally {        console.log(&#39;inner  finally&#39;);    }} catch(ex) {    console.error(&#39;outer catch&#39;, ex.message);} finally {    console.log(&#39;outer finally&#39;);}</code></pre><p>结果 内部catch&gt;内部finally&gt;外部catch&gt;外部finally</p><pre><code>inner catch oops  inner  finally  outer catch oops  outer finally  </code></pre><h3 id="严格模式待补充">严格模式(待补充）</h3><pre><code>function func() {    &#39;use strict&#39;;}</code></pre><h3 id="对象">对象</h3><p>对象创建<br>字面量创建</p><pre><code>var obj = {x: 1};console.log(obj);console.log(obj.y);Object.prototype.y = 2;console.log(obj);console.log(obj.y);obj.y = undefined;console.log(obj);console.log(obj.y);{ x: 1 }undefined{ x: 1 }2{ x: 1, y: undefined }undefined</code></pre><p>new构造器创建</p><pre><code>function foo() { this.color = &#39;red&#39;;}foo.prototype.background = &#39;#000&#39;;var redColor = new foo();console.log(redColor);console.log(typeof redColor.toString);console.log(redColor.color);console.log(redColor.background);console.log(foo);console.log(foo.prototype);console.log(foo.prototype.prototype);console.log(&#39;background&#39; in redColor);redColor.background = &#39;#FFF&#39;;console.log(redColor.background);console.log(foo.prototype.background);foo { color: &#39;red&#39; }functionred#000[Function: foo]foo { background: &#39;#000&#39; }undefinedtrue#FFF#000</code></pre><p>Object.create()创建</p><pre><code>function obj() {    this.x = 1;}console.log(obj);var obj1 = new obj();console.log(obj1);var obj2 = Object.create(obj);console.log(obj2);console.log(obj2.x);var obj3 = Object.create(obj1);console.log(obj3);console.log(obj3.x);;[Function: obj]obj { x: 1 }Function {}undefinedobj {}1</code></pre><h3 id="对象的内部原型proto和构造器的原型prototype的关系">对象的内部原型(<strong>proto</strong>)和构造器的原型（prototype）的关系。</h3><p>一、所有构造器/函数的<strong>proto</strong>都指向Function.prototype，它是一个空函数（Empty function）</p><pre><code>Number.__proto__ === Function.prototype  // true  Boolean.__proto__ === Function.prototype // true  String.__proto__ === Function.prototype  // true  Object.__proto__ === Function.prototype  // true  Function.__proto__ === Function.prototype // true  Array.__proto__ === Function.prototype   // true  RegExp.__proto__ === Function.prototype  // true  Error.__proto__ === Function.prototype   // true  Date.__proto__ === Function.prototype    // true  Math.__proto__ === Object.prototype  // true  JSON.__proto__ === Object.prototype  // true // 函数声明function Person() {}// 函数表达式var Man = function() {}console.log(Person.__proto__ === Function.prototype) // true  console.log(Man.__proto__ === Function.prototype)    // true  </code></pre><p>所有的构造器都来自于Function.prototype，甚至包括根构造器Object及Function自身。所有构造器都继承了Function.prototype的属性及方法。如length、call、apply、bind（ES5）</p><pre><code>console.log(typeof Function.prototype) // functionconsole.log(typeof Object.prototype)   // objectconsole.log(typeof Number.prototype)   // objectconsole.log(typeof Boolean.prototype)  // objectconsole.log(typeof String.prototype)   // objectconsole.log(typeof Array.prototype)    // objectconsole.log(typeof RegExp.prototype)   // objectconsole.log(typeof Error.prototype)    // objectconsole.log(typeof Date.prototype)     // objectconsole.log(typeof Object.prototype)   // object  console.log(Function.prototype.__proto__ === Object.prototype) // true    Object.prototype.__proto__ === null  // true  </code></pre><p>二、所有对象的<strong>proto</strong>都指向其构造器的prototype<br>JavaScript引擎内置构造器</p><pre><code>var obj = {name: &#39;jack&#39;}var arr = [1,2,3]var reg = /hello/gvar date = new Datevar err = new Error(&#39;exception&#39;)console.log(obj.__proto__ === Object.prototype) // trueconsole.log(arr.__proto__ === Array.prototype)  // trueconsole.log(reg.__proto__ === RegExp.prototype) // trueconsole.log(date.__proto__ === Date.prototype)  // trueconsole.log(err.__proto__ === Error.prototype)  // true</code></pre><p>自定义的构造器</p><pre><code>function Person(name) {    this.name = name}var p = new Person(&#39;jack&#39;)console.log(p.__proto__ === Person.prototype) // true</code></pre><p>每个对象都有一个constructor属性，可以获取它的构造器</p><pre><code>function Person(name) {    this.name = name}var p = new Person(&#39;jack&#39;)console.log(p.__proto__ === p.constructor.prototype) // true</code></pre><h3 id="对象属性操作">对象属性操作</h3><p>属性读写</p><pre><code>// 属性读写var obj = {x1: 1, x2: 2};var i = 1, n = 2;for(; i&lt;= n; i++) {    console.log(obj[&#39;x&#39; + i]);}// 输出1，2var p;for(p in obj) {    console.log(obj[p]);}// 输出1，2var obj = {x: 1};// 读写异常console.log(obj.y); // undefinedvar yz = obj.y.z;  // TypeError: Cannot read property &#39;z&#39; of undefinedobj.y.z = 2;      //TypeError: Cannot set property &#39;z&#39; of undefined// 正确方式var yz;if(obj.y) {    yz = obj.y.z;}// 或者var yz = obj &amp;&amp; obj.y &amp;&amp; obj.y.z  // 这个会返回undefined</code></pre><p>属性删除</p><pre><code>var person = {age: 28, title: &#39;fe&#39;};console.log(delete person.age);  // trueconsole.log(delete person[&#39;age&#39;]);  // trueconsole.log(person.age);  // undefinedconsole.log(delete person.age);   // 注意这个也返回true 判断操作结束后该属性是否存在// 有些属性是不能删除的console.log(delete Object.prototype);  // false// 原因var descriptor = Object.getOwnPropertyDescriptor(Object, &#39;prototype&#39;);console.log(descriptor.configurable);  // false// 变量及函数不可删除var globalVal = 1;console.log(delete globalVal);  // false(function() {    var localVal = 1;    console.log(delete localVal);}());  // falsefunction fd() {}console.log(delete fd);  // false(function() {    function fd() {};    console.log(delete fd);}());  // false// 隐示定义的变量可以ohNo = 1;console.log(delete ohNo);  // true</code></pre><p>对象属性检测</p><pre><code>var cat = new Object();cat.legs = 4;cat.name = &#39;Kitty&#39;;console.log(&#39;legs&#39; in cat);  // trueconsole.log(&#39;abc&#39; in cat);  // falseconsole.log(&#39;toString&#39; in cat);  // true 继承属性console.log(cat.hasOwnProperty(&#39;legs&#39;));  // trueconsole.log(cat.hasOwnProperty(&#39;toString&#39;));  // falseconsole.log(cat.propertyIsEnumerable(&#39;legs&#39;));  // trueconsole.log(cat.propertyIsEnumerable(&#39;toString&#39;));  // falseObject.defineProperty(cat, &#39;price&#39;, {enumerable: false, value: 1000});// defineProperty是Object的方法，默认的标签enumerable值为false// Object.x创建属性，默认的标签值为trueconsole.log(cat.propertyIsEnumerable(&#39;price&#39;));  // falseconsole.log(cat.hasOwnProperty(&#39;price&#39;));  // true// 判断属性是否存在if(cat &amp;&amp; cat.legs) {    cat.legs *= 2;}if(cat.legs != undefined) {    // !== undefined 或者 !== null}if(cat.legs !== undefined) {    // !== undefined}</code></pre><p>对象属性枚举</p><pre><code>var o = {x: 1, y: 2, z: 3};console.log(&#39;toString&#39; in o);  // trueo.propertyIsEnumerable(&#39;toString&#39;);  // falsevar key;console.log(o.x);  // 1console.log(o.y);  // 2console.log(o.z);  // 3for(key in o) {    console.log(key);  // x, y, z    console.log(o.key);  // undefined    console.log(o[key]);  // 1, 2, 3}var obj = Object.create(o);obj.a = 4;var key;for(key in obj) {    console.log(key); // a, x, y, z}var key1;for (key1 in obj) {    if(obj.hasOwnProperty(key1)) {        console.log(key1); // a    }}</code></pre><p>对象属性的get/set方法</p><pre><code>// 对象属性的get/set方法var man = {    name: &#39;Bug&#39;,    weibo: &#39;Bug&#39;,    get age() {        return new Date().getFullYear() - 1988;    },    set age(val) {        console.log(&#39;cannot be set &#39; + val);    },};console.log(man.age);  // 调用age的get方法27man.age = 100;  // 调用age的set方法 cannot be set 100console.log(man.age);  // 27var man = {    weibo: &#39;Bug&#39;,    $age: null,    get age() {        if(this.$age == undefined) {            return new Date().getFullYear() - 1988;        } else {            return this.$age;        }    },    set age(val) {        val = +val; // 转为数字        if(!isNaN(val) &amp;&amp; val &gt; 0 &amp;&amp; val &lt; 150) {            this.$age = + val;        } else {            throw new Error(&#39;Incorrect val = &#39; + val );        }    }}console.log(man.age);  // 27man.age = 100;console.log(man.age);  // 100//man.age = &#39;abc&#39;;  // Error: Incorrect val = NaN// get/set方法与原型链// 这是错误的定义对象属性get方法方式function foo1() {}foo1.prototype.z = {    get: function() {        return 2;    }};var obj = new foo1();console.log(obj.z);  // 这个会被认为是对象 { get: [Function] }obj.z = 200;console.log(obj.z);  // 200// 正确定义方法function foo() {}Object.defineProperty(foo.prototype, &#39;z&#39;, {    get: function() {        return 1;    },    // configurable: true,  // 开启此属于也不会被改变    // writable: true,  // 此项不能配置writable/value get/set 二选一 });var obj = new foo();console.log(obj.z);   // 1obj.z = 100;console.log(obj.z);  // 但是还是1 并没有被改变Object.defineProperty(obj, &#39;z&#39;, {    value: 100,    configurable: true});console.log(obj.z);  // 100delete obj.z;console.log(obj.z);  // 返回到1// 另外一个例子var o = {};Object.defineProperty(o, &#39;x&#39;, {    value: 1});  // 默认writable: false, configurable: falsevar obj = Object.create(o);console.log(obj.x);  // 1obj.x = 100;console.log(obj.x);  // 还是1Object.defineProperty(obj, &#39;x&#39;, {    writable: true,    configurable: true,    value: 100});console.log(obj.x);  // 100obj.x = 200;console.log(obj.x); // 200</code></pre><h3 id="对象属性标签">对象属性标签</h3><pre><code>person = {};Object.defineProperty(person, &#39;type&#39;, {    configurable: false,    writable: true,    enumerable: false,    value: &#39;Object&#39;,});console.log(Object.keys(person));   // [] 返回空数组，不能枚举console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));   // { value: &#39;Object&#39;, writable: true, enumerable: false, configurable: false }// writable为true，可以通过赋值方法修改value值 [通过赋值修改属性值只和writable标签有关，和configurable无关]person.type = &#39;Object2&#39;;console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));  // { value: &#39;Object2&#39;, writable: true, enumerable: false, configurable: false }// configurable: false 无法使用delete删除属性， 无法使用get/set方法，  无法重新配置属性标签（除了将writable从true修改为false）console.log(delete person.type);   // 返回false// 只有writable和configurable标签都为false时，不能修改value标签值，其他情况都可以修改value标签值Object.defineProperty(person, &#39;type&#39;, {    configurable: false,    writable: true,    enumerable: false,    value: &#39;Object1&#39;,});console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));   // { value: &#39;Object1&#39;, writable: true, enumerable: false, configurable: false }// 可以重新配置writable标签值(只能重true改为false)Object.defineProperty(person, &#39;type&#39;, {    writable: false,});console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));   // { value: &#39;Object1&#39;, writable: false, enumerable: false, configurable: false }// 无法将writable从false改为trueObject.defineProperty(person, &#39;type&#39;, {    writable: true,});console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));   // TypeError: Cannot redefine property: type// 无法重新配置enumerable，configurable属性Object.defineProperty(person, &#39;type&#39;, {    enumerable: true,});console.log(Object.getOwnPropertyDescriptor(person, &#39;type&#39;));   // TypeError: Cannot redefine property: type</code></pre><h3 id="对象标签">对象标签</h3><p>原型标签<strong>proto</strong></p><pre><code>// 原型标签__proto__function Person(name) {    this.name = name;}var p = new Person(&#39;jack&#39;);console.log(p.__proto__ === Person.prototype);  // true</code></pre><p>类型标签</p><pre><code>//  对象class标签，表示对象是哪个类型，没有直接的方法去修改或者获取var toString = Object.prototype.toString;console.log(toString.call(null));  // [object Null]console.log(toString.call(undefined));  // [object Undefined]console.log(toString.call(1));  // [object Number]console.log(toString.call(new Number(1)));  // [object Number]console.log(toString.call(true));  // [object Boolean]console.log(toString.call(new Boolean(true)));  // [object Boolean]</code></pre><p>可扩展标签</p><pre><code>// extensible 可扩展标签，表示是否可以继续添加对象属性var obj = {x: 1, y: 2};console.log(Object.isExtensible(obj));  // true 对象可扩展Object.preventExtensions(obj);  // 配置对象不可扩展console.log(Object.isExtensible(obj));  // false 对象不可扩展obj.z =1;console.log(obj.z);  // undefined 添加属性失败console.log(Object.getOwnPropertyDescriptor(obj, &#39;x&#39;));  // // { value: 1, writable: true, enumerable: true, configurable: true }// Object.seal方法，对象的所有属性configurable值为falseObject.seal(obj);console.log(Object.getOwnPropertyDescriptor(obj, &#39;x&#39;));  // { value: 1, writable: true, enumerable: true, configurable: false }console.log(Object.isSealed(obj)); // true// Object.freeze方法，对象的所有属性configurable，writable标签值为falseObject.freeze(obj);console.log(Object.getOwnPropertyDescriptor(obj, &#39;x&#39;));   // // { value: 1, writable: false, enumerable: true, configurable: false }console.log(Object.isFrozen(obj));  // true</code></pre><h3 id="js对象与json格式转换">JS对象与json格式转换</h3><pre><code>// 将js对象转为json格式JSON.stringify()var obj = {x: 1, y: true, z: [1, 2, 3], nullVal: null};console.log(JSON.stringify(obj));  // {&quot;x&quot;:1,&quot;y&quot;:true,&quot;z&quot;:[1,2,3],&quot;nullVal&quot;:null}// undefined,NaN,Infinity等特殊属性值var obj = {val: undefined, a: NaN, b: Infinity, c: new Date()};console.log(JSON.stringify(obj));  // {&quot;a&quot;:null,&quot;b&quot;:null,&quot;c&quot;:&quot;2015-12-19T12:30:40.456Z&quot;}// 将json格式转为js对象JSON.parsevar obj = JSON.parse(&#39;{&quot;x&quot;: 1}&#39;);console.log(obj.x);  // 1//toJSON方法var obj = {    x: 1,    y: 2,    o: {        o1: 1,        o2: 2,        toJSON: function() {            return this.o1 + this.o2;        }    },};console.log(JSON.stringify(obj));  // {&quot;x&quot;:1,&quot;y&quot;:2,&quot;o&quot;:3}</code></pre><p>###toString valueOf方法</p><pre><code>// 对象在作为操作数时，解释器总是优先调用valueOf()--(Date类型的对象在二元“+”运算时例外),而其他情况，解释器总是认为我们想要的是字符串，所以会优先调用toString()。var obj = {x: 1, y: 2};console.log(obj.toString());  // [object Object]console.log(+obj.toString());  // NaNconsole.log(3 + obj.toString());  // 3[object Object] 会被理解为字符串拼接console.log(+obj.valueOf());  // NaN// 重写obj.toString = function() {    return this.x + this.y;};console.log(+obj);  // 3obj.valueOf = function() {    return this.x + this.y + 100;};console.log(+obj);  // 103// 如果只重写了toString，对象转换时会无视valueOf的存在来进行转换。但是，如果只重写了valueOf方法，在要转换为字符串的时候会优先考虑valueOf方法。在不能调用toString的情况下，只能让valueOf上阵了。var cc = {    i: 10,    valueOf: function() {        console.log(&#39;valueOf&#39;);        return this.i;    }};console.log(cc);// 10 { [Number: 10] i: 10, valueOf: [Function] }console.log(+cc); // 10 valueOfconsole.log(&#39;&#39;+cc); // 10 valueOfconsole.log(String(cc)); // [object Object]console.log(Number(cc)); // 10 valueOfconsole.log(cc == &#39;10&#39;); // true valueOf</code></pre><h3 id="数组">数组</h3><p>创建数组</p><pre><code>// 字面量创建数组 数组的长度不能超过2^23 - 1 = 4,294,967,295var BAT = [&#39;B&#39;, &#39;A&#39;, &#39;T&#39;];var students = [{name: &#39;B&#39;, age: 27}, {name: &#39;A&#39;, age: 30}];var arr = [&#39;T&#39;, 123, true, null, undefined];var arrInArr = [[1, 2], [1, 2, 3]];// 对象创建数组 new关键字可以省略var arr = new Array();  // var = [];var arrWithLength = new Array(100);  // undefined * 100var arrLikesLiteral = new Array(true, false, null, 1, 2, &#39;hi&#39;);  // [true, false, null, 1, 2, &#39;hi&#39;]</code></pre><p>数组元素操作</p><pre><code>// 数组元素读写// 索引访问var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr[1]);  // bconsole.log(arr.length);  // 5arr[5] = &#39;f&#39;;console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]console.log(arr.length);  // 6// delete方法并不会改变数组长度,delete 和定义为undefined的区别delete arr[0];console.log(arr);  // [ , &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]console.log(arr.length);  // 6console.log(0 in arr);  // 会返回falsearr[1] = undefined;console.log(arr);  // [ , undefined, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]console.log(arr.length);  // 6console.log(1 in arr);  // true// 数组是动态的，无需指定大小// 指定索引位置，改变数组var arr = [];arr[1] = &#39;b&#39;;console.log(arr.length);  // 2console.log(arr);   // [ , &#39;b&#39; ]// push方法，在数组尾部添加元素,并返回新的数组长度console.log(arr.push(&#39;c&#39;));  // 3console.log(arr);  // [ , &#39;b&#39;, &#39;c&#39; ]// 在数组尾部添加的另一种方法arr[arr.length] = &#39;d&#39;;console.log(arr);  // [ , &#39;b&#39;, &#39;c&#39;, &#39;d&#39; ]// unshift方法，在数组头部添加元素，并返回新的数组长度console.log(arr.unshift(&#39;a&#39;));  // 5console.log(arr);  // [ &#39;a&#39;, , &#39;b&#39;, &#39;c&#39;, &#39;d&#39; ]// pop方法，删除数组尾部的元素并返回这个元素console.log(arr.pop());  // &#39;d&#39;console.log(arr);  // [ &#39;a&#39;, , &#39;b&#39;, &#39;c&#39; ]// 删除数组尾部元素的另个方法arr.length -= 1;console.log(arr);  // [ &#39;a&#39;, , &#39;b&#39; ]// shift方法，删除数组头部的元素并返回这个元素console.log(arr.shift());  // &#39;a&#39;console.log(arr);  // [ , &#39;b&#39; ]</code></pre><p>数组迭代</p><pre><code>// 数组迭代var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;];for(var i = 0; i &lt; arr.length; i++) {    console.log(arr[i]);}// a b c d e f gfor(i in arr) {    console.log(arr[i]);}// a b c d e f g// for in 表达式的坑：会迭代原型的元素Array.prototype.x = &#39;keng&#39;;for(i in arr) {    console.log(arr[i]);}// a b c d e f g kengfor(i in arr) {    if(arr.hasOwnProperty(i)) {        console.log(arr[i]);    }}// a b c d e f g</code></pre><p>特殊数组：二维数组和稀疏数组</p><pre><code>// 特殊数组：二维数组，稀疏数组// 二维数组var arr = [[&#39;a&#39;, &#39;b&#39;], [&#39;c&#39;, &#39;d&#39;], [&#39;e&#39;, &#39;f&#39;]];var i = 0, j = 0;var row;for(; i &lt; arr.length; i++) {    row = arr[i];    console.log(&#39;row&#39; + i);    for(j = 0; j &lt; row.length; j++) {        console.log(row[j]);    }}// row0 a b row1 c d row2 e f// 稀疏数组：并不含有从0开始的连续索引var arr1 = [undefined];var arr2 = new Array(1);console.log(0 in arr1);  // trueconsole.log(0 in arr2);  // false</code></pre><h3 id="数组的方法">数组的方法</h3><p>Array.prototype.join(separator)</p><pre><code>// Array.prototype.join(separator)方法：将数组拼接成字符串，返回字符串，不改变原数组var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];console.log(arr.join());  // a,b,cconsole.log(arr.join(&#39;_&#39;));  // a,b,cfunction repeatString(str, n) {    return new Array(n + 1).join(str);}console.log(repeatString(&#39;a&#39;, 3));  // aaaconsole.log(repeatString(&#39;Hi&#39;, 5));  // HiHiHiHiHi</code></pre><p>Array.prototype.reverse()</p><pre><code>// Array.prototype.reverse() 将数组逆序，返回数组本身，会改变数组本身var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];var arr1 = arr;var arr2 = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];console.log(arr.reverse());  // [ &#39;c&#39;, &#39;b&#39;, &#39;a&#39; ]console.log(arr);  // [ &#39;c&#39;, &#39;b&#39;, &#39;a&#39; ]console.log(arr1);  // [ &#39;c&#39;, &#39;b&#39;, &#39;a&#39; ]console.log(arr2);  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39; ]</code></pre><p>Array.prototype.sort(sortby）</p><pre><code>// Array.prototype.sort(sortby)方法：接受一个函数参数(不传参数默认按字符编码顺序)，返回数组本身，会修改原数组var arr = [&#39;f&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;a&#39;];console.log(arr.sort());  // [ &#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]var arr = [13, 24, 51, 3];console.log(arr.sort());  // [ 13, 24, 3, 51 ]// 传入参数：比较函数(a, b)// 若 a 小于 b，在排序后的数组中 a 应该出现在 b 之前，则返回一个小于 0 的值。// 若 a 等于 b，则返回 0。// 若 a 大于 b，则返回一个大于 0 的值。function sortNumber(a, b) {    return a - b;}console.log(arr.sort(sortNumber));  // [ 3, 13, 24, 51 ]var arr = [{age: 25}, {age: 29}, {age: 40}];console.log(arr.sort(function sortAge(a, b) {    return a.age - b.age;}));  // [ { age: 25 }, { age: 29 }, { age: 40 } ]</code></pre><p>Array.prototype.concat(arrayX, arrayY.....)</p><pre><code>// Array.prototype.concat(arrayX, arrayY.....)方法 连接多个数组，返回一个新的数组，不会改变原数组var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];console.log(arr.concat(&#39;d&#39;, &#39;e&#39;));  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ]console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39; ]console.log(arr.concat([&#39;d&#39;, &#39;e&#39;], &#39;f&#39;));  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; ]console.log(arr.concat([&#39;d&#39;, &#39;e&#39;], [&#39;f&#39;, &#39;g&#39;]));  // &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39; ]console.log(arr.concat([[&#39;d&#39;, &#39;e&#39;], &#39;f&#39;]));  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, [ &#39;d&#39;, &#39;e&#39; ], &#39;f&#39; ]console.log(arr.concat([[[&#39;d&#39;, &#39;e&#39;], &#39;f&#39;], &#39;g&#39;]));  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, [ [ &#39;d&#39;, &#39;e&#39; ], &#39;f&#39; ], &#39;g&#39; ]</code></pre><p>Array.prototype.slice(start, end)</p><pre><code>// Array.prototype.slice(start, end)方法：左闭右开截取数组，返回一个新的数组，不改变原数组var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.slice(1, 3));  // [&#39;b&#39;, &#39;c&#39;]console.log(arr.slice(1));  // [&#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]console.log(arr.slice(1, -1));  // [&#39;b&#39;, &#39;c&#39;, &#39;d&#39;]console.log(arr.slice(-4, -3));  // [&#39;b&#39;]</code></pre><p>Array.prototype.splice(index, howmany, item1,....itemX)</p><pre><code>// Array.prototype.splice(index, howmany, item1,....itemX)方法：// 向/从数组中添加/删除项目，然后返回被删除的项目。会改变原数组// index参数：必须，整数，添加或删除的位置，左闭合// howmany参数：可选，设置为0，则不会删除// item1,.....itemX：可选，向数组中添加的元素var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice(2));   // [ &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ]console.log(arr);  // [ &#39;a&#39;, &#39;b&#39; ]var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice(2, 1));  // [ &#39;c&#39; ]console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39; ]var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice(2, 0));  // []console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ]var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice(2, 2, &#39;f&#39;, &#39;g&#39;, [&#39;h&#39;, &#39;i&#39;]));  // [ &#39;c&#39;, &#39;d&#39; ]console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;f&#39;, &#39;g&#39;, [ &#39;h&#39;, &#39;i&#39; ], &#39;e&#39; ]// 指定位置插入新的元素var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice(2, 0, &#39;f&#39;));  // []console.log(arr); // [ &#39;a&#39;, &#39;b&#39;, &#39;f&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ]var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];console.log(arr.splice());  // []console.log(arr); // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ]</code></pre><p>Array.prototype.forEach()</p><pre><code>// Array.prototype.forEach()方法(ES5)：接收函数参数// 函数的3个参数x: 元素值，index：元素索引，a 数组本身var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;];arr.forEach(function(x, index, a) {    console.log(x + &#39;_&#39; + index + &#39;_&#39; + a);});// a_0_a,b,c,d,e b_1_a,b,c,d,e c_2_a,b,c,d,e d_3_a,b,c,d,e e_4_a,b,c,d,e</code></pre><p>Array.prototype.map()</p><pre><code>//Array.prototype.map()方法(ES5):接收函数参数,不会修改原数组var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];var arr1 = arr.map(function(x) {    return x + &#39;like&#39;;});console.log(arr);  // [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39; ]console.log(arr1);  // [ &#39;alike&#39;, &#39;blike&#39;, &#39;clike&#39; ]</code></pre><p>Array.prototype.filter()</p><pre><code>// Array.prototype.filter()过滤方法(ES5):接收函数参数，不修改原数组var arr = [1,2,3,4,5,6,7,8,9,10];var arr1 = arr.filter(function(x, index) {    return index % 3 === 0 || x &gt;= 8;});console.log(arr1);  // [ 1, 4, 7, 8, 9, 10 ]console.log(arr);  // [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]</code></pre><p>Array.prototype.every() &amp; Array.prototype.some()</p><pre><code>// Array.prototype.every() &amp; Array.prototype.some()判断方法(ES5):接收函数参数，不修改原数组// every 全部符合条件  some 只需一个符合条件var arr = [1,2,3,4,5];console.log(arr.every(function(x) {    return x &lt; 10;}));  // trueconsole.log(arr.every(function(x) {    return x &lt;= 3;}));  // falseconsole.log(arr.some(function(x) {    return x === 3;}));  // trueconsole.log(arr.some(function(x) {    return x === 100;}));  // false</code></pre><p>Array.prototype.reduce(function, index) Array.prototype.reduceRight(function, index)</p><pre><code>// Array.prototype.reduce(function, index) Array.prototype.reduceRight(function, index)方法// 接收一个函数参数和一个数组索引参数，并返回一个值，不修改原数组// 函数参加接收2个参数分别代表2个索引// 索引参数表示从第index个元素开始var arr = [1, 2, 3];var sum = arr.reduce(function(x, y) {    return x + y;}, 0);console.log(sum);  // 6  1+2返回3 3+3 返回6var arr = [3, 9, 6];var max = arr.reduce(function(x, y) {    console.log(x + &#39;|&#39; + y);    return x &gt; y ? x : y;});// 3|9// 9|6console.log(max);  // 9var max = arr.reduceRight(function(x, y) {    console.log(x + &#39;|&#39; + y);    return x &gt; y ? x : y;});// 6|9// 9|3console.log(max);  // 9</code></pre><p>Array.prototype.indexOf(value, index) Array.prototype.lastIndexOf(value, index)</p><pre><code>// Array.prototype.indexOf(value, index) Array.prototype.lastIndexOf(value, index)数字检索方法// value参数表示要查找的元素值，index表示从第几个索引位置开始查找(闭合)var arr = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;b&#39;, &#39;a&#39;];console.log(arr.indexOf(&#39;b&#39;));  // 1 在数组中查找是否有元素值为&#39;b&#39;，有则返回这个元素索引console.log(arr.indexOf(&#39;f&#39;));  // -1 如果没有则返回-1console.log(arr.indexOf(&#39;b&#39;, 1));  // 1 从第2个元素开始查找，返回索引1console.log(arr.indexOf(&#39;b&#39;, 2));  // 3console.log(arr.indexOf(&#39;b&#39;, -2));  // 3console.log(arr.indexOf(&#39;b&#39;, -4));  // 1console.log(arr.indexOf(&#39;b&#39;, -8));  // 1console.log(arr.lastIndexOf(&#39;b&#39;));  // 3</code></pre><p>Array.isArray()</p><pre><code>// Array.isArray() 判断是否为数组console.log(Array.isArray([]));  // true</code></pre><h3 id="创建函数">创建函数</h3><pre><code>// 函数声明function add(a, b) {    a = +a;    b = +b;    if (isNaN(a) || isNaN(b)) {        return;    }    return a + b;}// 函数表达式var add = function(a, b) {    // do sth};// IEF(立即执行函数表达式)(function() {    // do sth})();// 函数表达式return function () {    // do sth};// NFE(命名式函数表达式)var add = function foo(a, b) {    // do sth};</code></pre><p><strong>函数声明和函数表达式区别：函数声明会前置</strong></p><pre><code>var num = add(1, 2);console.log(num);function add(a, b) {    a = +a;    b = +b;    if (isNaN(a) || isNaN(b)) {        return;    }    return a + b;}// 结果为3var num = add(1, 2);console.log(num);var add = function (a, b) {    a = +a;    b = +b;    if (isNaN(a) || isNaN(b)) {        return;    }    return a + b;};// TypeError: add is not a function</code></pre><h3 id="this">this</h3><p>全局下的this</p><pre><code>// 全局下的this(浏览器下)console.log(this.window === document);  // trueconsole.log(this === window);  // truethis.a = 37;console.log(window.a);  // 37</code></pre><p>一般函数的this</p><pre><code>// 一般函数的this（浏览器下）function f1() {    return this;}f1() === window;  // truefunction f2() {    &quot;use strict&quot;;  // 严格模式下    return this}f2() === undefined;  // true</code></pre><p>作为对象方法的函数的this</p><pre><code>var o = {    prop: 37,    f: function() {        return this.prop;    }};console.log(o.f());  // 37var o = {prop: 37};function  independent() {    return this.prop;}o.f = independent;console.log(o.f());  // 37</code></pre><p>原型链上的this</p><pre><code>var o = {    f: function() {        return this.a + this.b;    }};var p = Object.create(o); // p为空对象，其原型会指向op.a = 1;p.b = 4;console.log(p.f())  // 5</code></pre><p>构造器中的this</p><pre><code>// 当new的函数构造器没有return返回值或者返回值不是对象时，new返回一个this指向构造器的prototype这样一个空对象// 如果return返回的是对象 new返回的这是这个对象function Myclass() {    this.a = 37;}var o = new Myclass();console.log(o.a);  // 37function C2() {    this.a = 37;    return {a: 38};}o = new C2();console.log(o.a);  // 38</code></pre><p>call和apply的this</p><pre><code>function add(c, d) {    return this.a + this.b + c + d;}var o = {a: 1, b: 2};add.call(o, 5, 6);  // 1+3+5+7=16add.apply(o, [10, 20]);  //1+3+10+20=34function bar() {    console.log(Object.prototype.toString.call(this));}bar.call(7); // [object Number]</code></pre><p>band和this</p><pre><code>//bind是es5后，ie9+使用function f() {    return this.a;}var g = f.bind({a: &#39;test&#39;});console.log(g());  // testvar o = {    a: 37,    f: f,    g: g};console.log(o.f(), o.g());  // 37, test</code></pre><p>函数arguments属性</p><pre><code>function foo(x, y, z) {    arguments.length;  // 2 实际传入的参数数量    arguments[0];  // 1 传入第一个参数值    arguments[0] = 10;    x;  // 10 将第一个参数值修改为10， 严格模式下任然是1    arguments[2] = 100;    z; // undefined  由于第三个参数没有传入，不会绑定    arguments.callee  === foo;  // true   严格模式下不能使用}foo(1, 2);foo.length;  // 3   3个参数foo.name;  // &quot;foo&quot; 函数名</code></pre><h3 id="call和apply">call和apply</h3><pre><code>// apply和call方法（浏览器）// 第一个参数是作为this的对象，如果不是对象，会转换为对象// call传入的是扁平传入参数// apply第二个参数树数组function foo(x, y) {    console.log(x, y, this);}foo.call(100, 1, 2);  // 1, 2, Number(100)foo.apply(true, [3, 4]);  //3, 4, Boolean(true)foo.apply(null);  // undefined, undefined, windowfoo.apply(undefined);  // undefined, undefined, window</code></pre><h3 id="bind">bind</h3><p>bind方法：改变this</p><pre><code>// bind方法this.x = 9;var module = {    x: 81,    getX: function() {        return this.x;    }};module.getX();  // 81 this指向modulevar getX = module.getX;getX();  // 9 this指向全局变量var boundGetX = getX.bind(module);boundGetX();  // 81  bind改变this指向</code></pre><p>bind方法：科里化</p><pre><code>// bind方法function add(a, b, c) {    return a+b+c;}var func = add.bind(undefined, 100);func(1, 2);  // 103  undefined传给this， 100传给第一个参数avar func2 = func.bind(undefined, 200);func2(10);  // 310 undefined传给this，200传给b</code></pre><p>bind与new</p><pre><code>// bind方法与newfunction foo() {    this.b = 100;    return this.a;}var func = foo.bind({a: 1});func(); // 1  foo.bind后this指向{a: 1} return this.a = 1new func();  // {b: 100} new调用将返回一个this，this会被初始化一个空对象，并且其原型是foo.prototype,空对象的b属性为100</code></pre><h3 id="闭包">闭包</h3><p>闭包基本概念</p><pre><code>// 闭包var n = 999;function f1() {    console.log(n);}f1();  // 999  函数内部可以访问全局变量function f1() {    var n = 999;}console.log(n);  // error  函数外部无法访问函数内部局部变量function f1() {    n = 999;}console.log(n); // 999 因为没有使用var语句，相当于定义一个全局变量// 简单的闭包原型function f1() {    var n = 999;    function f2() {        console.log(n);    }    return f2}var result = f1();result();  // 999</code></pre><p>闭包案例</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;Title&lt;/title&gt;    &lt;style&gt;        #div1 {            background-color: rosybrown;        }        #div2 {            background-color: aquamarine;        }        #div3 {            background-color: yellowgreen;        }    &lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script&gt;    document.body.innerHTML = &#39;&lt;div id=&quot;div1&quot;&gt;aaa&lt;/div&gt;&lt;div id=&quot;div2&quot;&gt;bbb&lt;/div&gt;&lt;div id=&quot;div3&quot;&gt;ccc&lt;/div&gt;&#39;;    for(var i = 1; i &lt; 4; i++) {        alert(i);  // 结果为1，2，3        document.getElementById(&#39;div&#39; + i).                addEventListener(&#39;click&#39;, function() {            alert(i);  // 点击div1，div2，div3结果都是4,因为addEventListener的回调函数执行时i都为4        });    }&lt;/script&gt;&lt;/html&gt;</code></pre><p>正确写法</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;Title&lt;/title&gt;    &lt;style&gt;        #div1 {            background-color: rosybrown;        }        #div2 {            background-color: aquamarine;        }        #div3 {            background-color: yellowgreen;        }    &lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script&gt;    document.body.innerHTML = &#39;&lt;div id=&quot;div1&quot;&gt;aaa&lt;/div&gt;&lt;div id=&quot;div2&quot;&gt;bbb&lt;/div&gt;&lt;div id=&quot;div3&quot;&gt;ccc&lt;/div&gt;&#39;;    for(var i = 1; i &lt; 4; i++) {        !function(i) {            alert(i);  // 1,2,3            document.getElementById(&#39;div&#39; + i).               addEventListener(&#39;click&#39;, function() {                   alert(i);  // 1, 2,3             });        }(i);    }&lt;/script&gt;&lt;/html&gt;</code></pre><p>闭包中的封装</p><pre><code>(function() {    var _userID = 23245;    var _typeID = &#39;item&#39;;    var exportID = {};    function converter(userID) {        return +userID;    }    exportID.getUserID = function() {        return converter(_userID);    };    exportID.getTypeID = function() {        return _typeID;    };    global.exportID = exportID;}());console.log(exportID.getUserID());  //23245console.log(exportID._userID);  // undefined</code></pre><h3 id="三种作用域">三种作用域</h3><pre><code>// 作用域： 全局作用域，函数作用域，eval作用域var a = 10;(function() {    var b = 20;})();console.log(a);  // 10console.log(b);  // errorfor(var item in {a: 1, b: 2}) {    console.log(item);  // a, b}console.log(item); // b</code></pre><h3 id="es3中的执行上下文">ES3中的执行上下文</h3><p>EC = Execution Context 执行上下文<br>变量对象（Variable Object 简写VO）是一个抽象概念，用于存储执行上下文中的变量，函数声明，函数参数</p><pre><code>var a = 10;function test(x) {    var b = 20;}test(30);</code></pre><p>对应的上下文</p><pre><code>// 整个js环境中的VOVO(globalContext) = {    a: 10,    test: &lt;ref to function&gt;};// 执行test(30)的VOVO(test functionContext) = {    x: 30,    b: 20};</code></pre><p>全局执行上下文</p><pre><code>VO(globalContext) === [[global]][[global]] = {    Math : &lt;...&gt;,    String : &lt;...&gt;,    isNaN: function() {[Native Code]},    ...    ...    window: global};String(10);  //[[global]].String(10)window.a = 10;  // [[global]].window.a = 10this.b = 20;  // [[global]].b = 20</code></pre><p>变量初始化阶段</p><pre><code>// 1, 函数参数（若没有传入，则其值为undefined）// 2, 函数声明（若函数声明和函数参数冲突，则函数声明会覆盖掉函数参数）// 3，变量声明（初始化变量值为undefined，若何函数参数，函数声明冲突，会被忽略掉）function test(a, b) {    var c = 10;    function d() {}    var e = function _e() {};    (function x() {});    b = 20;}test(10);AO(test) = {    a: 10,    b: undefined,    c: undefined,    d: &lt;ref to func &#39;d&#39;&gt;,    e: undefined,};</code></pre><p>变量初始化案例1</p><pre><code>function foo(x, y, z) {    function x() {}    console.log(x);}foo(100);  // [Function: x]//AO(foo) = {    //x: 100,    y: undefined,    z: undefined,    x: &lt;ref to func &#39;x&#39;&gt;,  // 函数声明x会覆盖掉参数声明 }</code></pre><p>变量初始化案例2</p><pre><code>function foo(x, y, z) {    function func() {}    var func;    console.log(func);}foo(100);  // [Function: func]function foo(x, y, z) {    function func() {}    var func = 1;    console.log(func);}foo(100);  // 1  执行阶段会执行func = 1 这个语句</code></pre><p>代码执行阶段</p><pre><code>function test(a, b) {    var c = 10;    function d() {}    var e = function _e() {};    (function x() {})();    b = 20;}// 初始化阶段AO(test) = {    a: 10,    b: undefined,    c: undefined,    d: &lt;ref to func &#39;d&#39;&gt;,    e: undefined};// 代码执行阶段AO(test) = {    a: 10,    b: 20,    c: 10,    d: &lt;reference to FunctionDeclaration &#39;d&#39;&gt;,    e: function _e()};</code></pre><p>全局执行上下文案例</p><pre><code>console.log(x);  // [Function: x]var x = 10;  // 初始化阶段x: 冲突，被忽略console.log(x);  // 10x = 20;function x() {}  // 初始化阶段x: &lt;ref to func &#39;x&#39;&gt;console.log(x);  // 20if (true) {    var a = 1;  // 初始化阶段a: undefined} else {    var b = true;  // 初始化阶段b: undefined}console.log(a);  // 1console.log(b);  // undefined</code></pre><h3 id="prototype">prototype</h3><p>prototype是函数对象上的预设的对象属性<br>原型是对象上的原型，通常都是构造器的prototype属性<br>实例</p><pre><code>function Abc() {    this.y = 2;    var z = 3;}console.log(Abc);  // [Function: Abc]console.log(Abc.prototype);  // Abc {}console.log(typeof Abc.prototype);  // objectAbc.prototype.x = 1;console.log(Abc.prototype);  // Abc { x: 1 }var obj1 = new Abc();console.log(obj1.__proto__);  // Abc { x: 1 }console.log(obj1.__proto__ === Abc.prototype);  // true  new构造器创建的对象的原型是构造器的prototype属性console.log(obj1);  // Abc { y: 2 }console.log(obj1.y);  // 2console.log(obj1.x);  // 1</code></pre><h3 id="继承">继承</h3><p>实现继承的方法</p><pre><code>// 实现继承的方法function Person() {}function Student() {}Student.prototype = Person.prototype;  // 错误，会影响被继承类的方法Student.prototype = new Person();  // 错误，传参问题，因为Student是类，并不是实例// 正确的方法Student.prototype = Object.create(Person.prototype);Student.prototype.constructor = Student;// Object.create()是es5的方法，下面是fix方法if(!Object.create) {    Object.create = function(proto) {        function F() {}        F.prototype = proto;        return new F;    };}</code></pre><p>原型的继承方法</p><pre><code>function Person(name, age) {    this.name = name;    this.age = age;    this.sayNo = function() {        console.log(this.name + &#39; say no&#39;);    }}Person.prototype.hi = function() {    console.log(&#39;Hi, my name is &#39; + this.name + &#39;,I\&#39;m &#39; + this.age + &#39; years old now&#39;);};Person.prototype.LEGS_NUM = 2;Person.prototype.ARMS_NUM = 2;Person.prototype.walk = function() {    console.log(this.name + &#39; is walking...&#39;);};console.log(Person);  // [Function: Person]console.log(Person.prototype);  // Person { hi: [Function], LEGS_NUM: 2, ARMS_NUM: 2, walk: [Function] }var Jack = new Person();  // Person构造器没有return对象，所以返回的是thisJack.sayNo();  // undefined say noJack.hi();  // Hi, my name is undefined,I&#39;m undefined years old nowJack.walk();  // undefined is walking...console.log(Jack);  // Person { name: undefined, age: undefined, sayNo: [Function] }console.log(Jack.__proto__);  // Person { hi: [Function], LEGS_NUM: 2, ARMS_NUM: 2, walk: [Function] }// 以下5行代码是js中对象继承的写法function Student(name, age, className) {    Person.call(this, name, age);  // 使用call方法调用父构造器函数    this.className = className;}Student.prototype = Object.create(Person.prototype);   // 这个如果直接使用Student.prototype = Person.prototype，改变Student对象方法会改变Person对象的方法，因为他们指向的是同一个对象Student.prototype.constructor = Student;Student.prototype.hi = function() {    console.log(&#39;Hi, my name is &#39; + this.name + &#39;, I\&#39;m&#39; + this.age + &#39; years old now, and from &#39; + this.className + &#39;.&#39;);};Student.prototype.learn = function(subject) {    console.log(this.name + &#39; is learning &#39; + subject + &#39; at &#39; + this.className + &#39;.&#39;);};var Lussi = new Student(&#39;Lussi&#39;, 27, &#39;Class Tree&#39;);Lussi.sayNo();  // Lussi say noLussi.hi();  // Hi, my name is Lussi, I&#39;m27 years old now, and from Class Tree.Lussi.walk();  // Lussi is walking...Lussi.learn(&#39;math&#39;);  // Lussi is learning math at Class Tree.console.log(Lussi);  // Student {name: &#39;Lussi&#39;, age: 27, sayNo: [Function], className: &#39;Class Tree&#39; }console.log(Lussi.__proto__);  // Student {constructor: [Function: Student], hi: [Function], learn: [Function] }console.log(Lussi.__proto__.__proto__);  // Person { hi: [Function], LEGS_NUM: 2, ARMS_NUM: 2, walk: [Function] }console.log(Lussi.__proto__.__proto__.__proto__);  // {}console.log(Lussi.__proto__.__proto__.__proto__.__proto__);  // null  // 改变prototypeStudent.prototype.x = 101;  // 会影响已经创建实例的属性console.log(Jack.x);  // undefinedconsole.log(Lussi.x);  // 101Student.prototype = {y: 2};  // 不会影响已经创建实例的属性，但会影响新创建的实例，并且重新修改prototype.y属性也不会改变console.log(Jack.y); // undefinedconsole.log(Lussi.y);  // undefinedvar Lilei = new Student(&#39;Lilei&#39;, 24, &#39;Class three&#39;);console.log(Lilei.x);  // undefinedconsole.log(Lilei.y);  // 2Student.prototype.y = 100;console.log(Lilei.y);  // 100console.log(Lussi.y);  // undefinedStudent.prototype.z = 30;console.log(Lilei.z);  // 30console.log(Lussi.z);  // undefinedPerson.prototype.z = 40;console.log(Lilei.z);  // 30console.log(Lussi.z);  // 40console.log(Jack.z);  // 40</code></pre><h3 id="instanceof">instanceof</h3><pre><code>// instanceof  左边是对象（如果不是，直接返回false），右边是构造器（如果不是，直接报错），判断构造器的prototype属性是否在对象的原型链上console.log([1, 2] instanceof Array);  // trueconsole.log(1 instanceof Array);  // falseconsole.log(Array.prototype);  // []console.log(new Object() instanceof Array);  //falseconsole.log(Object.prototype);  // {}console.log(new Object() instanceof Object);  // trueconsole.log(new Array() instanceof Object);  // true</code></pre><h3 id="模拟重载">模拟重载</h3><pre><code>function Person() {    var args = arguments;    // 判断第一个传入的是不是对象，因为args[null]也返回object，所有需要判断是否为null    if(typeof args[0] === &#39;object&#39; &amp;&amp; args[0]) {        if(args[0].name) {            this.name = args[0].name;        }        if(args[0].age) {            this.age = args[0].age;        }    } else {        if(args[0]) {            this.name = args[0];        }        if(args[1]) {            this.age = args[1];        }    }}Person.prototype.toString = function() {    console.log(&#39;name=&#39; + this.name + &#39;, age=&#39; + this.age);};var LiLei = new Person(&#39;LiLei&#39;, 23);var Hanmm = new Person({name: &#39;Hanmm&#39;, age: 21});LiLei.toString();  // name=LiLei, age=23Hanmm.toString();  // name=Hanmm, age=21</code></pre><h3 id="调用子类方法">调用子类方法</h3><pre><code>function Person(name) {    this.name = name;}function Student(name, className) {    this.className = className;    Person.call(this, name);}Person.prototype.init = function() {    console.log(&#39;Person.init&#39;);};Student.prototype.init = function() {    console.log(&#39;Student.init&#39;);    Person.prototype.init.apply(this, arguments);};var LiLei = new Student(&#39;LiLei&#39;, &#39;Class four&#39;);console.log(LiLei);  // Student { className: &#39;Class four&#39;, name: &#39;LiLei&#39; }LiLei.init();  // Student.init  Person.init</code></pre><h3 id="实现链式调用">实现链式调用</h3><pre><code>function ClassManager() {    console.log(&#39;ClassManager&#39;);    this.name = &#39;ClassName&#39;;}ClassManager.prototype.addClass = function(str) {    console.log(&#39;class: &#39;  + str + &#39; added.&#39;);    console.log(this);    return this;  // this始终指向ClassManger类的实例};var manager = new ClassManager();manager.addClass(&#39;A&#39;).addClass(&#39;B&#39;).addClass(&#39;C&#39;);  //class: A added. ClassManager { name: &#39;ClassName&#39; } class: B added. ClassManager { name: &#39;ClassName&#39; } class: C added. ClassManager { name: &#39;ClassName&#39; }</code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css兼容性汇总</title>
      <link href="/2016/11/10/Css%E5%85%BC%E5%AE%B9%E6%80%A7%E6%B1%87%E6%80%BB/"/>
      <url>/2016/11/10/Css%E5%85%BC%E5%AE%B9%E6%80%A7%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="ie6ie7中overflowhidden失效问题">ie6,ie7中overflow:hidden失效问题</h3><blockquote><p>在父元素中使用position:relative;可以hack iframe自适应高度</p></blockquote><h3 id="不建议使用iframe">不建议使用iframe</h3><p>在css里面设置一个min-height <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.class</span> &#123;</span><br><span class="line"><span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>主页面嵌入如下js代码 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setIframeHeight</span>(<span class="params">iframe</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (iframe) &#123;</span><br><span class="line">        <span class="keyword">var</span> iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;</span><br><span class="line">        <span class="keyword">if</span> (iframeWin.document.body) &#123;</span><br><span class="line">            iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setIframeHeight(<span class="built_in">document</span>.getElementById(<span class="string">'external-frame'</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>iframe标签里 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"backtop.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">id</span>=<span class="string">"external-frame"</span> <span class="attr">onload</span>=<span class="string">"setIframeHeight(this)"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>css代码 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">text-indent</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>js代码 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultTopPosition = $(<span class="string">'#indexCellcate'</span>).css(<span class="string">'top'</span>);</span><br></pre></td></tr></table></figure></p><p>浏览器差异 <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ie7，ie8 返回-205.422px  </span><br><span class="line">现代chrome，firefox -205.422px  </span><br><span class="line">但是ie9及以上会返回0px</span><br><span class="line">如果将css中的top设置为-205.422px，则无差异。</span><br></pre></td></tr></table></figure></p><blockquote><p>但响应式布局要求百分百设置,我的解决思路: 获取对应元素的高度来替代top值 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultTopPosition = cellcate.children(<span class="string">'li'</span>).height();</span><br><span class="line">defaultTopPosition = -<span class="built_in">parseInt</span>(defaultTopPosition);</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windowsserver服务器基础设置</title>
      <link href="/2016/11/09/Windowsserver%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/"/>
      <url>/2016/11/09/Windowsserver%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="远程连接">远程连接</h3><p>禁止administrators组远程连接</p><blockquote><p>运行gpedit.msc<br>计算机配置-&gt;windows设置-&gt;安全设置-&gt;本地策略-&gt;用户权限分配-&gt;通过终端服务允许登录<br>将Administrators账号删除掉,保留Remote Desktop Users</p></blockquote><p>创建新的用户</p><blockquote><p>本地用户和组-&gt;用户右键-&gt;新用户-&gt;输入用户名，设置密码 添加Administrators组，Remote Desktop Users组</p></blockquote><p>限制登陆次数</p><blockquote><p>计算机配置-&gt;windows设置-&gt;安全设置-&gt;账户策略-&gt;账户锁定策略”，“账户锁定阈值”设置为 20后，系统会自动设置锁定时间和计数器</p></blockquote><p>3389端口修改</p><blockquote><p>修改注册表，是不是需要修改？</p></blockquote><p>超过2个远程连接处理办法及规避方法</p><pre><code>mstsc /console /v:10.10.10.10:3389</code></pre><blockquote><p>开始－管理工具－终端服务配置－服务器配置－限制每个用户使用一个会话</p></blockquote><h3 id="防火墙">防火墙</h3><p>开启防火墙</p><blockquote><p>控制面板&gt;防火墙&gt;开启<br>例外里勾选远程桌面,保证服务器可以正常连接<br>其他情况就在添加端口里添加即可</p></blockquote><h3 id="ftp">FTP</h3><p>开启ftp</p><blockquote><p>在控制面板的添加/删除程序——Windows组件向导——应用程序服务器——Internet信息服务(IIS)中选中“文件传输协议(FTP)服务”。<br>需要文件夹AMD64 设置一个ftp用户ftpuser<br>在ftp设置中关掉允许匿名连接<br>主目录中本地路径为E:\FTP<br>不要勾选写入权限<br>默认ftp站点新建虚拟目录ftpuser 路径E:\FTP\ftpuser<br>在防火墙上开启20，21端口 在ftp客户端选择port主动模式，主动模式不需要服务器开启其他端口</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>thinkphp入门基础</title>
      <link href="/2016/11/09/Thinkphp%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Thinkphp%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="url">URL</h3><h3 id="配置url伪静态">配置URL伪静态</h3><p>3.1版本默认支持.html,.shtml,.xml,.pdf伪静态<br>在配置文件中配置[是在项目下的配置文件./App/Conf/config.php]</p><pre><code>&#39;URL_HTML_SUFFIX&#39;=&gt;&#39;html|shmtl|xml&#39; // 多个用 | 分割</code></pre><h3 id="配置url路由">配置URL路由</h3><p>基本规则</p><blockquote><p>一、规则路由<br>格式1：'路由规则'=&gt;'[分组/模块/操作]?额外参数1=值1&amp;额外参数2=值2...'<br>格式2：'路由规则'=&gt;array('[分组/模块/操作]','额外参数1=值1&amp;额外参数2=值2...')<br>格式3：'路由规则'=&gt;'外部地址'<br>格式4：'路由规则'=&gt;array('外部地址','重定向代码')<br>注意事项：<br>路由规则中如果以“:”开头，表示动态变量，否则为静态地址<br>格式2的额外参数可以传入数组或者字符串<br>外部地址中如果要引用动态变量， 采用 :1、:2 的方式<br>路由规则支持变量的数字约束定义，例如：'news/:id\d'=&gt;'News/read'<br>规则路由可以支持 全动态和动静结合定义，例如':user/blog/:id'=&gt;'Home/Blog/user'<br>路由规则非数字变量支持排除，例如 'news/:cate^add|edit|delete'=&gt;'News/category'<br>路由规则中的静态地址部分不区分大小写</p></blockquote><p>配置文件开启路由</p><pre><code>&#39;URL_ROUTER_ON&#39;   =&gt; true, //开启路由&#39;URL_ROUTE_RULES&#39; =&gt; array( //定义路由规则    &#39;news/:year/:month/:day&#39; =&gt; array(&#39;News/archive&#39;, &#39;status=1&#39;),    &#39;news/:id&#39;               =&gt; &#39;News/read&#39;,    &#39;news/read/:id&#39;          =&gt; &#39;/news/:1&#39;, ),</code></pre><blockquote><p><code>http://serverName/index.php/news/2012/01/08</code>匹配第一条路由<br>也可以写成<code>'news/:year/:month/:day/'=&gt;'News/archive?status=1',</code> <code>http://serverName/index.php/news/8</code>匹配第二条路由 第三条用于url地址迁移，重定向使用</p></blockquote><h3 id="正则路由">正则路由</h3><blockquote><p>正则路由可以实现更加复杂的路由定义，支持的定义格式如下：<br>格式1：'路由正则'=&gt;'[分组/模块/操作]?参数1=值1&amp;参数2=值2...'<br>格式2：'路由正则'=&gt;array('[分组/模块/操作]','参数1=值1&amp;参数2=值2...')<br>格式3：'路由正则'=&gt;'外部地址'<br>格式4：'路由正则'=&gt;array('外部地址','重定向代码')</p></blockquote><p>注意事项：<br>正则路由规则必须以“/”开始和结束<br>格式2的参数可以传入数组或者字符串<br>参数值和外部地址中可以用动态变量 采用 :1、 :2 的方式<br>下面是正则路由的定义示例：</p><pre><code>&#39;URL_ROUTER_ON&#39;   =&gt; true, //开启路由 &#39;URL_ROUTE_RULES&#39; =&gt; array( //定义路由规则    &#39;/^blog\/(\d+)$/&#39;        =&gt; &#39;Blog/read?id=:1&#39;,    &#39;/^blog\/(\d+)\/(\d+)$/&#39; =&gt; &#39;Blog/achive?year=:1&amp;month=:2&#39;,    &#39;/^blog\/(\d+)_(\d+)$/&#39;  =&gt; &#39;blog.php?id=:1&amp;page=:2&#39;, ), <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">### URL区分大小写</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'URL\_CASE\_INSENSITIVE'</span> =&gt;<span class="keyword">true</span>, <span class="comment">// 不区分 'URL\_CASE\_INSENSITIVE' =&gt;false, // 区分</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">### 缓存</span></span><br><span class="line">    <span class="comment">### 静态缓存</span></span><br><span class="line">    开启静态缓存[是在分组下的配置文件./App/Moduels/Index/Conf/config.php]  </span><br><span class="line">    和静态缓存相关的配置参数包括：  </span><br><span class="line">    HTML_CACHE_ON 是否开启静态缓存功能  </span><br><span class="line">    HTML_FILE_SUFFIX 静态文件后缀 惯例配置的值是 .html  </span><br><span class="line">    HTML_CACHE_TIME 默认的静态缓存有效期 默认<span class="number">60</span>秒 可以在静态规则定义覆盖  </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'HTML\_CACHE\_ON'</span>=&gt;<span class="keyword">true</span>, <span class="string">'HTML\_CACHE\_RULES'</span>=&gt; <span class="keyword">array</span>( <span class="string">'ActionName'</span> =&gt; <span class="keyword">array</span>(<span class="string">'静态规则'</span>, <span class="string">'静态缓存有效期'</span>, <span class="string">'附加规则'</span>), <span class="string">'ModuleName(小写)'</span> =&gt; <span class="keyword">array</span>(<span class="string">'静态规则'</span>, <span class="string">'静态缓存有效期'</span>, <span class="string">'附加规则'</span>), <span class="string">'ModuleName(小写):ActionName'</span> =&gt; <span class="keyword">array</span>(<span class="string">'静态规则'</span>, <span class="string">'静态缓存有效期'</span>, <span class="string">'附加规则'</span>), <span class="string">'*'</span> =&gt; <span class="keyword">array</span>(<span class="string">'静态规则'</span>, <span class="string">'静态缓存有效期'</span>, <span class="string">'附加规则'</span>), <span class="string">'Show:index'</span> =&gt; <span class="keyword">array</span>(<span class="string">'&#123;:module&#125;_&#123;:action&#125;_&#123;id&#125;'</span>, <span class="number">100</span>),</span><br><span class="line"></span><br><span class="line">    所有控制器下read方法缓存，其中，&#123;id&#125; 表示取$_GET[<span class="string">'id'</span>] 为静态缓存文件名，第二个参数表示缓存<span class="number">60</span>秒</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'read'</span>=&gt;<span class="keyword">array</span>(<span class="string">'&#123;id&#125;'</span>,<span class="string">'60'</span>)</span><br><span class="line"></span><br><span class="line">    User控制器下所有方法缓存，其中，&#123;:action&#125; 表示当前的操作名称</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'user:'</span>=&gt;<span class="keyword">array</span>(<span class="string">'User/&#123;:action&#125;_&#123;id&#125;'</span>,<span class="string">'600'</span>)</span><br><span class="line"></span><br><span class="line">    Blog控制器下read方法缓存</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'blog:read'</span>=&gt;<span class="keyword">array</span>(<span class="string">'&#123;id&#125;'</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    全局缓存</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">'*'</span>=&gt;<span class="keyword">array</span>(<span class="string">'&#123;$\_SERVER.REQUEST\_URI|md5&#125;'</span>),</span><br><span class="line"></span><br><span class="line">    静态规则  </span><br><span class="line">    <span class="number">1.</span>  使用系统变量 包括 _GET _REQUEST _SERVER _SESSION _COOKIE</span><br><span class="line">    &gt; &#123;$_×××|<span class="function"><span class="keyword">function</span>&#125;</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    2.  使用框架特定的变量</span></span><br><span class="line"><span class="function">    &gt; </span>&#123;:app&#125;、&#123;:group&#125; 、&#123;:module&#125; 和&#123;:action&#125; 分别表示当前项目名、分组名、模块名和操作名</span><br><span class="line">    </span><br><span class="line">    <span class="number">3.</span>  使用_GET变量</span><br><span class="line">    &gt; &#123;<span class="keyword">var</span>|<span class="function"><span class="keyword">function</span>&#125;    也就是说 </span>&#123;id&#125; 其实等效于 &#123;$_GET.id&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="number">4.</span>  直接使用函数</span><br><span class="line">    &gt; &#123;|<span class="function"><span class="keyword">function</span>&#125;   例如：</span>&#123;|time&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="number">5.</span>  支持混合定义</span><br><span class="line">    &gt; <span class="string">'&#123;id&#125;,&#123;name|md5&#125;'</span>   </span><br><span class="line">    在&#123;&#125;之外的字符作为字符串对待，如果包含有”/”，会自动创建目录。  </span><br><span class="line">    例如，定义下面的静态规则：  </span><br><span class="line">    &#123;:module&#125;/&#123;:action&#125;_&#123;id&#125;  </span><br><span class="line">    则会在静态目录下面创建模块名称的子目录，然后写入操作名_id.shtml 文件。    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    使用get中文参数乱码问题</span><br><span class="line">    <span class="comment">### 原因</span></span><br><span class="line">    中文浏览器中默认使用的是gbk2312编码</span><br><span class="line">    </span><br><span class="line">    <span class="comment">### 解决方法</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">/\*\* \* 解决get参数中带中文的乱码问题 * @param $keywords 传入的关键字 * @<span class="keyword">return</span> string */ <span class="function"><span class="keyword">function</span> <span class="title">decodeToUtf</span><span class="params">($keywords)</span> </span>&#123; $keywords = mb\_convert\_encoding($keywords, <span class="string">'UTF-8'</span>,<span class="string">'GB2312,UTF-8'</span>); <span class="keyword">return</span> $keywords; &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">$keywords = I(<span class="string">'keywords'</span>); $keywords = decodeToUtf($keywords); $page = <span class="keyword">new</span> Page($count,<span class="keyword">self</span>::$perPage); $page-&gt;parameter = <span class="string">'keywords='</span> . $keywords;</span><br></pre></td></tr></table></figure></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows软件运行时错误429,ACTIVEX部件不能创建对象的解决方法</title>
      <link href="/2016/11/09/Windows%E8%BD%AF%E4%BB%B6%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF429,ACTIVEX%E9%83%A8%E4%BB%B6%E4%B8%8D%E8%83%BD%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2016/11/09/Windows%E8%BD%AF%E4%BB%B6%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF429,ACTIVEX%E9%83%A8%E4%BB%B6%E4%B8%8D%E8%83%BD%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="安装软件出现activex部件不能创建对象">安装软件出现“ACTIVEX部件不能创建对象”</h3><p>提示错误</p><blockquote><p>中文：“运行时错误429，ActiveX部件不能创建对象”<br>英文："Run-time error '429' ActiveX componnent can't create object"</p></blockquote><p>新建文件，将下面代码复制粘贴，文件另存为xxx.bat 运行xxx.bat，重启电脑，OK.</p><pre><code>echo 正在修复，这个过程可能需要几分钟，请稍候…… rundll32.exe advpack.dll /DelNodeRunDLL32 %systemroot%\System32\dacui.dll rundll32.exe advpack.dll /DelNodeRunDLL32 %systemroot%\Catroot\icatalog.mdb regsvr32 /s comcat.dll regsvr32 /s asctrls.ocx regsvr32 /s oleaut32.dll regsvr32 /s shdocvw.dll /I regsvr32 /s shdocvw.dll regsvr32 /s browseui.dll regsvr32 /s browseui.dll /I regsvr32 /s msrating.dll regsvr32 /s mlang.dll regsvr32 /s hlink.dll regsvr32 /s mshtml.dll regsvr32 /s mshtmled.dll regsvr32 /s urlmon.dll regsvr32 /s plugin.ocx regsvr32 /s sendmail.dll regsvr32 /s mshtml.dll /i regsvr32 /s scrobj.dll regsvr32 /s corpol.dll regsvr32 /s jscrīpt.dll regsvr32 /s msxml.dll regsvr32 /s imgutil.dll regsvr32 /s cryptext.dll regsvr32 /s inseng.dll regsvr32 /s iesetup.dll /i regsvr32 /s cryptdlg.dll regsvr32 /s actxprxy.dll regsvr32 /s dispex.dll regsvr32 /s occache.dll regsvr32 /s iepeers.dll regsvr32 /s urlmon.dll /i regsvr32 /s cdfview.dll regsvr32 /s webcheck.dll regsvr32 /s mobsync.dll regsvr32 /s pngfilt.dll regsvr32 /s licmgr10.dll regsvr32 /s hhctrl.ocx regsvr32 /s inetcfg.dll regsvr32 /s trialoc.dll regsvr32 /s tdc.ocx regsvr32 /s MSR2C.DLL regsvr32 /s msident.dll regsvr32 /s msieftp.dll regsvr32 /s xmsconf.ocx regsvr32 /s ils.dll regsvr32 /s msoeacct.dll regsvr32 /s wab32.dll regsvr32 /s wabimp.dll regsvr32 /s wabfind.dll regsvr32 /s oemiglib.dll regsvr32 /s directdb.dll regsvr32 /s inetcomm.dll regsvr32 /s msoe.dll regsvr32 /s oeimport.dll regsvr32 /s msdxm.ocx regsvr32 /s dxmasf.dll regsvr32 /s laprxy.dll regsvr32 /s l3codecx.ax regsvr32 /s acelpdec.ax regsvr32 /s mpg4ds32.ax regsvr32 /s danim.dll regsvr32 /s Daxctle.ocx regsvr32 /s lmrt.dll regsvr32 /s datime.dll regsvr32 /s dxtrans.dll regsvr32 /s dxtmsft.dll regsvr32 /s wshom.ocx regsvr32 /s wshext.dll regsvr32 /s vbscrīpt.dll regsvr32 /s scrrun.dll mstinit.exe /setup regsvr32 /s msnsspc.dll /SspcCreateSspiReg regsvr32 /s msapsspc.dll /SspcCreateSspiReg echo. echo. echo 修复成功！任意键退出！ pause&gt;nul</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sublime入门基础</title>
      <link href="/2016/11/09/Sublime%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Sublime%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="下载地址">下载地址</h3><p><a href="http://www.sublimetext.com/3" target="_blank" rel="noopener">http://www.sublimetext.com/3</a></p><h3 id="ubuntu下载">Ubuntu下载</h3><pre><code>sudo add-apt-repository ppa:webupd8team/sublime-text-3sudo apt-get updatesudo apt-get install sublime-text-installer</code></pre><h3 id="插件下载地址">插件下载地址</h3><p><a href="https://packagecontrol.io/" target="_blank" rel="noopener">https://packagecontrol.io/</a></p><h3 id="注册码">注册码</h3><pre><code>----- BEGIN LICENSE ----Andrew WeberSingle User LicenseEA7E-855605813A03DD 5E4AD9E6 6C0EEB94 BC99798F942194A6 02396E98 E62C9979 4BB979FE91424C9D A45400BF F6747D88 2FB8807890F5CC94 1CDC92DC 8457107A F151657B1D22E383 A997F016 42397640 33F41CFCE1D0AE85 A0BBD039 0E9C8D55 E1B89D5D5CDB7036 E56DE1C0 EFCC0840 650CD3A6B98FC99C 8FAC73EE D2B95564 DF450523------ END LICENSE ------</code></pre><h3 id="安装package-control">安装Package Control</h3><pre><code>import urllib.request,os; pf = &#39;Package Control.sublime-package&#39;; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf), &#39;wb&#39;).write(urllib.request.urlopen( &#39;http://sublime.wbond.net/&#39; + pf.replace(&#39; &#39;,&#39;%20&#39;)).read())</code></pre><h3 id="安装模板material-theme">安装模板Material Theme</h3><p>配置方法</p><pre><code>Package Control Messages========================Material Theme--------------  Material Theme for Sublime Text 3  For more information on the Material Theme: https://github.com/equinusocio/material-theme  **********************************************************************************************  If installing manually (not through Package Control), add the following to your   Settings - User file and restart Sublime Text after:  {    &quot;theme&quot;: &quot;Material-Theme.sublime-theme&quot;,    &quot;color_scheme&quot;: &quot;Packages/Material Theme/schemes/Material-Theme.tmTheme&quot;,  }  **********************************************************************************************  This theme includes a Darker and Lighter version:  Darker version:  {    &quot;theme&quot;: &quot;Material-Theme-Darker.sublime-theme&quot;,    &quot;color_scheme&quot;: &quot;Packages/Material Theme/schemes/Material-Theme-Darker.tmTheme&quot;,  }  Lighter version:  {    &quot;theme&quot;: &quot;Material-Theme-Lighter.sublime-theme&quot;,    &quot;color_scheme&quot;: &quot;Packages/Material Theme/schemes/Material-Theme-Lighter.tmTheme&quot;,  }  **********************************************************************************************  Recommended UI and font settings for a better experience:  {    &quot;overlay_scroll_bars&quot;: &quot;enabled&quot;,    &quot;line_padding_top&quot;: 3,    &quot;line_padding_bottom&quot;: 3,    &quot;always_show_minimap_viewport&quot;: true,    &quot;bold_folder_labels&quot;: true,    &quot;indent_guide_options&quot;: [ &quot;draw_normal&quot;, &quot;draw_active&quot; ]    // Highlight active indent    &quot;font_options&quot;: [ &quot;gray_antialias&quot; ],                       // For retina Mac  }  **********************************************************************************************  Other available theme options:  &quot;material_theme_small_tab&quot;: true,                           // Set small tabs  &quot;material_theme_disable_fileicons&quot;: true,                   // Hide siderbar file type icons  &quot;material_theme_disable_folder_animation&quot;: true,            // Disable folder animation  &quot;material_theme_small_statusbar&quot;: true,                     // Set small status bar  &quot;material_theme_disable_tree_indicator&quot;: true,              // Disable sidebar file indicator  &quot;material_theme_bold_tab&quot;: true,                            // Make the tab labels bolder  &quot;material_theme_tabs_separator&quot;: true,                      // Show tabs separator  &quot;material_theme_accent_lime&quot;: true,                         // set green lime accent color  &quot;material_theme_accent_purple&quot;: true,                       // set purple accent color  &quot;material_theme_accent_red&quot;: true,                          // set pale red accent color  &quot;material_theme_accent_orange&quot;: true,                       // set orange accent color  &quot;material_theme_accent_yellow&quot;: true,                       // set yellow accent color  &quot;material_theme_panel_separator&quot;: true,                     // show bottom panel separator  &quot;material_theme_tabs_autowidth&quot;: true,                      // Enable autowidth for tabs  &quot;material_theme_contrast_mode&quot;: true,                       // Enable sidebar and panels contrast mode</code></pre><h3 id="设置空格缩进">设置空格缩进</h3><pre><code>{        &quot;tab_size&quot;: 4,        &quot;translate_tabs_to_spaces&quot;: true } </code></pre><h3 id="设置行间距">设置行间距</h3><pre><code>{    &quot;line_padding_bottom&quot;: 3,     &quot;line_padding_top&quot;: 3,}    </code></pre><h3 id="插件安装">插件安装</h3><p><strong>Emmet(懂的)</strong><br><strong>ConvertToUtf8(编码转换)</strong><br><strong>Sublime​Linter(代码检查工具，需要配合各语言插件包检查)</strong><br><strong>SideBarEnhancements（侧边栏右键增强）</strong><br><strong>Bracket​Highlighter（显示标签块？？）</strong><br><strong>SublimeCodeIntel(跳转到自定义函数)</strong></p><blockquote><p>For Windows:<br>Jump to definition = Alt+Click<br>Jump to definition = Control+Windows+Alt+Up<br>Go back = Control+Windows+Alt+Left<br>Manual Code Intelligence = Control+Shift+space<br>需要自己设置执行路径</p></blockquote><pre><code>        &quot;PHP&quot;: {            &quot;php&quot;: &quot;D:\\PHP\\php.exe&quot;,            &quot;codeintel_scan_extra_dir&quot;: [],            &quot;codeintel_scan_files_in_project&quot;: true,            &quot;codeintel_max_recursive_dir_depth&quot;: 15,            &quot;codeintel_scan_exclude_dir&quot;:[&quot;D:\\PHP&quot;]        }</code></pre><p><strong>HTML5(html5的snippets)</strong><br><strong>Alignment(自动对齐插件)</strong><br><strong>SFTP(ftp上传)需要配置对应的ftp路径等信息</strong> <strong>git</strong> <strong>jquery(jquery snippets)</strong> <strong>SaSS(可以支持sass)</strong> <strong>DocBlockr（块状注释）</strong></p><h3 id="ubuntu安装中文输入法">ubuntu安装中文输入法</h3><h3 id="安装">安装</h3><pre><code>git clone https://github.com/lyfeyaj/sublime-text-imfix.git</code></pre><h3 id="复制文件">复制文件</h3><pre><code>cd ~/sublime-text-imfixsudo cp ./lib/libsublime-imfix.so /opt/sublime_text/sudo cp ./src/subl /usr/bin/</code></pre><h3 id="测试">测试</h3><p>终端输入</p><pre><code>LD_PRELOAD=./libsublime-imfix.so subl</code></pre><h3 id="建立快捷方式">建立快捷方式</h3><p>新建文件sublime放在/home目录下，脚本内容：</p><pre><code>#!/bin/bashLD_PRELOAD=/opt/sublime_text/libsublime-imfix.so subl</code></pre><h3 id="测试-1">测试</h3><p>终端输入</p><pre><code>bash ~/sublime</code></pre><h3 id="快捷方式修改">快捷方式修改</h3><p>将[Desktop Entry]中的字符串<br>Exec=/opt/sublime_text/sublime_text %F<br>修改为<br>Exec=bash -c "LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F"<br>将[Desktop Action Window]中的字符串<br>Exec=/opt/sublime_text/sublime_text -n<br>修改为<br>Exec=bash -c "LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n"<br>将[Desktop Action Document]中的字符串<br>Exec=/opt/sublime_text/sublime_text --command new_file<br>修改为<br>Exec=bash -c "LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file"<br>注意：<br>修改时请注意双引号"",否则会导致不能打开带有空格文件名的文件。</p>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git入门基础</title>
      <link href="/2016/11/09/Git%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Git%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="配置">配置</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置代理</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global http.proxy <span class="string">'socks5://127.0.0.1:1080'</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global https.proxy <span class="string">'socks5://127.0.0.1:1080'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看配置项</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --list</span></span><br></pre></td></tr></table></figure><h1 id="创建项目">创建项目</h1><pre><code>git init</code></pre><h1 id="查看分支">查看分支</h1><pre><code>E:\HKMAIN (master)λ git branch* master  v1.1  v1.2λ git branch -v* master bf0d2bf 蛋白模板修改USAGE:Reconstitute in sterile ddH2O.  v1.1   b48a782 试剂盒现货列表添加样本信息一栏  v1.2   acbf4f1 c1.2</code></pre><h1 id="删除分支">删除分支</h1><p>查看未合并的分支</p><pre><code>λ git branch --no-merged</code></pre><p>删除分支</p><pre><code>git branch -d v1.1</code></pre><p>如果是未合并的分支，使用大写的-D</p><pre><code>E:\HKMAIN (master)λ git branch -d v1.1Deleted branch v1.1 (was b48a782).E:\HKMAIN (master)λ git branch -v* master bf0d2bf 蛋白模板修改USAGE:Reconstitute in sterile ddH2O.  v1.2   acbf4f1 c1.2</code></pre><h3 id="创建分支">创建分支</h3><pre><code>git branch v2.0E:\HKMAIN (master)λ git branch VmysqlE:\HKMAIN (master)λ git branch  Vmysql* master  v1.2E:\HKMAIN (master)λ git checkout VmysqlSwitched to branch &#39;Vmysql&#39;E:\HKMAIN (Vmysql)λ</code></pre><p>或者直接使用git checkout -b v3.0</p><pre><code>E:\HKMAIN (Vmysql)λ git checkout -b VsqlserverSwitched to a new branch &#39;Vsqlserver&#39;E:\HKMAIN (Vsqlserver)λ git branch  Vmysql* Vsqlserver  master  v1.2</code></pre><h3 id="git查看远程仓库">git查看远程仓库</h3><pre><code># git查看远程仓库git remote -v# git添加远程仓库git remote add xxx git@gitlab.xxx.com:xxx/xxx# 删除远程分值git remote rm xxx</code></pre><h3 id="git-stash">git stash</h3><p>使用git stash命令先把当前进度保存起来，然后切换到另一个分支去修改bug，修改完提交后，再切回dev分支，使用git stash pop来恢复之前的进度继续开发新功能。</p><pre><code># 保存当前进度git stash# 查看现有的存储git stash list# 恢复最新的进度到工作区git stash popgit stash save your-file-name</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Excel公式入门基础</title>
      <link href="/2016/11/09/Excel%E5%85%AC%E5%BC%8F%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Excel%E5%85%AC%E5%BC%8F%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="返回最后一个值倒数第二个值">返回最后一个值、倒数第二个值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=LOOKUP(1,0/(A2:J2&lt;&gt;&quot;&quot;),A2:J2)</span><br><span class="line">=LOOKUP(1,0/(B2:J2&lt;&gt;&quot;&quot;),A2:J2)</span><br></pre></td></tr></table></figure><h3 id="返回时间差">返回时间差</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=DATEDIF(--TEXT(F2,&quot;00-00-00&quot;),TODAY(),&quot;D&quot;)</span><br></pre></td></tr></table></figure><h3 id="vlookup-逆向检索">VLOOKUP 逆向检索</h3><p><a href="http://zhidao.baidu.com/link?url=-1b12Kx36WQ4vf05DIDhZmxCOtvC6Zdhc62kve1QRoF-hV_Hbl3cZDuBZOYgGRjEo513fDk9-UL6gfUnMI9Jna" target="_blank" rel="noopener">参考</a> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=VLOOKUP(C2,IF(&#123;1,0&#125;,Sheet2!$D$2:$D$5,Sheet2!$A$2:$A$5),2,FALSE)</span><br><span class="line">=INDEX(Sheet2!A:A,MATCH(Sheet1!C2,Sheet2!D:D,0))</span><br></pre></td></tr></table></figure></p><h3 id="countifs-多条件求和">COUNTIFS 多条件求和</h3><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160304142206.png" alt="示例"> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">统计每个部门人数</span><br><span class="line">&#123;=SUM(IFERROR(1/(COUNTIFS(Sheet2!L$2:Sheet2!L$250,B5,Sheet2!N$2:Sheet2!N$250,Sheet2!N$2:Sheet2!N$250)*(Sheet2!L$2:Sheet2!L$250=B5)),))&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Excel </tag>
            
            <tag> Office </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wireshark抓包基础</title>
      <link href="/2016/11/09/Wireshark%E6%8A%93%E5%8C%85%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Wireshark%E6%8A%93%E5%8C%85%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="nmap安装">nmap安装</h3><pre><code>sudo apt-get install nmap</code></pre><h3 id="zenmap图形gui安装">Zenmap图形GUI安装</h3><pre><code>sudo apt-get install Zenmap</code></pre><h3 id="扫描主机">扫描主机</h3><pre><code>nmap -T4 -A -v 192.168.1.3/16</code></pre><p>其中-A选项用于使用进攻性（Aggressive）方式扫描；-T4指定扫描过程使用的时序（Timing），总有6个级别（0-5），级别越高，扫描速度越快，但也容易被防火墙或IDS检测并屏蔽掉，在网络通讯状况良好的情况推荐使用T4；-v表示显示冗余（verbosity）信息，在扫描过程中显示扫描的细节，从而让用户了解当前的扫描状态。<br>/32 表示扫描 192.168.1.3<br>/24 表示扫描 192.168.1.0-192.168.1.255<br>/16 表示扫描 192.168.0.0-192.168.255.255<br>/8<br>/1<br>参考<a href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener">cird</a></p><h3 id="nmap所识别的6个端口状态">Nmap所识别的6个端口状态。</h3><p>open(开放的) 应用程序正在该端口接收TCP 连接或者UDP报文。发现这一点常常是端口扫描 的主要目标。安全意识强的人们知道每个开放的端口 都是攻击的入口。攻击者或者入侵测试者想要发现开放的端口。 而管理员则试图关闭它们或者用防火墙保护它们以免妨碍了合法用户。 非安全扫描可能对开放的端口也感兴趣，因为它们显示了网络上那些服务可供使用。 closed(关闭的) 关闭的端口对于Nmap也是可访问的(它接受Nmap的探测报文并作出响应)， 但没有应用程序在其上监听。 它们可以显示该IP地址上(主机发现，或者ping扫描)的主机正在运行up 也对部分操作系统探测有所帮助。 因为关闭的关口是可访问的，也许过会儿值得再扫描一下，可能一些又开放了。 系统管理员可能会考虑用防火墙封锁这样的端口。 那样他们就会被显示为被过滤的状态，下面讨论。 filtered(被过滤的) 由于包过滤阻止探测报文到达端口， Nmap无法确定该端口是否开放。过滤可能来自专业的防火墙设备，路由器规则 或者主机上的软件防火墙。这样的端口让攻击者感觉很挫折，因为它们几乎不提供 任何信息。有时候它们响应ICMP错误消息如类型3代码13 (无法到达目标: 通信被管理员禁止)，但更普遍的是过滤器只是丢弃探测帧， 不做任何响应。 这迫使Nmap重试若干次以访万一探测包是由于网络阻塞丢弃的。 这使得扫描速度明显变慢。 unfiltered(未被过滤的) 未被过滤状态意味着端口可访问，但Nmap不能确定它是开放还是关闭。 只有用于映射防火墙规则集的ACK扫描才会把端口分类到这种状态。 用其它类型的扫描如窗口扫描，SYN扫描，或者FIN扫描来扫描未被过滤的端口可以帮助确定 端口是否开放。 open|filtered(开放或者被过滤的) 当无法确定端口是开放还是被过滤的，Nmap就把该端口划分成 这种状态。开放的端口不响应就是一个例子。没有响应也可能意味着报文过滤器丢弃 了探测报文或者它引发的任何响应。因此Nmap无法确定该端口是开放的还是被过滤的。 UDP，IP协议， FIN，Null，和Xmas扫描可能把端口归入此类。 closed|filtered(关闭或者被过滤的) 该状态用于Nmap不能确定端口是关闭的还是被过滤的。 它只可能出现在IPID Idle扫描中。</p><h3 id="监视指定网络接口的数据包tcpdump">监视指定网络接口的数据包tcpdump</h3><p>如果不指定网卡，默认tcpdump只会监视第一个网络接口，一般是eth0，</p><pre><code>tcpdump -i eth0</code></pre><h3 id="路由追踪traceroute">路由追踪traceroute</h3><p>linux</p><pre><code>sudo apt-get install traceroute  traceroute hostname</code></pre><p>window</p><pre><code>tracert hostname</code></pre><h3 id="ubuntu开启和关闭混杂模式">ubuntu开启和关闭混杂模式</h3><p>``` ifconfig eth0 promisc # 设置eth0为混杂模式。 ifconfig eth0 -promisc # 取消它的混杂模式</p><pre><code>ifconfig参数详解</code></pre><p>字段含义说明： eth0/eth1： 分别表示第一块网卡和第二块网卡； lo： 表示回环测试接口，注意，这个虚拟的interface一定要存在！ usb0： 表示USB接口的网卡； Linkencap： 表示位于OSI物理层的名称，即连接类型Ethernet（以太网） HWaddr： 表示网卡的硬件地址，即MAC地址 inetaddr ： 表示网卡IP； Bcast： 表示广播(broadcast ) 的地址； Mask： 表示子网掩码； UP： 表示网卡开启状态； BROADCAST： 表示支持广播； MULTICAST： 表示网卡混杂模式； RUNNING： 表示网卡的网线被接上； MULTICAST： 表示支持组播； MTU： 表示MaximumTrasmission Unit 最大传输单元(字节)，即此接口一次所能传输的最大封包； Metric： 表示路由度量值，缺省值是0； RX： 表示网络由激活到目前为止接收的数据包； TX： 表示网络由激活到目前为止发送的数据包； collisions： 表示网络信号冲突的情况； txqueuelen： 表示传输缓冲区长度大小； Memory： 表示占用内存范围。</p><pre><code>### 安装wireshark</code></pre><p>sudo apt-get install wireshark</p><pre><code>wireshark捕获过滤器  </code></pre><p>src 192.168.0.10 &amp;&amp; port 80 源地址192.168.0.10和端口为80相关<br>host 192.160.0.1 和主机192.168.0.1相关<br>src host 192.168.0.1<br>port 8080<br>!port 8080<br>dst port 80<br>icmp<br>!ip6</p><pre><code>wireshark显示过滤器  </code></pre><p>!tcp<br>ip.addr == 192.168.0.1<br>frame.len &lt;= 128<br>tcp.port == 23 || tcp.port == 21<br>smtp || pop || imap<br>ip.addr == 192.168.0.1 or ip.addr == 192.168.0.2</p><h1 id="操作符-.">操作符 ==, !=, &gt;, &lt;, &gt;=. &lt;=</h1><h1 id="操作符-and-or-xor有且仅有1个满足-not">操作符 and, or, xor(有且仅有1个满足), not</h1>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>jetbrains使用配置</title>
      <link href="/2016/11/09/Jetbrains%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/2016/11/09/Jetbrains%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="需要新的license">需要新的license</h3><p>选择server license<br>添加 http://idea.lanyus.com/<br>点击 "ok"<br>成功添加<br>phpstorm10.03开始使用http://idea.qinxi1992.cn/<br>pycharm</p><pre><code>43B4A73YYJ-eyJsaWNlbnNlSWQiOiI0M0I0QTczWVlKIiwibGljZW5zZWVOYW1lIjoibGFuIHl1IiwiYXNzaWduZWVOYW1lIjoiIiwiYXNzaWduZWVFbWFpbCI6IiIsImxpY2Vuc2VSZXN0cmljdGlvbiI6IkZvciBlZHVjYXRpb25hbCB1c2Ugb25seSIsImNoZWNrQ29uY3VycmVudFVzZSI6ZmFsc2UsInByb2R1Y3RzIjpbeyJjb2RlIjoiSUkiLCJwYWlkVXBUbyI6IjIwMTctMDItMjUifSx7ImNvZGUiOiJBQyIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9LHsiY29kZSI6IkRQTiIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9LHsiY29kZSI6IlBTIiwicGFpZFVwVG8iOiIyMDE3LTAyLTI1In0seyJjb2RlIjoiRE0iLCJwYWlkVXBUbyI6IjIwMTctMDItMjUifSx7ImNvZGUiOiJDTCIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9LHsiY29kZSI6IlJTMCIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9LHsiY29kZSI6IlJDIiwicGFpZFVwVG8iOiIyMDE3LTAyLTI1In0seyJjb2RlIjoiUEMiLCJwYWlkVXBUbyI6IjIwMTctMDItMjUifSx7ImNvZGUiOiJSTSIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9LHsiY29kZSI6IldTIiwicGFpZFVwVG8iOiIyMDE3LTAyLTI1In0seyJjb2RlIjoiREIiLCJwYWlkVXBUbyI6IjIwMTctMDItMjUifSx7ImNvZGUiOiJEQyIsInBhaWRVcFRvIjoiMjAxNy0wMi0yNSJ9XSwiaGFzaCI6IjMzOTgyOTkvMCIsImdyYWNlUGVyaW9kRGF5cyI6MCwiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-keaxIkRgXPKE4BR/ZTs7s7UkP92LBxRe57HvWamu1EHVXTcV1B4f/KNQIrpOpN6dgpjig5eMVMPmo7yMPl+bmwQ8pTZaCGFuLqCHD1ngo6ywHKIQy0nR249sAUVaCl2wGJwaO4JeOh1opUx8chzSBVRZBMz0/MGyygi7duYAff9JQqfH3p/BhDTNM8eKl6z5tnneZ8ZG5bG1XvqFTqWk4FhGsEWdK7B+He44hPjBxKQl2gmZAodb6g9YxfTHhVRKQY5hQ7KPXNvh3ikerHkoaL5apgsVBZJOTDE2KdYTnGLmqxghFx6L0ofqKI6hMr48ergMyflDk6wLNGWJvYHLWw==-MIIEPjCCAiagAwIBAgIBBTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE1MTEwMjA4MjE0OFoXDTE4MTEwMTA4MjE0OFowETEPMA0GA1UEAwwGcHJvZDN5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxcQkq+zdxlR2mmRYBPzGbUNdMN6OaXiXzxIWtMEkrJMO/5oUfQJbLLuMSMK0QHFmaI37WShyxZcfRCidwXjot4zmNBKnlyHodDij/78TmVqFl8nOeD5+07B8VEaIu7c3E1N+e1doC6wht4I4+IEmtsPAdoaj5WCQVQbrI8KeT8M9VcBIWX7fD0fhexfg3ZRt0xqwMcXGNp3DdJHiO0rCdU+Itv7EmtnSVq9jBG1usMSFvMowR25mju2JcPFp1+I4ZI+FqgR8gyG8oiNDyNEoAbsR3lOpI7grUYSvkB/xVy/VoklPCK2h0f0GJxFjnye8NT1PAywoyl7RmiAVRE/EKwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQC9WZuYgQedSuOc5TOUSrRigMw4/+wuC5EtZBfvdl4HT/8vzMW/oUlIP4YCvA0XKyBaCJ2iX+ZCDKoPfiYXiaSiH+HxAPV6J79vvouxKrWg2XV6ShFtPLP+0gPdGq3x9R3+kJbmAm8w+FOdlWqAfJrLvpzMGNeDU14YGXiZ9bVzmIQbwrBA+c/F4tlK/DV07dsNExihqFoibnqDiVNTGombaU2dDup2gwKdL81ua8EIcGNExHe82kjF4zwfadHk3bQVvbfdAwxcDy4xBjs3L4raPLU3yenSzr/OEur1+jfOxnQSmEcMXKXgrAQ9U55gwjcOFKrgOxEdek/Sk1VfOjvS+nuM4eyEruFMfaZHzoQiuw4IqgGc45ohFH0UUyjYcuFxxDSU9lMCv8qdHKm+wnPRb0l9l5vXsCBDuhAGYD6ss+Ga+aDY6f/qXZuUCEUOH3QUNbbCUlviSz6+GiRnt1kA9N2Qachl+2yBfaqUqr8h7Z2gsx5LcIf5kYNsqJ0GavXTVyWh7PYiKX4bs354ZQLUwwa/cG++2+wNWP+HtBhVxMRNTdVhSm38AknZlD+PTAsWGu9GyLmhti2EnVwGybSD2Dxmhxk3IPCkhKAK+pl0eWYGZWG3tJ9mZ7SowcXLWDFAk0lRJnKGFMTggrWjV8GYpw5bq23VmIqqDLgkNzuoog==</code></pre><h3 id="输入法问题">输入法问题</h3><p>升级到ubuntu16.04后，输入无法使用<br>去安装目录bin文件夹下找到启动idea.sh,用编辑器打开，添加</p><pre><code>XMODIFIERS=&quot;@im=fcitx&quot;export XMODIFIERS</code></pre><p>在</p><pre><code># ---------------------------------------------------------------------# Run the IDE.# ---------------------------------------------------------------------</code></pre><p>上面即可！</p><h3 id="ubuntu安装">ubuntu安装</h3><p>下载并压缩到/opt/目录下,并在/usr/share/appliactions/下创建快捷方式的文件，命名为phpstorm.desktop,编辑如下代码，保存</p><pre><code>[Desktop Entry]Categories=Development;Comment[zh_CN]=Comment=Exec=/opt/phpstorm/bin/phpstorm.shGenericName[zh_CN]=IDEGenericName=IDEIcon=/opt/phpstorm/bin/webide.pngName[zh_CN]=phpStormName=phpStorm　　　　　　　Path=StartupNotify=trueTerminal=falseType=ApplicationX-DBUS-ServiceName=X-DBUS-StartupType=X-KDE-SubstituteUID=falseX-KDE-Username=Learn Programming</code></pre><h3 id="界面样式">界面样式</h3><p><a href="https://github.com/jkaving/intellij-colors-solarized" target="_blank" rel="noopener">theme</a><br><a href="https://github.com/ChrisRM/material-theme-jetbrains" target="_blank" rel="noopener">背景修改，含theme</a></p><h3 id="界面配置">界面配置</h3><p>显示行号<br>Editor-&gt;General-&gt;Appearance-&gt;Show line number<br>关闭自动保存<br>Appearance&amp;Behavior-&gt;System settings-&gt;save files on frame deactivation 关闭<br>Editor-&gt;General-&gt;Editor tabs-&gt;Mark modified tabs with asterisk 勾选</p><h3 id="theme安装">theme安装</h3><p>安装模板下载http://phpstorm-themes.com/<br>ubuntu安装地址~/.pycharm/config/colors/ ###快捷键 Ctrl+/ 或 Ctrl+Shift+/ 注释（// 或者/<em>…</em>/ ）<br>Shift+F6 重构-重命名<br>Ctrl+X 删除行<br>Ctrl+D 复制行<br>Ctrl+G 查找行<br>Ctrl+Shift+Up/Down 代码向上/下移动。<br>F2 或Shift+F2 高亮错误或警告快速定位<br>写代码，按Tab 生成代码<br>选中文本，按Ctrl+Shift+F7 高亮显示所有该文本，按Esc高亮消失。(因为这个功能我就可以发放心的放弃sublime了)<br>Ctrl+B或Ctrl+鼠标左键单击 快速打开光标处的类或方法，（NB的功能）<br>Ctrl + Alt + B Go to implementation(s) 跳转方法实现处<br>Ctrl + Shift + I Open quick definition lookup 打开定义快速查找<br>Alt + Up/Down Go to previous/next method 跳转到上一个/下一个方法<br>Ctrl+E 最近打开的文件<br>Alt+F1 查找代码所在位置<br>Ctrl+Alt+L 格式化代码<br>Ctrl+R 替换文本<br>Ctrl+F 查找文本<br>Ctrl+P 方法参数提示<br>F3 查找下一个<br>Shift+F3 查找上一个<br>alt+Shift+F 将当前文件加入收藏夹<br>ctrl+alt+s 打开配置窗口<br>ctrl+Shift+N 通过文件名快速查找工程内的文件（必记）<br>ctrl+Shift+alt+N 通过一个字符快速查找位置（必记）<br>Shift+enter 重新开始一行（无论光标在哪个位置）<br>Ctrl + Alt + T with…（if, else, try, catch, for, etc）用 * 来围绕选中的代码行，（ * 包括 if 、 while 、 try catch 等）<br>Ctrl + Shift + U Toggle case for word at caret or selected block 光标所在位置大小写<br>Ctrl + Delete Delete to word end 删除文字结束<br>Ctrl + Backspace Delete to word start 删除文字开始<br>Ctrl + E Recent files popup 弹出最近打开的文件<br>F11 Toggle bookmark 切换标记，我觉得叫书签更好，就是sublime text 的F2<br>Ctrl + Shift + F12 Toggle maximizing editor 切换最大化编辑器<br>Alt + Shift + F Add to Favorites 添至收藏夹</p>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache入门基础</title>
      <link href="/2016/11/09/Apache%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Apache%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="apache配置">Apache配置</h2><h3 id="查看apache加载的模块">查看Apache加载的模块</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>apachectl -t -D DUMP_MODULES</span><br></pre></td></tr></table></figure><h3 id="禁用和启用模块">禁用和启用模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo a2dismod python</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo a2enmod python</span></span><br></pre></td></tr></table></figure><h3 id="查看版本号">查看版本号</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> apachectl -v</span></span><br></pre></td></tr></table></figure><h3 id="赋予权限">赋予权限</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.2.x以下版本</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Order</span></span> deny,allow</span><br><span class="line"><span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.4.x以上版本</span></span><br><span class="line"><span class="attribute">Require</span> <span class="literal">all</span> granted</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django入门基础</title>
      <link href="/2016/11/09/Django%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Django%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="环境安装">环境安装</h2><h3 id="python3.5">Python3.5</h3><p><a href="/2016/11/09/Python入门基础/" title="python入门基础">python入门基础</a></p><h3 id="django1.11">Django1.11</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装项目目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~/www/html/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> virtualenv --no-site-packages -p /usr/bin/python3.5 CCO</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> CCO</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ./bin/activate</span></span><br><span class="line">(CCO) $ pip3 install ipython</span><br><span class="line">(CCO) $ pip3 install Django==1.11.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看django是否安装成功</span></span><br><span class="line">(CCO) $  ipython</span><br><span class="line"><span class="meta">$</span><span class="bash"> import django</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> django.VERSION <span class="comment"># 打印出django版本表示成功</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开始创建项目</span></span><br><span class="line">(CCO) $ django-admin.py startproject CCO_WEB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建应用</span></span><br><span class="line">(CCO) $ cd CCO_WEB</span><br><span class="line">(CCO) $ django-admin.py startapp polls</span><br></pre></td></tr></table></figure><h3 id="配置django">配置Django</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改文件内容</span></span><br><span class="line">(CCO) $ vim CCO_WEB/CCO_WEB/setting.py</span><br><span class="line">ALLOWED_HOSTS = ['127.0.0.1', 'localhost']  # 修改</span><br><span class="line">STATIC_URL = '/static/' # 原始</span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, 'static/') # 添加</span><br></pre></td></tr></table></figure><h3 id="数据库迁移">数据库迁移</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建数据库和超级管理员</span></span><br><span class="line">(CCO) $ ./manage.py makemigrations</span><br><span class="line">(CCO) $ ./manage.py migrate</span><br><span class="line">(CCO) $ ./manage.py createsuperuser # 创建超级管理员</span><br></pre></td></tr></table></figure><h3 id="静态文件收集">静态文件收集</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(CCO) $ ./manage.py collectstatic # 收集静态文件</span><br></pre></td></tr></table></figure><h3 id="本地开发环境">本地开发环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 用django自带服务器运行</span><br><span class="line">(CCO) $ sudo ufw allow 8000 # 关闭防火墙</span><br><span class="line">(CCO) $ ./manage.py runserver 0.0.0.0:8000 # 成功表示django开发环境配置完成</span><br></pre></td></tr></table></figure><h3 id="apache线上部署">Apache线上部署</h3><p>安装apache模块 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Python 2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libapache2-mod-wsgi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Python 3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libapache2-mod-wsgi-py3</span></span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">apache虚拟主机配置</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/apache2/sites-available/www.cco.com.conf</span></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ServerName www.example.com</span><br><span class="line">        ServerAdmin webmaster@localhost</span><br><span class="line">         # 这里指明静态文件存放的地方</span><br><span class="line">    Alias /static  /home/hanchang/www/html/CCO/CCO_WEB/static</span><br><span class="line">    # 给文件夹分配权限</span><br><span class="line">    &lt;Directory /home/hanchang/www/html/CCO/CCO_WEB/static&gt;</span><br><span class="line">            Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">    #接下来，我们将授予访问存储Django代码的二级项目目录中的wsgi.py文件的权限。</span><br><span class="line">    &lt;Directory /home/hanchang/www/html/CCO/CCO_WEB/CCO_WEB&gt;</span><br><span class="line">    &lt;Files wsgi.py&gt;</span><br><span class="line">            Require all granted</span><br><span class="line">    &lt;/Files&gt;</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">        WSGIDaemonProcess CCO_WEB python-home=/home/hanchang/www/html/CCO/CCO_WEB/CCO_WEB python-path=/home/hanchang/www/html/CCO</span><br><span class="line">    WSGIProcessGroup CCO_WEB</span><br><span class="line">    WSGIScriptAlias / /home/hanchang/www/html/CCO/CCO_WEB/CCO_WEB/wsgi.py</span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 线上</span></span></span><br><span class="line">sudo a2ensite www.cco.com</span><br><span class="line">sudo service apache2 restart</span><br><span class="line">http://127.0.0.1 查看</span><br></pre></td></tr></table></figure><p><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-apache-and-mod_wsgi-on-ubuntu-16-04" target="_blank" rel="noopener">原文查看</a></p><p>### 守护进程</p><p><a href="/2016/11/10/CentOs7.2服务器基础配置/" title="CentOs7.2服务器基础配置">CentOs7.2服务器基础配置</a> Supervisor部分</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql主从复制</title>
      <link href="/2016/11/09/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
      <url>/2016/11/09/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="测试环境">测试环境</h3><p>主服务器<br>192.168.0.160 mysql 5.6.17 win2008R2<br>从服务器<br>192.168.0.206 mysql 5.6.12 win2003</p><h3 id="主服务器创建数据库test1-test2">主服务器创建数据库test1, test2</h3><pre><code>mysql&gt;CREATE DATABASE `test1` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;     mysql&gt;USE test1mysql&gt;CREATE TABLE `test1`.`user` ( `id` INT(10) NOT NULL AUTO_INCREMENT , `name` VARCHAR(100) NOT NULL , PRIMARY KEY (`id`)) ENGINE = MyISAM;  mysql&gt;INSERT INTO `user` (`id`, `name`) VALUES (NULL, &#39;user1&#39;), (NULL, &#39;user2&#39;)mysql&gt;CREATE DATABASE `test2` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;    mysql&gt;USE test2mysql&gt;CREATE TABLE `test2`.`user` ( `id` INT(10) NOT NULL AUTO_INCREMENT , `name` VARCHAR(100) NOT NULL , PRIMARY KEY (`id`)) ENGINE = MyISAM;  mysql&gt;INSERT INTO `user` (`id`, `name`) VALUES (NULL, &#39;user1&#39;), (NULL, &#39;user2&#39;)</code></pre><h3 id="将test1test2-复制到从服务器上">将test1,test2 复制到从服务器上</h3><pre><code>mysql&gt;CREATE DATABASE `test1` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;     mysql&gt;USE test1  mysql&gt;set names utf8;  mysql&gt;source c:/test1.sql;mysql&gt;CREATE DATABASE `test2` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;     mysql&gt;USE test2  mysql&gt;set names utf8;  mysql&gt;source c:/test2.sql;</code></pre><h3 id="主服务器配置">主服务器配置</h3><p>编辑配置文件my.ini</p><pre><code>[mysqld] server-id=1     # 配一个唯一的ID编号，1至32  log-bin=mysql-bin  # 二进制文件存放路径  binlog-do-db=test1  # 需要同步的数据库名  binlog-ignore-db=test2  # 不需要同步的数据库名</code></pre><p>重启mysql并重新登陆，创建授权用户</p><pre><code>mysql&gt;grant REPLICATION SLAVE,RELOAD,SUPER on *.* to slave@192.168.0.206 identified by &#39;123456&#39; ;  mysql&gt;grant REPLICATION SLAVE,RELOAD,SUPER on *.* to slave1@192.168.0.118 identified by &#39;123456&#39; ; # 如果是多从mysql&gt;flush privileges;     mysql&gt;show master status;  # 找到File 和 Position 的值记录下来    </code></pre><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160401152254.png"></p><h3 id="从服务器配置192.168.0.206">从服务器配置192.168.0.206</h3><p>编辑配置文件my.ini添加</p><pre><code>[mysqld]server-id=2     #唯一replicate-do-db=test1replicate-ignore-db=test2</code></pre><p>重启数据库并重新登陆</p><pre><code>mysql&gt;mysql -uroot -p  mysql&gt;change master to master_host=&#39;192.168.0.160&#39;,master_user=&#39;slave&#39;,master_password=&#39;123456&#39;, master_log_file=&#39;mysql-bin.000001&#39;,master_log_pos=199;  mysql&gt;start slave;mysql&gt;show slave status\G</code></pre><p>结果出现一下内容表示成功</p><pre><code>Slave_IO_Running: YesSlave_SQL_Running: Yes</code></pre><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160401152538.png"> 多从，另一个从服务器配置192.168.0.118<br>编辑配置文件my.ini添加</p><pre><code>[mysqld]server-id=3     #唯一，注意和其他的从服务器不一致replicate-do-db=test1replicate-ignore-db=test2</code></pre><p>重启mysql并重新登陆，创建授权用户</p><pre><code>mysql&gt;change master to master_host=&#39;192.168.0.160&#39;,master_user=&#39;slave1&#39;,master_password=&#39;123456&#39;, master_log_file=&#39;mysql-bin.000001&#39;,master_log_pos=199;  mysql&gt;start slave;mysql&gt;show slave status\G    </code></pre><h3 id="最后测试">最后测试</h3><p>在主服务器添加表和数据，可以看到从服务器数据库已经修改。<br>重启主从数据库，依然可以正常同步。</p><h3 id="错误处理办法">错误处理办法</h3><p>连接不上master：<br>1，密码是否正确，是否给予权限<br>2，防火墙是否开启3306端口 配置的时候注意锁表</p><pre><code>LOCK TABLESUNLOCK TABLES;</code></pre><p>错误提示 Got fatal error 1236 from master when reading data from binary log: 'Slave can not handle replication events with the checksum that master is configured to log; the first event 'mysql-bin.000002' at 120, the last event read from './mysql-bin.000002' at 120, the last byte read from './mysql-bin.000002' at 120 由于主库是5.6, 从库是5.5.<br>5.6的版本中加入了replication event checksum，主从复制时间校验功能，所以需要把这个关掉才能正常同步到5.5的slave 修改主库</p><pre><code>sudo vim /etc/my.cnfbinlog_checksum=none</code></pre><p>重新配置主从即可</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql入门基础</title>
      <link href="/2016/11/09/Mysql%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Mysql%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="安装mysql">安装mysql</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ubuntu16.04</span><br><span class="line">sudo apt-get install mysql-server</span><br><span class="line">sudo apt install mysql-client  # 服务器端不需要</span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><h1 id="查看mysql版本信息">查看mysql版本信息</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql --version  </span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">'%version_%'</span>;</span></span><br></pre></td></tr></table></figure><h1 id="数据库创建备份导入命令">数据库创建备份导入命令</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 创建数据库  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`test`</span> <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;  </span><br><span class="line"></span><br><span class="line">// 删除数据库  </span><br><span class="line"> <span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`test`</span>; </span><br><span class="line"></span><br><span class="line">// 创建表  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>(<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,<span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>)<span class="keyword">DEFAULT</span> <span class="keyword">charset</span>=utf8;  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 重置自增字段</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`tableName`</span> AUTO_INCREMENT = <span class="number">1</span>; </span><br><span class="line">或者</span><br><span class="line"><span class="keyword">truncate</span> tableName; </span><br><span class="line"></span><br><span class="line">// 删除表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>;</span><br><span class="line">    </span><br><span class="line">// 删除表内容，保留表结构  </span><br><span class="line">mysql&gt; TRUNCATE TABLE `tabel_name`;</span><br><span class="line">    </span><br><span class="line">// 删除表并重置主键，不会留下日志，相当于删除表并重建    </span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="string">`animal_cell_attribute`</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 导出一个数据库    </span><br><span class="line">mysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名.sql   </span><br><span class="line">mysqldump -u root -p uscnerp &gt; uscnerp.sql    </span><br><span class="line">Enter password:  </span><br><span class="line">    </span><br><span class="line">// 导出一张表</span><br><span class="line">mysqldump -u 用户名 -p 数据库名 表名 &gt; 导出的文件名.sql  </span><br><span class="line">mysqldump -u root -p animal animal_service &gt; animal_service.sql</span><br><span class="line">Enter password: **********  </span><br><span class="line">    </span><br><span class="line">// 导出多个数据库</span><br><span class="line">mysqldump  -uroot -p --databases test mysql #空格分隔</span><br><span class="line">    </span><br><span class="line">// 导出到excel表格</span><br><span class="line">mysql   -uroot   -p   -e   "select   *   from   test.table2 "   &gt;   d:a.xsl</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 导入数据库  </span><br><span class="line"></span><br><span class="line">mysql&gt;use 数据库  </span><br><span class="line">mysql&gt;set names utf8; （先确认编码，如果不设置可能会出现乱码，注意不是UTF-8）   </span><br><span class="line">mysql&gt;source d:\wcnc_db.sql</span><br></pre></td></tr></table></figure><h1 id="查看表">查看表</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查看表结构</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><h1 id="配置用户权限">配置用户权限</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置root密码并查看所有用户权限</span></span><br><span class="line"> mysql&gt; use mysql;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; UPDATE user SET Password = PASSWORD('newpassword') WHERE user = 'root';</span><br><span class="line">Query OK, 3 rows affected (0.02 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT Host,User,Password FROM mysql.user;</span><br><span class="line">+<span class="comment">-----------+--------+-------------------------------------------+</span></span><br><span class="line">| Host      | User   | Password                                  |</span><br><span class="line">+<span class="comment">-----------+--------+-------------------------------------------+</span></span><br><span class="line">| localhost | root   | *2ED3112AFECE04CEE0AA42619AB00D4498BA3342 |</span><br><span class="line">| 127.0.0.1 | root   | *2ED3112AFECE04CEE0AA42619AB00D4498BA3342 |</span><br><span class="line">| ::1       | root   | *2ED3112AFECE04CEE0AA42619AB00D4498BA3342 |</span><br><span class="line">| localhost |        |                                           |</span><br><span class="line">| localhost | animal | *CC87B1E39E699B64E0B80741B5D1991BC5BE57AC |</span><br><span class="line">+<span class="comment">-----------+--------+-------------------------------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">// 查看全部用户</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">CONCAT</span>(<span class="string">'User: '''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>) <span class="keyword">AS</span> <span class="keyword">query</span> <span class="keyword">FROM</span> mysql.user;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">// 创建用户</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> username@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br><span class="line">&gt; username:用户名  </span><br><span class="line">&gt; @localhost：表示用户只能在本地访问  </span><br><span class="line">&gt; password:密码</span><br><span class="line"></span><br><span class="line">// 配置权限</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">INSERT</span>,<span class="keyword">UPDATE</span> <span class="keyword">ON</span> database.* <span class="keyword">TO</span> username@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;  </span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="keyword">user</span>;@localhost </span><br><span class="line">// <span class="keyword">GRANT</span> 权限名称 <span class="keyword">ON</span> 数据库.数据表 <span class="keyword">TO</span> 用户名@访问地址 <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'密码'</span>;</span><br><span class="line">    </span><br><span class="line">// 刷新权限列表</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line">    </span><br><span class="line">// 配置备份用户权限</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'backuper'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'PASSWORD'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, RELOAD, PROCESS, <span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>, SUPER, <span class="keyword">LOCK</span> <span class="keyword">TABLES</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">EVENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'backuper'</span>@<span class="string">'localhost'</span>;</span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br><span class="line"></span><br><span class="line">// 开启慢查询日志</span><br><span class="line">```bash </span><br><span class="line">sudo vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># slow_query_log</span></span><br><span class="line">slow_query_log=on</span><br><span class="line">slow-query-log-file=/var/log/mysql/slow.log <span class="comment"># 保证此文件属于mysql用户，mysql组，并可写权限</span></span><br><span class="line">long_query_time=1 <span class="comment"># 超过1秒写入慢查询日志</span></span><br><span class="line">log-queries-not-using-indexes</span><br><span class="line">    </span><br><span class="line">// 查看是否开启mysql慢查询日志</span><br><span class="line">&gt;mysql show variables like "slow_query_log";</span><br><span class="line"></span><br><span class="line">// 设置密码过期时间</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> default_password_lifetime = <span class="number">0</span>;  // 全局用户永不过期</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">'root'</span>@<span class="string">'localhost'</span> <span class="keyword">PASSWORD</span> <span class="keyword">EXPIRE</span> <span class="keyword">NEVER</span>;  // 单个用户用户过期</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">'root'</span>@<span class="string">'localhost'</span> <span class="keyword">PASSWORD</span> <span class="keyword">EXPIRE</span> <span class="built_in">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;  // 单个用户</span><br></pre></td></tr></table></figure><h1 id="window服务器下自动备份">window服务器下自动备份</h1><h2 id="编写脚本">编写脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rem *******************************Code Start*****************************</span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">    </span><br><span class="line"><span class="built_in">set</span> <span class="string">"Ymd=%date:~,4%%date:~5,2%%date:~8,2%"</span></span><br><span class="line">mysqldump --opt -u root --password=abcdefg database &gt; F:\FTP\BackupMysql\database_%Ymd%.sql</span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line">rem *******************************Code End*****************************</span><br></pre></td></tr></table></figure><h2 id="定时任务">定时任务</h2><p>注意在操作中填写脚本并在起始于写入脚本所在盘符E:<br></p><h2 id="删除mysql">删除mysql</h2><blockquote><p>在服务里找到mysql服务，停止使用<br>控制面板中卸载mysql 注册表文件删除： HKEY_LOCAL_MACHINE/SYSTEM/ControlSet001/Services/Eventlog/Application/MySQL 目录删除; HKEY_LOCAL_MACHINE/SYSTEM/ControlSet002/Services/Eventlog/Application/MySQL 目录删除; HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/Eventlog/Application/MySQL 目录删除; 在硬盘和注册表中搜索mysql并删除掉</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rsync同步web服务器</title>
      <link href="/2016/11/09/Rsync%E5%90%8C%E6%AD%A5web%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2016/11/09/Rsync%E5%90%8C%E6%AD%A5web%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="测试环境">测试环境</h3><p>服务端安装 WIN2008R2 ip:192.168.0.160<br>客户端安装 WIN2003 ip:192.168.0.206</p><h3 id="程序下载">程序下载</h3><p>新版已经开始收费，这里使用旧版4.0.5,百度网盘下载http://pan.baidu.com/s/1kTNyk1h</p><h3 id="服务端安装">服务端安装</h3><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/cwrsync.png"> 一路直接下一步，这里会创建一个用户，创建的默认密码可以不需要修改，直接下一步。 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/cwrsync1.png"> 创建的用户 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/cwrsync2.png"> 创建的服务改为自动启动</p><h3 id="客户端安装">客户端安装</h3><p>一路下一步直到完成。</p><h3 id="配置服务端">配置服务端</h3><pre><code>use chroot = false# 不验证用户密码strict modes = falselock file = rsyncd.lock hosts allow = 192.168.0.206max connections = 5# 默认端口port = 873# 指定匿名访问uid = 0gid = 0log file = rsyncd.log# Module definitions# Remember cygwin naming conventions : c:\work becomes /cygdrive/c/work[web]path = /cygdrive/C/WEB# 下面两行是配置用户名密码的# auth users = dbbackuper# secrets file = /cygdrive/e/Setting/Rsync/rsync_db.ps# 只允许客户端下载，不允许客户端上传read only = truetransfer logging = yes</code></pre><p>防火墙设置允许配置的端口通过<br>查看端口配置是否错误</p><pre><code>telnet 192.168.0.160 873  @RSYNCD: 30.0</code></pre><p>服务器端配置测试文件目录 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/cwrsync3.png"> 其中targetDir为联接文件</p><pre><code>C:\&gt;mklink /J WEB\targetDir\ source\为 WEB\targetDir\ &lt;&lt;===&gt;&gt; source\ 创建的联接</code></pre><h3 id="配置客户端">配置客户端</h3><p>在安装目录下使用如下命令</p><pre><code>C:\Program Files\cwRsync\bin&gt;rsync --port=873 -vzrtopg --progress --delete 192.168.0.160::web /cygdrive/C/WEBreceiving incremental file listskipping non-regular file &quot;targetDir&quot;./TEST4/test3/sent 39 bytes  received 163 bytes  134.67 bytes/sectotal size is 19  speedup is 0.09</code></pre><p>查看客户端文件目录</p><pre><code>test3TEST4</code></pre><p>提示skipping non-regular file 'targetDir'忽略软链接解决办法<br>参数-L:--copy-links 像对待常规文件一样处理软链结</p><pre><code>C:\Program Files\cwRsync\bin&gt;rsync --port=873 -vzrtopgL --progress --delete 192.168.0.160::web /cygdrive/C/WEBreceiving incremental file listdeleting test5/adda.txtdeleting test5/./TEST4/targetDir/targetDir/HAFA/targetDir/pdf/targetDir/pdf/TARGE.txt           0 100%    0.00kB/s    0:00:00 (xfer#1, to-check=1/8)test3/sent 70 bytes  received 272 bytes  97.71 bytes/sectotal size is 0  speedup is 0.00</code></pre><h3 id="实现客户端定时任务">实现客户端定时任务</h3><p>1，要添加环境变量到系统中<br>2，上传脚本文件到客户端sync_client.bat</p><pre><code>rsync --port=873 -vzrtopgL --progress --delete 192.168.0.160::web /cygdrive/C/WEB</code></pre><p>3,在系统中添加定时任务，并指定更新时间</p><h3 id="具体参数详解">具体参数详解</h3><p>rsync参数的具体解释如下： -v, --verbose 详细模式输出<br>-q, --quiet 精简输出模式<br>-c, --checksum 打开校验开关，强制对文件传输进行校验<br>-a, --archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD<br>-r, --recursive 对子目录以递归模式处理<br>-R, --relative 使用相对路径信息<br>-b, --backup 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用--suffix选项来指定不同的备份文件前缀。<br>--backup-dir 将备份文件(如~filename)存放在在目录下。<br>-suffix=SUFFIX 定义备份文件前缀<br>-u, --update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。(不覆盖更新的文件)<br>-l, --links 保留软链结<br>-L, --copy-links 想对待常规文件一样处理软链结<br>--copy-unsafe-links 仅仅拷贝指向SRC路径目录树以外的链结<br>--safe-links 忽略指向SRC路径目录树以外的链结<br>-H, --hard-links 保留硬链结<br>-p, --perms 保持文件权限<br>-o, --owner 保持文件属主信息<br>-g, --group 保持文件属组信息<br>-D, --devices 保持设备文件信息<br>-t, --times 保持文件时间信息<br>-S, --sparse 对稀疏文件进行特殊处理以节省DST的空间<br>-n, --dry-run现实哪些文件将被传输<br>-W, --whole-file 拷贝文件，不进行增量检测<br>-x, --one-file-system 不要跨越文件系统边界<br>-B, --block-size=SIZE 检验算法使用的块尺寸，默认是700字节<br>-e, --rsh=COMMAND 指定使用rsh、ssh方式进行数据同步<br>--rsync-path=PATH 指定远程服务器上的rsync命令所在路径信息<br>-C, --cvs-exclude 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件<br>--existing 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件<br>--delete 删除那些DST中SRC没有的文件<br>--delete-excluded 同样删除接收端那些被该选项指定排除的文件<br>--delete-after 传输结束以后再删除<br>--ignore-errors 及时出现IO错误也进行删除<br>--max-delete=NUM 最多删除NUM个文件<br>--partial 保留那些因故没有完全传输的文件，以是加快随后的再次传输<br>--force 强制删除目录，即使不为空<br>--numeric-ids 不将数字的用户和组ID匹配为用户名和组名<br>--timeout=TIME IP超时时间，单位为秒<br>-I, --ignore-times 不跳过那些有同样的时间和长度的文件<br>--size-only 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间<br>--modify-window=NUM 决定文件是否时间相同时使用的时间戳窗口，默认为0<br>-T --temp-dir=DIR 在DIR中创建临时文件<br>--compare-dest=DIR 同样比较DIR中的文件来决定是否需要备份<br>-P 等同于 --partial<br>--progress 显示备份过程<br>-z, --compress 对备份的文件在传输时进行压缩处理<br>--exclude=PATTERN 指定排除不需要传输的文件模式<br>--include=PATTERN 指定不排除而需要传输的文件模式<br>--exclude-from=FILE 排除FILE中指定模式的文件<br>--include-from=FILE 不排除FILE指定模式匹配的文件<br>--version 打印版本信息<br>--address 绑定到特定的地址<br>--config=FILE 指定其他的配置文件，不使用默认的rsyncd.conf文件<br>--port=PORT 指定其他的rsync服务端口<br>--blocking-io 对远程shell使用阻塞IO<br>-stats 给出某些文件的传输状态<br>--progress 在传输时现实传输过程<br>--log-format=formAT 指定日志文件格式<br>--password-file=FILE 从FILE中得到密码<br>--bwlimit=KBPS 限制I/O带宽，KBytes per second<br>-h, --help 显示帮助信息</p><h3 id="部分错误的解决办法">部分错误的解决办法</h3><p>1.'rsync' 不是内部或外部命令，也不是可运行的程序或批处理文件。<br>加环境变量 path = C:\Program Files (x86)\cwRsync\bin 2.rsync: failed to connect to 192.168.1.82: Connection timed out (116) rsync error: error in socket IO (code 10) at clientserver.c(122) [Receiver=3.0.7]<br>网络通畅，服务器端允许访问端口 873 3.@ERROR: invalid uid nobody<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>指定uid gid<br>uid = 0<br>gid = 0 4.@ERROR: chdir failed<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>path目录配置的正确，得存在<br>解决：服务器端同步目录没有权限，cwrsync默认用户是Svcwrsync。为同步目录添加用户Svcwrsync权限。<br>也可以通过 菜单--cwRsyncServer--02. Prep a Dir for Upload 配置目录权限 除完全控制和特殊权限外的所有权限 5.@ERROR: auth failed on module test<br>rsync error: error starting client-server protocol (code 5) at main.c(1506) [Receiver=3.0.7]<br>客户端设置<br>a.在命令上要指定好用户名<br>b.密码文件只写密码<br>rsyncd.secrets文件<br>rsyncpass<br>c.用户名密码都要正确 6.Unexpected local arg: /cygdrive/d/rsyncBackup<br>If arg is a remote file/dir, prefix it with a colon (:).<br>rsync error: syntax or usage error (code 1) at main.c(1218) [Receiver=3.0.7]<br>不一定是这个路径有问题，可能是--password-file路径中有空格，服务器端没问题，客户端好像不行 7.password file must be owned by root when running as root<br>continuing without password file<br>Password:<br>设置密码访问权限chown.exe可从服务器端拷贝过来<br>chmod -c 600 /cygdrive/c/etc/rsyncd.secrets<br>chown administrator /cygdrive/c/etc/rsyncd.secrets<br>服务器端不设也可以 8.当出现rsync: chown “” failed: Invalid argument (22)错误时，是因为参数中有o，即保留文件的owner信息，而window服务端无法完成chown操作，解决办法是去掉参数o。另外有些可能还会出现rsync: chgrp “” failed: Invalid argument (22)，原因类似，只要去掉参数中的g即可。</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux开发环境常用软件</title>
      <link href="/2016/11/09/Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/"/>
      <url>/2016/11/09/Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="显示电脑硬件信息">显示电脑硬件信息</h1><pre><code>$ sudo add-apt-repository ppa:dawidd0811/neofetch$ sudo apt-get update$ sudo apt-get install neofetchneofetch</code></pre><h1 id="安装独立显卡驱动">安装独立显卡驱动</h1><p>https://blog.csdn.net/ghw15221836342/article/details/79571559</p><pre><code># 驱动版本查询   https://www.nvidia.com/Download/index.aspx?lang=en-us# 安装sudo add-apt-repository ppa:graphics-drivers/ppa  sudo apt-get update  sudo apt-get install nvidia-390 #此处要根据上面查询到的版本适当更改sudo apt-get install mesa-common-dev  sudo apt-get install freeglut3-de# 测试nvidia-smi  #若出现电脑GPU列表，即安装成功或者nvidia-settings #显示你的显卡信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # Chrome浏览器</span><br><span class="line">    下载地址 [百度云盘](http://pan.baidu.com/s/1hq0Nom4)</span><br><span class="line">    </span><br><span class="line">    # 配置SS</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line">==</span><br><span class="line"></span><br><span class="line">apt-get install python-pip pip install s\_h\_a\_d\_o\_w\_s\_o\_c\_k\_s</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">==</span><br><span class="line"></span><br><span class="line">sslocal -s server\_ip -p server\_port -l 1080 -k password -t 600 -m aes-256-cfb</span><br><span class="line"></span><br><span class="line">简写</span><br><span class="line">==</span><br><span class="line"></span><br><span class="line">sslocal -s ip -p port -k &quot;password&quot;</span><br><span class="line"></span><br><span class="line">    开机启动配置  </span><br><span class="line">    在/home下新建文件ss.sh脚本</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">#!/bin/bash #文件名:ss.sh sslocal -s ip -p port -k &quot;password&quot;</span><br><span class="line"></span><br><span class="line">    编辑开机启动文件</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">sudo vim /etc/rc.local</span><br></pre></td></tr></table></figure># 最后加入以下内容nohup bash /home/ss.sh&gt;/home/ss.txt &amp;</code></pre><p>代理设置</p><pre><code>service： 127.0.0.1port ： 1080type： socks5</code></pre><h1 id="配置proxychains">配置proxychains</h1><pre><code># 安装sudo apt install proxychainssudo vim /etc/proxychains.conf~ socks5 127.0.0.1 1080  # 最后一行加入socks代理# 测试proxychains wget https://www.google.com</code></pre><h1 id="wine-qq现在推荐docker安装qq">wine qq（现在推荐docker安装qq）</h1><p>安装wine1.7以上版本<br>安装WineQQ7.8-20151109-Longene.deb版本<br>下载<a href="https://pan.baidu.com/s/1bpLn0vl" target="_blank" rel="noopener">网盘</a></p><h1 id="elinks-纯文本浏览器">elinks 纯文本浏览器</h1><pre><code>sudo apt-get install elinks   # 安装elinks www.zhuohc.com  # 使用</code></pre><h1 id="unzip-zip">unzip / zip</h1><p>解决中文乱码</p><pre><code>unzip -O CP936 xxx.zip</code></pre><p>解压到指定目录</p><pre><code>unzip -O xxx.zip -d xxx/</code></pre><p>压缩文件</p><pre><code>zip -r yasuo.zip abc.txt dir1</code></pre><h1 id="wps-office办公">wps office办公</h1><p>显示字体确实错误 <a href="https://pan.baidu.com/s/1bpLn0vl" target="_blank" rel="noopener">下载字体</a><br>将字体复制到linux字体中</p><pre><code>sudo cp * /usr/share/fonts</code></pre><p>生成字体索引信息</p><pre><code>sudo mkfontscalesudo mkfontdir</code></pre><p>更新字体缓存</p><pre><code>sudo fc-cache</code></pre><p>中文无法输入</p><pre><code>$ vi /usr/bin/wps  # word文档#!/bin/bashexport XMODIFIERS=&quot;@im=fcitx&quot;  # 添加的内容  export QT_IM_MODULE=&quot;fcitx&quot;     # 添加的内容    gOpt=#gOptExt=-multiplygTemplateExt=(&quot;wpt&quot; &quot;dot&quot; &quot;dotx&quot;)$ vi /usr/bin/et   # excel表格#!/bin/bashexport XMODIFIERS=&quot;@im=fcitx&quot;  # 添加的内容  export QT_IM_MODULE=&quot;fcitx&quot;  # 添加的内容  gOpt=#gOptExt=-multiply</code></pre><h1 id="输入法">输入法</h1><p>系统自带或者sougou输入法 ， 倬彼昊天系列皮肤</p><h1 id="截屏">截屏</h1><p>系统设置&gt;键盘&gt;自定义快捷键&gt;+&gt;<br>名称填screenshot<br>命令</p><pre><code>gnome-screenshot -a</code></pre><p>在disabled修改快捷键</p><h1 id="下载">下载</h1><p>安装uget</p><pre><code>sudo add-apt-repository ppa:plushuang-tw/uget-stable sudo apt-get update sudo apt-get install uget</code></pre><p>安装aria2</p><pre><code>sudo add-apt-repository ppa:t-tujikawa/ppa sudo apt-get update sudo apt-get install aria2</code></pre><p>在uget gui里编辑插件，选择aria2</p><h1 id="美化监视工具">美化监视工具</h1><pre><code> sudo apt-get install conky   sudo add-apt-repository ppa:teejee2008/ppa sudo apt-get update sudo apt-get install conky-manager <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">显示桌面会自动隐藏conky的<span class="keyword">bug解决办法: </span> </span><br><span class="line">编辑配置文件</span><br></pre></td></tr></table></figure> # own_window_type normalown_window_type desktop</code></pre><p># 快速搜索文件</p><pre><code>sudo add-apt-repository ppa:synapse-core/testingsudo apt-get updatesudo apt-get install synapse  </code></pre><h1 id="卸载synapse">卸载synapse</h1><pre><code>sudo apt-get remove synapse</code></pre><h1 id="移除ppa">移除PPA</h1><pre><code>sudo apt-get install ppa-purgesudo ppa-purge ppa:synapse-core/testing</code></pre><h1 id="安装oh-my-zsh">安装oh-my-zsh</h1><pre><code># https://github.com/robbyrussell/oh-my-zsh$ sudo apt-get install git$ sudo apt-get install zsh$ sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;$ chsh -s /bin/zsh # 更改默认bash//或:$ chsh -s `which zsh`$ sudo reboot</code></pre><h1 id="terminator-终端管理软件">terminator 终端管理软件</h1><p>安装</p><pre><code>sudo add-apt-repository ppa:gnome-terminatorsudo apt-get updatesudo apt-get install terminator</code></pre><p>基本设置方法</p><blockquote><p>右键点击终端任意区域，选择首选项</p></blockquote><p>设置<a href="https://github.com/ghuntley/terminator-solarized" target="_blank" rel="noopener">solarized</a>配色（<a href="http://blog.codinglabs.org/articles/getting-started-with-ubuntu.html" target="_blank" rel="noopener">参考</a>）</p><pre><code>cd ~/.config/terminator  vim config</code></pre><p>覆盖以下内容</p><pre><code>[global_config]    title_transmit_bg_color = &quot;#d30102&quot;    focus = system    suppress_multiple_term_dialog = True[keybindings][profiles]    [[default]]        palette = &quot;#073642:#dc322f:#859900:#b58900:#268bd2:#d33682:#2aa198:#eee8d5:#002b36:#cb4b16:#586e75:#657b83:#839496:#6c71c4:#93a1a1:#fdf6e3&quot;        copy_on_selection = True        background_image = None        background_darkness = 0.95        background_type = transparent        use_system_font = False        cursor_color = &quot;#eee8d5&quot;        foreground_color = &quot;#839496&quot;        show_titlebar = False        font = Monospace 11        background_color = &quot;#002b36&quot;    [[solarized-dark]]        palette = &quot;#073642:#dc322f:#859900:#b58900:#268bd2:#d33682:#2aa198:#eee8d5:#002b36:#cb4b16:#586e75:#657b83:#839496:#6c71c4:#93a1a1:#fdf6e3&quot;        background_color = &quot;#002b36&quot;        background_image = None        cursor_color = &quot;#eee8d5&quot;        foreground_color = &quot;#839496&quot;    [[solarized-light]]        palette = &quot;#073642:#dc322f:#859900:#b58900:#268bd2:#d33682:#2aa198:#eee8d5:#002b36:#cb4b16:#586e75:#657b83:#839496:#6c71c4:#93a1a1:#fdf6e3&quot;        background_color = &quot;#fdf6e3&quot;        background_image = None        cursor_color = &quot;#002b36&quot;        foreground_color = &quot;#657b83&quot;[layouts]    [[default]]        [[[child1]]]            type = Terminal            parent = window0            profile = default        [[[window0]]]            type = Window            parent = &quot;&quot;[plugins]</code></pre><p>以上配置后会修改配色方案，但是没有bright色<br><a href="https://github.com/seebi/dircolors-solarized" target="_blank" rel="noopener">dircolors-solarized</a>项目提供了适合于solarized的dircolors配色方案，只要选择合适的方案使用就可以了。</p><pre><code>curl https://raw.github.com/seebi/dircolors-solarized/master/dircolors.ansi-dark &gt; ~/.dircolors</code></pre><p>然后在~/.bashrc中加入如下配置：</p><pre><code># enable color support of ls and also add handy aliasesif [ -x /usr/bin/dircolors ]; then    test -r ~/.dircolors &amp;&amp; eval &quot;$(dircolors -b ~/.dircolors)&quot; || eval &quot;$(dircolors -b)&quot;    alias ls=&#39;ls --color=auto&#39;    #alias dir=&#39;dir --color=auto&#39;    #alias vdir=&#39;vdir --color=auto&#39;    alias grep=&#39;grep --color=auto&#39;    alias fgrep=&#39;fgrep --color=auto&#39;    alias egrep=&#39;egrep --color=auto&#39;fi# some more ls aliasesalias ll=&#39;ls -alF&#39;alias la=&#39;ls -A&#39;alias l=&#39;ls -CF&#39;</code></pre><p>执行</p><pre><code>source ~/.bashrc</code></pre><h1 id="tmux配合terminator使用">tmux配合terminator使用</h1><p>安装</p><pre><code>sudo apt-get install tmux</code></pre><p>配置</p><pre><code>touch .tmux.conf</code></pre><p>配置内容和使用方法</p><pre><code># 设置前缀为Ctrl + xset -g prefix C-x# 解除Ctrl+b 与前缀的对应关系unbind C-b# 将r 设置为加载配置文件，并显示&quot;reloaded!&quot;信息bind r source-file ~/.tmux.conf \; display &quot;Reloaded!&quot;# copy-mode 将快捷键设置为vi 模式setw -g mode-keys vi# tmux-powerline设置set-option -g status onset-option -g status-interval 2set-option -g status-utf8 onset-option -g status-justify &quot;centre&quot;set-option -g status-left-length 60set-option -g status-right-length 90set-option -g status-left &quot;#(~/.tmux/tmux-powerline/powerline.sh left)&quot;set-option -g status-right &quot;#(~/.tmux/tmux-powerline/powerline.sh right)&quot;# 将窗口列表换成 powerline的风格set-window-option -g window-status-current-format &quot;#[fg=colour235, bg=colour27]⮀#[fg=colour255, bg=colour27] #I ⮁ #W #[fg=colour27, bg=colour235]⮀&quot;# 设置默认bashset-option -g default-shell /bin/zsh########## 复制模式  ########### copy mode 复制模式# &#39;prefix +  [ &#39;进入复制模式# 按space 开始复制# Enter退出复制模式</code></pre><p>需要安装powerline插件</p><pre><code>https://github.com/erikw/tmux-powerline</code></pre><p>显示日期的星期</p><pre><code>vim data_day.sh # date +&quot;%a&quot;改成大写 date +&quot;%A&quot;</code></pre><p>powerline字体安装查看 http://powerline.readthedocs.io/en/latest/installation/linux.html 在terminator配置自动启动turm</p><pre><code>首选项-&gt;配置&gt;命令&gt;自定义命令   ([[ -f &quot;$TMUX&quot; ]] &amp;&amp; tmux -2 -S $TMUX) || (TMUX=&quot;&quot; tmux -2)</code></pre><p>自动部署多窗口任务</p><pre><code>touch ~/development.startchmod +x development.starttmux has-session -t developmentif [ $? != 0 ]then    tmux new-session -s development -n editor -d    tmux send-keys -t development &#39;vim&#39; C-m    tmux split-window -v -t development    tmux select-layout -t development main-horizontal    tmux new-window -n bash -t development    tmux new-window -n ssh -t development    tmux new-window -n mysql -t development    tmux new-window -n front-end -t development    tmux select-window -t development:1fitmux attach -t development</code></pre><p>执行文件</p><pre><code>~/development.start</code></pre><h1 id="visual-studio-code">Visual Studio Code</h1><p>通过官方PPA来安装Ubuntu Make</p><pre><code>sudo add-apt-repository ppa:ubuntu-desktop/ubuntu-makesudo apt-get updatesudo apt-get install ubuntu-make</code></pre><p>安装Ubuntu Make完后，接着使用下列命令安装Visual Studio Code</p><pre><code>umake web visual-studio-code</code></pre><p>卸载命令</p><pre><code>umake web visual-studio-code --remove</code></pre><h1 id="wine">wine</h1><p>卸载wineqq</p><pre><code>sudo dpkg -l | grep qq  # 找到安装包名称   sudo dpkg -r wine-qq7.8-longeneteam # 卸载</code></pre><h1 id="curl-http请求">curl http请求</h1><pre><code>curl &quot;http://www.baidu.com&quot; # 如果这里的URL指向的是一个文件或者一幅图都可以直接下载到本地  curl -i &quot;http://www.baidu.com&quot; # 显示全部信息  curl -l &quot;http://www.baidu.com&quot; # 只显示头部信息  curl -v &quot;http://www.baidu.com&quot; # 显示get请求全过程解析    curl -d &quot;param1=value1¶m2=value2&quot; &quot;http://www.baidu.com&quot; # post请求  </code></pre><h1 id="安卓虚拟机genymotion">安卓虚拟机genymotion</h1><p>前提必须安装virtualBox<br>下载地址: https://www.genymotion.com/download/<br>需要先注册,下载后执行</p><pre><code>chmod +x genymotion-2.2.2_x64.bin./genymotion-2.2.2_x64.bin -d /home/user</code></pre><p>执行home/user/genymotion/genymotion</p><h1 id="安装为知笔记">安装为知笔记</h1><p>简易版本</p><pre><code>http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/pool/main/w/wiznote/</code></pre><p>编译安装</p><pre><code>http://www.wiz.cn/compile-client.html</code></pre><p>chrome安装扩展</p><pre><code>https://chrome.google.com/webstore/detail/wiznote-web-clipper/jfanfpmalehkemdiiebjljddhgojhfab/related?hl=zh-CN</code></pre><h1 id="安装系统状态指示器">安装系统状态指示器</h1><pre><code>sudo add-apt-repository ppa:indicator-multiload/stable-dailysudo apt-get updatesudo apt-get install indicator-multiload</code></pre><h1 id="安装albert搜索框">安装albert搜索框</h1><pre><code>sudo add-apt-repository ppa:noobslab/macbuntusudo apt-get updatesudo apt-get install albert设置快捷键Ctrl+/ 样式NUMIX</code></pre><h1 id="下载特殊文件">下载特殊文件</h1><pre><code>sudo apt-get install ktorrentsudo apt-get install amule</code></pre>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python入门基础</title>
      <link href="/2016/11/09/Python%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/09/Python%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="linux源码安装适合生产环境">1. linux源码安装（适合生产环境）</h1><p>安装python3.x.x <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 以centos系统安装python3.6.6为例</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum groupinstall <span class="string">"Development tools"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tar.xz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xJf Python-3.6.6.tar.xz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> Python-3.6.6</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/python3  <span class="comment"># 编译配置</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo make install</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建软链接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/python3/bin/python3 /usr/bin/python3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/python3/bin/pip3 /usr/bin/pip3</span></span><br></pre></td></tr></table></figure></p><p>安装虚拟环境</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum <span class="keyword">install</span> python-virtualenv  <span class="comment"># centos</span></span><br></pre></td></tr></table></figure><p>创建项目</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv --no-site-packages -p /usr/bin/python3 .env-<span class="keyword">project</span></span><br><span class="line">$ source.env-<span class="keyword">project</span>/bin/active  <span class="comment"># 进入虚拟环境</span></span><br><span class="line">(.env-<span class="keyword">project</span>) deactive  <span class="comment"># 退出虚拟环境</span></span><br></pre></td></tr></table></figure><h1 id="pyenv安装适合开发环境">2. pyenv安装(适合开发环境)</h1><p>安装pyenv</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/pyenv/</span>pyenv-installer<span class="regexp">/master/</span>bin<span class="regexp">/pyenv-installer | bash</span></span><br></pre></td></tr></table></figure><p>设置环境变量</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~<span class="string">/.zshrc</span>  <span class="comment"># 具体文件看自己的终端工具</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$HOME</span>/.pyenv/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(pyenv init -)</span>"</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(pyenv virtualenv-init -)</span>"</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ~/.zshrc</span></span><br></pre></td></tr></table></figure><p>检查环境</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>pyenv doctor  <span class="comment"># 如有错误，根据自己的环境解决</span></span><br></pre></td></tr></table></figure><p>安装python3.x.x</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv install <span class="number">3.6</span><span class="number">.6</span></span><br></pre></td></tr></table></figure><p>如果pyenv下载文件缓慢，可以先下载文件到缓存中</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cd ~<span class="regexp">/.pyenv/cache</span>  <span class="comment"># 没有则创建文件</span></span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">https:</span>/<span class="regexp">/www.python.org/ftp</span><span class="regexp">/python/</span><span class="number">3.6</span>.<span class="number">6</span>/Python-<span class="number">3.6</span>.<span class="number">6</span>.tar.xz</span><br><span class="line"><span class="variable">$ </span>pyenv install <span class="number">3.6</span>.<span class="number">6</span></span><br></pre></td></tr></table></figure><p>依次安装python3.7.3 python2.7.10</p><p>查看当前系统所有python版本</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv versions</span><br><span class="line">*<span class="built_in"> system </span>(<span class="builtin-name">set</span> by /home/zhc/.pyenv/version)</span><br><span class="line">  2.7.10</span><br><span class="line">  3.6.6</span><br><span class="line">  3.7.3</span><br></pre></td></tr></table></figure><p>pyenv系统级别global切换版本&lt;pyenv目录级别local切换版本&lt;pyenv当前shell级别切换版本</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> pyenv global <span class="number">3.6</span><span class="number">.6</span>                                                                 </span><br><span class="line"><span class="symbol">$</span> pyenv version                                                                     </span><br><span class="line"><span class="number">3.6</span><span class="number">.6</span> (<span class="keyword">set</span> by /home/<span class="comment">zhc</span>/.pyenv/<span class="comment">version)</span>                                                 </span><br><span class="line">$ pyenv <span class="comment">global 3.7.3</span></span><br><span class="line">$ pyenv <span class="comment">version</span></span><br><span class="line">3.7.3 (<span class="keyword">set</span> <span class="comment">by</span> /home/<span class="comment">zhc</span>/.pyenv/<span class="comment">version)</span></span><br><span class="line">$ pyenv <span class="comment">shell 3.6.6</span></span><br><span class="line">$ pyenv <span class="comment">version</span></span><br><span class="line">3.6.6 (<span class="keyword">set</span> <span class="comment">by PYENV_VERSION environment variable)</span> </span><br><span class="line">$ pyenv <span class="comment">local 3.6.6  #</span> 会在当前文件夹下创建<span class="comment">.python-version</span>文件，存储虚拟环境名称</span><br></pre></td></tr></table></figure><p>pyenv安装虚拟环境</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">pyenv</span> <span class="selector-tag">virtualenv</span> 3<span class="selector-class">.6</span><span class="selector-class">.6</span> <span class="selector-tag">test-3</span><span class="selector-class">.6</span><span class="selector-class">.6</span></span><br><span class="line"><span class="selector-tag">pyenv</span> <span class="selector-tag">virtualenv</span> 3<span class="selector-class">.7</span><span class="selector-class">.3</span> <span class="selector-tag">test-3</span><span class="selector-class">.7</span><span class="selector-class">.3</span></span><br></pre></td></tr></table></figure><p>pyenv删除虚拟环境</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">pyenv</span> <span class="selector-tag">uninstall</span> <span class="selector-tag">test-3</span><span class="selector-class">.6</span><span class="selector-class">.6</span></span><br></pre></td></tr></table></figure><p>pyenv查看全部虚拟环境</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ pyenv virtualenvs                                                                 </span><br><span class="line">  <span class="number">3.6</span><span class="number">.6</span>/envs/test<span class="number">-3.6</span><span class="number">.6</span> (created from /home/zhc/.pyenv/versions/<span class="number">3.6</span><span class="number">.6</span>)                 </span><br><span class="line">  <span class="number">3.7</span><span class="number">.3</span>/envs/test<span class="number">-3.7</span><span class="number">.3</span> (created from /home/zhc/.pyenv/versions/<span class="number">3.7</span><span class="number">.3</span>)                 </span><br><span class="line">  test<span class="number">-3.6</span><span class="number">.6</span> (created from /home/zhc/.pyenv/versions/<span class="number">3.6</span><span class="number">.6</span>)</span><br><span class="line">  test<span class="number">-3.7</span><span class="number">.3</span> (created from /home/zhc/.pyenv/versions/<span class="number">3.7</span><span class="number">.3</span>)</span><br></pre></td></tr></table></figure><p>切换虚拟环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pyenv activate <span class="built_in">test</span>-3.6.6</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pyenv <span class="built_in">local</span> <span class="built_in">test</span>-3.6.6</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> deactivate</span></span><br></pre></td></tr></table></figure><p>pyenv重建环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="built_in">rehash</span></span><br></pre></td></tr></table></figure><h1 id="源码安装python2.7.9">源码安装python2.7.9</h1><pre><code>$ sudo apt-get install -y openssl$ sudo apt-get install -y libssl-dev # 即 openssl-devel$ sudo apt-get install -y libffi-dev # 即 libffi-devel$ sudo apt-get install -y python-openssl$ sudo apt-get install libbz2-dev$ sudo apt-get install libxml2-dev$ sudo apt-get install libxslt1-dev$ sudo apt-get install sqlite3 libsqlite3-dev$ sudo apt-get install libmysqlclient-devwget -c https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tgz  tar -xzvf Python-2.7.9.tgz  cd Python-2.7.9/ </code></pre><p>修改源码，支持ssl</p><pre><code>vim Modules/Setup.dist# Socket module helper for SSL support; you must comment out the other# socket line above, and possibly edit the SSL variable:#SSL=/usr/local/ssl#_ssl _ssl.c \#        -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \#        -L$(SSL)/lib -lssl -lcrypto</code></pre><p>改成</p><pre><code># Socket module helper for SSL support; you must comment out the other# socket line above, and possibly edit the SSL variable:SSL=/usr/local/ssl_ssl _ssl.c \        -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \        -L$(SSL)/lib -lssl -lcryptoLDFLAGS=&quot;-L/usr/lib/x86_64-linux-gnu&quot; ./configure  make  sudo make install</code></pre><h1 id="虚拟环境搭建">虚拟环境搭建</h1><p>安装</p><pre><code>sudo apt-get install python-virtualenv</code></pre><p>创建虚拟环境</p><pre><code>cd ~/var/wwwvirtualenv --no-site-packages -p /usr/local/bin/python Novel # 参数表示不安装系统已经安装的第三方包, -p表示用哪个版本的python</code></pre><p>启用虚拟环境</p><pre><code>cd /var/www/Novelsource ./bin/activate</code></pre><p>虚拟环境安装包</p><pre><code>(Novel) pip isntall django==1.8.2 # 不能加sudo</code></pre><p>退出虚拟环境，进入正常环境</p><pre><code>deactivate</code></pre><p>虚拟环境复制</p><pre><code>pip freeze &gt; requirements.txtpip install -r requirements.txt</code></pre><h1 id="pip安装超时">pip安装超时</h1><pre><code>pip --default-timeout=100 install -U pip</code></pre><h1 id="安装python-mysql">安装python-mysql</h1><pre><code>sudo apt-get install python-setuptoolssudo apt-get install libmysqld-devsudo apt-get install libmysqlclient-devsudo apt-get install python-devsudo easy_install mysql-python</code></pre><p>在终端输入以下内容,不报错则表示成功</p><pre><code>import MySQLdb</code></pre><h1 id="获取文件修改时间">获取文件修改时间</h1><pre><code>import timefilemt= time.localtime(os.stat(filename).st_mtime)  #文件修改时间filect = time.localtime(os.stat(filename).st_ctime)  #文件创建print time.strftime(&quot;%Y-%m-%d&quot;,filemt)  print time.strftime(&quot;%Y-%m-%d&quot;,filect)</code></pre><h1 id="获取多少天以前的时间">获取多少天以前的时间</h1><pre><code>import datetime# 30天以前的日期date_time = (datetime.datetime.now() - datetime.timedelta(days=30)).strftime(&quot;%Y-%m-%d&quot;)print date_time</code></pre><h1 id="去除列表重复项内容">去除列表重复项内容</h1><pre><code># 如果列表里面内容为字典f = lambda x,y:x if y in x else x + [y]products = reduce(f, [[], ] + products_query)print products# 如果列表里面内容为字符串l1 = [&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;b&#39;,&#39;c&#39;,&#39;a&#39;,&#39;a&#39;]l2 = list(set(l1))print l2# 保持原来的顺序l1 = [&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;b&#39;,&#39;c&#39;,&#39;a&#39;,&#39;a&#39;]l2 = sorted(set(l1),key=l1.index)print l2</code></pre><h1 id="md5hash加密">md5，hash加密</h1><pre><code>import hashlibdata =  &#39;This a md5 test!&#39;hash_md5 = hashlib.md5(data)  # md5hash_md5.hexdigest()hashlib.sha1(&#39;This is a sha1 test!&#39;).hexdigest() # sha1</code></pre><h1 id="打印输出对象">打印输出对象</h1><pre><code>from pprint import pprintpprint(vars(object))</code></pre><h1 id="windows安装python相关环境">windows安装python相关环境</h1><h1 id="安装虚拟环境">安装虚拟环境</h1><pre><code># 安装包pip install virtualenv# 创建虚拟环境envvirtualenv.exe  env# 开启虚拟环境./scripts/active# 退出虚拟环境deactivate</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>S_h_a_d_o_w_s_o_c_k_s服务</title>
      <link href="/2016/11/09/S_h_a_d_o_w_s_o_c_k_s%E6%9C%8D%E5%8A%A1/"/>
      <url>/2016/11/09/S_h_a_d_o_w_s_o_c_k_s%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><h3 id="python版本">Python版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CentOS6.5默认安装的Python版本是2.6.6，返回值为：Python 2.6.6</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python –version</span></span><br></pre></td></tr></table></figure><h3 id="安装setuptools">安装setuptools</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装完毕后，easy_install命令就可以使用了。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install -y python-setuptools</span></span><br></pre></td></tr></table></figure><h3 id="安装pip">安装pip</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> easy_install pip </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过easy_install安装pip是最为简单的方法。pip默认安装到/usr/bin目录下。</span></span><br></pre></td></tr></table></figure><h3 id="安装-1">安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install shadowsocks</span></span><br></pre></td></tr></table></figure><h2 id="配置">配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/shadowsocks.json</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"server"</span>:<span class="string">"your_server_ip"</span>,</span><br><span class="line"><span class="attr">"server_port"</span>:<span class="number">8989</span>,</span><br><span class="line"><span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line"><span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line"><span class="attr">"password"</span>:<span class="string">"yourpassword"</span>,</span><br><span class="line"><span class="attr">"timeout"</span>:<span class="number">600</span>,</span><br><span class="line"><span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line"><span class="attr">"fast_open"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">"workers"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>各字段的含义：</p></blockquote><ul><li>server：服务器 IP (IPv4/IPv6)，注意这也将是服务端监听的 IP 地址<br></li><li>server_port：监听的服务器端口<br></li><li>local_address：本地监听的 IP 地址<br></li><li>local_port：本地端端口<br></li><li>password：用来加密的密码<br></li><li>timeout：超时时间（秒）<br></li><li>method：加密方法，可选择 “bf-cfb”, “aes-256-cfb”, “des-cfb”, “rc4″, 等等。默认是一种不安全的加密，推荐用 “aes-256-cfb” fast-open：true 或 false。如果你的服务器 Linux 内核在3.7+，可以开启 fast-open 以降低延迟。开启方法： echo 3 &gt; /proc/sys/net/ipv4/tcp_fastopen<br></li><li>开启之后，将 fast_open 的配置设置为 true 即可。<br></li><li>works：works数量，默认为 1</li></ul><h3 id="安装m2crypto">安装M2Crypto</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 默认加密方法 table 速度很快，但很不安全。推荐使用 “aes-256-cfb” 或者 “bf-cfb”。请不要使用 “rc4″，它不安全。如果选择 “table” 之外的加密，需要安装 M2Crypto。 先安装依赖包：</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install -y openssl-devel gcc swig python-devel autoconf libtool</span></span><br></pre></td></tr></table></figure><h3 id="安装setuptools-1">安装setuptools</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget --no-check-certificate https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python ez_setup.py install</span></span><br></pre></td></tr></table></figure><p>再通过pip安装M2Crypto： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install M2Crypto</span></span><br></pre></td></tr></table></figure></p><h3 id="安装-gevent">安装 gevent</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 gevent可以提高 Shadowsocks 的性能。CentOS下安装gevent依赖libevent和greenlet。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install -y libevent</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install greenlet</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install gevent</span></span><br></pre></td></tr></table></figure><h3 id="服务器端启动">服务器端启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssserver -c /etc/shadowsocks.json</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果想在后台一直运行Shadowsocks，启动命令如下：</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nohup ssserver -c /etc/shadowsocks.json &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 备注：关于nohup，是可以让程序在后台运行的命令。 同时可以用命令行参数覆盖 /etc/shadowsocks.json 里的设置：</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sslocal -s 服务器地址 -p 服务器端口 -l 本地端端口 -k 密码 -m 加密方法</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssserver -p 服务器端口 -k 密码 -m 加密方法</span></span><br><span class="line">备注：sslocal是客户端程序；ssserver是服务端程序。</span><br></pre></td></tr></table></figure><h2 id="防火墙设置如有">防火墙设置（如有）</h2><p>编辑防火墙配置文件/etc/sysconfig/iptables，将服务器端口（server_port）放行。<br>新增一条防火墙规则： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 8989 -j ACCEPT</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> service iptables save</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> service iptables restart</span></span><br></pre></td></tr></table></figure></p><h2 id="配置多个用户">配置多个用户</h2><div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">{</span></span><span id="cb1-2"><a href="#cb1-2"></a><span class="dt">&quot;timeout&quot;</span><span class="fu">:</span> <span class="dv">600</span><span class="fu">,</span></span><span id="cb1-3"><a href="#cb1-3"></a><span class="dt">&quot;method&quot;</span><span class="fu">:</span> <span class="st">&quot;aes-256-cfb&quot;</span><span class="fu">,</span></span><span id="cb1-4"><a href="#cb1-4"></a><span class="dt">&quot;port_password&quot;</span><span class="fu">:</span> </span><span id="cb1-5"><a href="#cb1-5"></a><span class="fu">{</span></span><span id="cb1-6"><a href="#cb1-6"></a><span class="dt">&quot;40001&quot;</span><span class="fu">:</span> <span class="st">&quot;password1&quot;</span><span class="fu">,</span></span><span id="cb1-7"><a href="#cb1-7"></a><span class="dt">&quot;40002&quot;</span><span class="fu">:</span> <span class="st">&quot;password2&quot;</span><span class="fu">,</span></span><span id="cb1-8"><a href="#cb1-8"></a><span class="dt">&quot;40003&quot;</span><span class="fu">:</span> <span class="st">&quot;password3&quot;</span></span><span id="cb1-9"><a href="#cb1-9"></a><span class="fu">},</span></span><span id="cb1-10"><a href="#cb1-10"></a><span class="dt">&quot;_comment&quot;</span><span class="fu">:</span></span><span id="cb1-11"><a href="#cb1-11"></a><span class="fu">{</span></span><span id="cb1-12"><a href="#cb1-12"></a><span class="dt">&quot;40001&quot;</span><span class="fu">:</span> <span class="st">&quot;xiaoming&quot;</span><span class="fu">,</span></span><span id="cb1-13"><a href="#cb1-13"></a><span class="dt">&quot;40002&quot;</span><span class="fu">:</span> <span class="st">&quot;lilei&quot;</span><span class="fu">,</span></span><span id="cb1-14"><a href="#cb1-14"></a><span class="dt">&quot;40003&quot;</span><span class="fu">:</span> <span class="st">&quot;mike&quot;</span></span><span id="cb1-15"><a href="#cb1-15"></a><span class="fu">}</span></span><span id="cb1-16"><a href="#cb1-16"></a><span class="fu">}</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python将office word 转为html 并提取相关图片信息</title>
      <link href="/2016/11/09/Python%E5%B0%86office%20word%20%E8%BD%AC%E4%B8%BAhtml%20%E5%B9%B6%E6%8F%90%E5%8F%96%E7%9B%B8%E5%85%B3%E5%9B%BE%E7%89%87%E4%BF%A1%E6%81%AF/"/>
      <url>/2016/11/09/Python%E5%B0%86office%20word%20%E8%BD%AC%E4%B8%BAhtml%20%E5%B9%B6%E6%8F%90%E5%8F%96%E7%9B%B8%E5%85%B3%E5%9B%BE%E7%89%87%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="需求">需求</h3><p>工作需要将2000多格word文档中的图片提取出来，并改名为word文档名</p><h3 id="思路1">思路1</h3><blockquote><p>More exactly, a .docx document is a Zip archive in OpenXML format: you have first to uncompress it. I downloaded a sample (Google: some search term filetype:docx) and after unzipping I found some folders. The word folder contains the document itself, in file document.xml.</p></blockquote><p>于是使用unzip模块</p><pre><code>import zipfile</code></pre><p>但是报错</p><pre><code>BadZipfile: File is not a zip file</code></pre><p>检查发现同事提供的office word文件结尾为.doc,<br>于是使用7-zip进行提取发现确实报错</p><blockquote><p>文件末端错误</p></blockquote><p>尝试用本机office2013打开并另存为word文档.docx<br>再次使用7-zip进行提取，成功，会生成以下一个文件夹</p><blockquote><p>_rels文件夹<br>docProps文件夹<br>word文件夹<br>[Content_Types].xml文件</p></blockquote><p>其中\word\media文件夹下就有我需要的图片信息<br>既然需要更改文件后缀，那么就有另一个思路。</p><h3 id="思路2">思路2</h3><blockquote><p>通过win32com.clientm将文件改为html文件，会生成类似的文件夹</p></blockquote><p>核心代码</p><pre><code># -*- encoding: utf8 -*-import win32comfrom win32com.client import constants# 打开初始化word文档w = win32com.client.Dispatch(&#39;Word.Application&#39;)w.Visible = 0w.DisplayAlerts = 0doc = w.Documents.Open(source_file)  # 打开文件doc.SaveAs(target_fold + &#39;/&#39; + file_number + &#39;.htm&#39;, 8)  # 更名为htm文件doc.Close()w.Quit()</code></pre><p>另存为其他规格只需要将参数8修改即可</p><blockquote><p>wdFormatDocument = 0<br>wdFormatDocument97 = 0<br>wdFormatDocumentDefault = 16<br>wdFormatDOSText = 4<br>wdFormatDOSTextLineBreaks = 5<br>wdFormatEncodedText = 7<br>wdFormatFilteredHTML = 10<br>wdFormatFlatXML = 19<br>wdFormatFlatXMLMacroEnabled = 20<br>wdFormatFlatXMLTemplate = 21<br>wdFormatFlatXMLTemplateMacroEnabled = 22<br>wdFormatHTML = 8<br>wdFormatPDF = 17<br>wdFormatRTF = 6<br>wdFormatTemplate = 1<br>wdFormatTemplate97 = 1<br>wdFormatText = 2<br>wdFormatTextLineBreaks = 3<br>wdFormatUnicodeText = 7<br>wdFormatWebArchive = 9<br>wdFormatXML = 11<br>wdFormatXMLDocument = 12<br>wdFormatXMLDocumentMacroEnabled = 13<br>wdFormatXMLTemplate = 14<br>wdFormatXMLTemplateMacroEnabled = 15<br>wdFormatXPS = 18</p></blockquote><p>最后脚本</p><pre><code># -*- encoding: utf8 -*-import win32comimport osimport xlrdimport shutilfrom win32com.client import constants# 从excel表格中导入数据并组成字典XlsFile = &#39;default.xlsx&#39;                  # 需要的数据data = xlrd.open_workbook(XlsFile)table = data.sheets()[0]nrows = table.nrows# 获取文件名列表number_list = []for i in range(1, nrows):    number_list.append(table.row_values(i)[0])# 打开初始化word文档w = win32com.client.Dispatch(&#39;Word.Application&#39;)w.Visible = 0w.DisplayAlerts = 0# 遍历文件夹并将文件剪贴到新的文件夹中source_fold = os.path.split(os.path.realpath(__file__))[0] + &#39;/&#39; + &#39;WordFile&#39;target_fold = os.path.split(os.path.realpath(__file__))[0] + &#39;/&#39; + &#39;NewFile&#39;img_fold = os.path.split(os.path.realpath(__file__))[0] + &#39;/&#39; + &#39;Img&#39;word_list = os.listdir(source_fold)for file_name in word_list:    # 根据货号在列表中查找    try:        file_number = file_name[0:10]        if file_number in number_list:            print(file_name + &#39;是需要的文件.&#39;)            source_file = source_fold + &#39;/&#39; + file_name            doc = w.Documents.Open(source_file)  # 打开文件            doc.SaveAs(target_fold + &#39;/&#39; + file_number + &#39;.htm&#39;, 8)  # 更名为htm文件            doc.Close()            od_img = target_fold + &#39;/&#39; + file_number + &#39;.files&#39; + &#39;/&#39; + &#39;image003.jpg&#39;            shutil.copyfile(od_img, img_fold + &#39;/&#39; + file_number + &#39;.jpg&#39;)  # 复制新的文件            number_list.remove(file_number)  # 从excel列表中删除此元素防止重复选取    except Exception, e:        print(file_name)        print ew.Quit()try:    f = open(&quot;php.json&quot;, &quot;w&quot;)    print &gt;&gt;f, number_list  # 最后将剩下的元素打印到文件中except Exception, e:    print &#39;写入php.json失败&#39;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python从excel导出数据并批量替换word文档内容</title>
      <link href="/2016/11/09/Python%E4%BB%8Eexcel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2word%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9/"/>
      <url>/2016/11/09/Python%E4%BB%8Eexcel%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2word%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<h3 id="老外的代码">老外的代码</h3><p>第一个是操作word，第二个是操作excel</p><pre><code>from win32com.client import constants, Dispatchimport pythoncomwdStory = 6class WordDocument(object):  &quot;&quot;&quot;  Some convenience methods for Word documents accessed  through COM.  &quot;&quot;&quot;  def __init__(self, visible=False):    self.app = Dispatch(&quot;Word.Application&quot;)    self.app.Visible = visible  def new(self, filename=None):    &quot;&quot;&quot;    Create a new Word document. If &#39;filename&#39; specified,    use the file as a template.    &quot;&quot;&quot;    self.app.Documents.Add(filename)  def open(self, filename):    &quot;&quot;&quot;    Open an existing Word document for editing.    &quot;&quot;&quot;    self.app.Documents.Open(filename)  def save(self, filename=None):    &quot;&quot;&quot;    Save the active document. If &#39;filename&#39; is given,    do a Save As.    &quot;&quot;&quot;    if filename:      self.app.ActiveDocument.SaveAs(filename)    else:      self.app.ActiveDocument.Save()  def save_as(self, filename):    return self.save(filename)  def print_out(self):    &quot;&quot;&quot;    Print the active document.    &quot;&quot;&quot;    self.app.Application.PrintOut()  def close(self):    &quot;&quot;&quot;    Close the active document.    &quot;&quot;&quot;    self.app.ActiveDocument.Close()  def quit(self):    &quot;&quot;&quot;    Quit Word.    &quot;&quot;&quot;    return self.app.Quit()  def find_and_replace(self, find_str, replace_str):    &quot;&quot;&quot;    Find all occurances of &#39;find_str&#39; and replace with &#39;replace_str&#39;    in the active document.    &quot;&quot;&quot;    self.app.Selection.HomeKey(Unit=wdStory)    find = self.app.Selection.Find    find.Text = find_str    while self.app.Selection.Find.Execute():      self.app.Selection.TypeText(Text=replace_str)from win32com.client import constants, Dispatchimport pythoncomimport osborderTop = 3borderBottom = 4borderLeft = 1borderRight = 2borderSolid = 1borderDashed = 2borderDotted = 3colorBlack = 1directionUp = -4162directionDown = -4121directionLeft = -4131directionRight = -4152class ExcelDocument(object):  &quot;&quot;&quot;  Some convenience methods for Excel documents accessed  through COM.  &quot;&quot;&quot;  def __init__(self, visible=False):    self.app = Dispatch(&quot;Excel.Application&quot;)    self.app.Visible = visible    self.sheet = 1  def new(self, filename=None):    &quot;&quot;&quot;    Create a new Excel workbook. If &#39;filename&#39; specified,    use the file as a template.    &quot;&quot;&quot;    self.app.Workbooks.Add(filename)  def open(self, filename):    &quot;&quot;&quot;    Open an existing Excel workbook for editing.    &quot;&quot;&quot;    self.app.Workbooks.Open(filename)  def set_sheet(self, sheet):    &quot;&quot;&quot;    Set the active worksheet.    &quot;&quot;&quot;    self.sheet = sheet  def get_range(self, range):    &quot;&quot;&quot;    Get a range object for the specified range or single cell.    &quot;&quot;&quot;    return self.app.ActiveWorkbook.Sheets(self.sheet).Range(range)  def set_value(self, cell, value=&#39;&#39;):    &quot;&quot;&quot;    Set the value of &#39;cell&#39; to &#39;value&#39;.    &quot;&quot;&quot;    self.get_range(cell).Value = value  def get_value(self, cell):    &quot;&quot;&quot;    Get the value of &#39;cell&#39;.    &quot;&quot;&quot;    value = self.get_range(cell).Value    if isinstance(value, tuple):      value = [v[0] for v in value]    return value  def set_border(self, range, side, line_style=borderSolid, color=colorBlack):    &quot;&quot;&quot;    Set a border on the specified range of cells or single cell.    &#39;range&#39; = range of cells or single cell    &#39;side&#39; = one of borderTop, borderBottom, borderLeft, borderRight    &#39;line_style&#39; = one of borderSolid, borderDashed, borderDotted, others?    &#39;color&#39; = one of colorBlack, others?    &quot;&quot;&quot;    range = self.get_range(range).Borders(side)    range.LineStyle = line_style    range.Color = color  def sort(self, range, key_cell):    &quot;&quot;&quot;    Sort the specified &#39;range&#39; of the activeworksheet by the    specified &#39;key_cell&#39;.    &quot;&quot;&quot;    range.Sort(Key1=self.get_range(key_cell), Order1=1, Header=0, OrderCustom=1, MatchCase=False, Orientation=1)  def hide_row(self, row, hide=True):    &quot;&quot;&quot;    Hide the specified &#39;row&#39;.    Specify hide=False to show the row.    &quot;&quot;&quot;    self.get_range(&#39;a%s&#39; % row).EntireRow.Hidden = hide  def hide_column(self, column, hide=True):    &quot;&quot;&quot;    Hide the specified &#39;column&#39;.    Specify hide=False to show the column.    &quot;&quot;&quot;    self.get_range(&#39;%s1&#39; % column).EntireColumn.Hidden = hide  def delete_row(self, row, shift=directionUp):    &quot;&quot;&quot;    Delete the entire &#39;row&#39;.    &quot;&quot;&quot;    self.get_range(&#39;a%s&#39; % row).EntireRow.Delete(Shift=shift)  def delete_column(self, column, shift=directionLeft):    &quot;&quot;&quot;    Delete the entire &#39;column&#39;.    &quot;&quot;&quot;    self.get_range(&#39;%s1&#39; % column).EntireColumn.Delete(Shift=shift)  def fit_column(self, column):    &quot;&quot;&quot;    Resize the specified &#39;column&#39; to fit all its contents.    &quot;&quot;&quot;    self.get_range(&#39;%s1&#39; % column).EntireColumn.AutoFit()  def save(self):    &quot;&quot;&quot;    Save the active workbook.    &quot;&quot;&quot;    self.app.ActiveWorkbook.Save()  def save_as(self, filename, delete_existing=False):    &quot;&quot;&quot;    Save the active workbook as a different filename.    If &#39;delete_existing&#39; is specified and the file already    exists, it will be deleted before saving.    &quot;&quot;&quot;    if delete_existing and os.path.exists(filename):      os.remove(filename)    self.app.ActiveWorkbook.SaveAs(filename)  def print_out(self):    &quot;&quot;&quot;    Print the active workbook.    &quot;&quot;&quot;    self.app.Application.PrintOut()  def close(self):    &quot;&quot;&quot;    Close the active workbook.    &quot;&quot;&quot;    self.app.ActiveWorkbook.Close()  def quit(self):    &quot;&quot;&quot;    Quit Excel.    &quot;&quot;&quot;    return self.app.Quit()</code></pre><h3 id="基本使用方法">基本使用方法</h3><pre><code># -*- encoding: utf8 -*-# 配置项import osimport shutilimport reimport timeimport win32comfrom win32com.client import constantsimport xlrdXlsFile = &#39;default.xls&#39;                  # 需要的数据OldStrs = [&#39;#CatalogNumber#&#39;,           &#39;#ProductName#&#39;,           &#39;#OSpecies#&#39;,           &#39;#Short#&#39;,           &#39;#Organism#&#39;,           &#39;#Fragment#&#39;,           &#39;#PROTEIN#&#39;,           &#39;#Tag#&#39;           ]# 确认模板类型DefaultFile = raw_input(&#39;Want to use ihc.jpg,input \&#39;Y\&#39;,or input \&#39;N\&#39;:\n&#39;)if DefaultFile == &#39;N&#39;:    DocFile = os.path.abspath(&#39;default_noihc.doc&#39;)    print DocFileelif DefaultFile == &#39;Y&#39;:    DocFile = os.path.abspath(&#39;default.doc&#39;)    print DocFileelse:    raisefilepath = &#39;D:/Py/CreateAntibodyWord/NewFile&#39;    # 生成文件目录# 获取括号内容的正则表达式patt = re.compile(r&quot;\((.*?)\)&quot;, re.I | re.X)# 打开初始化word文档w = win32com.client.Dispatch(&#39;Word.Application&#39;)w.Visible = 0w.DisplayAlerts = 0# 从excel表格中导入数据data = xlrd.open_workbook(XlsFile) table = data.sheets()[0]nrows = table.nrows# 循环表格中的内容for i in range(1, nrows):    try:        # 获取新的数据        CatalogNumber = table.row_values(i)[0]        ProductName = table.row_values(i)[1]        OrganismSpecies = table.row_values(i)[2]        Tag = table.row_values(i)[3]        Fragment = table.row_values(i)[4]        Short = patt.findall(ProductName)[0]        # 获取对应蛋白的货号        ProteinNumber = re.sub(r&#39;^PA&#39;, r&#39;RP&#39;, CatalogNumber)        # Ge多物种没有缩写，用General替代        Organism = patt.findall(OrganismSpecies)        if len(Organism) &gt; 0:            Organism = Organism[0]        else:            Organism = &#39;General&#39;        # 没有氨基酸片段信息的用原始值替代        Fragment = patt.findall(Fragment)        if len(Fragment) &gt; 0:            Fragment = Fragment[0]        else:            Fragment = &#39;#Fragment#&#39;        NewStrs = [CatalogNumber,                   ProductName,                   OrganismSpecies,                   Short,                   Organism,                   Fragment,                   ProteinNumber,                   Tag                   ]        # 打开复制的文件        NewFileName = CatalogNumber + &#39;-e.doc&#39;                                        # 命名新的文件        shutil.copyfile(DocFile, filepath + &#39;/&#39; + NewFileName)                        # 复制新的文件        CopyFile = os.path.abspath(filepath + &#39;/&#39; + NewFileName)                      # 新的文件目录        doc = w.Documents.Open(FileName=CopyFile)                                     # 打开文件        # 文本框处理        canvas = doc.Shapes[2]        canvas.TextFrame.TextRange.Find.Execute(OldStrs[3], False, False, False, False, False, True, 1, True, NewStrs[3], 2)        canvas.TextFrame.TextRange.Find.Execute(OldStrs[4], False, False, False, False, False, True, 1, True, NewStrs[4], 2)        # 正文文字处理        w.Selection.Find.ClearFormatting()        w.Selection.Find.Replacement.ClearFormatting()        for j in range(len(NewStrs)):            w.Selection.Find.Execute(OldStrs[j], False, False, False, False, False, True, 1, True, NewStrs[j], 2)        # 获取属性信息并修改,参考https://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.workbook.builtindocumentproperties(v=vs.120).aspx?cs-save-lang=1&amp;cs-lang=vb#code-snippet-1        doc.BuiltInDocumentProperties(&#39;Title&#39;).Value = ProductName        doc.BuiltInDocumentProperties(&#39;Subject&#39;).Value = &#39;Instruction manual (Catalog No.&#39; + CatalogNumber + &#39;)&#39;        doc.BuiltInDocumentProperties(&#39;Keywords&#39;).Value = ProductName        doc.BuiltInDocumentProperties(&#39;Category&#39;).Value = OrganismSpecies        # 保存文件并关闭        doc.Save()        doc.Close()        print CatalogNumber + &#39; create word success!&#39;    # 捕获异常并写入log文件中    except Exception, e:        print CatalogNumber + &#39; create word error!&#39;        print e        errorfile = open(filepath + &#39;/errorlog.txt&#39;, &#39;a&#39;)        try:            errorfile.write(CatalogNumber + &#39; create word error! &#39; + time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) + &#39;\n&#39;)        except Exception, e:            doc.Close()            w.Quit()            raise e        finally:            errorfile.close()w.Quit()        </code></pre><h3 id="替换word文档属性里的详细信息">替换Word文档属性里的详细信息</h3><pre><code>        doc.BuiltInDocumentProperties(&#39;Title&#39;).Value = ProductName        doc.BuiltInDocumentProperties(&#39;Subject&#39;).Value = &#39;Instruction manual (Catalog No.&#39; + CatalogNumber + &#39;)&#39;        doc.BuiltInDocumentProperties(&#39;Keywords&#39;).Value = ProductName        doc.BuiltInDocumentProperties(&#39;Category&#39;).Value = Ospecies</code></pre><p>参考<a href="http://stackoverflow.com/questions/3022898/python-win32com-automating-word-how-to-replace-text-in-a-text-box" target="_blank" rel="noopener">微软官方说明</a></p><h3 id="替换word长文本">替换Word长文本</h3><p>使用以下语句替换长文本会报错"字符串过长"</p><pre><code>w.Selection.Find.Execute(OldStrs[j], False, False, False, False, False, True, 1, True, NewStrs[j], 2)</code></pre><p>使用以下语句</p><pre><code>find = w.Selection.Findfind.Text = &#39;#SEQUENCE#&#39;while w.Selection.Find.Execute():    w.Selection.TypeText(Text=SEQUENCE)</code></pre><h3 id="替换word文本框内容">替换Word文本框内容</h3><p>参考以下代码 <a href="http://stackoverflow.com/questions/3022898/python-win32com-automating-word-how-to-replace-text-in-a-text-box" target="_blank" rel="noopener">http://stackoverflow.com/</a></p><pre><code>import win32com.clientword = win32com.client.Dispatch(&quot;Word.Application&quot;)canvas = word.ActiveDocument.Shapes[0]for item in canvas.CanvasItems:    print item.TextFrame.TextRange.Text</code></pre><p>或者</p><pre><code>find = shp.TextFrame.TextRange.Findfind.Text = sourcefind.Replacement.Text = targetfind.Execute(Replace=1, Forward=True)</code></pre>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>局域网部分电脑不能连接网络,局域网共享文件夹,打印机等情况</title>
      <link href="/2016/11/09/%E5%B1%80%E5%9F%9F%E7%BD%91%E9%83%A8%E5%88%86%E7%94%B5%E8%84%91%E4%B8%8D%E8%83%BD%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C,%E5%B1%80%E5%9F%9F%E7%BD%91%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9,%E6%89%93%E5%8D%B0%E6%9C%BA%E7%AD%89%E6%83%85%E5%86%B5/"/>
      <url>/2016/11/09/%E5%B1%80%E5%9F%9F%E7%BD%91%E9%83%A8%E5%88%86%E7%94%B5%E8%84%91%E4%B8%8D%E8%83%BD%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C,%E5%B1%80%E5%9F%9F%E7%BD%91%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9,%E6%89%93%E5%8D%B0%E6%9C%BA%E7%AD%89%E6%83%85%E5%86%B5/</url>
      
        <content type="html"><![CDATA[<h3 id="问题反应">问题反应</h3><p>今天公司出现网络故障，有2个部门全部不能连接网络。</p><h3 id="正常问题">正常问题</h3><blockquote><p>一台电脑不能上网，找该台电脑的问题<br>一部门电脑不能上网，找该部门交换机<br>多部门电脑不能上网，找主交换机问题<br>全部不能上网，拿电脑直连路由</p></blockquote><h3 id="问题分析">问题分析</h3><p>公司主交换机A<br>部门分交换机B<br>测试电脑C<br>部门不能上网故障，正常情况应该是A模块出现问题。于是重启A，仍然有一个部门故障。<br>重启B，不能解决问题。<br>将C与B直连的线路连接到C，C正常。<br>A,B问题都排除，那么问题在哪？<br>继续尝试，B上只连接C，正常。B上连接该部门全部电脑，故障。<br>找到那条会导致故障的线路，换掉网线，OK.<br>确认问题原因居然是<strong><em>网线！</em></strong></p><h3 id="结论">结论</h3><p>子交换机上的网线问题会影响主交换。</p><h3 id="共享打印机安装出现0x00000709">共享打印机安装出现0x00000709</h3><p>解决办法：重启打印机服务器的Print Spooler服务，重启本地计算机</p><h3 id="账号密码问题">账号密码问题</h3><p>局域网有xp电脑可以正常访问共享电脑，排序账号密码问题。</p><h3 id="共享设置问题">共享设置问题</h3><p>xp系统访问正常，win7系统访问显示“帐号密码错误”。于是想到共享设置问题。</p><blockquote><p>开始=&gt;<br>运行=&gt;<br>gpedit.msc=&gt;<br>本地计算机策略=&gt;<br>计算机配置=&gt;<br>Windows设置=&gt;<br>安全设置=&gt;<br>本地策略=&gt;<br>安全选项=&gt;<br>网络安全：LAN管理器身份验证级别=&gt;<br>发送LM &amp; NTLM响应</p></blockquote><p>但是之前win7是可以正常访问的，所以该项设置是正确的。</p><h3 id="时间设置问题">时间设置问题</h3><p>于是询问是什么时候不能访问的，告之电脑蓝屏重启后。那么原因自然是蓝屏导致共享电脑设置的时间出现错误。</p><blockquote><p>如果win7的系统时间和访问的共享文件夹的创建时间间隔太长的话，会出现此现象。这是win7的安全机制造成的。<br>将共享电脑时间设置为当前时间即可</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>window常用软件</title>
      <link href="/2016/11/08/Window%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/"/>
      <url>/2016/11/08/Window%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="压缩软件7-zip">压缩软件7-zip</h3><p>终端命令(需要将安装目录添加到环境变量)</p><blockquote><p>7z a file.zip filefold #添加文件压缩<br>7z e file.zip filefold #释放文件解压</p></blockquote><h3 id="电脑清理ccleaner">电脑清理ccleaner</h3><p>电脑清理工具：清理注册表，系统垃圾文件 下载地址 <a href="http://pan.baidu.com/s/1c0G34re" target="_blank" rel="noopener">http://pan.baidu.com/s/1c0G34re</a><br>断网后注册，可用注册码</p><blockquote><p>注册名： R J. van der Linden<br>注册码：CBEW-ZZJA-84DT-VZQG-SRJC<br>注册名：Registered User<br>注册码：CBB4-FJN4-EPC6-G5P6-QT4C</p></blockquote><h3 id="卸载软件total-uninstall">卸载软件Total Uninstall</h3><p>电脑清理工具：卸载软件<br>破解版v6.16.0下载地址<a href="http://pan.baidu.com/s/1mgwAta4" target="_blank" rel="noopener">http://pan.baidu.com/s/1mgwAta4</a></p><h3 id="驱动管理工具driverdownloader">驱动管理工具DriverDownloader</h3><p>下载地址 <a href="http://pan.baidu.com/s/1qW9tPF2" target="_blank" rel="noopener">http://pan.baidu.com/s/1qW9tPF2</a><br>需要使用代理更新驱动，在Settings设置(前提是设置了代理上网)</p><blockquote><p>proxy 127.0.0.1<br>port 1080</p></blockquote><p>注册码</p><blockquote><p>DF12-2RM2-JDPE-1009</p></blockquote><p>如果提示its usage limit 将1009改成逐渐+1，改成1010，1011等等等等</p><h3 id="下载工具idminternet-download-manager6.25版">下载工具IDM(Internet Download Manager)6.25版</h3><p>下载地址<br><a href="http://www.internetdownloadmanager.com/download.html" target="_blank" rel="noopener">官网</a><br><a href="http://pan.baidu.com/s/1c0Be5Bq" target="_blank" rel="noopener">官网下载版</a><br><a href="http://pan.baidu.com/s/1eQfmv8e" target="_blank" rel="noopener">破解版</a><br>注册码(断网注册)</p><pre><code>DBNJC-D4R59-YPAGA-T3S1Q  #已经失效  F9TZ9-P6IGF-SME74-2WP21  CJA0S-K6CO4-R4NPJ-EKNRK  F9TZ9-P6IGF-SME74-2WP21  CJA0S-K6CO4-R4NPJ-EKNRK  N0Z90-KJTTW-7TZO4-I27A1  629U7-XLT5H-6SCGJ-2CENZ  XONF7-PMUOL-HU7P4-D1QQX  N0Z90-KJTTW-7TZO4-I27A1  L67GT-CE6TR-DFT1D-XWVCM </code></pre><p>或者使用host修改办法<br>host文件添加</p><pre><code>127.0.0.1 registeridm.com127.0.0.1 www.registeridm.com127.0.0.1 www.internetdownloadmanager.com</code></pre><p>打开IDM，注册，注册码如下：</p><pre><code>OS5HG-K90NH-SXOGT-7JYEZR2C1T-O0KQO-JAVU2-4MMYPM2A16-47AAW-6NLYP-V1E0JIZO7M-360FW-QY1XP-AWLPN46YFS-S9G7H-QZFWI-QQBQBTUTR2-I2NHO-GQBC6-ZECWH</code></pre><h3 id="终端管理工具cmder">终端管理工具Cmder</h3><p>下载地址<a href="http://cmder.net/" target="_blank" rel="noopener">官方</a></p><h3 id="文件图片批量处理软件">文件图片批量处理软件</h3><p>Bulk Rename Utility<br>下载地址<a href="http://www.bulkrenameutility.co.uk/Main_Intro.php" target="_blank" rel="noopener">官方</a><a href="http://pan.baidu.com/s/1sjpaa1R" target="_blank" rel="noopener">云盘</a></p><h3 id="文件资源管理器total-commander">文件资源管理器Total Commander</h3><p><a href="http://pan.baidu.com/s/1dEvQm5b" target="_blank" rel="noopener">破解版下载</a><br>快捷键</p><blockquote><p>F3——查看文件<br>F4——编辑文件<br>F5——拷贝文件<br>F6——重命名、移动文件<br>F7——新建文件夹<br>F8——删除文件、文件夹<br>F10——菜单条激活开关<br>ALT<br>Alt+F1——改变左边窗口的驱动器<br>Alt+F2——改变右边窗口的驱动器<br>Alt+Shift+F3——使用内部查看程序浏览文件<br>Alt+F5——压缩文件/文件夹<br>Alt+Shift+F5——压缩文件/文件夹，并删除原文件/文件夹<br>Alt+F7——查找文件/文件夹<br>Alt+F9——文件解压缩<br>Alt+left/right——切换至上次进入的前一个/后一个文件夹<br>Alt+down——显示历史访问地址列表<br>SHIFT<br>Shift+F4——用外部编辑器（UltraEdit）创建新文件<br>Shift+F5——复制（重命名）文件/文件夹到当前文件夹<br>Shift+Ctrl+F5——创建所选对象的快捷方式<br>Shift+F6——重命名文件/文件夹<br>Shift+ESC——Total Commander最小化<br>NUM<br>NUM + ——选择属性相同的一组文件<br>NUM — ——清除所选文件中属性相同的一组文件<br>NUM * ——反向选择<br>NUM / ——恢复选择<br>CTRL+NUM + ——全部选择<br>CTRL+NUM - ——清除全部选择<br>Alt+NUM + ——选择与当前光标选中的文件扩展名相同的一组文件<br>CTRL<br>Ctrl+PgUP——回上一级目录<br>Ctrl+left/right——在左边/右边文件窗口中显示当前文件夹列表<br>CTRL+/——返回根目录<br>CTRL+SHIFT+F1——缩略图视图（图片预览）<br>CTRL+F2——显示文件/文件夹详细资料<br>CTRL+F3——以名称排序<br>CTRL+F4——以扩展名排序<br>CTRL+F5——以文件的创建时间排序<br>CTRL+F6——以文件的大小排序<br>CTRL+F8——显示目录结构<br>CTRL+F9——打印当前光标处的文件<br>CTRL+F10——显示所有文件<br>CTRL+F11——显示所有可执行文件/隐藏非执行文件<br>CTRL+ENTER——将当前文件名复制到TC的命令行<br>CTRL+SHIFT+ENTER——将当前完整路径及文件名复制到TC的命令行<br>CTRL+D——打开常用文件夹列表（可作书签用）<br>CTRL+F——连接到FTP服务器<br>CTRL+SHIFT+F——断开与FTP服务器的连接<br>CTRL+Q——打开/关闭快速查看<br>CTRL+U——切换左右文件窗口显示内容<br>CTRL+W——关闭当前目录标签<br>CTRL+SHIFT+W——关闭所有目录标签<br>CTRL+Y——清空命令行输入框并置光标于命令行<br>ESC——清空命令行输入框并置光标于文件窗口<br>INSERT——选择文件/目录<br>SPACE——选择文件/目录<br>SHIFT+ENTER——<br>1.当命令行输入框有字符串命令：运行命令行的字符串命令<br>2.当光标位于压缩文件用相应的压缩工具打开压缩文件<br>3.位于压缩文件内：将所选中的文件解到临时文件目录，并试图将其做压缩文件的解压处理<br>ALT+ENTER——显示所选文件属性<br>Total Commander常用快捷键<br>显示编辑文件：<br>F3：这个恐怕是使用程度最高的快捷键了，专门用来查看文件。需要说明的是，默认安装的TC 5.5版只能查看文本及一些关联的影像文件，图片只支持BMP等很少的种类。如需要查看更多类型的文件，还需要安装插件。<br>Ctrl + Q：快速预览。<br>F4：主要用来编辑文本文件。可以设置外部程序来编辑文本(我设置的是Editplus)。<br>Shift + F4： 新建文本文件，调用记事本编辑（自定义编辑器）。<br>Ctrl + Z： 编辑文件/文件夹的说明。<br>Ctlt + Enter：查看文件或文件夹属性。<br>空格键：选择或取消选择文件，如在文件夹按下，则计算该文件夹占用空间。<br>Shift + 空格： 选中光标所在，不计算文件夹的容量。<br>Alt + Shift + Enter：计算当前窗格下所有文件夹的占用空间，设置后再点击顶栏的“大小”可使文件夹参与排序，迅速找到占用空间最大的文件夹。<br>Ctrl+Shift+Enter获取光标所在处文件/文件夹的绝对路径并显示在命令行里。 操作复制文件<br>F5：复制文件，这个也是最常用的快捷键之一。TC分为左、右两个窗口，我们把光标选中的文件拷贝到另一个窗口。另外，TC也支持以鼠标拖拽方式复制文件，两者哪个更方便完全由你的个人喜好决定。<br>Shift + F5： 同目录复制<br>F6：移动文件，将光标选中的文件移动到另一个窗口。<br>shift+Ins TC中的块拷贝<br>SHIFT + F6 重命名文件（F2修改版）<br>Ctrl + M： 批量更改文件名。<br>空格 选择文件/文件夹(如同 INSERT)。如果光标处文件夹还未选中，按空格键后，计算其占用空间（含子文件夹）并用字节数代替</p><p>（详细资料显示方式下）。通过 '配置' - '选项' - '操作' - '用空格键选择' 可禁用该特性。 右键长按 在NC风格下这是调用 Windows 风格下的右键菜单<br>Shift + F10——显示关联试菜单，类似于鼠标右键的效果<br>新建<br>SHIFT + F4 新建文本文件，加载到编辑器(自定义）<br>F7：新建一个或多层文件夹。可以像DOS那样新建多层的目录，比如c:/file/a/b/c 删除<br>F8 / Del：删除文件。与Windows一样，按住Shift + Delete，则直接删除而不放到回收站中。<br>搜索定位<br>Alt + Ctrl + 任意字母 或 Alt+任意字母 或 任意字母 ：快速定位文件 [菜单：配置--选项--快速搜索 中设置]<br>Alt + F7：搜索。有了TC之后，我再没用过Windows系统自带的搜索。TC的搜索简单，而且速度快，功能全，非常好用。<br>Ctrl + D：常用文件夹列表。按下会弹出浮动窗口，能够快速跳转到设定好的文件夹中。(非常好用）<br>ctrl + s: 快速搜索只显示所选文件<br>Alt + ↓：历史文件夹列表，可以快速回溯到你曾经到过的某个文件夹。<br>Alt + ← 或 →：快速后退或前进历史目录。<br>Tab： 左右窗口间切换。<br>Alt + Tab： 窗口标签间切换。<br>空格键：选择或取消选择文件，如在文件夹按下，则计算该文件夹占用空间。<br><em>(小键盘星号键)：反向选择。<br>+(小键盘加号键)：选择全部或指定类型的文件。<br>-(小键盘加号键)：取消选择全部或指定类型的文件。<br>Ctrl + A：全选当前窗口所有文件。与Windows资源管理器不同，按下此快捷键并不选中文件夹。<br>Shift + ↓ 和 Shift + ↑：选择或取消选择文件或文件夹。<br>Ctrl+↑： 在当前窗口的新标签中打开光标处文件夹<br>Ctrl+↓： 在对面窗口的新标签中打开光标处文件夹<br>Ctrl + ←/→：如果光标在窗格顶部，将左/右窗格的显示内容调整为一样的；如果光标所在处是一个文件夹，在左/右窗格打开此文件夹；如果光标所在处是一个压缩文件，在左/右窗格打开此文件。<br>Ctrl + num</em> 锁定/解锁当前标签。<br>ALT+F1 改变左侧窗口的驱动器<br>ALT+F2 改变右侧窗口的驱动器<br>压缩文件<br>Alt + F5：压缩选中的文件。按下回车，生成后的压缩包将会出现另一个目的窗口中。<br>Alt + F6 解压缩文件<br>显示方式<br>Ctrl + B： 显示当前文件夹及子文件夹下的所有文件。<br>Ctrl + R： 刷新<br>Ctrl + F1-8、10-12 不同方式在窗口显示文件列表</p></blockquote><h3 id="翻译软件-灵格斯">翻译软件 灵格斯</h3><p>下载地址<a href="http://www.lingoes.cn/" target="_blank" rel="noopener">http://www.lingoes.cn/</a></p><h3 id="coreldrawx7破解版">CorelDRAWX7破解版</h3><p>下载地址[百度网盘]（http://pan.baidu.com/s/1ntVwlgH）<br>断网注册</p><h3 id="xmind7破解版">XMIND7破解版</h3><p>下载地址<a href="http://pan.baidu.com/s/1i3OdeVr" target="_blank" rel="noopener">百度网盘</a></p>]]></content>
      
      
      <categories>
          
          <category> 办公 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>硬链接软链接方式</title>
      <link href="/2016/11/08/%E7%A1%AC%E9%93%BE%E6%8E%A5%E8%BD%AF%E9%93%BE%E6%8E%A5%E6%96%B9%E5%BC%8F/"/>
      <url>/2016/11/08/%E7%A1%AC%E9%93%BE%E6%8E%A5%E8%BD%AF%E9%93%BE%E6%8E%A5%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="硬链结和符号链接的区别">硬链结和符号链接的区别</h3><p>硬连接记录的是目标的 inode,符号连接记录的是目标的 path。<br>软连接就像是快捷方式,而硬连接就像是备份!符号连接可以做跨分区的 link；而 硬连接由于 inode 的缘故，只能在本分区中做 link.所以,符号连接的使用频率要高的多。</p><h3 id="软链接文件">软链接文件</h3><p>软链接又叫符号链接，这个文件包含了另一个文件的路径名。可以是任意文件或目录，可以链接不同文件系统的文件。和win下的快捷方式差不多。链接文件甚至可以链接不存在的文件，这就产生一般称之为"断链"的问题(或曰“现象")，链接文件甚至可以循环链接自己。类似于编程语言中的递归。 命令格式：</p><pre><code>ln [-s] source_path target_path </code></pre><h3 id="硬链接文件">硬链接文件</h3><p>info ln 命令告诉您，硬链接是已存在文件的另一个名字，硬连接的命令是</p><pre><code>ln -d existfile newfile </code></pre><p>硬链接文件有两个限制 1、不允许给目录创建硬链接；<br>2、只有在同一文件系统中的文件之间才能创建链接。<br>对硬链接文件进行读写和删除操作时候，结果和软链接相同。但如果我们删除硬链接文件的源文件，硬链接文件仍然存在，而且保留了愿有的内容。这时，系统就“忘记”了它曾经是硬链接文件。而把他当成一个普通文件。修改其中一个，与其连接的文件同时被修改</p><h3 id="windows-下创建硬链接只能适用于-ntfs-文件系统">Windows 下创建硬链接，只能适用于 NTFS 文件系统</h3><pre><code>fsutil hardlink create NewFileName ExistingFileName</code></pre><h3 id="windows-下创建软链接">Windows 下创建软链接</h3><p>NTFS只支持对目录的软链接，微软把它称作 junction。但是对于文件的软链接，微软也有提供解决方案，那就是快捷方式(Shortcut，.lnk 文件)。不过软链接和快捷方式不是一个层次上的东西，前者是底层文件系统的功能，后者是应用层的功能。Windows 下目录的快捷方式用 dir 看起来是个文件。<br>命令方式</p><pre><code>junction  LinkDirectory ExistingDirectory</code></pre><p>例如</p><pre><code>junction d:\link c:\winnt</code></pre><p>将为c:\winnt 建立一个链接目录 d:\link，C和D分区都要是 NTFS 格式，在资源管理器和 dir 列示中 d:\link 都以目录的面目存在的。d:\link 就像是 c:\winnt 的一个引用一般，删除 d:\link 目录中的内容也就是删除了 c:\winnt 中的内容，但删除 d:\link 本身是不会影响到 c:\winnt 的。</p><h3 id="win7可以使用mklink命令">win7可以使用mklink命令</h3><pre><code>λ mklink /?创建符号链接。MKLINK [[/D] | [/H] | [/J]] Link Target        /D      创建目录符号链接。默认为文件                符号链接。        /H      创建硬链接而非符号链接。        /J      创建目录联接。        Link    指定新的符号链接名称。        Target  指定新链接引用的路径                (相对或绝对)。</code></pre><p>其中\D \J区别如下</p><pre><code>E:\λ mkdir SourceDirE:\λ mklink /D DTargetDir\ SourceDir\为 DTargetDir\ &lt;&lt;===&gt;&gt; SourceDir\ 创建的符号链接E:\λ mklink /J JTargetDir\ SourceDir\为 JTargetDir\ &lt;&lt;===&gt;&gt; SourceDir\ 创建的联接</code></pre><p><img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160127111417.png"> <img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160127111459.png"> SourceDir,JTargetDir,DTargetDir 3个文件夹内部修改/增加/删除都会互相影响。<br>复制JTargetDir, 不会出现新的目录，文件夹文件内部复制 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160127112544.png"> 这样复制会影响DTargetDir和SourceDir，慎用！ 复制DTargetDir文件夹会生成一个全新的文件夹，不会被其他文件夹影响，也不能影响其他文件夹。 复制JTargetDir的父级目录不会影响该目录，复制生成的目录下JTargetDir目录会变成独立的文件夹且文件夹内为空 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160127132448.png"> ![][0.048387699760496616] [0.048387699760496616]: http://7xq3ry.com1.z0.glb.clouddn.com/20160127132633.png 删除JTargetDir,DTargetDir均不影响SourceDir<br>删除SorceDir,会使得JTargetDir和DTargetDir失效 使用mklink /D时需要保证源目录和目标目录在同一个目录下，否则创建成功但不能正常访问</p><h3 id="linux服务器的软硬件链接">linux服务器的软硬件链接</h3><p>软链接可以跨文件系统，硬链接不可以</p><pre><code>ln source target # 硬链接ln -s source target # 软链接</code></pre><p>软链接如果跨文件夹，必须使用绝对路径,否则会出现软链接无法访问的情况</p><pre><code>ln -s /var/www/html/Upload/product/manual/en/ /var/www/html/manual</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php将pdf转为jpg，png图片</title>
      <link href="/2016/11/08/Php%E5%B0%86pdf%E8%BD%AC%E4%B8%BAjpg%EF%BC%8Cpng%E5%9B%BE%E7%89%87/"/>
      <url>/2016/11/08/Php%E5%B0%86pdf%E8%BD%AC%E4%B8%BAjpg%EF%BC%8Cpng%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<h3 id="环境">环境</h3><p>WINDOW,PHP5.2</p><h3 id="安装">安装</h3><p>安装ImageMagick并添加环境变量 <a href="http://www.imagemagick.org/script/index.php" target="_blank" rel="noopener">官网</a><br>安装php扩展php_imagick.dll,并在php.ini开启 <a href="https://pecl.php.net/package/imagick" target="_blank" rel="noopener">官网</a><br>查看是否载入扩展</p><pre><code>phpinfo();</code></pre><p>安装Ghostscript并添加环境变量 <a href="http://www.ghostscript.com/download/" target="_blank" rel="noopener">官网</a></p><h3 id="下载地址">下载地址</h3><p><a href="http://pan.baidu.com/s/1kTOkhFL" target="_blank" rel="noopener">百度网盘</a></p><h3 id="测试是否可以正常运行">测试是否可以正常运行</h3><pre><code>λ convert.exe SEZ588Hu.pdf SEZ588Hu.png</code></pre><h3 id="php代码">php代码</h3><p>生成jpg文件 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $im = <span class="keyword">new</span> imagick(<span class="string">'A.pdf[0]'</span>);</span><br><span class="line">    $im-&gt;setImageFormat(<span class="string">'jpg'</span>);</span><br><span class="line">    $im-&gt;writeImages(<span class="string">'A.jpg'</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>或者直接输出到浏览器</p><div class="sourceCode" id="cb3"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">&lt;?php</span></span><span id="cb3-2"><a href="#cb3-2"></a>    <span class="kw">$im</span> = <span class="kw">new</span> <span class="kw">imagick</span><span class="ot">(</span><span class="st">&#39;file.pdf[0]&#39;</span><span class="ot">);</span></span><span id="cb3-3"><a href="#cb3-3"></a>    <span class="kw">$im</span>-&gt;setImageFormat<span class="ot">(</span><span class="st">&#39;jpg&#39;</span><span class="ot">);</span></span><span id="cb3-4"><a href="#cb3-4"></a>    <span class="fu">header</span><span class="ot">(</span><span class="st">&#39;Content-Type: image/jpeg&#39;</span><span class="ot">);</span></span><span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">echo</span> <span class="kw">$im</span><span class="ot">;</span></span><span id="cb3-6"><a href="#cb3-6"></a><span class="kw">?&gt;</span></span></code></pre></div><h3 id="错误处理">错误处理</h3><p>1，将Ghostscript64位卸载，安装32位<br>2，将php.ini里的upload_tmp_dir对应目录权限修改为IISUER可读写</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>oracle virtualbox入门基础</title>
      <link href="/2016/11/08/Oracle%20virtualbox%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
      <url>/2016/11/08/Oracle%20virtualbox%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="安装和主机共享">安装和主机共享</h3><blockquote><p>点击设备，安装增强功能</p></blockquote><h3 id="共享剪贴板">共享剪贴板</h3><blockquote><p>点击设备，共享剪贴板，双向</p></blockquote><h3 id="快捷键">快捷键</h3><blockquote><p>显示客户机菜单 右Ctrl+C 全屏快捷键 右Ctrl+F</p></blockquote><h3 id="中网络连接形式以下内容来自网络">4中网络连接形式(以下内容来自网络)</h3><p><strong>第一种 NAT模式</strong><br>解释： NAT模式是最简单的实现虚拟机上网的方式，你可以这样理解：Vhost访问网络的所有数据都是由主机提供的，vhost并不真实存在于网络中，主机与网络中的任何机器都不能查看和访问到Vhost的存在。<br>虚拟机与主机关系：<br>只能单向访问，虚拟机可以通过网络访问到主机，主机无法通过网络访问到虚拟机。<br>虚拟机与网络中其他主机的关系：<br>只能单向访问，虚拟机可以访问到网络中其他主机，其他主机不能通过网络访问到虚拟机。<br>虚拟机与虚拟机之间的关系：<br>相互不能访问，虚拟机与虚拟机各自完全独立，相互间无法通过网络访问彼此。<br>IP:10.0.2.15<br>网关：10.0.2.2<br>DNS：10.0.2.3<br>一台虚拟机的多个网卡可以被设定使用 NAT， 第一个网卡连接了到专用网 10.0.2.0，第二个网卡连接到专用网络 10.0.3.0，等等。默认得到的客户端ip（IP Address）是10.0.2.15，网关（Gateway）是10.0.2.2，域名服务器（DNS）是10.0.2.3，可以手动参考这个进行修改。<br>NAT方案优缺点：<br>笔记本已插网线时： 虚拟机可以访问主机，虚拟机可以访问互联网，在做了端口映射后（最后有说明），主机可以访问虚拟机上的服务（如数据库）。<br>笔记本没插网线时： 主机的“本地连接”有红叉的，虚拟机可以访问主机，虚拟机不可以访问互联网，在做了端口映射后，主机可以访问虚拟机上的服务（如数据库）。 <strong>第二种 Bridged Adapter模式</strong><br>解释：<br>网桥模式是我最喜欢的用的一种模式，同时，模拟度也是相当完美。你可以这样理解，它是通过主机网卡，架设了一条桥，直接连入到网络中了。因此，它使得虚拟机能被分配到一个网络中独立的IP，所有网络功能完全和在网络中的真实机器一样。<br>虚拟机与主机关系：<br>可以相互访问，因为虚拟机在真实网络段中有独立IP，主机与虚拟机处于同一网络段中，彼此可以通过各自IP相互访问。<br>虚拟机于网络中其他主机关系：<br>可以相互访问，同样因为虚拟机在真实网络段中有独立IP，虚拟机与所有网络其他主机处于同一网络段中，彼此可以通过各自IP相互访问。<br>虚拟机于虚拟机关系：<br>可以相互访问，原因同上。<br>IP：一般是DHCP分配的，与主机的“本地连接”的IP 是同一网段的。虚拟机就能与主机互相通信。<br>笔记本已插网线时：（若网络中有DHCP服务器）主机与虚拟机会通过DHCP分别得到一个IP，这两个IP在同一网段。 主机与虚拟机可以ping通，虚拟机可以上互联网。<br>笔记本没插网线时：主机与虚拟机不能通信。主机的“本地连接”有红叉，就不能手工指定IP。虚拟机也不能通过DHCP得到IP地址，手工指定IP后，也无法与主机通信，因为主机无IP。<br>这时主机的VirtualBox Host-Only Network 网卡是有ip的，192.168.56.1。虚拟机就算手工指定了IP 192.168.56.<em>，也ping不能主机。 <strong>第三种 Internal模式</strong><br>解释：<br>内网模式，顾名思义就是内部网络模式，虚拟机与外网完全断开，只实现虚拟机于虚拟机之间的内部网络模式。<br>虚拟机与主机关系：<br>不能相互访问，彼此不属于同一个网络，无法相互访问。<br>虚拟机与网络中其他主机关系：<br>不能相互访问，理由同上。<br>虚拟机与虚拟机关系：<br>可以相互访问，前提是在设置网络时，两台虚拟机设置同一网络名称。如上配置图中，名称为intnet。<br>IP: VirtualBox的DHCP服务器会为它分配IP ，一般得到的是192.168.56.101，因为是从101起分的，也可手工指定192.168.56.</em>。<br>笔记本已插网线时：虚拟机可以与主机的VirtualBox Host-Only Network 网卡通信<br>这种方案不受主机本地连接（网卡）是否有红叉的影响。 <strong>第四种 Host-only Adapter模式</strong><br>解释：<br>主机模式，这是一种比较复杂的模式，需要有比较扎实的网络基础知识才能玩转。可以说前面几种模式所实现的功能，在这种模式下，通过虚拟机及网卡的设置都可以被实现。<br>我们可以理解为Vbox在主机中模拟出一张专供虚拟机使用的网卡，所有虚拟机都是连接到该网卡上的，我们可以通过设置这张网卡来实现上网及其他很多功能，比如（网卡共享、网卡桥接等）。<br>虚拟机与主机关系<br>默认不能相互访问，双方不属于同一IP段，host-only网卡默认IP段为192.168.56.X 子网掩码为255.255.255.0，后面的虚拟机被分配到的也都是这个网段。通过网卡共享、网卡桥接等，可以实现虚拟机于主机相互访问。<br>虚拟机与网络主机关系<br>默认不能相互访问，原因同上，通过设置，可以实现相互访问。<br>虚拟机与虚拟机关系<br>默认可以相互访问，都是同处于一个网段。<br>虚拟机访问主机 用的是主机的VirtualBox Host-Only Network网卡的IP：192.168.56.1 ，不管主机“本地连接”有无红叉，永远通。<br>主机访问虚拟机，用是的虚拟机的网卡3的IP： 192.168.56.101 ，不管主机“本地连接”有无红叉，永远通。<br>虚拟机访问互联网，用的是自己的网卡2， 这时主机要能通过“本地连接”有线上网，（无线网卡不行） 通过对以上几种网络模式的了解，我们就可以灵活运用，模拟组建出我们所想要的任何一种网络环境了。<br>比如我想模拟出来一个一台主机，监控一个局域网上网情况的网络环境。<br>首先我开启了两台虚拟机vhost1与vhost2，当然如果硬件允许，我同样可以再增加vhost3、vhost4…<br>所有的vhost我都设置成internat内网模式，网络名称为intnal，网关为192.168.56.100，意思就是通过 192.168.56.100网卡上网。其中有一台vhost1我设置为双网卡，一张为内网模式（192.168.56.100），一张为网桥模式 （192.168.1.101）。两张网卡设置双网卡共享上网<br>虚拟机之间为局域网，其中有一台虚拟机vhost1通过与外网相连，所有局域网中的虚拟机又通过vhost1来实现上外网。这样vhost1就可以监控整个虚拟机局域网上网情况了。</p><h3 id="xp下全屏">xp下全屏</h3><p>安装增强包后再全局设置里设置成本机的分辨率 <img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160119172333.png"></p><h3 id="ubuntu全屏">Ubuntu全屏</h3><p>首先，安装增强包，点击Run Software<img src="http://7xq3ry.com1.z0.glb.clouddn.com/20160114170837.png"> 重启虚拟机<br>点击设备-&gt;分配光驱-&gt;移除虚拟盘<br>点击 右Ctrl+F全屏快捷键</p><h3 id="ubuntu设置桥接网卡">Ubuntu设置桥接网卡</h3><p>在设置-&gt;网络-&gt;连接方式-&gt;桥接网卡</p><pre><code>sudo vim /etc/network/interfaces</code></pre><p>修改配置文件,对应的信息要和主机的一致，保证虚拟机和主机在同一IP段</p><pre><code># The primary network interfaceauto eth0iface eth0 inet staticaddress 192.168.2.1gateway 192.168.2.254netmask 255.255.255.0#network 192.168.2.0#broadcast 192.168.2.255</code></pre><p>重启</p><pre><code>sudo /etc/init.d/networking restart</code></pre><p>在主机中设置上级路由器，放行虚拟机的MAC地址保证虚拟机可以访问外网。</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
